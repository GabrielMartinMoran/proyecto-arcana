import"./DsnmJJEf.js";import{p as F,b as P,ab as W,t as O,K as I,j as a,a as C,d as E,e as b,g as i,bf as we,r as c,f as K,aa as $,J as ee,Y as Me,aT as Se,c as Ne}from"./DWCm9pug.js";import{d as L,s as j,a as qe,o as be,e as Re}from"./Cr_WvuOy.js";import{i as T}from"./DAwWLKW0.js";import{r as Ie,s as te,e as X}from"./9dkhkBLf.js";import{c as ze}from"./W-LzVpAM.js";import{b as _e,s as Y}from"./BkiENg0Z.js";import{p as D}from"./eoMlQPJr.js";import{c as z,u as Te,a as me,b as oe,C as De,d as Fe,e as Ee,f as ce,I as q}from"./B9j_VgLP.js";import{g as Q}from"./DQyq_pEW.js";import{a as ye,u as We}from"./8iG_Nq0v.js";import{c as He}from"./CGjaQNWU.js";import{g as je}from"./Ch-wVOzj.js";import{r as Oe}from"./B1RTRjFS.js";import{b as Ge}from"./DFxZkHn7.js";var Ue=(r,t,e)=>t.onChange(a(e)),Le=P('<input type="text" class="svelte-19nbfo1"/>');function fe(r,t){F(t,!0);let e=D(t,"placeholder",3,void 0),n=W(()=>t.value);var l=Le();Ie(l),l.__input=[Ue,t,n],O(()=>{te(l,"placeholder",e()),l.disabled=t.readonly}),_e(l,()=>a(n),_=>I(n,_)),C(r,l),E()}L(["input"]);var Ve=P("<label> </label>"),Be=(r,t,e)=>t.onChange(a(e)),Je=P("<div><!> <div><textarea></textarea></div></div>");function ie(r,t){F(t,!0);const e=6;let n=D(t,"label",3,void 0),l=D(t,"placeholder",3,""),_=D(t,"maxRows",3,e),w=W(()=>t.value);var p=Je();let S;var A=b(p);{var m=d=>{var o=Ve(),h=b(o,!0);c(o),O(()=>j(h,n())),C(d,o)};T(A,d=>{n()&&d(m)})}var s=i(A,2);let k;var g=b(s);we(g),g.__input=[Be,t,w];let y;c(s),c(p),O((d,o,h)=>{S=Y(p,1,"fieldgroup svelte-o02g58",null,S,d),k=Y(s,1,"field svelte-o02g58",null,k,o),g.disabled=t.readonly,te(g,"placeholder",l()),te(g,"rows",_()==="unlimited"?void 0:_()),y=Y(g,1,"svelte-o02g58",null,y,h)},[()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"})]),_e(g,()=>a(w),d=>I(w,d)),C(r,p),E()}L(["input"]);var Ke=P('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),Ye=P("<!> <!>",1);function Qe(r,t){F(t,!0);let e=D(t,"character",7);var n=Ye(),l=K(n);{var _=p=>{z(p,{children:(S,A)=>{var m=Ke(),s=b(m);c(m),O(()=>{te(s,"src",e().img),te(s,"alt",e().name)}),C(S,m)},$$slots:{default:!0}})};T(l,p=>{e().img&&p(_)})}var w=i(l,2);z(w,{children:(p,S)=>{ie(p,{label:"Historia",get value(){return e().story},get readonly(){return t.readonly},onChange:A=>{e().story=A,t.onChange(e())}})},$$slots:{default:!0}}),C(r,n),E()}var Xe=(r,t)=>t("ability"),Ze=(r,t)=>t("item"),$e=P('<!> <div class="controls svelte-o497rd"><span class="svelte-o497rd">Agregar cartas a tu colecci√≥n</span> <div class="buttons svelte-o497rd"><button>Agregar Carta de Habilidad</button> <button>Agregar Carta de Objeto M√°gico</button></div></div>',1),et=P('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),tt=P('<div class="cards-tab svelte-o497rd"><!> <!> <!></div> <div class="add-card-modal svelte-o497rd"><div class="all-cards svelte-o497rd"><!> <div class="cards-viewport svelte-o497rd"><!></div></div> <div class="footer svelte-o497rd"><span class="results-count"> </span> <button>Cerrar</button></div></div>',1);function at(r,t){F(t,!0);let e=D(t,"character",7),{loadAbilityCards:n,abilityCards:l,loadItemCards:_,itemCards:w}=me(),{rollExpression:p}=ye();const{buildEmptyFilters:S}=Te();let A=$(ee(S({onlyAvailables:!0}))),m=$(ee([])),s=$(ee({opened:!1,filteredCards:[],allCards:[]}));const k=l.subscribe(()=>{I(s,{...a(s),allCards:[],filteredCards:[]},!0)});qe(()=>{k()}),be(async()=>{await Promise.all([_(),n()]),I(m,[...Q(w),...Q(l)],!0)});const g=R=>{e().cards=R,t.onChange(e())},y=async R=>{const H=e().cards.find(U=>U.id===R),B=a(m).find(U=>U.id===R);H&&B&&H.uses!==null&&B&&await p({expression:"1d6",variables:{},title:`${e().name}: Recarga de carta ${B.name}`,resultFormatter:J=>`<span class="total ${J>=(B.uses?.qty??0)?"success":"failure"}">${J}</span>`})>=(B.uses?.qty??0)&&(H.uses+=1,g([...e().cards]))},d=R=>{I(A,R,!0),I(s,{...a(s),filteredCards:ce(a(s).allCards,a(A),e())},!0)},o=()=>{d(S({onlyAvailables:!0}))},h=R=>{setTimeout(()=>{const H=R==="ability"?Q(l):Q(w);I(s,{opened:!0,filteredCards:ce(H,a(A),e()),allCards:H},!0)},0)},x=()=>{I(s,{opened:!1,filteredCards:[],allCards:[]},!0)};var u=tt(),v=K(u),f=b(v);{var M=R=>{z(R,{children:(H,B)=>{var U=$e(),J=K(U);q(J,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return e().maxActiveCards},get readonly(){return t.readonly},fullWidth:!0,onChange:Ae=>{e().maxActiveCards=Number(Ae),t.onChange(e())}});var re=i(J,2),ve=i(b(re),2),ue=b(ve);ue.__click=[Xe,h];var pe=i(ue,2);pe.__click=[Ze,h],c(ve),c(re),C(H,U)},$$slots:{default:!0}})};T(f,R=>{t.readonly||R(M)})}var N=i(f,2);z(N,{get title(){return`Cartas Activas (${e().numActiveCards??""}/${e().maxActiveCards??""})`},children:(R,H)=>{{let B=W(()=>a(m).filter(U=>e().cards.some(J=>J.isActive&&J.id===U.id)));oe(R,{get cards(){return a(B)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"active",onChange:g,onCardReloadClick:y})}},$$slots:{default:!0}});var G=i(N,2);{let R=W(()=>`Colecci√≥n (${e().cards.length})`);z(G,{get title(){return a(R)},children:(H,B)=>{{let U=W(()=>a(m).filter(J=>e().cards.some(re=>re.id===J.id)));oe(H,{get cards(){return a(U)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"collection",onChange:g})}},$$slots:{default:!0}})}c(v);var V=i(v,2),Z=b(V),ne=b(Z);De(ne,{get cards(){return a(s).filteredCards},onFiltersChange:d,onResetFilters:o,get filters(){return a(A)},includeOnlyAvailablesFilter:!0});var se=i(ne,2),he=b(se);{var Ce=R=>{{let H=W(()=>a(s).filteredCards.filter(B=>e().cards.find(U=>U.id===B.id)===void 0));oe(R,{get cards(){return a(H)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"all",onChange:g})}},Pe=R=>{var H=et();C(R,H)};T(he,R=>{a(s).filteredCards.length>0?R(Ce):R(Pe,!1)})}c(se),c(Z);var de=i(Z,2),le=b(de),ke=b(le);c(le);var xe=i(le,2);xe.__click=x,c(de),c(V),Fe(V,R=>Ee?.(R)),O(()=>{te(V,"hidden",!a(s).opened),j(ke,`${a(s).filteredCards.length??""}
			${a(s).filteredCards.length===1?"resultado":"resultados"}`)}),Re("outsideclick",V,x),C(r,u),E()}L(["click"]);const nt=(r,t,e,n,l,_)=>{const w={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};n().goldHistory.unshift(w),l.onChange(n()),_()},rt=(r,t,e,n,l,_)=>{const w={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};n().goldHistory.unshift(w),l.onChange(n()),_()};var lt=P('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ot=P('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Raz√≥n</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),it=(r,t,e)=>t(a(e)),st=P('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),dt=P('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),vt=P('<div class="history svelte-ssntdk"></div>'),ut=P("<!> <!> <!>",1);function ct(r,t){F(t,!0);const e="Sin raz√≥n especifica";let n=D(t,"character",7),l=ee({quantity:1,reason:""});const _=()=>{l.quantity=1,l.reason=""},w=k=>{n().goldHistory=n().goldHistory.filter(g=>g.id!==k.id),t.onChange(n())};var p=ut(),S=K(p);z(S,{title:"Estado Actual",children:(k,g)=>{var y=lt(),d=b(y),o=i(b(d),2);let h;var x=b(o,!0);c(o),c(d);var u=i(d,2),v=i(b(u),2),f=b(v,!0);c(v),c(u),c(y),O(M=>{h=Y(o,1,"number svelte-ssntdk",null,h,M),j(x,n().currentGold),j(f,n().spentGold)},[()=>({negative:n().currentGold<0})]),C(k,y)},$$slots:{default:!0}});var A=i(S,2);{var m=k=>{z(k,{title:"Actualizar Oro",children:(g,y)=>{var d=ot(),o=i(b(d),2),h=b(o);q(h,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:f=>{l.quantity=Number(f)}});var x=i(h,2);q(x,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:f=>{l.reason=f.toString()}});var u=i(x,2);u.__click=[rt,l,e,n,t,_];var v=i(u,2);v.__click=[nt,l,e,n,t,_],c(o),c(d),C(g,d)},$$slots:{default:!0}})};T(A,k=>{t.readonly||k(m)})}var s=i(A,2);z(s,{title:"Historial",children:(k,g)=>{var y=vt();X(y,21,()=>n().goldHistory,d=>d.id,(d,o)=>{var h=st(),x=b(h);let u;var v=b(x);c(x);var f=i(x,2),M=b(f,!0);c(f);var N=i(f,2);N.__click=[it,w,o],c(h),O(G=>{u=Y(x,1,"log-amount svelte-ssntdk",null,u,G),j(v,`${a(o).type==="add"?"+":"-"}${a(o).value??""} Oro`),j(M,a(o).reason)},[()=>({positive:a(o).type==="add",negative:a(o).type==="subtract"})]),C(d,h)},d=>{var o=dt();C(d,o)}),c(y),C(k,y)},$$slots:{default:!0}}),C(r,p),E()}L(["click"]);const gt=(r,t,e)=>{t([...t(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),e.onChange(t())};var bt=P('<button title="Agregar Ataque">‚ûï</button>'),_t=(r,t,e)=>t(a(e)),mt=P('<button title="Eliminar" class="svelte-1v2w3y3">üóëÔ∏è</button>'),yt=P('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),ft=P('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Da√±o</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function ht(r,t){F(t,!0);let e=D(t,"attacks",7);const n=m=>{e(e().filter(s=>s.id!==m.id)),t.onChange(e())};var l=ft(),_=b(l),w=i(b(_),2);{var p=m=>{var s=bt();s.__click=[gt,e,t],C(m,s)};T(w,m=>{t.readonly||m(p)})}c(_);var S=i(_,2),A=i(b(S),2);X(A,17,e,m=>m.id,(m,s,k)=>{var g=yt(),y=b(g);q(y,{get value(){return a(s).name},get readonly(){return t.readonly},placeholder:"Nombre",fullWidth:!0,onChange:v=>{a(s).name=v.toString(),t.onChange(e())}});var d=i(y,2);{let v=W(()=>({icon:"üéØ",title:"Tirar Ataque",onClick:()=>t.onAttackRoll(a(s)),disabled:!a(s).atkFormula}));q(d,{get value(){return a(s).atkFormula},get readonly(){return t.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:f=>{a(s).atkFormula=f.toString(),t.onChange(e())},get button(){return a(v)}})}var o=i(d,2);{let v=W(()=>({icon:"üí•",title:"Tirar Da√±o",onClick:()=>t.onDamageRoll(a(s)),disabled:!a(s).dmgFormula}));q(o,{get value(){return a(s).dmgFormula},get readonly(){return t.readonly},placeholder:"1d4",fullWidth:!0,onChange:f=>{a(s).dmgFormula=f.toString(),t.onChange(e())},get button(){return a(v)}})}var h=i(o,2);q(h,{get value(){return a(s).notes},get readonly(){return t.readonly},placeholder:"Contundente",fullWidth:!0,onChange:v=>{a(s).notes=v.toString(),t.onChange(e())}});var x=i(h,2);{var u=v=>{var f=mt();f.__click=[_t,n,s],C(v,f)};T(x,v=>{t.readonly||v(u)})}c(g),C(m,g)}),c(S),c(l),C(r,l),E()}L(["click"]);function ae(r,t){F(t,!0);{let e=W(()=>({icon:"üé≤",onClick:t.onDiceRoll,title:"Tirar"}));q(r,{get label(){return t.name},get value(){return t.value},get readonly(){return t.readonly},onChange:n=>t.onChange(Number(n)),get button(){return a(e)}})}E()}const Ct=(r,t,e)=>{t([...t(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),e.onChange(t())};var Pt=P('<button title="Agregar Item">‚ûï</button>'),kt=(r,t,e)=>t(a(e)),xt=P('<button title="Eliminar">üóëÔ∏è</button>'),pt=P('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),At=P('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="quantity svelte-1ewnrao">Cantidad</label> <label class="name svelte-1ewnrao">Nombre</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function wt(r,t){F(t,!0);let e=D(t,"equipment",7);const n=m=>{e(e().filter(s=>s.id!==m.id)),t.onChange(e())};var l=At(),_=b(l),w=i(b(_),2);{var p=m=>{var s=Pt();s.__click=[Ct,e,t],C(m,s)};T(w,m=>{t.readonly||m(p)})}c(_);var S=i(_,2),A=i(b(S),2);X(A,17,e,m=>m.id,(m,s,k)=>{var g=pt(),y=b(g);q(y,{get value(){return a(s).quantity},get readonly(){return t.readonly},onChange:u=>{a(s).quantity=Number(u),t.onChange(e())}});var d=i(y,2);q(d,{get value(){return a(s).name},get readonly(){return t.readonly},placeholder:"Nombre",onChange:u=>{a(s).name=u.toString(),t.onChange(e())}});var o=i(d,2);q(o,{get value(){return a(s).notes},get readonly(){return t.readonly},placeholder:"Notas",fullWidth:!0,onChange:u=>{a(s).notes=u.toString(),t.onChange(e())}});var h=i(o,2);{var x=u=>{var v=xt();v.__click=[kt,n,s],C(u,v)};T(h,u=>{t.readonly||u(x)})}c(g),C(m,g)}),c(S),c(l),C(r,l),E()}L(["click"]);var Mt=P('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),St=P('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Nt=P('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),qt=P('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Rt=P('<div class="empty svelte-ox7hjw"><em>El equipo esta vac√≠o.</em></div>'),It=P('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),zt=P("<!> <!> <!> <!>",1);function Tt(r,t){F(t,!0);let e=D(t,"character",7),{rollExpression:n,rollModal:l}=ye();const _=g=>{l.openRollModal({expression:`1d6e+${g}`,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence,iniciativa:e().initiative},title:`${e().name}: ${He(g)}`})},w=g=>{l.openRollModal({expression:g.atkFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Ataque con ${g.name}`})},p=g=>{n({expression:g.dmgFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Da√±o de ${g.name}`})};var S=zt(),A=K(S);z(A,{title:"Atributos Principales",children:(g,y)=>{var d=Mt(),o=b(d);ae(o,{name:"Cuerpo",get value(){return e().attributes.body},get readonly(){return t.readonly},onDiceRoll:()=>_("cuerpo"),onChange:M=>{e().attributes.body=M,t.onChange(e())}});var h=i(o,2);ae(h,{name:"Reflejos",get value(){return e().attributes.reflexes},get readonly(){return t.readonly},onDiceRoll:()=>_("reflejos"),onChange:M=>{e().attributes.reflexes=M,t.onChange(e())}});var x=i(h,2);ae(x,{name:"Mente",get value(){return e().attributes.mind},get readonly(){return t.readonly},onDiceRoll:()=>_("mente"),onChange:M=>{e().attributes.mind=M,t.onChange(e())}});var u=i(x,2);ae(u,{name:"Instinto",get value(){return e().attributes.instinct},get readonly(){return t.readonly},onDiceRoll:()=>_("instinto"),onChange:M=>{e().attributes.instinct=M,t.onChange(e())}});var v=i(u,2);ae(v,{name:"Presencia",get value(){return e().attributes.presence},get readonly(){return t.readonly},onDiceRoll:()=>_("presencia"),onChange:M=>{e().attributes.presence=M,t.onChange(e())}});var f=i(v,2);q(f,{label:"Suerte",get value(){return e().currentLuck},get max(){return e().maxLuck},get readonly(){return t.readonly},onChange:M=>{e().currentLuck=Number(M),t.onChange(e())}}),c(d),C(g,d)},$$slots:{default:!0}});var m=i(A,2);z(m,{title:"Atributos Derivados",children:(g,y)=>{var d=St(),o=b(d);q(o,{label:"Salud",get value(){return e().currentHP},get max(){return e().maxHP},get readonly(){return t.readonly},onChange:N=>{e().currentHP=Number(N),t.onChange(e())}});var h=i(o,2);q(h,{label:"Salud Temporal",get value(){return e().tempHP},get readonly(){return t.readonly},onChange:N=>{e().tempHP=Number(N),t.onChange(e())}});var x=i(h,2);q(x,{label:"Velocidad",get value(){return e().speed},readonly:!0});var u=i(x,2);q(u,{label:"Esquiva",get value(){return e().evasion},readonly:!0});var v=i(u,2);q(v,{label:"Mitigaci√≥n F√≠sica",get value(){return e().physicalMitigation},readonly:!0});var f=i(v,2);q(f,{label:"Mitigaci√≥n M√°gica",get value(){return e().magicalMitigation},readonly:!0});var M=i(f,2);q(M,{label:"Iniciativa",get value(){return e().initiative},readonly:!0,button:{icon:"üé≤",title:"Tirar iniciativa",onClick:()=>_("iniciativa")}}),c(d),C(g,d)},$$slots:{default:!0}});var s=i(m,2);z(s,{title:"Informaci√≥n",children:(g,y)=>{var d=qt(),o=b(d);ht(o,{get attacks(){return e().attacks},get readonly(){return t.readonly},onChange:f=>{e().attacks=f,t.onChange(e())},onAttackRoll:w,onDamageRoll:p});var h=i(o,2);{var x=f=>{var M=Nt();C(f,M)};T(h,f=>{e().attacks.length===0&&f(x)})}var u=i(h,2);ie(u,{label:"Informaci√≥n R√°pida",get value(){return e().quickInfo},get readonly(){return t.readonly},placeholder:"Informaci√≥n general, habilidades, etc.",onChange:f=>{e().quickInfo=f,t.onChange(e())}});var v=i(u,2);q(v,{label:"Lenguas",get value(){return e().languages},get readonly(){return t.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:f=>{e().languages=f,t.onChange(e())}}),c(d),C(g,d)},$$slots:{default:!0}});var k=i(s,2);z(k,{title:"Equipo",children:(g,y)=>{var d=It(),o=b(d);q(o,{label:"Oro",get value(){return e().currentGold},readonly:!0,fullWidth:!0});var h=i(o,2);wt(h,{get equipment(){return e().equipment},get readonly(){return t.readonly},onChange:v=>{e().equipment=v,t.onChange(e())}});var x=i(h,2);{var u=v=>{var f=Rt();C(v,f)};T(x,v=>{e().equipment.length===0&&v(u)})}c(d),C(g,d)},$$slots:{default:!0}}),C(r,S),E()}const Dt=(r,t,e,n)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};I(t,[...a(t),l],!0),e.onChange(a(t)),n(l)};var Ft=(r,t,e)=>t(a(e)),Et=P('<div class="header svelte-z1ulbz"><button title="Agregar Nota">‚ûï</button> <button title="Eliminar Nota">üóëÔ∏è</button></div>'),Wt=(r,t,e)=>t(a(e)),Ht=P('<button><span class="svelte-z1ulbz"> </span></button>'),jt=P('<div class="notes svelte-z1ulbz"></div>'),Ot=P('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Gt=P('<div class="note svelte-z1ulbz"><!> <!></div>'),Ut=P('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Lt=P('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Vt(r,t){F(t,!0);let e=$(ee(t.notes)),n=$(void 0),l=W(()=>a(e).find(u=>u.id===a(n)));const _=u=>{I(n,u.id,!0)},w=u=>{u&&(I(e,a(e).filter(v=>v.id!==u),!0),I(n,void 0),t.onChange(a(e)))},p=()=>{I(e,[...a(e)],!0),t.onChange(a(e))};var S=Lt(),A=b(S),m=b(A);{var s=u=>{var v=Et(),f=b(v);f.__click=[Dt,e,t,_];var M=i(f,2);M.__click=[Ft,w,n],c(v),O(()=>M.disabled=!a(l)),C(u,v)};T(m,u=>{t.readonly||u(s)})}var k=i(m,2);{var g=u=>{var v=jt();X(v,21,()=>a(e),f=>f.id,(f,M)=>{var N=Ht();let G;N.__click=[Wt,_,M];var V=b(N),Z=b(V,!0);c(V),c(N),O(ne=>{G=Y(N,1,"note-btn svelte-z1ulbz",null,G,ne),j(Z,a(M).title||"Nota sin t√≠tulo")},[()=>({selected:a(n)===a(M).id})]),C(f,N)}),c(v),C(u,v)},y=u=>{var v=Ot();C(u,v)};T(k,u=>{a(e).length>0?u(g):u(y,!1)})}c(A);var d=i(A,2),o=b(d);{var h=u=>{var v=Gt(),f=b(v);fe(f,{get value(){return a(l).title},get readonly(){return t.readonly},placeholder:"T√≠tulo de la nota",onChange:N=>{a(l).title=N,p()}});var M=i(f,2);ie(M,{get value(){return a(l).content},get readonly(){return t.readonly},placeholder:"Contenido de la nota",onChange:N=>{a(l).content=N,p()},maxRows:"unlimited"}),c(v),C(u,v)},x=u=>{var v=Ut();C(u,v)};T(o,u=>{a(l)?u(h):u(x,!1)})}c(d),c(S),C(r,S),E()}L(["click"]);function Bt(r,t){F(t,!0);let e=D(t,"character",7);z(r,{title:"Notas",children:(n,l)=>{Vt(n,{get notes(){return e().notes},get readonly(){return t.readonly},onChange:_=>{e().notes=_,t.onChange(e())}})},$$slots:{default:!0}}),E()}const Jt=(r,t,e,n,l,_)=>{const w={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};n().ppHistory.unshift(w),l.onChange(n()),_()},Kt=(r,t,e,n,l,_)=>{const w={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};n().ppHistory.unshift(w),l.onChange(n()),_()};var Yt=P('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Rango del PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),Qt=P('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Raz√≥n</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),Xt=(r,t,e)=>t(a(e)),Zt=P('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),$t=P('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),ea=P('<div class="history svelte-1cdo061"></div>'),ta=P("<!> <!> <!>",1);function aa(r,t){F(t,!0);const e="Sin raz√≥n especifica";let n=D(t,"character",7),l=ee({quantity:1,reason:""});const _=()=>{l.quantity=1,l.reason=""},w=k=>{n().ppHistory=n().ppHistory.filter(g=>g.id!==k.id),t.onChange(n())};var p=ta(),S=K(p);z(S,{title:"Estado Actual",children:(k,g)=>{var y=Yt(),d=b(y),o=i(b(d),2);let h;var x=b(o,!0);c(o),c(d);var u=i(d,2),v=i(b(u),2),f=b(v,!0);c(v),c(u);var M=i(u,2),N=i(b(M),2),G=b(N,!0);c(N),c(M),c(y),O(V=>{h=Y(o,1,"number svelte-1cdo061",null,h,V),j(x,n().currentPP),j(f,n().spentPP),j(G,n().tier)},[()=>({negative:n().currentPP<0})]),C(k,y)},$$slots:{default:!0}});var A=i(S,2);{var m=k=>{z(k,{title:"Actualizar Progreso",children:(g,y)=>{var d=Qt(),o=i(b(d),2),h=b(o);q(h,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:f=>{l.quantity=Number(f)}});var x=i(h,2);q(x,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:f=>{l.reason=f.toString()}});var u=i(x,2);u.__click=[Kt,l,e,n,t,_];var v=i(u,2);v.__click=[Jt,l,e,n,t,_],c(o),c(d),C(g,d)},$$slots:{default:!0}})};T(A,k=>{t.readonly||k(m)})}var s=i(A,2);z(s,{title:"Historial",children:(k,g)=>{var y=ea();X(y,21,()=>n().ppHistory,d=>d.id,(d,o)=>{var h=Zt(),x=b(h);let u;var v=b(x);c(x);var f=i(x,2),M=b(f,!0);c(f);var N=i(f,2);N.__click=[Xt,w,o],c(h),O(G=>{u=Y(x,1,"log-amount svelte-1cdo061",null,u,G),j(v,`${a(o).type==="add"?"+":"-"}${a(o).value??""} PP`),j(M,a(o).reason)},[()=>({positive:a(o).type==="add",negative:a(o).type==="subtract"})]),C(d,h)},d=>{var o=$t();C(d,o)}),c(y),C(k,y)},$$slots:{default:!0}}),C(r,p),E()}L(["click"]);const na=(r,t)=>{let e="";if(e+=`# ${r.name}

`,e+=`## Atributos
`,e+=`- **Cuerpo:** ${r.attributes.body}
`,e+=`- **Reflejos:** ${r.attributes.reflexes}
`,e+=`- **Mente:** ${r.attributes.mind}
`,e+=`- **Instinto:** ${r.attributes.instinct}
`,e+=`- **Presencia:** ${r.attributes.presence}

`,e+=`- **Suerte:** ${r.currentLuck}/${r.maxLuck}
`,e+=`
`,e+=`## Atributos derivados
`,e+=`- **Salud:** ${r.currentHP}/${r.maxHP}
`,e+=`- **Salud Temporal:** ${r.tempHP}
`,e+=`- **Velocidad:** ${r.speed}
`,e+=`- **Esquiva:** ${r.evasion}
`,e+=`- **Mitigaci√≥n F√≠sica:** ${r.physicalMitigation}
`,e+=`- **Mitigaci√≥n M√°gica:** ${r.magicalMitigation}
`,e+=`- **Iniciativa:** ${r.initiative}
`,e+=`
`,r.quickInfo&&(e+=`## Informaci√≥n R√°pida
`,e+=`\`\`\`${r.quickInfo}
\`\`\`
`,e+=`
`),e+=`## Lenguas
`,e+=`${r.languages||"-"}
`,e+=`
`,e+=`## Oro
`,e+=`${r.currentGold}
`,e+=`
`,e+=`## Inventario
`,r.equipment.length>0){e+=`| Cantidad | Nombre | Notas |
`,e+=`| - | - | - |
`;for(const n of r.equipment)e+=`| ${n.quantity} | ${n.name} | ${n.notes} |
`}else e+=`__No hay items en el inventario.__
`;if(e+=`
`,e+=`## Cartas
`,e+=`**Cartas activas:** ${r.numActiveCards}${r.maxActiveCards}
`,e+=`### Colecci√≥n
`,r.cards.length>0){e+=`| Nombre | Tipo | Activa |
`,e+=`| - | - | - |
`;for(const n of r.cards){const l=t.find(_=>_.id===n.id);l&&(e+=`| ${l.name} | ${l.cardType==="item"?"Objeto M√°gico":"Habilidad"} | ${n.isActive?"Si":"No"} |
`)}}else e+=`__No hay cartas en la colecci√≥n.__
`;if(e+=`
`,e+=`## Progreso
`,e+=`- **PP Actuales:** ${r.currentPP}
`,e+=`- **PP Gastados:** ${r.spentPP}
`,e+=`- **Rango del Personaje:** ${r.tier}
`,e+=`
`,r.story&&(e+=`## Historia
`,e+=`${r.story}
`,e+=`
`),r.notes.length>0){e+=`## Notas del Jugador
`;for(const n of r.notes)e+=`### ${n.title}
`,e+=`\`\`\`${n.content}\`\`\`
`;e+=`
`}return e},ra=async(r,t)=>{try{await navigator.clipboard.writeText(a(t)),alert("Personaje en formato Markdown copiado al portapapeles!")}catch(e){console.error("Failed to copy text: ",e),alert("Error al copiar el markdown al portapapeles")}};var la=P('<div class="header svelte-1m8ejye"><label>Personaje</label> <button>Copiar Markdown</button></div> <pre class="svelte-1m8ejye"> </pre>',1);function oa(r,t){F(t,!0);let e=$(ee([])),{loadAbilityCards:n,abilityCards:l,loadItemCards:_,itemCards:w}=me(),p=W(()=>na(t.character,a(e)));be(async()=>{await Promise.all([_(),n()]),I(e,[...Q(w),...Q(l)],!0)}),z(r,{children:(S,A)=>{var m=la(),s=K(m),k=i(b(s),2);k.__click=[ra,p],c(s);var g=i(s,2),y=b(g,!0);c(g),O(()=>j(y,a(p))),C(S,m)},$$slots:{default:!0}}),E()}L(["click"]);var ia=(r,t,e)=>t()(a(e)),sa=P("<option> </option>"),da=P('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function ge(r,t){F(t,!0);let e=D(t,"onChange",3,()=>{}),n=W(()=>t.value);var l=da(),_=b(l);_.__change=[ia,e,n],X(_,21,()=>t.options,w=>w.label,(w,p)=>{var S=sa(),A=b(S,!0);c(S);var m={};O(()=>{j(A,a(p).label),m!==(m=a(p).value)&&(S.value=(S.__value=a(p).value)??"")}),C(w,S)}),c(_),c(l),Ge(_,()=>a(n),w=>I(n,w)),C(r,l),E()}L(["change"]);const va=(r,t,e)=>{t([...t(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),e.onChange(t())};var ua=(r,t,e)=>t(a(e)),ca=P('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">üóëÔ∏è</button></div>'),ga=P('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),ba=P('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">‚ûï</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Raz√≥n</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function _a(r,t){F(t,!0);let e=D(t,"modifiers",7);const n=A=>{e(e().filter(m=>m.id!==A.id)),t.onChange(e())};var l=ba(),_=b(l),w=i(b(_),2);w.__click=[va,e,t],c(_);var p=i(_,2),S=i(b(p),2);X(S,17,e,A=>A.id,(A,m,s)=>{var k=ca(),g=b(k);ge(g,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return a(m).type},onChange:x=>{a(m).type=x.toString(),t.onChange(e())}});var y=i(g,2);ge(y,{options:[{label:"Salud M√°xima",value:"maxHP"},{label:"Suerte M√°xima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigaci√≥n F√≠sica",value:"physicalMitigation"},{label:"Mitigaci√≥n M√°gica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return a(m).attribute},onChange:x=>{a(m).attribute=x.toString(),t.onChange(e())}});var d=i(y,2);q(d,{get value(){return a(m).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:x=>{a(m).formula=x.toString(),t.onChange(e())}});var o=i(d,2);q(o,{get value(){return a(m).reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:x=>{a(m).reason=x.toString(),t.onChange(e())}});var h=i(o,2);h.__click=[ua,n,m],c(k),C(A,k)},A=>{var m=ga();C(A,m)}),c(p),c(l),C(r,l),E()}L(["click"]);const ma=async(r,t)=>{const e=prompt("Introduce el ID del grupo al que quieres unirte:");e&&t(e)},ya=async(r,t)=>{confirm("¬øSeguro que quieres abandonar el grupo actual?")&&t(null)},fa=(r,t)=>{je(Oe(`/parties?partyId=${t().party.partyId}`))};var ha=P("<button>Unirse a un Grupo</button>"),Ca=P("<button>Abandonar Grupo</button> <button>Ver Grupo</button>",1),Pa=P('<div class="party svelte-1hn03u3"><!> <div class="buttons svelte-1hn03u3"><!></div></div>'),ka=P('<div class="general svelte-1hn03u3"><!></div>'),xa=P('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),pa=P("<!> <!> <!>",1);function Aa(r,t){F(t,!0);let e=D(t,"character",7);const n=We();let l=$(null);Me(()=>{const s=e()?.party?.partyId??null;if(!s){I(l,null);return}(async()=>{try{await n.initFirebase();const k=await n.loadParty(s);console.log("[SettingsTab] Getting party name"),I(l,k?.name??null,!0)}catch{I(l,null)}})()});async function _(s){const k=s?.toString()?.trim()||null,g=e().party.partyId;if(!k){if(e().party.partyId=null,e().party.ownerId=null,I(l,null),t.onChange(e()),g&&e().id)try{const y=Q(n.user),d=y?y.uid:null;d&&typeof n.removePartyMember=="function"&&(await n.removePartyMember(g,d,e().id),console.debug("[SettingsTab] removePartyMember succeeded",{prevPid:g,uid:d,cid:e().id}))}catch(y){console.warn("[SettingsTab] removePartyMember failed (awaited)",y)}return}e().party.partyId=k;try{await n.initFirebase();const y=await n.loadParty(k);e().party.ownerId=y?.ownerId??null,I(l,y?.name??null,!0)}catch(y){console.warn("[SettingsTab] Failed to read party info",y),e().party={partyId:null,ownerId:null},I(l,null)}finally{t.onChange(e());try{const y=Q(n.user),d=y?y.uid:null;if(d&&k&&e().id)try{typeof n.setPartyMember=="function"&&(await n.setPartyMember(k,d,e().id),console.debug("[SettingsTab] setPartyMember succeeded",{pid:k,uid:d,cid:e().id}))}catch(o){console.warn("[SettingsTab] setPartyMember failed (awaited)",o),alert("No se pudo registrar el personaje en el grupo (permiso denegado o error).")}}catch{}}}var w=pa(),p=K(w);{var S=s=>{z(s,{title:"Grupo",children:(k,g)=>{var y=Pa(),d=b(y);{let v=W(()=>a(l)??e().party.partyId??"");q(d,{label:"Grupo Actual",placeholder:"Ninguno, pidele a tu DJ el ID del grupo",get value(){return a(v)},readonly:!0,fullWidth:!0})}var o=i(d,2),h=b(o);{var x=v=>{var f=ha();f.__click=[ma,_],C(v,f)},u=v=>{var f=Ca(),M=K(f);M.__click=[ya,_];var N=i(M,2);N.__click=[fa,e],C(v,f)};T(h,v=>{e().party.partyId?v(u,!1):v(x)})}c(o),c(y),C(k,y)},$$slots:{default:!0}})};T(p,s=>{t.allowPartyChange&&s(S)})}var A=i(p,2);z(A,{title:"General",children:(s,k)=>{var g=ka(),y=b(g);{let d=W(()=>e().img??"");q(y,{label:"URL del Retrato",get value(){return a(d)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:o=>{const h=o.toString();h.length>0?e().img=h:e().img=null,t.onChange(e())}})}c(g),C(s,g)},$$slots:{default:!0}});var m=i(A,2);z(m,{title:"Modificadores",children:(s,k)=>{var g=xa(),y=b(g);_a(y,{get modifiers(){return e().modifiers},onChange:d=>{e().modifiers=d,t.onChange(e())}}),Se(2),c(g),C(s,g)},$$slots:{default:!0}}),C(r,w),E()}L(["click"]);var wa=P("<button> </button>"),Ma=P('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function Ua(r,t){F(t,!0);let e=D(t,"character",7),n=D(t,"allowPartyChange",3,!0);const l=[{name:"general",title:"General",component:Tt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:at,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:Qe,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Bt,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:aa,availableWhenReadOnly:!0},{name:"economy",title:"Econom√≠a",component:ct,availableWhenReadOnly:!0},{name:"settings",title:"Configuraci√≥n",component:Aa,availableWhenReadOnly:!1},{name:"see_as_md",title:"Ver como MD",component:oa,availableWhenReadOnly:!0}];let _=W(()=>Math.max(l.findIndex(o=>o.name===t.currentTab),0)),w=W(()=>l.find(o=>o.name===t.currentTab)??l[0]),p=null;const S=500,A=o=>{const h=o.copy();e(h),p&&clearTimeout(p),p=setTimeout(()=>{p=null,t.onChange(h)},S)},m=o=>{I(_,o),t.onTabChange(l[o].name)};var s=Ma(),k=b(s),g=b(k);fe(g,{get value(){return e().name},get readonly(){return t.readonly},onChange:o=>{e().name=o,A(e())}}),c(k);var y=i(k,2);X(y,23,()=>l,o=>o.title,(o,h,x)=>{var u=Ne(),v=K(u);{var f=M=>{var N=wa();let G;N.__click=()=>m(a(x));var V=b(N,!0);c(N),O(Z=>{G=Y(N,1,"tab",null,G,Z),j(V,a(h).title)},[()=>({selected:a(_)===a(x)})]),C(M,N)};T(v,M=>{(a(h).availableWhenReadOnly||!t.readonly)&&M(f)})}C(o,u)}),c(y);var d=i(y,2);ze(d,()=>a(w).component,(o,h)=>{h(o,{get character(){return e()},get readonly(){return t.readonly},onChange:A,get allowPartyChange(){return n()}})}),c(s),C(r,s),E()}L(["click"]);export{Ua as C,Vt as N,fe as T,na as s};
