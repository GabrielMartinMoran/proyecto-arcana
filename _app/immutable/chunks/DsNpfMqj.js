import"./DsnmJJEf.js";import{p as F,b as C,ab as H,t as O,K as I,j as a,a as h,d as W,e as m,g as i,bf as we,r as c,f as K,aa as Z,J as $,Y as Me,aT as qe,c as Ne}from"./t0Cq7XZL.js";import{d as U,s as E,a as Re,o as be,e as Se}from"./D_zjkKVN.js";import{i as T}from"./CuTJ2zLb.js";import{r as Ie,s as ee,e as X}from"./BDY9aIh_.js";import{c as ze}from"./Cj3oZ-tp.js";import{b as _e,s as Y}from"./BmU-s7xp.js";import{p as D}from"./Pn6U6YSw.js";import{C as z}from"./0WDDsGuN.js";import{u as Te,a as me,b as oe,C as De,c as Fe,d as We,f as ce,I as R}from"./CF0SpOGH.js";import{g as Q}from"./y52P6WVk.js";import{a as ye,u as He}from"./F630LRhk.js";import{c as je}from"./CGjaQNWU.js";import{g as Ee}from"./CGx-opJy.js";import{r as Oe}from"./B_AVrfgA.js";import{b as Ge}from"./DtnJLG4x.js";var Ue=(n,t,e)=>t.onChange(a(e)),Le=C('<input type="text" class="svelte-19nbfo1"/>');function fe(n,t){F(t,!0);let e=D(t,"placeholder",3,void 0),r=H(()=>t.value);var l=Le();Ie(l),l.__input=[Ue,t,r],O(()=>{ee(l,"placeholder",e()),l.disabled=t.readonly}),_e(l,()=>a(r),f=>I(r,f)),h(n,l),W()}U(["input"]);var Ve=C("<label> </label>"),Je=(n,t,e)=>t.onChange(a(e)),Be=C("<div><!> <div><textarea></textarea></div></div>");function ie(n,t){F(t,!0);const e=6;let r=D(t,"label",3,void 0),l=D(t,"placeholder",3,""),f=D(t,"maxRows",3,e),A=H(()=>t.value);var w=Be();let M;var p=m(w);{var y=o=>{var b=Ve(),P=m(b,!0);c(b),O(()=>E(P,r())),h(o,b)};T(p,o=>{r()&&o(y)})}var s=i(p,2);let k;var g=m(s);we(g),g.__input=[Je,t,A];let d;c(s),c(w),O((o,b,P)=>{M=Y(w,1,"fieldgroup svelte-o02g58",null,M,o),k=Y(s,1,"field svelte-o02g58",null,k,b),g.disabled=t.readonly,ee(g,"placeholder",l()),ee(g,"rows",f()==="unlimited"?void 0:f()),d=Y(g,1,"svelte-o02g58",null,d,P)},[()=>({expanded:f()==="unlimited"}),()=>({expanded:f()==="unlimited"}),()=>({expanded:f()==="unlimited"})]),_e(g,()=>a(A),o=>I(A,o)),h(n,w),W()}U(["input"]);var Ke=C('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),Ye=C("<!> <!>",1);function Qe(n,t){F(t,!0);let e=D(t,"character",7);var r=Ye(),l=K(r);{var f=w=>{z(w,{children:(M,p)=>{var y=Ke(),s=m(y);c(y),O(()=>{ee(s,"src",e().img),ee(s,"alt",e().name)}),h(M,y)},$$slots:{default:!0}})};T(l,w=>{e().img&&w(f)})}var A=i(l,2);z(A,{children:(w,M)=>{ie(w,{label:"Historia",get value(){return e().story},get readonly(){return t.readonly},onChange:p=>{e().story=p,t.onChange(e())}})},$$slots:{default:!0}}),h(n,r),W()}var Xe=(n,t)=>t("ability"),Ze=(n,t)=>t("item"),$e=C('<!> <div class="controls svelte-o497rd"><span class="svelte-o497rd">Agregar cartas a tu colecci√≥n</span> <div class="buttons svelte-o497rd"><button>Agregar Carta de Habilidad</button> <button>Agregar Carta de Objeto M√°gico</button></div></div>',1),et=C('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),tt=C('<div class="cards-tab svelte-o497rd"><!> <!> <!></div> <div class="add-card-modal svelte-o497rd"><div class="all-cards svelte-o497rd"><!> <div class="cards-viewport svelte-o497rd"><!></div></div> <div class="footer svelte-o497rd"><span class="results-count"> </span> <button>Cerrar</button></div></div>',1);function at(n,t){F(t,!0);let e=D(t,"character",7),{loadAbilityCards:r,abilityCards:l,loadItemCards:f,itemCards:A}=me(),{rollExpression:w}=ye();const{buildEmptyFilters:M}=Te();let p=Z($(M({onlyAvailables:!0}))),y=Z($([])),s=Z($({opened:!1,filteredCards:[],allCards:[]}));const k=l.subscribe(()=>{I(s,{...a(s),allCards:[],filteredCards:[]},!0)});Re(()=>{k()}),be(async()=>{await Promise.all([f(),r()]),I(y,[...Q(A),...Q(l)],!0)});const g=S=>{e().cards=S,t.onChange(e())},d=async S=>{const j=e().cards.find(G=>G.id===S),V=a(y).find(G=>G.id===S);j&&V&&j.uses!==null&&V&&await w({expression:"1d6",variables:{},title:`${e().name}: Recarga de carta ${V.name}`,resultFormatter:B=>`<span class="total ${B>=(V.uses?.qty??0)?"success":"failure"}">${B}</span>`})>=(V.uses?.qty??0)&&(j.uses+=1,g([...e().cards]))},o=S=>{I(p,S,!0),I(s,{...a(s),filteredCards:ce(a(s).allCards,a(p),e())},!0)},b=()=>{o(M({onlyAvailables:!0}))},P=S=>{setTimeout(()=>{const j=S==="ability"?Q(l):Q(A);I(s,{opened:!0,filteredCards:ce(j,a(p),e()),allCards:j},!0)},0)},x=()=>{I(s,{opened:!1,filteredCards:[],allCards:[]},!0)};var u=tt(),v=K(u),_=m(v);{var q=S=>{z(S,{children:(j,V)=>{var G=$e(),B=K(G);R(B,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return e().maxActiveCards},get readonly(){return t.readonly},fullWidth:!0,onChange:Ae=>{e().maxActiveCards=Number(Ae),t.onChange(e())}});var ne=i(B,2),ve=i(m(ne),2),ue=m(ve);ue.__click=[Xe,P];var pe=i(ue,2);pe.__click=[Ze,P],c(ve),c(ne),h(j,G)},$$slots:{default:!0}})};T(_,S=>{t.readonly||S(q)})}var N=i(_,2);z(N,{get title(){return`Cartas Activas (${e().numActiveCards??""}/${e().maxActiveCards??""})`},children:(S,j)=>{{let V=H(()=>a(y).filter(G=>e().cards.some(B=>B.isActive&&B.id===G.id)));oe(S,{get cards(){return a(V)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"active",onChange:g,onCardReloadClick:d})}},$$slots:{default:!0}});var L=i(N,2);{let S=H(()=>`Colecci√≥n (${e().cards.length})`);z(L,{get title(){return a(S)},children:(j,V)=>{{let G=H(()=>a(y).filter(B=>e().cards.some(ne=>ne.id===B.id)));oe(j,{get cards(){return a(G)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"collection",onChange:g})}},$$slots:{default:!0}})}c(v);var J=i(v,2),te=m(J),re=m(te);De(re,{get cards(){return a(s).filteredCards},onFiltersChange:o,onResetFilters:b,get filters(){return a(p)},includeOnlyAvailablesFilter:!0});var se=i(re,2),he=m(se);{var Ce=S=>{{let j=H(()=>a(s).filteredCards.filter(V=>e().cards.find(G=>G.id===V.id)===void 0));oe(S,{get cards(){return a(j)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"all",onChange:g})}},Pe=S=>{var j=et();h(S,j)};T(he,S=>{a(s).filteredCards.length>0?S(Ce):S(Pe,!1)})}c(se),c(te);var de=i(te,2),le=m(de),ke=m(le);c(le);var xe=i(le,2);xe.__click=x,c(de),c(J),Fe(J,S=>We?.(S)),O(()=>{ee(J,"hidden",!a(s).opened),E(ke,`${a(s).filteredCards.length??""}
			${a(s).filteredCards.length===1?"resultado":"resultados"}`)}),Se("outsideclick",J,x),h(n,u),W()}U(["click"]);const rt=(n,t,e,r,l,f)=>{const A={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};r().goldHistory.unshift(A),l.onChange(r()),f()},nt=(n,t,e,r,l,f)=>{const A={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};r().goldHistory.unshift(A),l.onChange(r()),f()};var lt=C('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ot=C('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Raz√≥n</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),it=(n,t,e)=>t(a(e)),st=C('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),dt=C('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),vt=C('<div class="history svelte-ssntdk"></div>'),ut=C("<!> <!> <!>",1);function ct(n,t){F(t,!0);const e="Sin raz√≥n especifica";let r=D(t,"character",7),l=$({quantity:1,reason:""});const f=()=>{l.quantity=1,l.reason=""},A=k=>{r().goldHistory=r().goldHistory.filter(g=>g.id!==k.id),t.onChange(r())};var w=ut(),M=K(w);z(M,{title:"Estado Actual",children:(k,g)=>{var d=lt(),o=m(d),b=i(m(o),2);let P;var x=m(b,!0);c(b),c(o);var u=i(o,2),v=i(m(u),2),_=m(v,!0);c(v),c(u),c(d),O(q=>{P=Y(b,1,"number svelte-ssntdk",null,P,q),E(x,r().currentGold),E(_,r().spentGold)},[()=>({negative:r().currentGold<0})]),h(k,d)},$$slots:{default:!0}});var p=i(M,2);{var y=k=>{z(k,{title:"Actualizar Oro",children:(g,d)=>{var o=ot(),b=i(m(o),2),P=m(b);R(P,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:_=>{l.quantity=Number(_)}});var x=i(P,2);R(x,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:_=>{l.reason=_.toString()}});var u=i(x,2);u.__click=[nt,l,e,r,t,f];var v=i(u,2);v.__click=[rt,l,e,r,t,f],c(b),c(o),h(g,o)},$$slots:{default:!0}})};T(p,k=>{t.readonly||k(y)})}var s=i(p,2);z(s,{title:"Historial",children:(k,g)=>{var d=vt();X(d,21,()=>r().goldHistory,o=>o.id,(o,b)=>{var P=st(),x=m(P);let u;var v=m(x);c(x);var _=i(x,2),q=m(_,!0);c(_);var N=i(_,2);N.__click=[it,A,b],c(P),O(L=>{u=Y(x,1,"log-amount svelte-ssntdk",null,u,L),E(v,`${a(b).type==="add"?"+":"-"}${a(b).value??""} Oro`),E(q,a(b).reason)},[()=>({positive:a(b).type==="add",negative:a(b).type==="subtract"})]),h(o,P)},o=>{var b=dt();h(o,b)}),c(d),h(k,d)},$$slots:{default:!0}}),h(n,w),W()}U(["click"]);const gt=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),e.onChange(t())};var bt=C('<button title="Agregar Ataque">‚ûï</button>'),_t=(n,t,e)=>t(a(e)),mt=C('<button title="Eliminar" class="svelte-1v2w3y3">üóëÔ∏è</button>'),yt=C('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),ft=C('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Da√±o</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function ht(n,t){F(t,!0);let e=D(t,"attacks",7);const r=y=>{e(e().filter(s=>s.id!==y.id)),t.onChange(e())};var l=ft(),f=m(l),A=i(m(f),2);{var w=y=>{var s=bt();s.__click=[gt,e,t],h(y,s)};T(A,y=>{t.readonly||y(w)})}c(f);var M=i(f,2),p=i(m(M),2);X(p,17,e,y=>y.id,(y,s,k)=>{var g=yt(),d=m(g);R(d,{get value(){return a(s).name},get readonly(){return t.readonly},placeholder:"Nombre",fullWidth:!0,onChange:v=>{a(s).name=v.toString(),t.onChange(e())}});var o=i(d,2);{let v=H(()=>({icon:"üéØ",title:"Tirar Ataque",onClick:()=>t.onAttackRoll(a(s)),disabled:!a(s).atkFormula}));R(o,{get value(){return a(s).atkFormula},get readonly(){return t.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:_=>{a(s).atkFormula=_.toString(),t.onChange(e())},get button(){return a(v)}})}var b=i(o,2);{let v=H(()=>({icon:"üí•",title:"Tirar Da√±o",onClick:()=>t.onDamageRoll(a(s)),disabled:!a(s).dmgFormula}));R(b,{get value(){return a(s).dmgFormula},get readonly(){return t.readonly},placeholder:"1d4",fullWidth:!0,onChange:_=>{a(s).dmgFormula=_.toString(),t.onChange(e())},get button(){return a(v)}})}var P=i(b,2);R(P,{get value(){return a(s).notes},get readonly(){return t.readonly},placeholder:"Contundente",fullWidth:!0,onChange:v=>{a(s).notes=v.toString(),t.onChange(e())}});var x=i(P,2);{var u=v=>{var _=mt();_.__click=[_t,r,s],h(v,_)};T(x,v=>{t.readonly||v(u)})}c(g),h(y,g)}),c(M),c(l),h(n,l),W()}U(["click"]);function ae(n,t){F(t,!0);{let e=H(()=>({icon:"üé≤",onClick:t.onDiceRoll,title:"Tirar"}));R(n,{get label(){return t.name},get value(){return t.value},get readonly(){return t.readonly},onChange:r=>t.onChange(Number(r)),get button(){return a(e)}})}W()}const Ct=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),e.onChange(t())};var Pt=C('<button title="Agregar Item">‚ûï</button>'),kt=(n,t,e)=>t(a(e)),xt=C('<button title="Eliminar">üóëÔ∏è</button>'),pt=C('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),At=C('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="quantity svelte-1ewnrao">Cantidad</label> <label class="name svelte-1ewnrao">Nombre</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function wt(n,t){F(t,!0);let e=D(t,"equipment",7);const r=y=>{e(e().filter(s=>s.id!==y.id)),t.onChange(e())};var l=At(),f=m(l),A=i(m(f),2);{var w=y=>{var s=Pt();s.__click=[Ct,e,t],h(y,s)};T(A,y=>{t.readonly||y(w)})}c(f);var M=i(f,2),p=i(m(M),2);X(p,17,e,y=>y.id,(y,s,k)=>{var g=pt(),d=m(g);R(d,{get value(){return a(s).quantity},get readonly(){return t.readonly},onChange:u=>{a(s).quantity=Number(u),t.onChange(e())}});var o=i(d,2);R(o,{get value(){return a(s).name},get readonly(){return t.readonly},placeholder:"Nombre",onChange:u=>{a(s).name=u.toString(),t.onChange(e())}});var b=i(o,2);R(b,{get value(){return a(s).notes},get readonly(){return t.readonly},placeholder:"Notas",fullWidth:!0,onChange:u=>{a(s).notes=u.toString(),t.onChange(e())}});var P=i(b,2);{var x=u=>{var v=xt();v.__click=[kt,r,s],h(u,v)};T(P,u=>{t.readonly||u(x)})}c(g),h(y,g)}),c(M),c(l),h(n,l),W()}U(["click"]);var Mt=C('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),qt=C('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Nt=C('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),Rt=C('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),St=C('<div class="empty svelte-ox7hjw"><em>El equipo esta vac√≠o.</em></div>'),It=C('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),zt=C("<!> <!> <!> <!>",1);function Tt(n,t){F(t,!0);let e=D(t,"character",7),{rollExpression:r,rollModal:l}=ye();const f=g=>{l.openRollModal({expression:`1d6e+${g}`,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence,iniciativa:e().initiative},title:`${e().name}: ${je(g)}`})},A=g=>{l.openRollModal({expression:g.atkFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Ataque con ${g.name}`})},w=g=>{r({expression:g.dmgFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Da√±o de ${g.name}`})};var M=zt(),p=K(M);z(p,{title:"Atributos Principales",children:(g,d)=>{var o=Mt(),b=m(o);ae(b,{name:"Cuerpo",get value(){return e().attributes.body},get readonly(){return t.readonly},onDiceRoll:()=>f("cuerpo"),onChange:q=>{e().attributes.body=q,t.onChange(e())}});var P=i(b,2);ae(P,{name:"Reflejos",get value(){return e().attributes.reflexes},get readonly(){return t.readonly},onDiceRoll:()=>f("reflejos"),onChange:q=>{e().attributes.reflexes=q,t.onChange(e())}});var x=i(P,2);ae(x,{name:"Mente",get value(){return e().attributes.mind},get readonly(){return t.readonly},onDiceRoll:()=>f("mente"),onChange:q=>{e().attributes.mind=q,t.onChange(e())}});var u=i(x,2);ae(u,{name:"Instinto",get value(){return e().attributes.instinct},get readonly(){return t.readonly},onDiceRoll:()=>f("instinto"),onChange:q=>{e().attributes.instinct=q,t.onChange(e())}});var v=i(u,2);ae(v,{name:"Presencia",get value(){return e().attributes.presence},get readonly(){return t.readonly},onDiceRoll:()=>f("presencia"),onChange:q=>{e().attributes.presence=q,t.onChange(e())}});var _=i(v,2);R(_,{label:"Suerte",get value(){return e().currentLuck},get max(){return e().maxLuck},get readonly(){return t.readonly},onChange:q=>{e().currentLuck=Number(q),t.onChange(e())}}),c(o),h(g,o)},$$slots:{default:!0}});var y=i(p,2);z(y,{title:"Atributos Derivados",children:(g,d)=>{var o=qt(),b=m(o);R(b,{label:"Salud",get value(){return e().currentHP},get max(){return e().maxHP},get readonly(){return t.readonly},onChange:N=>{e().currentHP=Number(N),t.onChange(e())}});var P=i(b,2);R(P,{label:"Salud Temporal",get value(){return e().tempHP},get readonly(){return t.readonly},onChange:N=>{e().tempHP=Number(N),t.onChange(e())}});var x=i(P,2);R(x,{label:"Velocidad",get value(){return e().speed},readonly:!0});var u=i(x,2);R(u,{label:"Esquiva",get value(){return e().evasion},readonly:!0});var v=i(u,2);R(v,{label:"Mitigaci√≥n F√≠sica",get value(){return e().physicalMitigation},readonly:!0});var _=i(v,2);R(_,{label:"Mitigaci√≥n M√°gica",get value(){return e().magicalMitigation},readonly:!0});var q=i(_,2);R(q,{label:"Iniciativa",get value(){return e().initiative},readonly:!0,button:{icon:"üé≤",title:"Tirar iniciativa",onClick:()=>f("iniciativa")}}),c(o),h(g,o)},$$slots:{default:!0}});var s=i(y,2);z(s,{title:"Informaci√≥n",children:(g,d)=>{var o=Rt(),b=m(o);ht(b,{get attacks(){return e().attacks},get readonly(){return t.readonly},onChange:_=>{e().attacks=_,t.onChange(e())},onAttackRoll:A,onDamageRoll:w});var P=i(b,2);{var x=_=>{var q=Nt();h(_,q)};T(P,_=>{e().attacks.length===0&&_(x)})}var u=i(P,2);ie(u,{label:"Informaci√≥n R√°pida",get value(){return e().quickInfo},get readonly(){return t.readonly},placeholder:"Informaci√≥n general, habilidades, etc.",onChange:_=>{e().quickInfo=_,t.onChange(e())}});var v=i(u,2);R(v,{label:"Lenguas",get value(){return e().languages},get readonly(){return t.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:_=>{e().languages=_,t.onChange(e())}}),c(o),h(g,o)},$$slots:{default:!0}});var k=i(s,2);z(k,{title:"Equipo",children:(g,d)=>{var o=It(),b=m(o);R(b,{label:"Oro",get value(){return e().currentGold},readonly:!0,fullWidth:!0});var P=i(b,2);wt(P,{get equipment(){return e().equipment},get readonly(){return t.readonly},onChange:v=>{e().equipment=v,t.onChange(e())}});var x=i(P,2);{var u=v=>{var _=St();h(v,_)};T(x,v=>{e().equipment.length===0&&v(u)})}c(o),h(g,o)},$$slots:{default:!0}}),h(n,M),W()}const Dt=(n,t,e,r)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};I(t,[...a(t),l],!0),e.onChange(a(t)),r(l)};var Ft=(n,t,e)=>t(a(e)),Wt=C('<div class="header svelte-z1ulbz"><button title="Agregar Nota">‚ûï</button> <button title="Eliminar Nota">üóëÔ∏è</button></div>'),Ht=(n,t,e)=>t(a(e)),jt=C('<button><span class="svelte-z1ulbz"> </span></button>'),Et=C('<div class="notes svelte-z1ulbz"></div>'),Ot=C('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Gt=C('<div class="note svelte-z1ulbz"><!> <!></div>'),Ut=C('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Lt=C('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Vt(n,t){F(t,!0);let e=Z($(t.notes)),r=Z(void 0),l=H(()=>a(e).find(u=>u.id===a(r)));const f=u=>{I(r,u.id,!0)},A=u=>{u&&(I(e,a(e).filter(v=>v.id!==u),!0),I(r,void 0),t.onChange(a(e)))},w=()=>{I(e,[...a(e)],!0),t.onChange(a(e))};var M=Lt(),p=m(M),y=m(p);{var s=u=>{var v=Wt(),_=m(v);_.__click=[Dt,e,t,f];var q=i(_,2);q.__click=[Ft,A,r],c(v),O(()=>q.disabled=!a(l)),h(u,v)};T(y,u=>{t.readonly||u(s)})}var k=i(y,2);{var g=u=>{var v=Et();X(v,21,()=>a(e),_=>_.id,(_,q)=>{var N=jt();let L;N.__click=[Ht,f,q];var J=m(N),te=m(J,!0);c(J),c(N),O(re=>{L=Y(N,1,"note-btn svelte-z1ulbz",null,L,re),E(te,a(q).title||"Nota sin t√≠tulo")},[()=>({selected:a(r)===a(q).id})]),h(_,N)}),c(v),h(u,v)},d=u=>{var v=Ot();h(u,v)};T(k,u=>{a(e).length>0?u(g):u(d,!1)})}c(p);var o=i(p,2),b=m(o);{var P=u=>{var v=Gt(),_=m(v);fe(_,{get value(){return a(l).title},get readonly(){return t.readonly},placeholder:"T√≠tulo de la nota",onChange:N=>{a(l).title=N,w()}});var q=i(_,2);ie(q,{get value(){return a(l).content},get readonly(){return t.readonly},placeholder:"Contenido de la nota",onChange:N=>{a(l).content=N,w()},maxRows:"unlimited"}),c(v),h(u,v)},x=u=>{var v=Ut();h(u,v)};T(b,u=>{a(l)?u(P):u(x,!1)})}c(o),c(M),h(n,M),W()}U(["click"]);function Jt(n,t){F(t,!0);let e=D(t,"character",7);z(n,{title:"Notas",children:(r,l)=>{Vt(r,{get notes(){return e().notes},get readonly(){return t.readonly},onChange:f=>{e().notes=f,t.onChange(e())}})},$$slots:{default:!0}}),W()}const Bt=(n,t,e,r,l,f)=>{const A={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};r().ppHistory.unshift(A),l.onChange(r()),f()},Kt=(n,t,e,r,l,f)=>{const A={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};r().ppHistory.unshift(A),l.onChange(r()),f()};var Yt=C('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Rango del PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),Qt=C('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Raz√≥n</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),Xt=(n,t,e)=>t(a(e)),Zt=C('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),$t=C('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),ea=C('<div class="history svelte-1cdo061"></div>'),ta=C("<!> <!> <!>",1);function aa(n,t){F(t,!0);const e="Sin raz√≥n especifica";let r=D(t,"character",7),l=$({quantity:1,reason:""});const f=()=>{l.quantity=1,l.reason=""},A=k=>{r().ppHistory=r().ppHistory.filter(g=>g.id!==k.id),t.onChange(r())};var w=ta(),M=K(w);z(M,{title:"Estado Actual",children:(k,g)=>{var d=Yt(),o=m(d),b=i(m(o),2);let P;var x=m(b,!0);c(b),c(o);var u=i(o,2),v=i(m(u),2),_=m(v,!0);c(v),c(u);var q=i(u,2),N=i(m(q),2),L=m(N,!0);c(N),c(q),c(d),O(J=>{P=Y(b,1,"number svelte-1cdo061",null,P,J),E(x,r().currentPP),E(_,r().spentPP),E(L,r().tier)},[()=>({negative:r().currentPP<0})]),h(k,d)},$$slots:{default:!0}});var p=i(M,2);{var y=k=>{z(k,{title:"Actualizar Progreso",children:(g,d)=>{var o=Qt(),b=i(m(o),2),P=m(b);R(P,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:_=>{l.quantity=Number(_)}});var x=i(P,2);R(x,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:_=>{l.reason=_.toString()}});var u=i(x,2);u.__click=[Kt,l,e,r,t,f];var v=i(u,2);v.__click=[Bt,l,e,r,t,f],c(b),c(o),h(g,o)},$$slots:{default:!0}})};T(p,k=>{t.readonly||k(y)})}var s=i(p,2);z(s,{title:"Historial",children:(k,g)=>{var d=ea();X(d,21,()=>r().ppHistory,o=>o.id,(o,b)=>{var P=Zt(),x=m(P);let u;var v=m(x);c(x);var _=i(x,2),q=m(_,!0);c(_);var N=i(_,2);N.__click=[Xt,A,b],c(P),O(L=>{u=Y(x,1,"log-amount svelte-1cdo061",null,u,L),E(v,`${a(b).type==="add"?"+":"-"}${a(b).value??""} PP`),E(q,a(b).reason)},[()=>({positive:a(b).type==="add",negative:a(b).type==="subtract"})]),h(o,P)},o=>{var b=$t();h(o,b)}),c(d),h(k,d)},$$slots:{default:!0}}),h(n,w),W()}U(["click"]);const ra=(n,t)=>{let e="";if(e+=`# ${n.name}

`,e+=`## Atributos
`,e+=`- **Cuerpo:** ${n.attributes.body}
`,e+=`- **Reflejos:** ${n.attributes.reflexes}
`,e+=`- **Mente:** ${n.attributes.mind}
`,e+=`- **Instinto:** ${n.attributes.instinct}
`,e+=`- **Presencia:** ${n.attributes.presence}

`,e+=`- **Suerte:** ${n.currentLuck}/${n.maxLuck}
`,e+=`
`,e+=`## Atributos derivados
`,e+=`- **Salud:** ${n.currentHP}/${n.maxHP}
`,e+=`- **Salud Temporal:** ${n.tempHP}
`,e+=`- **Velocidad:** ${n.speed}
`,e+=`- **Esquiva:** ${n.evasion}
`,e+=`- **Mitigaci√≥n F√≠sica:** ${n.physicalMitigation}
`,e+=`- **Mitigaci√≥n M√°gica:** ${n.magicalMitigation}
`,e+=`- **Iniciativa:** ${n.initiative}
`,e+=`
`,n.quickInfo&&(e+=`## Informaci√≥n R√°pida
`,e+=`\`\`\`${n.quickInfo}
\`\`\`
`,e+=`
`),e+=`## Lenguas
`,e+=`${n.languages||"-"}
`,e+=`
`,e+=`## Oro
`,e+=`${n.currentGold}
`,e+=`
`,e+=`## Inventario
`,n.equipment.length>0){e+=`| Cantidad | Nombre | Notas |
`,e+=`| - | - | - |
`;for(const r of n.equipment)e+=`| ${r.quantity} | ${r.name} | ${r.notes} |
`}else e+=`__No hay items en el inventario.__
`;if(e+=`
`,e+=`## Cartas
`,e+=`**Cartas activas:** ${n.numActiveCards}${n.maxActiveCards}
`,e+=`### Colecci√≥n
`,n.cards.length>0){e+=`| Nombre | Tipo | Activa |
`,e+=`| - | - | - |
`;for(const r of n.cards){const l=t.find(f=>f.id===r.id);l&&(e+=`| ${l.name} | ${l.cardType==="item"?"Objeto M√°gico":"Habilidad"} | ${r.isActive?"Si":"No"} |
`)}}else e+=`__No hay cartas en la colecci√≥n.__
`;if(e+=`
`,e+=`## Progreso
`,e+=`- **PP Actuales:** ${n.currentPP}
`,e+=`- **PP Gastados:** ${n.spentPP}
`,e+=`- **Rango del Personaje:** ${n.tier}
`,e+=`
`,n.story&&(e+=`## Historia
`,e+=`${n.story}
`,e+=`
`),n.notes.length>0){e+=`## Notas del Jugador
`;for(const r of n.notes)e+=`### ${r.title}
`,e+=`\`\`\`${r.content}\`\`\`
`;e+=`
`}return e},na=async(n,t)=>{try{await navigator.clipboard.writeText(a(t)),alert("Personaje en formato Markdown copiado al portapapeles!")}catch(e){console.error("Failed to copy text: ",e),alert("Error al copiar el markdown al portapapeles")}};var la=C('<div class="header svelte-1m8ejye"><label>Personaje</label> <button>Copiar Markdown</button></div> <pre class="svelte-1m8ejye"> </pre>',1);function oa(n,t){F(t,!0);let e=Z($([])),{loadAbilityCards:r,abilityCards:l,loadItemCards:f,itemCards:A}=me(),w=H(()=>ra(t.character,a(e)));be(async()=>{await Promise.all([f(),r()]),I(e,[...Q(A),...Q(l)],!0)}),z(n,{children:(M,p)=>{var y=la(),s=K(y),k=i(m(s),2);k.__click=[na,w],c(s);var g=i(s,2),d=m(g,!0);c(g),O(()=>E(d,a(w))),h(M,y)},$$slots:{default:!0}}),W()}U(["click"]);var ia=(n,t,e)=>t()(a(e)),sa=C("<option> </option>"),da=C('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function ge(n,t){F(t,!0);let e=D(t,"onChange",3,()=>{}),r=H(()=>t.value);var l=da(),f=m(l);f.__change=[ia,e,r],X(f,21,()=>t.options,A=>A.label,(A,w)=>{var M=sa(),p=m(M,!0);c(M);var y={};O(()=>{E(p,a(w).label),y!==(y=a(w).value)&&(M.value=(M.__value=a(w).value)??"")}),h(A,M)}),c(f),c(l),Ge(f,()=>a(r),A=>I(r,A)),h(n,l),W()}U(["change"]);const va=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),e.onChange(t())};var ua=(n,t,e)=>t(a(e)),ca=C('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">üóëÔ∏è</button></div>'),ga=C('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),ba=C('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">‚ûï</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Raz√≥n</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function _a(n,t){F(t,!0);let e=D(t,"modifiers",7);const r=p=>{e(e().filter(y=>y.id!==p.id)),t.onChange(e())};var l=ba(),f=m(l),A=i(m(f),2);A.__click=[va,e,t],c(f);var w=i(f,2),M=i(m(w),2);X(M,17,e,p=>p.id,(p,y,s)=>{var k=ca(),g=m(k);ge(g,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return a(y).type},onChange:x=>{a(y).type=x.toString(),t.onChange(e())}});var d=i(g,2);ge(d,{options:[{label:"Salud M√°xima",value:"maxHP"},{label:"Suerte M√°xima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigaci√≥n F√≠sica",value:"physicalMitigation"},{label:"Mitigaci√≥n M√°gica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return a(y).attribute},onChange:x=>{a(y).attribute=x.toString(),t.onChange(e())}});var o=i(d,2);R(o,{get value(){return a(y).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:x=>{a(y).formula=x.toString(),t.onChange(e())}});var b=i(o,2);R(b,{get value(){return a(y).reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:x=>{a(y).reason=x.toString(),t.onChange(e())}});var P=i(b,2);P.__click=[ua,r,y],c(k),h(p,k)},p=>{var y=ga();h(p,y)}),c(w),c(l),h(n,l),W()}U(["click"]);const ma=async(n,t)=>{const e=prompt("Introduce el ID del grupo al que quieres unirte:");e&&t(e)},ya=async(n,t)=>{confirm("¬øSeguro que quieres abandonar el grupo actual?")&&t(null)},fa=(n,t)=>{Ee(Oe(`/parties?partyId=${t().party.partyId}`))};var ha=C("<button>Unirse a un Grupo</button>"),Ca=C("<button>Abandonar Grupo</button> <button>Ver Grupo</button>",1),Pa=C('<div class="party svelte-1hn03u3"><!> <div class="buttons svelte-1hn03u3"><!></div></div>'),ka=C('<div class="general svelte-1hn03u3"><!></div>'),xa=C('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),pa=C("<!> <!> <!>",1);function Aa(n,t){F(t,!0);let e=D(t,"character",7);const r=He();let l=Z(null);Me(()=>{const s=e()?.party?.partyId??null;if(!s){I(l,null);return}(async()=>{try{await r.initFirebase();const k=await r.loadParty(s);console.log("[SettingsTab] Getting party name"),I(l,k?.name??null,!0)}catch{I(l,null)}})()});async function f(s){const k=s?.toString()?.trim()||null,g=e().party.partyId;if(!k){if(e().party.partyId=null,e().party.ownerId=null,I(l,null),t.onChange(e()),g&&e().id)try{const d=Q(r.user),o=d?d.uid:null;o&&typeof r.removePartyMember=="function"&&(await r.removePartyMember(g,o,e().id),console.debug("[SettingsTab] removePartyMember succeeded",{prevPid:g,uid:o,cid:e().id}))}catch(d){console.warn("[SettingsTab] removePartyMember failed (awaited)",d)}return}e().party.partyId=k;try{await r.initFirebase();const d=await r.loadParty(k);e().party.ownerId=d?.ownerId??null,I(l,d?.name??null,!0)}catch(d){console.warn("[SettingsTab] Failed to read party info",d),e().party={partyId:null,ownerId:null},I(l,null)}finally{t.onChange(e());try{const d=Q(r.user),o=d?d.uid:null;if(o&&k&&e().id)try{typeof r.setPartyMember=="function"&&(await r.setPartyMember(k,o,e().id),console.debug("[SettingsTab] setPartyMember succeeded",{pid:k,uid:o,cid:e().id}))}catch(b){console.warn("[SettingsTab] setPartyMember failed (awaited)",b),alert("No se pudo registrar el personaje en el grupo (permiso denegado o error).")}}catch{}}}var A=pa(),w=K(A);{var M=s=>{z(s,{title:"Grupo",children:(k,g)=>{var d=Pa(),o=m(d);{let v=H(()=>a(l)??e().party.partyId??"");R(o,{label:"Grupo Actual",placeholder:"Ninguno, pidele a tu DJ el ID del grupo",get value(){return a(v)},readonly:!0,fullWidth:!0})}var b=i(o,2),P=m(b);{var x=v=>{var _=ha();_.__click=[ma,f],h(v,_)},u=v=>{var _=Ca(),q=K(_);q.__click=[ya,f];var N=i(q,2);N.__click=[fa,e],h(v,_)};T(P,v=>{e().party.partyId?v(u,!1):v(x)})}c(b),c(d),h(k,d)},$$slots:{default:!0}})};T(w,s=>{t.allowPartyChange&&s(M)})}var p=i(w,2);z(p,{title:"General",children:(s,k)=>{var g=ka(),d=m(g);{let o=H(()=>e().img??"");R(d,{label:"URL del Retrato",get value(){return a(o)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:b=>{const P=b.toString();P.length>0?e().img=P:e().img=null,t.onChange(e())}})}c(g),h(s,g)},$$slots:{default:!0}});var y=i(p,2);z(y,{title:"Modificadores",children:(s,k)=>{var g=xa(),d=m(g);_a(d,{get modifiers(){return e().modifiers},onChange:o=>{e().modifiers=o,t.onChange(e())}}),qe(2),c(g),h(s,g)},$$slots:{default:!0}}),h(n,A),W()}U(["click"]);var wa=C("<button> </button>"),Ma=C('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function La(n,t){F(t,!0);let e=D(t,"character",7),r=D(t,"allowPartyChange",3,!0);const l=[{name:"general",title:"General",component:Tt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:at,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:Qe,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Jt,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:aa,availableWhenReadOnly:!0},{name:"economy",title:"Econom√≠a",component:ct,availableWhenReadOnly:!0},{name:"settings",title:"Configuraci√≥n",component:Aa,availableWhenReadOnly:!1},{name:"see_as_md",title:"Ver como MD",component:oa,availableWhenReadOnly:!0}];let f=H(()=>Math.max(l.findIndex(d=>d.name===t.currentTab),0)),A=H(()=>l.find(d=>d.name===t.currentTab)??l[0]);const w=d=>{const o=d.copy();e(o),t.onChange(o)},M=d=>{I(f,d),t.onTabChange(l[d].name)};var p=Ma(),y=m(p),s=m(y);fe(s,{get value(){return e().name},get readonly(){return t.readonly},onChange:d=>{e().name=d,w(e())}}),c(y);var k=i(y,2);X(k,23,()=>l,d=>d.title,(d,o,b)=>{var P=Ne(),x=K(P);{var u=v=>{var _=wa();let q;_.__click=()=>M(a(b));var N=m(_,!0);c(_),O(L=>{q=Y(_,1,"tab",null,q,L),E(N,a(o).title)},[()=>({selected:a(f)===a(b)})]),h(v,_)};T(x,v=>{(a(o).availableWhenReadOnly||!t.readonly)&&v(u)})}h(d,P)}),c(k);var g=i(k,2);ze(g,()=>a(A).component,(d,o)=>{o(d,{get character(){return e()},get readonly(){return t.readonly},onChange:w,get allowPartyChange(){return r()}})}),c(p),h(n,p),W()}U(["click"]);export{La as C,Vt as N,fe as T,ra as s};
