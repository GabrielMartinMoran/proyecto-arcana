import"./DsnmJJEf.js";import{p as W,b as p,ab as O,t as B,Q as H,h as t,a as C,d as G,e as v,g as n,bj as Fe,r as c,f as Y,aa as le,O as oe,c as xe,aV as Se,bk as Ee,a5 as He}from"./Cx9SZC40.js";import{d as J,s as V,a as Oe,o as we,e as Ue}from"./FRtchhGd.js";import{i as E}from"./BQQjEHXb.js";import{r as Re,s as ie,e as X,i as Pe,d as We}from"./y3PUPQak.js";import{c as Ge}from"./ByubPs1i.js";import{b as Me,s as $}from"./BKawnmId.js";import{p as U}from"./BqEhn_dl.js";import{g as ee}from"./nYHX28hn.js";import{r as qe}from"./B-cUA3C8.js";import{a as ze,v as Le,u as Ie}from"./DjO2gEHc.js";import{C as F}from"./_p_6lNmE.js";import{u as Ve,a as Ne,b as _e,C as Be,c as Je,d as Ke,f as Ae,I as N}from"./CZpw6fbO.js";import{C as Qe}from"./CyC3GOE6.js";import{b as ye}from"./BQL_5efD.js";import{g as Ye}from"./BU-tBLa1.js";import{b as Xe}from"./CjSGUr8l.js";var Ze=(r,a,e)=>a.onChange(t(e)),$e=p('<input type="text" class="svelte-19nbfo1"/>');function Te(r,a){W(a,!0);let e=U(a,"placeholder",3,void 0),l=O(()=>a.value);var i=$e();Re(i),i.__input=[Ze,a,l],B(()=>{ie(i,"placeholder",e()),i.disabled=a.readonly}),Me(i,()=>t(l),_=>H(l,_)),C(r,i),G()}J(["input"]);var ea=p("<label> </label>"),aa=(r,a,e)=>a.onChange(t(e)),ta=p("<div><!> <div><textarea></textarea></div></div>");function Ce(r,a){W(a,!0);const e=6;let l=U(a,"label",3,void 0),i=U(a,"placeholder",3,""),_=U(a,"maxRows",3,e),A=O(()=>a.value);var x=ta();let S;var w=v(x);{var h=u=>{var b=ea(),P=v(b,!0);c(b),B(()=>V(P,l())),C(u,b)};E(w,u=>{l()&&u(h)})}var k=n(w,2);let f;var y=v(k);Fe(y),y.__input=[aa,a,A];let g;c(k),c(x),B((u,b,P)=>{S=$(x,1,"fieldgroup svelte-o02g58",null,S,u),f=$(k,1,"field svelte-o02g58",null,f,b),y.disabled=a.readonly,ie(y,"placeholder",i()),ie(y,"rows",_()==="unlimited"?void 0:_()),g=$(y,1,"svelte-o02g58",null,g,P)},[()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"})]),Me(y,()=>t(A),u=>H(A,u)),C(r,x),G()}J(["input"]);var ra=p('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),na=p("<!> <!>",1);function la(r,a){W(a,!0);let e=U(a,"character",7);var l=na(),i=Y(l);{var _=x=>{F(x,{children:(S,w)=>{var h=ra(),k=v(h);c(h),B(()=>{ie(k,"src",e().img),ie(k,"alt",e().name)}),C(S,h)},$$slots:{default:!0}})};E(i,x=>{e().img&&x(_)})}var A=n(i,2);F(A,{children:(x,S)=>{Ce(x,{label:"Historia",get value(){return e().story},get readonly(){return a.readonly},onChange:w=>{e().story=w,a.onChange(e())}})},$$slots:{default:!0}}),C(r,l),G()}var oa=(r,a)=>a("ability"),ia=(r,a)=>a("item"),sa=p('<!> <div class="controls svelte-o497rd"><span class="svelte-o497rd">Agregar cartas a tu colecciÃ³n</span> <div class="buttons svelte-o497rd"><button>Agregar Carta de Habilidad</button> <button>Agregar Carta de Objeto MÃ¡gico</button></div></div>',1),da=p('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),ca=p('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div> <div class="add-card-modal svelte-o497rd"><div class="all-cards svelte-o497rd"><!> <div class="cards-viewport svelte-o497rd"><!></div></div> <div class="footer svelte-o497rd"><span class="results-count"> </span> <button>Cerrar</button></div></div>',1);function va(r,a){W(a,!0);let e=U(a,"character",7),{loadAbilityCards:l,abilityCards:i,loadItemCards:_,itemCards:A}=Ne(),{rollExpression:x}=ze();const{buildEmptyFilters:S}=Ve();let w=le(oe(S({onlyAvailables:!0}))),h=le(oe([])),k=O(()=>e().cards.filter(q=>!t(h).some(D=>D.id===q.id))),f=le(oe({opened:!1,filteredCards:[],allCards:[]}));const y=i.subscribe(()=>{H(f,{...t(f),allCards:[],filteredCards:[]},!0)});Oe(()=>{y()}),we(async()=>{await Promise.all([_(),l()]),H(h,[...ee(A),...ee(i)],!0)});const g=q=>{e().cards=q,a.onChange(e())},u=q=>{e().cards=[...e().cards.filter(D=>t(h).some(L=>L.id===D.id)),...q],a.onChange(e())},b=async q=>{const D=e().cards.find(K=>K.id===q),L=t(h).find(K=>K.id===q);D&&L&&D.uses!==null&&L&&await x({expression:"1d8",variables:{},title:`${e().name}: Recarga de carta ${L.name}`,resultFormatter:Q=>`<span class="total ${Q>=(L.uses?.qty??0)?"success":"failure"}">${Q}</span>`})>=(L.uses?.qty??0)&&(D.uses+=1,g([...e().cards]))},P=q=>{H(w,q,!0),H(f,{...t(f),filteredCards:Ae(t(f).allCards,t(w),e())},!0)},o=()=>{P(S({onlyAvailables:!0}))},s=q=>{setTimeout(()=>{const D=q==="ability"?ee(i):ee(A);H(f,{opened:!0,filteredCards:Ae(D,t(w),e()),allCards:D},!0)},0)},d=()=>{H(f,{opened:!1,filteredCards:[],allCards:[]},!0)};var m=ca(),R=Y(m),M=v(R);{var z=q=>{F(q,{children:(D,L)=>{var K=sa(),Q=Y(K);N(Q,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return e().maxActiveCards},get readonly(){return a.readonly},fullWidth:!0,onChange:De=>{e().maxActiveCards=Number(De),a.onChange(e())}});var re=n(Q,2),pe=n(v(re),2),ke=v(pe);ke.__click=[oa,s];var je=n(ke,2);je.__click=[ia,s],c(pe),c(re),C(D,K)},$$slots:{default:!0}})};E(M,q=>{a.readonly||q(z)})}var I=n(M,2);F(I,{get title(){return`Cartas Activas (${e().numActiveCards??""}/${e().maxActiveCards??""})`},children:(q,D)=>{{let L=O(()=>t(h).filter(K=>e().cards.some(Q=>Q.isActive&&Q.id===K.id)));_e(q,{get cards(){return t(L)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"active",onChange:g,onCardReloadClick:b})}},$$slots:{default:!0}});var T=n(I,2);{let q=O(()=>`ColecciÃ³n (${e().cards.length})`);F(T,{get title(){return t(q)},children:(D,L)=>{{let K=O(()=>t(h).filter(Q=>e().cards.some(re=>re.id===Q.id)));_e(D,{get cards(){return t(K)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"collection",onChange:g})}},$$slots:{default:!0}})}var j=n(T,2);{var Z=q=>{{let D=O(()=>`Cartas Corruptas (${t(k).length})`);F(q,{get title(){return t(D)},children:(L,K)=>{{let Q=O(()=>t(k).map(re=>({id:re.id,name:"Carta Corrupta",level:re.level,tags:["Corrupta"],requirements:[],description:"Esta carta ya no existe. Por favor, eliminala.",uses:{qty:0,type:"USES"},type:"corrupta",cardType:re.cardType,img:Qe.ABILITY_CARD_BACKGROUNDS.default})));_e(L,{get cards(){return t(Q)},get readonly(){return a.readonly},get characterCards(){return t(k)},listMode:"collection",onChange:u})}},$$slots:{default:!0}})}};E(j,q=>{!a.readonly&&t(k).length>0&&q(Z)})}c(R);var ae=n(R,2),ce=v(ae),me=v(ce);Be(me,{get cards(){return t(f).filteredCards},onFiltersChange:P,onResetFilters:o,get filters(){return t(w)},includeOnlyAvailablesFilter:!0});var se=n(me,2),ve=v(se);{var ue=q=>{{let D=O(()=>t(f).filteredCards.filter(L=>e().cards.find(K=>K.id===L.id)===void 0));_e(q,{get cards(){return t(D)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"all",onChange:g})}},he=q=>{var D=da();C(q,D)};E(ve,q=>{t(f).filteredCards.length>0?q(ue):q(he,!1)})}c(se),c(ce);var ge=n(ce,2),ne=v(ge),de=v(ne);c(ne);var te=n(ne,2);te.__click=d,c(ge),c(ae),Je(ae,q=>Ke?.(q)),B(()=>{ie(ae,"hidden",!t(f).opened),V(de,`${t(f).filteredCards.length??""}
			${t(f).filteredCards.length===1?"resultado":"resultados"}`)}),Ue("outsideclick",ae,d),C(r,m),G()}J(["click"]);const ua=(r,a,e,l,i,_)=>{const A={id:crypto.randomUUID(),type:"add",value:a.quantity,reason:a.reason||e};l().goldHistory.unshift(A),i.onChange(l()),_()},ga=(r,a,e,l,i,_)=>{const A={id:crypto.randomUUID(),type:"subtract",value:a.quantity,reason:a.reason||e};l().goldHistory.unshift(A),i.onChange(l()),_()};var ba=p('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ma=p('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">RazÃ³n</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),_a=(r,a,e)=>a(t(e)),ha=p('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acciÃ³n">â†¶</button></div>'),ya=p('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),fa=p('<div class="history svelte-ssntdk"></div>'),Ca=p("<!> <!> <!>",1);function pa(r,a){W(a,!0);const e="Sin razÃ³n especifica";let l=U(a,"character",7),i=oe({quantity:1,reason:""});const _=()=>{i.quantity=1,i.reason=""},A=f=>{l().goldHistory=l().goldHistory.filter(y=>y.id!==f.id),a.onChange(l())};var x=Ca(),S=Y(x);F(S,{title:"Estado Actual",children:(f,y)=>{var g=ba(),u=v(g),b=n(v(u),2);let P;var o=v(b,!0);c(b),c(u);var s=n(u,2),d=n(v(s),2),m=v(d,!0);c(d),c(s),c(g),B(R=>{P=$(b,1,"number svelte-ssntdk",null,P,R),V(o,l().currentGold),V(m,l().spentGold)},[()=>({negative:l().currentGold<0})]),C(f,g)},$$slots:{default:!0}});var w=n(S,2);{var h=f=>{F(f,{title:"Actualizar Oro",children:(y,g)=>{var u=ma(),b=n(v(u),2),P=v(b);N(P,{get value(){return i.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:m=>{i.quantity=Number(m)}});var o=n(P,2);N(o,{get value(){return i.reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:m=>{i.reason=m.toString()}});var s=n(o,2);s.__click=[ga,i,e,l,a,_];var d=n(s,2);d.__click=[ua,i,e,l,a,_],c(b),c(u),C(y,u)},$$slots:{default:!0}})};E(w,f=>{a.readonly||f(h)})}var k=n(w,2);F(k,{title:"Historial",children:(f,y)=>{var g=fa();X(g,21,()=>l().goldHistory,u=>u.id,(u,b)=>{var P=ha(),o=v(P);let s;var d=v(o);c(o);var m=n(o,2),R=v(m,!0);c(m);var M=n(m,2);M.__click=[_a,A,b],c(P),B(z=>{s=$(o,1,"log-amount svelte-ssntdk",null,s,z),V(d,`${t(b).type==="add"?"+":"-"}${t(b).value??""} Oro`),V(R,t(b).reason)},[()=>({positive:t(b).type==="add",negative:t(b).type==="subtract"})]),C(u,P)},u=>{var b=ya();C(u,b)}),c(g),C(f,g)},$$slots:{default:!0}}),C(r,x),G()}J(["click"]);const ka=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),e.onChange(a())};var Pa=p('<button title="Agregar Ataque">â•</button>'),Aa=(r,a,e)=>a(t(e)),xa=p('<button title="Eliminar" class="svelte-1v2w3y3">ğŸ—‘ï¸</button>'),Sa=p('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),wa=p('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula DaÃ±o</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function Ra(r,a){W(a,!0);let e=U(a,"attacks",7);const l=h=>{e(e().filter(k=>k.id!==h.id)),a.onChange(e())};var i=wa(),_=v(i),A=n(v(_),2);{var x=h=>{var k=Pa();k.__click=[ka,e,a],C(h,k)};E(A,h=>{a.readonly||h(x)})}c(_);var S=n(_,2),w=n(v(S),2);X(w,17,e,h=>h.id,(h,k,f)=>{var y=Sa(),g=v(y);N(g,{get value(){return t(k).name},get readonly(){return a.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{t(k).name=d.toString(),a.onChange(e())}});var u=n(g,2);{let d=O(()=>({icon:"ğŸ¯",title:"Tirar Ataque",onClick:()=>a.onAttackRoll(t(k)),disabled:!t(k).atkFormula}));N(u,{get value(){return t(k).atkFormula},get readonly(){return a.readonly},placeholder:"1d8e+cuerpo",fullWidth:!0,onChange:m=>{t(k).atkFormula=m.toString(),a.onChange(e())},get button(){return t(d)}})}var b=n(u,2);{let d=O(()=>({icon:"ğŸ’¥",title:"Tirar DaÃ±o",onClick:()=>a.onDamageRoll(t(k)),disabled:!t(k).dmgFormula}));N(b,{get value(){return t(k).dmgFormula},get readonly(){return a.readonly},placeholder:"1d4",fullWidth:!0,onChange:m=>{t(k).dmgFormula=m.toString(),a.onChange(e())},get button(){return t(d)}})}var P=n(b,2);N(P,{get value(){return t(k).notes},get readonly(){return a.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{t(k).notes=d.toString(),a.onChange(e())}});var o=n(P,2);{var s=d=>{var m=xa();m.__click=[Aa,l,k],C(d,m)};E(o,d=>{a.readonly||d(s)})}c(y),C(h,y)}),c(S),c(i),C(r,i),G()}J(["click"]);function be(r,a){W(a,!0);{let e=O(()=>({icon:"ğŸ²",onClick:a.onDiceRoll,title:"Tirar"}));N(r,{get label(){return a.name},get value(){return a.value},get readonly(){return a.readonly},onChange:l=>a.onChange(Number(l)),get button(){return t(e)}})}G()}const Ma=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),e.onChange(a())};var qa=p('<button title="Agregar Item">â•</button>'),za=(r,a,e)=>a(t(e)),Ia=p('<button title="Eliminar">ğŸ—‘ï¸</button>'),Na=p('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),Ta=p('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="quantity svelte-1ewnrao">Cantidad</label> <label class="name svelte-1ewnrao">Nombre</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function ja(r,a){W(a,!0);let e=U(a,"equipment",7);const l=h=>{e(e().filter(k=>k.id!==h.id)),a.onChange(e())};var i=Ta(),_=v(i),A=n(v(_),2);{var x=h=>{var k=qa();k.__click=[Ma,e,a],C(h,k)};E(A,h=>{a.readonly||h(x)})}c(_);var S=n(_,2),w=n(v(S),2);X(w,17,e,h=>h.id,(h,k,f)=>{var y=Na(),g=v(y);N(g,{get value(){return t(k).quantity},get readonly(){return a.readonly},onChange:s=>{t(k).quantity=Number(s),a.onChange(e())}});var u=n(g,2);N(u,{get value(){return t(k).name},get readonly(){return a.readonly},placeholder:"Nombre",onChange:s=>{t(k).name=s.toString(),a.onChange(e())}});var b=n(u,2);N(b,{get value(){return t(k).notes},get readonly(){return a.readonly},placeholder:"Notas",fullWidth:!0,onChange:s=>{t(k).notes=s.toString(),a.onChange(e())}});var P=n(b,2);{var o=s=>{var d=Ia();d.__click=[za,l,k],C(s,d)};E(P,s=>{a.readonly||s(o)})}c(y),C(h,y)}),c(S),c(i),C(r,i),G()}J(["click"]);var Da=p('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),Fa=p('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Ea=(r,a,e)=>a(t(e)),Ha=p('<button> <span class="dice">ğŸ²</span></button>'),Oa=p('<div class="skill-group svelte-ox7hjw"><div class="group-header svelte-ox7hjw"> </div> <div class="skills-list svelte-ox7hjw"></div></div>'),Ua=p('<div class="empty svelte-ox7hjw"><em>No hay habilidades configuradas. Ve a ConfiguraciÃ³n para agregarlas.</em></div>'),Wa=p('<div class="skills-container svelte-ox7hjw"><!> <!></div>'),Ga=p('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),La=p('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Va=p('<div class="empty svelte-ox7hjw"><em>El equipo esta vacÃ­o.</em></div>'),Ba=p('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Ja=p("<!> <!> <!> <!> <!>",1);function Ka(r,a){W(a,!0);let e=U(a,"character",7),{rollExpression:l,rollModal:i}=ze();const _=o=>{i.openRollModal({expression:`1d8e+${o}`,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence,iniciativa:e().initiative},title:`${e().name}: ${ye(o)}`})},A=o=>{i.openRollModal({expression:o.atkFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Ataque con ${o.name}`})},x=o=>{l({expression:o.dmgFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: DaÃ±o de ${o.name}`})},S={body:"cuerpo",reflexes:"reflejos",mind:"mente",instinct:"instinto",presence:"presencia"},w=["body","reflexes","mind","instinct","presence"];let h=O(()=>{const o={};return w.forEach(s=>{const d=S[s];o[d]=[]}),e().skills&&e().skills.forEach(s=>{const d=S[s.attribute]||s.attribute;o[d]||(o[d]=[]),o[d].push(s)}),Object.keys(o).forEach(s=>{o[s].sort((d,m)=>d.name.localeCompare(m.name))}),o});const k=o=>{const s=S[o.attribute];let d=`1d8e+${s}`;i.openRollModal({expression:d,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: ${o.name} (${ye(s)})`,rollType:o.hasAdvantage?"advantage":"normal"})};var f=Ja(),y=Y(f);F(y,{title:"Atributos Principales",children:(o,s)=>{var d=Da(),m=v(d);be(m,{name:"Cuerpo",get value(){return e().attributes.body},get readonly(){return a.readonly},onDiceRoll:()=>_("cuerpo"),onChange:j=>{e().attributes.body=j,a.onChange(e())}});var R=n(m,2);be(R,{name:"Reflejos",get value(){return e().attributes.reflexes},get readonly(){return a.readonly},onDiceRoll:()=>_("reflejos"),onChange:j=>{e().attributes.reflexes=j,a.onChange(e())}});var M=n(R,2);be(M,{name:"Mente",get value(){return e().attributes.mind},get readonly(){return a.readonly},onDiceRoll:()=>_("mente"),onChange:j=>{e().attributes.mind=j,a.onChange(e())}});var z=n(M,2);be(z,{name:"Instinto",get value(){return e().attributes.instinct},get readonly(){return a.readonly},onDiceRoll:()=>_("instinto"),onChange:j=>{e().attributes.instinct=j,a.onChange(e())}});var I=n(z,2);be(I,{name:"Presencia",get value(){return e().attributes.presence},get readonly(){return a.readonly},onDiceRoll:()=>_("presencia"),onChange:j=>{e().attributes.presence=j,a.onChange(e())}});var T=n(I,2);N(T,{label:"Suerte",get value(){return e().currentLuck},get max(){return e().maxLuck},get readonly(){return a.readonly},onChange:j=>{e().currentLuck=Number(j),a.onChange(e())}}),c(d),C(o,d)},$$slots:{default:!0}});var g=n(y,2);F(g,{title:"Atributos Derivados",children:(o,s)=>{var d=Fa(),m=v(d);N(m,{label:"Salud",get value(){return e().currentHP},get max(){return e().maxHP},get readonly(){return a.readonly},onChange:Z=>{e().currentHP=Number(Z),a.onChange(e())}});var R=n(m,2);N(R,{label:"Salud Temporal",get value(){return e().tempHP},get readonly(){return a.readonly},onChange:Z=>{e().tempHP=Number(Z),a.onChange(e())}});var M=n(R,2);N(M,{label:"Velocidad",get value(){return e().speed},readonly:!0});var z=n(M,2);N(z,{label:"Esquiva",get value(){return e().evasion},readonly:!0});var I=n(z,2);N(I,{label:"MitigaciÃ³n FÃ­sica",get value(){return e().physicalMitigation},readonly:!0});var T=n(I,2);N(T,{label:"MitigaciÃ³n MÃ¡gica",get value(){return e().magicalMitigation},readonly:!0});var j=n(T,2);N(j,{label:"Iniciativa",get value(){return e().initiative},readonly:!0,button:{icon:"ğŸ²",title:"Tirar iniciativa",onClick:()=>_("iniciativa")}}),c(d),C(o,d)},$$slots:{default:!0}});var u=n(g,2);F(u,{title:"Habilidades",children:(o,s)=>{var d=Wa(),m=v(d);X(m,17,()=>Object.entries(t(h)),Pe,(z,I)=>{var T=O(()=>Ee(t(I),2));let j=()=>t(T)[0],Z=()=>t(T)[1];var ae=xe(),ce=Y(ae);{var me=se=>{var ve=Oa(),ue=v(ve),he=v(ue,!0);c(ue);var ge=n(ue,2);X(ge,21,Z,Pe,(ne,de)=>{var te=Ha();let q;te.__click=[Ea,k,de];var D=v(te);Se(),c(te),B(L=>{q=$(te,1,"skill-btn svelte-ox7hjw",null,q,L),ie(te,"title",t(de).description),V(D,`${t(de).name??""} `)},[()=>({advantage:t(de).hasAdvantage})]),C(ne,te)}),c(ge),c(ve),B(ne=>V(he,ne),[()=>ye(j())]),C(se,ve)};E(ce,se=>{Z().length>0&&se(me)})}C(z,ae)});var R=n(m,2);{var M=z=>{var I=Ua();C(z,I)};E(R,z=>{e().skills.length===0&&z(M)})}c(d),C(o,d)},$$slots:{default:!0}});var b=n(u,2);F(b,{title:"InformaciÃ³n",children:(o,s)=>{var d=La(),m=v(d);Ra(m,{get attacks(){return e().attacks},get readonly(){return a.readonly},onChange:T=>{e().attacks=T,a.onChange(e())},onAttackRoll:A,onDamageRoll:x});var R=n(m,2);{var M=T=>{var j=Ga();C(T,j)};E(R,T=>{e().attacks.length===0&&T(M)})}var z=n(R,2);Ce(z,{label:"InformaciÃ³n RÃ¡pida",get value(){return e().quickInfo},get readonly(){return a.readonly},placeholder:"InformaciÃ³n general, habilidades, etc.",onChange:T=>{e().quickInfo=T,a.onChange(e())}});var I=n(z,2);N(I,{label:"Lenguas",get value(){return e().languages},get readonly(){return a.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:T=>{e().languages=T,a.onChange(e())}}),c(d),C(o,d)},$$slots:{default:!0}});var P=n(b,2);F(P,{title:"Equipo",children:(o,s)=>{var d=Ba(),m=v(d);N(m,{label:"Oro",get value(){return e().currentGold},readonly:!0,fullWidth:!0});var R=n(m,2);ja(R,{get equipment(){return e().equipment},get readonly(){return a.readonly},onChange:I=>{e().equipment=I,a.onChange(e())}});var M=n(R,2);{var z=I=>{var T=Va();C(I,T)};E(M,I=>{e().equipment.length===0&&I(z)})}c(d),C(o,d)},$$slots:{default:!0}}),C(r,f),G()}J(["click"]);const Qa=(r,a,e,l)=>{const i={id:crypto.randomUUID(),title:"Nota Nueva",content:""};H(a,[...t(a),i],!0),e.onChange(t(a)),l(i)};var Ya=(r,a,e)=>a(t(e)),Xa=p('<div class="header svelte-z1ulbz"><button title="Agregar Nota">â•</button> <button title="Eliminar Nota">ğŸ—‘ï¸</button></div>'),Za=(r,a,e)=>a(t(e)),$a=p('<button><span class="svelte-z1ulbz"> </span></button>'),et=p('<div class="notes svelte-z1ulbz"></div>'),at=p('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),tt=p('<div class="note svelte-z1ulbz"><!> <!></div>'),rt=p('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),nt=p('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function lt(r,a){W(a,!0);let e=le(oe(a.notes)),l=le(void 0),i=O(()=>t(e).find(s=>s.id===t(l)));const _=s=>{H(l,s.id,!0)},A=s=>{s&&(H(e,t(e).filter(d=>d.id!==s),!0),H(l,void 0),a.onChange(t(e)))},x=()=>{H(e,[...t(e)],!0),a.onChange(t(e))};var S=nt(),w=v(S),h=v(w);{var k=s=>{var d=Xa(),m=v(d);m.__click=[Qa,e,a,_];var R=n(m,2);R.__click=[Ya,A,l],c(d),B(()=>R.disabled=!t(i)),C(s,d)};E(h,s=>{a.readonly||s(k)})}var f=n(h,2);{var y=s=>{var d=et();X(d,21,()=>t(e),m=>m.id,(m,R)=>{var M=$a();let z;M.__click=[Za,_,R];var I=v(M),T=v(I,!0);c(I),c(M),B(j=>{z=$(M,1,"note-btn svelte-z1ulbz",null,z,j),V(T,t(R).title||"Nota sin tÃ­tulo")},[()=>({selected:t(l)===t(R).id})]),C(m,M)}),c(d),C(s,d)},g=s=>{var d=at();C(s,d)};E(f,s=>{t(e).length>0?s(y):s(g,!1)})}c(w);var u=n(w,2),b=v(u);{var P=s=>{var d=tt(),m=v(d);Te(m,{get value(){return t(i).title},get readonly(){return a.readonly},placeholder:"TÃ­tulo de la nota",onChange:M=>{t(i).title=M,x()}});var R=n(m,2);Ce(R,{get value(){return t(i).content},get readonly(){return a.readonly},placeholder:"Contenido de la nota",onChange:M=>{t(i).content=M,x()},maxRows:"unlimited"}),c(d),C(s,d)},o=s=>{var d=rt();C(s,d)};E(b,s=>{t(i)?s(P):s(o,!1)})}c(u),c(S),C(r,S),G()}J(["click"]);function ot(r,a){W(a,!0);let e=U(a,"character",7);F(r,{title:"Notas",children:(l,i)=>{lt(l,{get notes(){return e().notes},get readonly(){return a.readonly},onChange:_=>{e().notes=_,a.onChange(e())}})},$$slots:{default:!0}}),G()}const it=(r,a,e,l,i,_)=>{const A={id:crypto.randomUUID(),type:"add",value:a.quantity,reason:a.reason||e};l().ppHistory.unshift(A),i.onChange(l()),_()},st=(r,a,e,l,i,_)=>{const A={id:crypto.randomUUID(),type:"subtract",value:a.quantity,reason:a.reason||e};l().ppHistory.unshift(A),i.onChange(l()),_()};var dt=p('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Rango del PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),ct=p('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">RazÃ³n</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),vt=(r,a,e)=>a(t(e)),ut=p('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acciÃ³n">â†¶</button></div>'),gt=p('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),bt=p('<div class="history svelte-1cdo061"></div>'),mt=p("<!> <!> <!>",1);function _t(r,a){W(a,!0);const e="Sin razÃ³n especifica";let l=U(a,"character",7),i=oe({quantity:1,reason:""});const _=()=>{i.quantity=1,i.reason=""},A=f=>{l().ppHistory=l().ppHistory.filter(y=>y.id!==f.id),a.onChange(l())};var x=mt(),S=Y(x);F(S,{title:"Estado Actual",children:(f,y)=>{var g=dt(),u=v(g),b=n(v(u),2);let P;var o=v(b,!0);c(b),c(u);var s=n(u,2),d=n(v(s),2),m=v(d,!0);c(d),c(s);var R=n(s,2),M=n(v(R),2),z=v(M,!0);c(M),c(R),c(g),B(I=>{P=$(b,1,"number svelte-1cdo061",null,P,I),V(o,l().currentPP),V(m,l().spentPP),V(z,l().tier)},[()=>({negative:l().currentPP<0})]),C(f,g)},$$slots:{default:!0}});var w=n(S,2);{var h=f=>{F(f,{title:"Actualizar Progreso",children:(y,g)=>{var u=ct(),b=n(v(u),2),P=v(b);N(P,{get value(){return i.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:m=>{i.quantity=Number(m)}});var o=n(P,2);N(o,{get value(){return i.reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:m=>{i.reason=m.toString()}});var s=n(o,2);s.__click=[st,i,e,l,a,_];var d=n(s,2);d.__click=[it,i,e,l,a,_],c(b),c(u),C(y,u)},$$slots:{default:!0}})};E(w,f=>{a.readonly||f(h)})}var k=n(w,2);F(k,{title:"Historial",children:(f,y)=>{var g=bt();X(g,21,()=>l().ppHistory,u=>u.id,(u,b)=>{var P=ut(),o=v(P);let s;var d=v(o);c(o);var m=n(o,2),R=v(m,!0);c(m);var M=n(m,2);M.__click=[vt,A,b],c(P),B(z=>{s=$(o,1,"log-amount svelte-1cdo061",null,s,z),V(d,`${t(b).type==="add"?"+":"-"}${t(b).value??""} PP`),V(R,t(b).reason)},[()=>({positive:t(b).type==="add",negative:t(b).type==="subtract"})]),C(u,P)},u=>{var b=gt();C(u,b)}),c(g),C(f,g)},$$slots:{default:!0}}),C(r,x),G()}J(["click"]);const ht=(r,a)=>{let e="";if(e+=`# ${r.name}

`,e+=`## Atributos
`,e+=`- **Cuerpo:** ${r.attributes.body}
`,e+=`- **Reflejos:** ${r.attributes.reflexes}
`,e+=`- **Mente:** ${r.attributes.mind}
`,e+=`- **Instinto:** ${r.attributes.instinct}
`,e+=`- **Presencia:** ${r.attributes.presence}

`,e+=`- **Suerte:** ${r.currentLuck}/${r.maxLuck}
`,e+=`
`,e+=`## Atributos derivados
`,e+=`- **Salud:** ${r.currentHP}/${r.maxHP}
`,e+=`- **Salud Temporal:** ${r.tempHP}
`,e+=`- **Velocidad:** ${r.speed}
`,e+=`- **Esquiva:** ${r.evasion}
`,e+=`- **MitigaciÃ³n FÃ­sica:** ${r.physicalMitigation}
`,e+=`- **MitigaciÃ³n MÃ¡gica:** ${r.magicalMitigation}
`,e+=`- **Iniciativa:** ${r.initiative}
`,e+=`
`,r.quickInfo&&(e+=`## InformaciÃ³n RÃ¡pida
`,e+=`\`\`\`${r.quickInfo}
\`\`\`
`,e+=`
`),e+=`## Lenguas
`,e+=`${r.languages||"-"}
`,e+=`
`,e+=`## Oro
`,e+=`${r.currentGold}
`,e+=`
`,e+=`## Inventario
`,r.equipment.length>0){e+=`| Cantidad | Nombre | Notas |
`,e+=`| - | - | - |
`;for(const l of r.equipment)e+=`| ${l.quantity} | ${l.name} | ${l.notes} |
`}else e+=`__No hay items en el inventario.__
`;if(e+=`
`,e+=`## Cartas
`,e+=`**Cartas activas:** ${r.numActiveCards}${r.maxActiveCards}
`,e+=`### ColecciÃ³n
`,r.cards.length>0){e+=`| Nombre | Tipo | Activa |
`,e+=`| - | - | - |
`;for(const l of r.cards){const i=a.find(_=>_.id===l.id);i&&(e+=`| ${i.name} | ${i.cardType==="item"?"Objeto MÃ¡gico":"Habilidad"} | ${l.isActive?"Si":"No"} |
`)}}else e+=`__No hay cartas en la colecciÃ³n.__
`;if(e+=`
`,e+=`## Progreso
`,e+=`- **PP Actuales:** ${r.currentPP}
`,e+=`- **PP Gastados:** ${r.spentPP}
`,e+=`- **Rango del Personaje:** ${r.tier}
`,e+=`
`,r.story&&(e+=`## Historia
`,e+=`${r.story}
`,e+=`
`),r.notes.length>0){e+=`## Notas del Jugador
`;for(const l of r.notes)e+=`### ${l.title}
`,e+=`\`\`\`${l.content}\`\`\`
`;e+=`
`}return e},yt=async(r,a)=>{try{await navigator.clipboard.writeText(t(a)),alert("Personaje en formato Markdown copiado al portapapeles!")}catch(e){console.error("Failed to copy text: ",e),alert("Error al copiar el markdown al portapapeles")}};var ft=p('<div class="header svelte-1m8ejye"><label>Personaje</label> <button>Copiar Markdown</button></div> <pre class="svelte-1m8ejye"> </pre>',1);function Ct(r,a){W(a,!0);let e=le(oe([])),{loadAbilityCards:l,abilityCards:i,loadItemCards:_,itemCards:A}=Ne(),x=O(()=>ht(a.character,t(e)));we(async()=>{await Promise.all([_(),l()]),H(e,[...ee(A),...ee(i)],!0)}),F(r,{children:(S,w)=>{var h=ft(),k=Y(h),f=n(v(k),2);f.__click=[yt,x],c(k);var y=n(k,2),g=v(y,!0);c(y),B(()=>V(g,t(x))),C(S,h)},$$slots:{default:!0}}),G()}J(["click"]);var pt=(r,a,e)=>a()(t(e)),kt=p("<option> </option>"),Pt=p('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function fe(r,a){W(a,!0);let e=U(a,"onChange",3,()=>{}),l=O(()=>a.value);var i=Pt(),_=v(i);_.__change=[pt,e,l],X(_,21,()=>a.options,A=>A.label,(A,x)=>{var S=kt(),w=v(S,!0);c(S);var h={};B(()=>{V(w,t(x).label),h!==(h=t(x).value)&&(S.value=(S.__value=t(x).value)??"")}),C(A,S)}),c(_),c(i),Xe(_,()=>t(l),A=>H(l,A)),C(r,i),G()}J(["change"]);const At=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),e.onChange(a())};var xt=(r,a,e)=>a(t(e)),St=p('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">ğŸ—‘ï¸</button></div>'),wt=p('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),Rt=p('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">â•</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">RazÃ³n</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function Mt(r,a){W(a,!0);let e=U(a,"modifiers",7);const l=w=>{e(e().filter(h=>h.id!==w.id)),a.onChange(e())};var i=Rt(),_=v(i),A=n(v(_),2);A.__click=[At,e,a],c(_);var x=n(_,2),S=n(v(x),2);X(S,17,e,w=>w.id,(w,h,k)=>{var f=St(),y=v(f);fe(y,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return t(h).type},onChange:o=>{t(h).type=o.toString(),a.onChange(e())}});var g=n(y,2);fe(g,{options:[{label:"Salud MÃ¡xima",value:"maxHP"},{label:"Suerte MÃ¡xima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"MitigaciÃ³n FÃ­sica",value:"physicalMitigation"},{label:"MitigaciÃ³n MÃ¡gica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return t(h).attribute},onChange:o=>{t(h).attribute=o.toString(),a.onChange(e())}});var u=n(g,2);N(u,{get value(){return t(h).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:o=>{t(h).formula=o.toString(),a.onChange(e())}});var b=n(u,2);N(b,{get value(){return t(h).reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:o=>{t(h).reason=o.toString(),a.onChange(e())}});var P=n(b,2);P.__click=[xt,l,h],c(f),C(w,f)},w=>{var h=wt();C(w,h)}),c(x),c(i),C(r,i),G()}J(["click"]);const qt=[{name:"Atletismo",attribute:"body",description:"Se usa para actividades fÃ­sicas exigentes como escalar, saltar largas distancias o nadar en aguas turbulentas.",hasAdvantage:!1},{name:"Fuerza Bruta",attribute:"body",description:"Se usa para aplicar tu poderÃ­o fÃ­sico sin refinamiento para superar un obstÃ¡culo. Incluye actos de fuerza explosiva como derribar una puerta, levantar un portÃ³n pesado o doblar barrotes.",hasAdvantage:!1},{name:"Aguante",attribute:"body",description:"Mide tu capacidad para soportar el agotamiento, el dolor y las condiciones adversas a travÃ©s de pura tenacidad. Se utiliza para realizar marchas forzadas durante dÃ­as, soportar climas extremos sin el equipo adecuado, aguantar la respiraciÃ³n bajo el agua, resistir los efectos del alcohol o el cansancio para no quedarte dormido, y para sobreponerse al dolor en un interrogatorio fÃ­sico.",hasAdvantage:!1},{name:"Acrobacias",attribute:"reflexes",description:"Mide tu capacidad para mantener el equilibrio, realizar piruetas, caer de pie y escapar de ataduras.",hasAdvantage:!1},{name:"Juego de Manos",attribute:"reflexes",description:"Para acciones que requieren destreza manual fina y discreta, como robar bolsillos, plantar un objeto en alguien o realizar trucos de prestidigitaciÃ³n.",hasAdvantage:!1},{name:"Sigilo",attribute:"reflexes",description:"Determina tu Ã©xito al moverte en silencio y evitar ser visto.",hasAdvantage:!1},{name:"Pilotaje",attribute:"reflexes",description:"Mide tu pericia para controlar monturas y vehÃ­culos, especialmente bajo presiÃ³n. Se utiliza para guiar un carruaje en una persecuciÃ³n a alta velocidad por las calles de una ciudad, para maniobrar una embarcaciÃ³n en aguas turbulentas, o para realizar giros cerrados y maniobras complejas con una montura en el fragor de la batalla.",hasAdvantage:!1},{name:"Conocimiento Arcano",attribute:"mind",description:"Mide tu conocimiento sobre conjuros, objetos mÃ¡gicos, tradiciones arcanas, planos de existencia y las criaturas que los habitan.",hasAdvantage:!1},{name:"Historia",attribute:"mind",description:"Refleja tu conocimiento sobre eventos pasados, reinos legendarios, dinastÃ­as antiguas y personajes histÃ³ricos.",hasAdvantage:!1},{name:"InvestigaciÃ³n",attribute:"mind",description:"Representa tu capacidad para deducir, encontrar pistas ocultas, descifrar cÃ³digos y conectar informaciÃ³n a partir de la evidencia.",hasAdvantage:!1},{name:"Naturaleza",attribute:"mind",description:"Mide tu conocimiento sobre flora y fauna, ecosistemas, venenos naturales y remedios herbales.",hasAdvantage:!1},{name:"ReligiÃ³n",attribute:"mind",description:"Representa tu conocimiento acerca de los panteones, sus dogmas, sus rituales y sus conflictos.",hasAdvantage:!1},{name:"PercepciÃ³n",attribute:"instinct",description:"Tu capacidad para ver, oÃ­r u oler detalles sutiles en tu entorno, como detectar una emboscada, encontrar una puerta secreta o notar que alguien estÃ¡ mintiendo.",hasAdvantage:!1},{name:"Perspicacia",attribute:"instinct",description:"Se usa para leer las intenciones de una criatura, discernir si estÃ¡ diciendo la verdad o sentir sus verdaderas emociones.",hasAdvantage:!1},{name:"Supervivencia",attribute:"instinct",description:"Mide tu habilidad para seguir rastros, cazar, orientarte en la naturaleza, predecir el clima y evitar peligros naturales.",hasAdvantage:!1},{name:"Trato con Animales",attribute:"instinct",description:"Tu aptitud para calmar, entender y hacerte amigo de los animales.",hasAdvantage:!1},{name:"EngaÃ±o",attribute:"presence",description:"Tu habilidad para mentir de forma convincente, ya sea ocultando la verdad, diciendo una mentira flagrante o adoptando un disfraz.",hasAdvantage:!1},{name:"IntimidaciÃ³n",attribute:"presence",description:"Se utiliza para influir en otros a travÃ©s de amenazas, una conducta hostil o la fuerza de tu presencia.",hasAdvantage:!1},{name:"InterpretaciÃ³n",attribute:"presence",description:"Refleja tu capacidad para cautivar a una audiencia a travÃ©s de la mÃºsica, el baile, la actuaciÃ³n, la oratoria o el relato de historias.",hasAdvantage:!1},{name:"PersuasiÃ³n",attribute:"presence",description:"Tu aptitud para convencer a otros a travÃ©s del tacto, la elocuencia, la buena fe y los argumentos lÃ³gicos.",hasAdvantage:!1}],zt=()=>qt.map(r=>({...r,id:Le()})),It=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),name:"",attribute:"body",description:"",hasAdvantage:!1}]),e.onChange(a())},Nt=(r,a,e)=>{a().length>0&&!confirm("Â¿EstÃ¡s seguro de que quieres cargar las habilidades por defecto? Esto borrarÃ¡ las habilidades actuales.")||(a(zt()),e.onChange(a()))};var Tt=p('<div class="skills-header svelte-6getny"><label class="name svelte-6getny">Nombre</label> <label class="attribute svelte-6getny">Atributo</label> <label class="description svelte-6getny">DescripciÃ³n</label> <label class="advantage svelte-6getny">Ventaja</label> <label class="btn svelte-6getny"></label></div>'),jt=(r,a,e,l)=>{t(a).hasAdvantage=r.currentTarget.checked,e.onChange(l())},Dt=(r,a,e)=>a(t(e)),Ft=p('<div class="skill svelte-6getny"><!> <!> <!> <div class="advantage-check svelte-6getny"><input type="checkbox" class="svelte-6getny"/></div> <button title="Eliminar" class="svelte-6getny">ğŸ—‘ï¸</button></div>'),Et=p('<div class="empty svelte-6getny"><em>No hay habilidades configuradas.</em></div>'),Ht=p('<div class="skills-list svelte-6getny"><div class="header svelte-6getny"><label>Habilidades</label> <div class="actions svelte-6getny"><button title="Cargar por defecto">ğŸ”„</button> <button title="Agregar Habilidad">â•</button></div></div> <div class="content svelte-6getny"><!> <!></div></div>');function Ot(r,a){W(a,!0);let e=U(a,"skills",7);const l=y=>{e(e().filter(g=>g.id!==y.id)),a.onChange(e())};var i=Ht(),_=v(i),A=n(v(_),2),x=v(A);x.__click=[Nt,e,a];var S=n(x,2);S.__click=[It,e,a],c(A),c(_);var w=n(_,2),h=v(w);{var k=y=>{var g=Tt();C(y,g)};E(h,y=>{e().length>0&&y(k)})}var f=n(h,2);X(f,17,e,y=>y.id,(y,g,u)=>{var b=Ft(),P=v(b);N(P,{get value(){return t(g).name},placeholder:"Nombre",onChange:M=>{t(g).name=M.toString(),a.onChange(e())}});var o=n(P,2);fe(o,{options:[{label:"Cuerpo",value:"body"},{label:"Reflejos",value:"reflexes"},{label:"Mente",value:"mind"},{label:"Instinto",value:"instinct"},{label:"Presencia",value:"presence"}],get value(){return t(g).attribute},onChange:M=>{t(g).attribute=M.toString(),a.onChange(e())}});var s=n(o,2);N(s,{get value(){return t(g).description},placeholder:"DescripciÃ³n",fullWidth:!0,onChange:M=>{t(g).description=M.toString(),a.onChange(e())}});var d=n(s,2),m=v(d);Re(m),m.__change=[jt,g,a,e],c(d);var R=n(d,2);R.__click=[Dt,l,g],c(b),B(()=>We(m,t(g).hasAdvantage)),C(y,b)},y=>{var g=Et();C(y,g)}),c(w),c(i),C(r,i),G()}J(["click","change"]);const Ut=async(r,a)=>{const e=prompt("Introduce el ID del grupo al que quieres unirte:");e&&a(e)},Wt=async(r,a)=>{confirm("Â¿Seguro que quieres abandonar el grupo actual?")&&a(null)},Gt=(r,a)=>{Ye(qe(`/parties?partyId=${a().party.partyId}`))};var Lt=p("<button>Unirse a un Grupo</button>"),Vt=p("<button>Abandonar Grupo</button> <button>Ver Grupo</button>",1),Bt=p('<div class="party svelte-1hn03u3"><!> <div class="buttons svelte-1hn03u3"><!></div></div>'),Jt=p('<div class="general svelte-1hn03u3"><!></div>'),Kt=p('<div class="skills svelte-1hn03u3"><!></div>'),Qt=p('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em><p>Valores disponibles: cuerpo, reflejos, mente, instinto, presencia, ppGastados.</p> <p>Funciones disponibles: floor, ceil, round, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math" class="svelte-1hn03u3">Math</a></p></em></small></div>'),Yt=p("<!> <!> <!> <!>",1);function Xt(r,a){W(a,!0);let e=U(a,"character",7);const l=Ie();let i=le(null);He(()=>{const f=e()?.party?.partyId??null;if(!f){H(i,null);return}(async()=>{try{await l.initFirebase();const y=await l.loadParty(f);console.log("[SettingsTab] Getting party name"),H(i,y?.name??null,!0)}catch{H(i,null)}})()});async function _(f){const y=f?.toString()?.trim()||null,g=e().party.partyId;if(!y){if(e().party.partyId=null,e().party.ownerId=null,H(i,null),a.onChange(e()),g&&e().id)try{const u=ee(l.user),b=u?u.uid:null;b&&typeof l.removePartyMember=="function"&&(await l.removePartyMember(g,b,e().id),console.debug("[SettingsTab] removePartyMember succeeded",{prevPid:g,uid:b,cid:e().id}))}catch(u){console.warn("[SettingsTab] removePartyMember failed (awaited)",u)}return}e().party.partyId=y;try{await l.initFirebase();const u=await l.loadParty(y);e().party.ownerId=u?.ownerId??null,H(i,u?.name??null,!0)}catch(u){console.warn("[SettingsTab] Failed to read party info",u),e().party={partyId:null,ownerId:null},H(i,null)}finally{a.onChange(e());try{const u=ee(l.user),b=u?u.uid:null;if(b&&y&&e().id)try{typeof l.setPartyMember=="function"&&(await l.setPartyMember(y,b,e().id),console.debug("[SettingsTab] setPartyMember succeeded",{pid:y,uid:b,cid:e().id}))}catch(P){console.warn("[SettingsTab] setPartyMember failed (awaited)",P),alert("No se pudo registrar el personaje en el grupo (permiso denegado o error).")}}catch{}}}var A=Yt(),x=Y(A);{var S=f=>{F(f,{title:"Grupo",children:(y,g)=>{var u=Bt(),b=v(u);{let m=O(()=>t(i)??e().party.partyId??"");N(b,{label:"Grupo Actual",placeholder:"Ninguno, pidele a tu DJ el ID del grupo",get value(){return t(m)},readonly:!0,fullWidth:!0})}var P=n(b,2),o=v(P);{var s=m=>{var R=Lt();R.__click=[Ut,_],C(m,R)},d=m=>{var R=Vt(),M=Y(R);M.__click=[Wt,_];var z=n(M,2);z.__click=[Gt,e],C(m,R)};E(o,m=>{e().party.partyId?m(d,!1):m(s)})}c(P),c(u),C(y,u)},$$slots:{default:!0}})};E(x,f=>{a.allowPartyChange&&f(S)})}var w=n(x,2);F(w,{title:"General",children:(f,y)=>{var g=Jt(),u=v(g);{let b=O(()=>e().img??"");N(u,{label:"URL del Retrato",get value(){return t(b)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:P=>{const o=P.toString();o.length>0?e().img=o:e().img=null,a.onChange(e())}})}c(g),C(f,g)},$$slots:{default:!0}});var h=n(w,2);F(h,{title:"Habilidades",children:(f,y)=>{var g=Kt(),u=v(g);Ot(u,{get skills(){return e().skills},onChange:b=>{e().skills=b,a.onChange(e())}}),c(g),C(f,g)},$$slots:{default:!0}});var k=n(h,2);F(k,{title:"Modificadores",children:(f,y)=>{var g=Qt(),u=v(g);Mt(u,{get modifiers(){return e().modifiers},onChange:b=>{e().modifiers=b,a.onChange(e())}}),Se(2),c(g),C(f,g)},$$slots:{default:!0}}),C(r,A),G()}J(["click"]);const Zt=(r,a,e)=>{const l=ee(a)?.uid;if(!l)return;const i=qe(`/characters/shared/${l}/${e().id}`);navigator.clipboard.writeText(window.location.origin+i),alert(`Se copio el enlace pÃºblico del personaje al portapapeles!

Compartelo con quien quieras que lo vea.`)};var $t=p("<button> </button>"),er=p('<span class="spacer svelte-1dl9cdg"></span> <button>ğŸ”— Compartir</button>',1),ar=p('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"><!> <!></div> <!></div>');function fr(r,a){W(a,!0);let e=U(a,"character",7),l=U(a,"allowPartyChange",3,!0),{user:i}=Ie();const _=[{name:"general",title:"General",component:Ka,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:va,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:la,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:ot,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:_t,availableWhenReadOnly:!0},{name:"economy",title:"EconomÃ­a",component:pa,availableWhenReadOnly:!0},{name:"settings",title:"ConfiguraciÃ³n",component:Xt,availableWhenReadOnly:!1},{name:"see_as_md",title:"Ver como MD",component:Ct,availableWhenReadOnly:!0}];let A=O(()=>Math.max(_.findIndex(o=>o.name===a.currentTab),0)),x=O(()=>_.find(o=>o.name===a.currentTab)??_[0]);const S=o=>{const s=o.copy();e(s),a.onChange(s)},w=o=>{H(A,o),a.onTabChange(_[o].name)};var h=ar(),k=v(h),f=v(k);Te(f,{get value(){return e().name},get readonly(){return a.readonly},onChange:o=>{e().name=o,S(e())}}),c(k);var y=n(k,2),g=v(y);X(g,19,()=>_,o=>o.title,(o,s,d)=>{var m=xe(),R=Y(m);{var M=z=>{var I=$t();let T;I.__click=()=>w(t(d));var j=v(I,!0);c(I),B(Z=>{T=$(I,1,"tab",null,T,Z),V(j,t(s).title)},[()=>({selected:t(A)===t(d)})]),C(z,I)};E(R,z=>{(t(s).availableWhenReadOnly||!a.readonly)&&z(M)})}C(o,m)});var u=n(g,2);{var b=o=>{var s=er(),d=n(Y(s),2);d.__click=[Zt,i,e],C(o,s)};E(u,o=>{a.readonly||o(b)})}c(y);var P=n(y,2);Ge(P,()=>t(x).component,(o,s)=>{s(o,{get character(){return e()},get readonly(){return a.readonly},onChange:S,get allowPartyChange(){return l()}})}),c(h),C(r,h),G()}J(["click"]);export{fr as C,lt as N,Te as T,ht as s};
