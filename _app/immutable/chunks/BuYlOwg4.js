import"./DsnmJJEf.js";import{p as W,b as k,ab as F,t as L,K as N,j as a,a as P,d as j,e as b,g as o,bf as Ne,r as u,f as K,aa as ee,J as te,Y as ze,aT as Te,c as De}from"./t0Cq7XZL.js";import{d as B,s as O,a as Fe,o as fe,e as Ee}from"./D_zjkKVN.js";import{i as D}from"./CuTJ2zLb.js";import{r as We,s as ae,e as Z}from"./BDY9aIh_.js";import{c as je}from"./Cj3oZ-tp.js";import{b as he,s as Q}from"./BmU-s7xp.js";import{p as E}from"./Pn6U6YSw.js";import{g as Y}from"./y52P6WVk.js";import{r as Ce}from"./FAsDFbmZ.js";import{a as Pe,u as ke}from"./J-oAiaes.js";import{C as T}from"./0WDDsGuN.js";import{u as He,a as pe,b as oe,C as Oe,c as Ge,d as Ue,f as me,I}from"./EWsrBkf5.js";import{C as Le}from"./BLLLuF8N.js";import{c as Ve}from"./CGjaQNWU.js";import{g as Be}from"./i9BYxFLC.js";import{b as Je}from"./DtnJLG4x.js";var Ke=(n,t,e)=>t.onChange(a(e)),Ye=k('<input type="text" class="svelte-19nbfo1"/>');function xe(n,t){W(t,!0);let e=E(t,"placeholder",3,void 0),r=F(()=>t.value);var l=Ye();We(l),l.__input=[Ke,t,r],L(()=>{ae(l,"placeholder",e()),l.disabled=t.readonly}),he(l,()=>a(r),y=>N(r,y)),P(n,l),j()}B(["input"]);var Qe=k("<label> </label>"),Xe=(n,t,e)=>t.onChange(a(e)),Ze=k("<div><!> <div><textarea></textarea></div></div>");function ve(n,t){W(t,!0);const e=6;let r=E(t,"label",3,void 0),l=E(t,"placeholder",3,""),y=E(t,"maxRows",3,e),x=F(()=>t.value);var w=Ze();let q;var A=b(w);{var _=i=>{var g=Qe(),p=b(g,!0);u(g),L(()=>O(p,r())),P(i,g)};D(A,i=>{r()&&i(_)})}var v=o(A,2);let C;var c=b(v);Ne(c),c.__input=[Xe,t,x];let f;u(v),u(w),L((i,g,p)=>{q=Q(w,1,"fieldgroup svelte-o02g58",null,q,i),C=Q(v,1,"field svelte-o02g58",null,C,g),c.disabled=t.readonly,ae(c,"placeholder",l()),ae(c,"rows",y()==="unlimited"?void 0:y()),f=Q(c,1,"svelte-o02g58",null,f,p)},[()=>({expanded:y()==="unlimited"}),()=>({expanded:y()==="unlimited"}),()=>({expanded:y()==="unlimited"})]),he(c,()=>a(x),i=>N(x,i)),P(n,w),j()}B(["input"]);var $e=k('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),et=k("<!> <!>",1);function tt(n,t){W(t,!0);let e=E(t,"character",7);var r=et(),l=K(r);{var y=w=>{T(w,{children:(q,A)=>{var _=$e(),v=b(_);u(_),L(()=>{ae(v,"src",e().img),ae(v,"alt",e().name)}),P(q,_)},$$slots:{default:!0}})};D(l,w=>{e().img&&w(y)})}var x=o(l,2);T(x,{children:(w,q)=>{ve(w,{label:"Historia",get value(){return e().story},get readonly(){return t.readonly},onChange:A=>{e().story=A,t.onChange(e())}})},$$slots:{default:!0}}),P(n,r),j()}var at=(n,t)=>t("ability"),rt=(n,t)=>t("item"),nt=k('<!> <div class="controls svelte-o497rd"><span class="svelte-o497rd">Agregar cartas a tu colecci√≥n</span> <div class="buttons svelte-o497rd"><button>Agregar Carta de Habilidad</button> <button>Agregar Carta de Objeto M√°gico</button></div></div>',1),lt=k('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),ot=k('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div> <div class="add-card-modal svelte-o497rd"><div class="all-cards svelte-o497rd"><!> <div class="cards-viewport svelte-o497rd"><!></div></div> <div class="footer svelte-o497rd"><span class="results-count"> </span> <button>Cerrar</button></div></div>',1);function it(n,t){W(t,!0);let e=E(t,"character",7),{loadAbilityCards:r,abilityCards:l,loadItemCards:y,itemCards:x}=pe(),{rollExpression:w}=Pe();const{buildEmptyFilters:q}=He();let A=ee(te(q({onlyAvailables:!0}))),_=ee(te([])),v=F(()=>e().cards.filter(R=>!a(_).some(z=>z.id===R.id))),C=ee(te({opened:!1,filteredCards:[],allCards:[]}));const c=l.subscribe(()=>{N(C,{...a(C),allCards:[],filteredCards:[]},!0)});Fe(()=>{c()}),fe(async()=>{await Promise.all([y(),r()]),N(_,[...Y(x),...Y(l)],!0)});const f=R=>{e().cards=R,t.onChange(e())},i=R=>{e().cards=[...e().cards.filter(z=>a(_).some(H=>H.id===z.id)),...R],t.onChange(e())},g=async R=>{const z=e().cards.find(U=>U.id===R),H=a(_).find(U=>U.id===R);z&&H&&z.uses!==null&&H&&await w({expression:"1d6",variables:{},title:`${e().name}: Recarga de carta ${H.name}`,resultFormatter:J=>`<span class="total ${J>=(H.uses?.qty??0)?"success":"failure"}">${J}</span>`})>=(H.uses?.qty??0)&&(z.uses+=1,f([...e().cards]))},p=R=>{N(A,R,!0),N(C,{...a(C),filteredCards:me(a(C).allCards,a(A),e())},!0)},m=()=>{p(q({onlyAvailables:!0}))},s=R=>{setTimeout(()=>{const z=R==="ability"?Y(l):Y(x);N(C,{opened:!0,filteredCards:me(z,a(A),e()),allCards:z},!0)},0)},d=()=>{N(C,{opened:!1,filteredCards:[],allCards:[]},!0)};var h=ot(),M=K(h),S=b(M);{var G=R=>{T(R,{children:(z,H)=>{var U=nt(),J=K(U);I(J,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return e().maxActiveCards},get readonly(){return t.readonly},fullWidth:!0,onChange:Ie=>{e().maxActiveCards=Number(Ie),t.onChange(e())}});var X=o(J,2),be=o(b(X),2),_e=b(be);_e.__click=[at,s];var Se=o(_e,2);Se.__click=[rt,s],u(be),u(X),P(z,U)},$$slots:{default:!0}})};D(S,R=>{t.readonly||R(G)})}var V=o(S,2);T(V,{get title(){return`Cartas Activas (${e().numActiveCards??""}/${e().maxActiveCards??""})`},children:(R,z)=>{{let H=F(()=>a(_).filter(U=>e().cards.some(J=>J.isActive&&J.id===U.id)));oe(R,{get cards(){return a(H)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"active",onChange:f,onCardReloadClick:g})}},$$slots:{default:!0}});var $=o(V,2);{let R=F(()=>`Colecci√≥n (${e().cards.length})`);T($,{get title(){return a(R)},children:(z,H)=>{{let U=F(()=>a(_).filter(J=>e().cards.some(X=>X.id===J.id)));oe(z,{get cards(){return a(U)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"collection",onChange:f})}},$$slots:{default:!0}})}var re=o($,2);{var ie=R=>{{let z=F(()=>`Cartas Corruptas (${a(v).length})`);T(R,{get title(){return a(z)},children:(H,U)=>{{let J=F(()=>a(v).map(X=>({id:X.id,name:"Carta Corrupta",level:X.level,tags:["Corrupta"],requirements:[],description:"Esta carta ya no existe. Por favor, eliminala.",uses:{qty:0,type:"USES"},type:"corrupta",cardType:X.cardType,img:Le.ABILITY_CARD_BACKGROUNDS.default})));oe(H,{get cards(){return a(J)},get readonly(){return t.readonly},get characterCards(){return a(v)},listMode:"collection",onChange:i})}},$$slots:{default:!0}})}};D(re,R=>{!t.readonly&&a(v).length>0&&R(ie)})}u(M);var ne=o(M,2),se=b(ne),ue=b(se);Oe(ue,{get cards(){return a(C).filteredCards},onFiltersChange:p,onResetFilters:m,get filters(){return a(A)},includeOnlyAvailablesFilter:!0});var ce=o(ue,2),Ae=b(ce);{var we=R=>{{let z=F(()=>a(C).filteredCards.filter(H=>e().cards.find(U=>U.id===H.id)===void 0));oe(R,{get cards(){return a(z)},get readonly(){return t.readonly},get characterCards(){return e().cards},listMode:"all",onChange:f})}},qe=R=>{var z=lt();P(R,z)};D(Ae,R=>{a(C).filteredCards.length>0?R(we):R(qe,!1)})}u(ce),u(se);var ge=o(se,2),de=b(ge),Me=b(de);u(de);var Re=o(de,2);Re.__click=d,u(ge),u(ne),Ge(ne,R=>Ue?.(R)),L(()=>{ae(ne,"hidden",!a(C).opened),O(Me,`${a(C).filteredCards.length??""}
			${a(C).filteredCards.length===1?"resultado":"resultados"}`)}),Ee("outsideclick",ne,d),P(n,h),j()}B(["click"]);const st=(n,t,e,r,l,y)=>{const x={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};r().goldHistory.unshift(x),l.onChange(r()),y()},dt=(n,t,e,r,l,y)=>{const x={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};r().goldHistory.unshift(x),l.onChange(r()),y()};var vt=k('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ut=k('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Raz√≥n</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),ct=(n,t,e)=>t(a(e)),gt=k('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),bt=k('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),_t=k('<div class="history svelte-ssntdk"></div>'),mt=k("<!> <!> <!>",1);function yt(n,t){W(t,!0);const e="Sin raz√≥n especifica";let r=E(t,"character",7),l=te({quantity:1,reason:""});const y=()=>{l.quantity=1,l.reason=""},x=C=>{r().goldHistory=r().goldHistory.filter(c=>c.id!==C.id),t.onChange(r())};var w=mt(),q=K(w);T(q,{title:"Estado Actual",children:(C,c)=>{var f=vt(),i=b(f),g=o(b(i),2);let p;var m=b(g,!0);u(g),u(i);var s=o(i,2),d=o(b(s),2),h=b(d,!0);u(d),u(s),u(f),L(M=>{p=Q(g,1,"number svelte-ssntdk",null,p,M),O(m,r().currentGold),O(h,r().spentGold)},[()=>({negative:r().currentGold<0})]),P(C,f)},$$slots:{default:!0}});var A=o(q,2);{var _=C=>{T(C,{title:"Actualizar Oro",children:(c,f)=>{var i=ut(),g=o(b(i),2),p=b(g);I(p,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:h=>{l.quantity=Number(h)}});var m=o(p,2);I(m,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:h=>{l.reason=h.toString()}});var s=o(m,2);s.__click=[dt,l,e,r,t,y];var d=o(s,2);d.__click=[st,l,e,r,t,y],u(g),u(i),P(c,i)},$$slots:{default:!0}})};D(A,C=>{t.readonly||C(_)})}var v=o(A,2);T(v,{title:"Historial",children:(C,c)=>{var f=_t();Z(f,21,()=>r().goldHistory,i=>i.id,(i,g)=>{var p=gt(),m=b(p);let s;var d=b(m);u(m);var h=o(m,2),M=b(h,!0);u(h);var S=o(h,2);S.__click=[ct,x,g],u(p),L(G=>{s=Q(m,1,"log-amount svelte-ssntdk",null,s,G),O(d,`${a(g).type==="add"?"+":"-"}${a(g).value??""} Oro`),O(M,a(g).reason)},[()=>({positive:a(g).type==="add",negative:a(g).type==="subtract"})]),P(i,p)},i=>{var g=bt();P(i,g)}),u(f),P(C,f)},$$slots:{default:!0}}),P(n,w),j()}B(["click"]);const ft=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),e.onChange(t())};var ht=k('<button title="Agregar Ataque">‚ûï</button>'),Ct=(n,t,e)=>t(a(e)),Pt=k('<button title="Eliminar" class="svelte-1v2w3y3">üóëÔ∏è</button>'),kt=k('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),pt=k('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Da√±o</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function xt(n,t){W(t,!0);let e=E(t,"attacks",7);const r=_=>{e(e().filter(v=>v.id!==_.id)),t.onChange(e())};var l=pt(),y=b(l),x=o(b(y),2);{var w=_=>{var v=ht();v.__click=[ft,e,t],P(_,v)};D(x,_=>{t.readonly||_(w)})}u(y);var q=o(y,2),A=o(b(q),2);Z(A,17,e,_=>_.id,(_,v,C)=>{var c=kt(),f=b(c);I(f,{get value(){return a(v).name},get readonly(){return t.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{a(v).name=d.toString(),t.onChange(e())}});var i=o(f,2);{let d=F(()=>({icon:"üéØ",title:"Tirar Ataque",onClick:()=>t.onAttackRoll(a(v)),disabled:!a(v).atkFormula}));I(i,{get value(){return a(v).atkFormula},get readonly(){return t.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:h=>{a(v).atkFormula=h.toString(),t.onChange(e())},get button(){return a(d)}})}var g=o(i,2);{let d=F(()=>({icon:"üí•",title:"Tirar Da√±o",onClick:()=>t.onDamageRoll(a(v)),disabled:!a(v).dmgFormula}));I(g,{get value(){return a(v).dmgFormula},get readonly(){return t.readonly},placeholder:"1d4",fullWidth:!0,onChange:h=>{a(v).dmgFormula=h.toString(),t.onChange(e())},get button(){return a(d)}})}var p=o(g,2);I(p,{get value(){return a(v).notes},get readonly(){return t.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{a(v).notes=d.toString(),t.onChange(e())}});var m=o(p,2);{var s=d=>{var h=Pt();h.__click=[Ct,r,v],P(d,h)};D(m,d=>{t.readonly||d(s)})}u(c),P(_,c)}),u(q),u(l),P(n,l),j()}B(["click"]);function le(n,t){W(t,!0);{let e=F(()=>({icon:"üé≤",onClick:t.onDiceRoll,title:"Tirar"}));I(n,{get label(){return t.name},get value(){return t.value},get readonly(){return t.readonly},onChange:r=>t.onChange(Number(r)),get button(){return a(e)}})}j()}const At=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),e.onChange(t())};var wt=k('<button title="Agregar Item">‚ûï</button>'),qt=(n,t,e)=>t(a(e)),Mt=k('<button title="Eliminar">üóëÔ∏è</button>'),Rt=k('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),St=k('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="quantity svelte-1ewnrao">Cantidad</label> <label class="name svelte-1ewnrao">Nombre</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function It(n,t){W(t,!0);let e=E(t,"equipment",7);const r=_=>{e(e().filter(v=>v.id!==_.id)),t.onChange(e())};var l=St(),y=b(l),x=o(b(y),2);{var w=_=>{var v=wt();v.__click=[At,e,t],P(_,v)};D(x,_=>{t.readonly||_(w)})}u(y);var q=o(y,2),A=o(b(q),2);Z(A,17,e,_=>_.id,(_,v,C)=>{var c=Rt(),f=b(c);I(f,{get value(){return a(v).quantity},get readonly(){return t.readonly},onChange:s=>{a(v).quantity=Number(s),t.onChange(e())}});var i=o(f,2);I(i,{get value(){return a(v).name},get readonly(){return t.readonly},placeholder:"Nombre",onChange:s=>{a(v).name=s.toString(),t.onChange(e())}});var g=o(i,2);I(g,{get value(){return a(v).notes},get readonly(){return t.readonly},placeholder:"Notas",fullWidth:!0,onChange:s=>{a(v).notes=s.toString(),t.onChange(e())}});var p=o(g,2);{var m=s=>{var d=Mt();d.__click=[qt,r,v],P(s,d)};D(p,s=>{t.readonly||s(m)})}u(c),P(_,c)}),u(q),u(l),P(n,l),j()}B(["click"]);var Nt=k('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),zt=k('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Tt=k('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),Dt=k('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Ft=k('<div class="empty svelte-ox7hjw"><em>El equipo esta vac√≠o.</em></div>'),Et=k('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Wt=k("<!> <!> <!> <!>",1);function jt(n,t){W(t,!0);let e=E(t,"character",7),{rollExpression:r,rollModal:l}=Pe();const y=c=>{l.openRollModal({expression:`1d6e+${c}`,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence,iniciativa:e().initiative},title:`${e().name}: ${Ve(c)}`})},x=c=>{l.openRollModal({expression:c.atkFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Ataque con ${c.name}`})},w=c=>{r({expression:c.dmgFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Da√±o de ${c.name}`})};var q=Wt(),A=K(q);T(A,{title:"Atributos Principales",children:(c,f)=>{var i=Nt(),g=b(i);le(g,{name:"Cuerpo",get value(){return e().attributes.body},get readonly(){return t.readonly},onDiceRoll:()=>y("cuerpo"),onChange:M=>{e().attributes.body=M,t.onChange(e())}});var p=o(g,2);le(p,{name:"Reflejos",get value(){return e().attributes.reflexes},get readonly(){return t.readonly},onDiceRoll:()=>y("reflejos"),onChange:M=>{e().attributes.reflexes=M,t.onChange(e())}});var m=o(p,2);le(m,{name:"Mente",get value(){return e().attributes.mind},get readonly(){return t.readonly},onDiceRoll:()=>y("mente"),onChange:M=>{e().attributes.mind=M,t.onChange(e())}});var s=o(m,2);le(s,{name:"Instinto",get value(){return e().attributes.instinct},get readonly(){return t.readonly},onDiceRoll:()=>y("instinto"),onChange:M=>{e().attributes.instinct=M,t.onChange(e())}});var d=o(s,2);le(d,{name:"Presencia",get value(){return e().attributes.presence},get readonly(){return t.readonly},onDiceRoll:()=>y("presencia"),onChange:M=>{e().attributes.presence=M,t.onChange(e())}});var h=o(d,2);I(h,{label:"Suerte",get value(){return e().currentLuck},get max(){return e().maxLuck},get readonly(){return t.readonly},onChange:M=>{e().currentLuck=Number(M),t.onChange(e())}}),u(i),P(c,i)},$$slots:{default:!0}});var _=o(A,2);T(_,{title:"Atributos Derivados",children:(c,f)=>{var i=zt(),g=b(i);I(g,{label:"Salud",get value(){return e().currentHP},get max(){return e().maxHP},get readonly(){return t.readonly},onChange:S=>{e().currentHP=Number(S),t.onChange(e())}});var p=o(g,2);I(p,{label:"Salud Temporal",get value(){return e().tempHP},get readonly(){return t.readonly},onChange:S=>{e().tempHP=Number(S),t.onChange(e())}});var m=o(p,2);I(m,{label:"Velocidad",get value(){return e().speed},readonly:!0});var s=o(m,2);I(s,{label:"Esquiva",get value(){return e().evasion},readonly:!0});var d=o(s,2);I(d,{label:"Mitigaci√≥n F√≠sica",get value(){return e().physicalMitigation},readonly:!0});var h=o(d,2);I(h,{label:"Mitigaci√≥n M√°gica",get value(){return e().magicalMitigation},readonly:!0});var M=o(h,2);I(M,{label:"Iniciativa",get value(){return e().initiative},readonly:!0,button:{icon:"üé≤",title:"Tirar iniciativa",onClick:()=>y("iniciativa")}}),u(i),P(c,i)},$$slots:{default:!0}});var v=o(_,2);T(v,{title:"Informaci√≥n",children:(c,f)=>{var i=Dt(),g=b(i);xt(g,{get attacks(){return e().attacks},get readonly(){return t.readonly},onChange:h=>{e().attacks=h,t.onChange(e())},onAttackRoll:x,onDamageRoll:w});var p=o(g,2);{var m=h=>{var M=Tt();P(h,M)};D(p,h=>{e().attacks.length===0&&h(m)})}var s=o(p,2);ve(s,{label:"Informaci√≥n R√°pida",get value(){return e().quickInfo},get readonly(){return t.readonly},placeholder:"Informaci√≥n general, habilidades, etc.",onChange:h=>{e().quickInfo=h,t.onChange(e())}});var d=o(s,2);I(d,{label:"Lenguas",get value(){return e().languages},get readonly(){return t.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:h=>{e().languages=h,t.onChange(e())}}),u(i),P(c,i)},$$slots:{default:!0}});var C=o(v,2);T(C,{title:"Equipo",children:(c,f)=>{var i=Et(),g=b(i);I(g,{label:"Oro",get value(){return e().currentGold},readonly:!0,fullWidth:!0});var p=o(g,2);It(p,{get equipment(){return e().equipment},get readonly(){return t.readonly},onChange:d=>{e().equipment=d,t.onChange(e())}});var m=o(p,2);{var s=d=>{var h=Ft();P(d,h)};D(m,d=>{e().equipment.length===0&&d(s)})}u(i),P(c,i)},$$slots:{default:!0}}),P(n,q),j()}const Ht=(n,t,e,r)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};N(t,[...a(t),l],!0),e.onChange(a(t)),r(l)};var Ot=(n,t,e)=>t(a(e)),Gt=k('<div class="header svelte-z1ulbz"><button title="Agregar Nota">‚ûï</button> <button title="Eliminar Nota">üóëÔ∏è</button></div>'),Ut=(n,t,e)=>t(a(e)),Lt=k('<button><span class="svelte-z1ulbz"> </span></button>'),Vt=k('<div class="notes svelte-z1ulbz"></div>'),Bt=k('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Jt=k('<div class="note svelte-z1ulbz"><!> <!></div>'),Kt=k('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Yt=k('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Qt(n,t){W(t,!0);let e=ee(te(t.notes)),r=ee(void 0),l=F(()=>a(e).find(s=>s.id===a(r)));const y=s=>{N(r,s.id,!0)},x=s=>{s&&(N(e,a(e).filter(d=>d.id!==s),!0),N(r,void 0),t.onChange(a(e)))},w=()=>{N(e,[...a(e)],!0),t.onChange(a(e))};var q=Yt(),A=b(q),_=b(A);{var v=s=>{var d=Gt(),h=b(d);h.__click=[Ht,e,t,y];var M=o(h,2);M.__click=[Ot,x,r],u(d),L(()=>M.disabled=!a(l)),P(s,d)};D(_,s=>{t.readonly||s(v)})}var C=o(_,2);{var c=s=>{var d=Vt();Z(d,21,()=>a(e),h=>h.id,(h,M)=>{var S=Lt();let G;S.__click=[Ut,y,M];var V=b(S),$=b(V,!0);u(V),u(S),L(re=>{G=Q(S,1,"note-btn svelte-z1ulbz",null,G,re),O($,a(M).title||"Nota sin t√≠tulo")},[()=>({selected:a(r)===a(M).id})]),P(h,S)}),u(d),P(s,d)},f=s=>{var d=Bt();P(s,d)};D(C,s=>{a(e).length>0?s(c):s(f,!1)})}u(A);var i=o(A,2),g=b(i);{var p=s=>{var d=Jt(),h=b(d);xe(h,{get value(){return a(l).title},get readonly(){return t.readonly},placeholder:"T√≠tulo de la nota",onChange:S=>{a(l).title=S,w()}});var M=o(h,2);ve(M,{get value(){return a(l).content},get readonly(){return t.readonly},placeholder:"Contenido de la nota",onChange:S=>{a(l).content=S,w()},maxRows:"unlimited"}),u(d),P(s,d)},m=s=>{var d=Kt();P(s,d)};D(g,s=>{a(l)?s(p):s(m,!1)})}u(i),u(q),P(n,q),j()}B(["click"]);function Xt(n,t){W(t,!0);let e=E(t,"character",7);T(n,{title:"Notas",children:(r,l)=>{Qt(r,{get notes(){return e().notes},get readonly(){return t.readonly},onChange:y=>{e().notes=y,t.onChange(e())}})},$$slots:{default:!0}}),j()}const Zt=(n,t,e,r,l,y)=>{const x={id:crypto.randomUUID(),type:"add",value:t.quantity,reason:t.reason||e};r().ppHistory.unshift(x),l.onChange(r()),y()},$t=(n,t,e,r,l,y)=>{const x={id:crypto.randomUUID(),type:"subtract",value:t.quantity,reason:t.reason||e};r().ppHistory.unshift(x),l.onChange(r()),y()};var ea=k('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Rango del PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),ta=k('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Raz√≥n</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),aa=(n,t,e)=>t(a(e)),ra=k('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acci√≥n">‚Ü∂</button></div>'),na=k('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),la=k('<div class="history svelte-1cdo061"></div>'),oa=k("<!> <!> <!>",1);function ia(n,t){W(t,!0);const e="Sin raz√≥n especifica";let r=E(t,"character",7),l=te({quantity:1,reason:""});const y=()=>{l.quantity=1,l.reason=""},x=C=>{r().ppHistory=r().ppHistory.filter(c=>c.id!==C.id),t.onChange(r())};var w=oa(),q=K(w);T(q,{title:"Estado Actual",children:(C,c)=>{var f=ea(),i=b(f),g=o(b(i),2);let p;var m=b(g,!0);u(g),u(i);var s=o(i,2),d=o(b(s),2),h=b(d,!0);u(d),u(s);var M=o(s,2),S=o(b(M),2),G=b(S,!0);u(S),u(M),u(f),L(V=>{p=Q(g,1,"number svelte-1cdo061",null,p,V),O(m,r().currentPP),O(h,r().spentPP),O(G,r().tier)},[()=>({negative:r().currentPP<0})]),P(C,f)},$$slots:{default:!0}});var A=o(q,2);{var _=C=>{T(C,{title:"Actualizar Progreso",children:(c,f)=>{var i=ta(),g=o(b(i),2),p=b(g);I(p,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:h=>{l.quantity=Number(h)}});var m=o(p,2);I(m,{get value(){return l.reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:h=>{l.reason=h.toString()}});var s=o(m,2);s.__click=[$t,l,e,r,t,y];var d=o(s,2);d.__click=[Zt,l,e,r,t,y],u(g),u(i),P(c,i)},$$slots:{default:!0}})};D(A,C=>{t.readonly||C(_)})}var v=o(A,2);T(v,{title:"Historial",children:(C,c)=>{var f=la();Z(f,21,()=>r().ppHistory,i=>i.id,(i,g)=>{var p=ra(),m=b(p);let s;var d=b(m);u(m);var h=o(m,2),M=b(h,!0);u(h);var S=o(h,2);S.__click=[aa,x,g],u(p),L(G=>{s=Q(m,1,"log-amount svelte-1cdo061",null,s,G),O(d,`${a(g).type==="add"?"+":"-"}${a(g).value??""} PP`),O(M,a(g).reason)},[()=>({positive:a(g).type==="add",negative:a(g).type==="subtract"})]),P(i,p)},i=>{var g=na();P(i,g)}),u(f),P(C,f)},$$slots:{default:!0}}),P(n,w),j()}B(["click"]);const sa=(n,t)=>{let e="";if(e+=`# ${n.name}

`,e+=`## Atributos
`,e+=`- **Cuerpo:** ${n.attributes.body}
`,e+=`- **Reflejos:** ${n.attributes.reflexes}
`,e+=`- **Mente:** ${n.attributes.mind}
`,e+=`- **Instinto:** ${n.attributes.instinct}
`,e+=`- **Presencia:** ${n.attributes.presence}

`,e+=`- **Suerte:** ${n.currentLuck}/${n.maxLuck}
`,e+=`
`,e+=`## Atributos derivados
`,e+=`- **Salud:** ${n.currentHP}/${n.maxHP}
`,e+=`- **Salud Temporal:** ${n.tempHP}
`,e+=`- **Velocidad:** ${n.speed}
`,e+=`- **Esquiva:** ${n.evasion}
`,e+=`- **Mitigaci√≥n F√≠sica:** ${n.physicalMitigation}
`,e+=`- **Mitigaci√≥n M√°gica:** ${n.magicalMitigation}
`,e+=`- **Iniciativa:** ${n.initiative}
`,e+=`
`,n.quickInfo&&(e+=`## Informaci√≥n R√°pida
`,e+=`\`\`\`${n.quickInfo}
\`\`\`
`,e+=`
`),e+=`## Lenguas
`,e+=`${n.languages||"-"}
`,e+=`
`,e+=`## Oro
`,e+=`${n.currentGold}
`,e+=`
`,e+=`## Inventario
`,n.equipment.length>0){e+=`| Cantidad | Nombre | Notas |
`,e+=`| - | - | - |
`;for(const r of n.equipment)e+=`| ${r.quantity} | ${r.name} | ${r.notes} |
`}else e+=`__No hay items en el inventario.__
`;if(e+=`
`,e+=`## Cartas
`,e+=`**Cartas activas:** ${n.numActiveCards}${n.maxActiveCards}
`,e+=`### Colecci√≥n
`,n.cards.length>0){e+=`| Nombre | Tipo | Activa |
`,e+=`| - | - | - |
`;for(const r of n.cards){const l=t.find(y=>y.id===r.id);l&&(e+=`| ${l.name} | ${l.cardType==="item"?"Objeto M√°gico":"Habilidad"} | ${r.isActive?"Si":"No"} |
`)}}else e+=`__No hay cartas en la colecci√≥n.__
`;if(e+=`
`,e+=`## Progreso
`,e+=`- **PP Actuales:** ${n.currentPP}
`,e+=`- **PP Gastados:** ${n.spentPP}
`,e+=`- **Rango del Personaje:** ${n.tier}
`,e+=`
`,n.story&&(e+=`## Historia
`,e+=`${n.story}
`,e+=`
`),n.notes.length>0){e+=`## Notas del Jugador
`;for(const r of n.notes)e+=`### ${r.title}
`,e+=`\`\`\`${r.content}\`\`\`
`;e+=`
`}return e},da=async(n,t)=>{try{await navigator.clipboard.writeText(a(t)),alert("Personaje en formato Markdown copiado al portapapeles!")}catch(e){console.error("Failed to copy text: ",e),alert("Error al copiar el markdown al portapapeles")}};var va=k('<div class="header svelte-1m8ejye"><label>Personaje</label> <button>Copiar Markdown</button></div> <pre class="svelte-1m8ejye"> </pre>',1);function ua(n,t){W(t,!0);let e=ee(te([])),{loadAbilityCards:r,abilityCards:l,loadItemCards:y,itemCards:x}=pe(),w=F(()=>sa(t.character,a(e)));fe(async()=>{await Promise.all([y(),r()]),N(e,[...Y(x),...Y(l)],!0)}),T(n,{children:(q,A)=>{var _=va(),v=K(_),C=o(b(v),2);C.__click=[da,w],u(v);var c=o(v,2),f=b(c,!0);u(c),L(()=>O(f,a(w))),P(q,_)},$$slots:{default:!0}}),j()}B(["click"]);var ca=(n,t,e)=>t()(a(e)),ga=k("<option> </option>"),ba=k('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function ye(n,t){W(t,!0);let e=E(t,"onChange",3,()=>{}),r=F(()=>t.value);var l=ba(),y=b(l);y.__change=[ca,e,r],Z(y,21,()=>t.options,x=>x.label,(x,w)=>{var q=ga(),A=b(q,!0);u(q);var _={};L(()=>{O(A,a(w).label),_!==(_=a(w).value)&&(q.value=(q.__value=a(w).value)??"")}),P(x,q)}),u(y),u(l),Je(y,()=>a(r),x=>N(r,x)),P(n,l),j()}B(["change"]);const _a=(n,t,e)=>{t([...t(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),e.onChange(t())};var ma=(n,t,e)=>t(a(e)),ya=k('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">üóëÔ∏è</button></div>'),fa=k('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),ha=k('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">‚ûï</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Raz√≥n</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function Ca(n,t){W(t,!0);let e=E(t,"modifiers",7);const r=A=>{e(e().filter(_=>_.id!==A.id)),t.onChange(e())};var l=ha(),y=b(l),x=o(b(y),2);x.__click=[_a,e,t],u(y);var w=o(y,2),q=o(b(w),2);Z(q,17,e,A=>A.id,(A,_,v)=>{var C=ya(),c=b(C);ye(c,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return a(_).type},onChange:m=>{a(_).type=m.toString(),t.onChange(e())}});var f=o(c,2);ye(f,{options:[{label:"Salud M√°xima",value:"maxHP"},{label:"Suerte M√°xima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigaci√≥n F√≠sica",value:"physicalMitigation"},{label:"Mitigaci√≥n M√°gica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return a(_).attribute},onChange:m=>{a(_).attribute=m.toString(),t.onChange(e())}});var i=o(f,2);I(i,{get value(){return a(_).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:m=>{a(_).formula=m.toString(),t.onChange(e())}});var g=o(i,2);I(g,{get value(){return a(_).reason},placeholder:"Raz√≥n",fullWidth:!0,onChange:m=>{a(_).reason=m.toString(),t.onChange(e())}});var p=o(g,2);p.__click=[ma,r,_],u(C),P(A,C)},A=>{var _=fa();P(A,_)}),u(w),u(l),P(n,l),j()}B(["click"]);const Pa=async(n,t)=>{const e=prompt("Introduce el ID del grupo al que quieres unirte:");e&&t(e)},ka=async(n,t)=>{confirm("¬øSeguro que quieres abandonar el grupo actual?")&&t(null)},pa=(n,t)=>{Be(Ce(`/parties?partyId=${t().party.partyId}`))};var xa=k("<button>Unirse a un Grupo</button>"),Aa=k("<button>Abandonar Grupo</button> <button>Ver Grupo</button>",1),wa=k('<div class="party svelte-1hn03u3"><!> <div class="buttons svelte-1hn03u3"><!></div></div>'),qa=k('<div class="general svelte-1hn03u3"><!></div>'),Ma=k('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),Ra=k("<!> <!> <!>",1);function Sa(n,t){W(t,!0);let e=E(t,"character",7);const r=ke();let l=ee(null);ze(()=>{const v=e()?.party?.partyId??null;if(!v){N(l,null);return}(async()=>{try{await r.initFirebase();const C=await r.loadParty(v);console.log("[SettingsTab] Getting party name"),N(l,C?.name??null,!0)}catch{N(l,null)}})()});async function y(v){const C=v?.toString()?.trim()||null,c=e().party.partyId;if(!C){if(e().party.partyId=null,e().party.ownerId=null,N(l,null),t.onChange(e()),c&&e().id)try{const f=Y(r.user),i=f?f.uid:null;i&&typeof r.removePartyMember=="function"&&(await r.removePartyMember(c,i,e().id),console.debug("[SettingsTab] removePartyMember succeeded",{prevPid:c,uid:i,cid:e().id}))}catch(f){console.warn("[SettingsTab] removePartyMember failed (awaited)",f)}return}e().party.partyId=C;try{await r.initFirebase();const f=await r.loadParty(C);e().party.ownerId=f?.ownerId??null,N(l,f?.name??null,!0)}catch(f){console.warn("[SettingsTab] Failed to read party info",f),e().party={partyId:null,ownerId:null},N(l,null)}finally{t.onChange(e());try{const f=Y(r.user),i=f?f.uid:null;if(i&&C&&e().id)try{typeof r.setPartyMember=="function"&&(await r.setPartyMember(C,i,e().id),console.debug("[SettingsTab] setPartyMember succeeded",{pid:C,uid:i,cid:e().id}))}catch(g){console.warn("[SettingsTab] setPartyMember failed (awaited)",g),alert("No se pudo registrar el personaje en el grupo (permiso denegado o error).")}}catch{}}}var x=Ra(),w=K(x);{var q=v=>{T(v,{title:"Grupo",children:(C,c)=>{var f=wa(),i=b(f);{let d=F(()=>a(l)??e().party.partyId??"");I(i,{label:"Grupo Actual",placeholder:"Ninguno, pidele a tu DJ el ID del grupo",get value(){return a(d)},readonly:!0,fullWidth:!0})}var g=o(i,2),p=b(g);{var m=d=>{var h=xa();h.__click=[Pa,y],P(d,h)},s=d=>{var h=Aa(),M=K(h);M.__click=[ka,y];var S=o(M,2);S.__click=[pa,e],P(d,h)};D(p,d=>{e().party.partyId?d(s,!1):d(m)})}u(g),u(f),P(C,f)},$$slots:{default:!0}})};D(w,v=>{t.allowPartyChange&&v(q)})}var A=o(w,2);T(A,{title:"General",children:(v,C)=>{var c=qa(),f=b(c);{let i=F(()=>e().img??"");I(f,{label:"URL del Retrato",get value(){return a(i)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:g=>{const p=g.toString();p.length>0?e().img=p:e().img=null,t.onChange(e())}})}u(c),P(v,c)},$$slots:{default:!0}});var _=o(A,2);T(_,{title:"Modificadores",children:(v,C)=>{var c=Ma(),f=b(c);Ca(f,{get modifiers(){return e().modifiers},onChange:i=>{e().modifiers=i,t.onChange(e())}}),Te(2),u(c),P(v,c)},$$slots:{default:!0}}),P(n,x),j()}B(["click"]);const Ia=(n,t,e)=>{const r=Y(t)?.uid;if(!r)return;const l=Ce(`/characters/shared/${r}/${e().id}`);navigator.clipboard.writeText(window.location.origin+l),alert(`Se copio el enlace p√∫blico del personaje al portapapeles!

Compartelo con quien quieras que lo vea.`)};var Na=k("<button> </button>"),za=k('<span class="spacer svelte-1dl9cdg"></span> <button>üîó Compartir</button>',1),Ta=k('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"><!> <!></div> <!></div>');function Za(n,t){W(t,!0);let e=E(t,"character",7),r=E(t,"allowPartyChange",3,!0),{user:l}=ke();const y=[{name:"general",title:"General",component:jt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:it,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:tt,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Xt,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:ia,availableWhenReadOnly:!0},{name:"economy",title:"Econom√≠a",component:yt,availableWhenReadOnly:!0},{name:"settings",title:"Configuraci√≥n",component:Sa,availableWhenReadOnly:!1},{name:"see_as_md",title:"Ver como MD",component:ua,availableWhenReadOnly:!0}];let x=F(()=>Math.max(y.findIndex(m=>m.name===t.currentTab),0)),w=F(()=>y.find(m=>m.name===t.currentTab)??y[0]);const q=m=>{const s=m.copy();e(s),t.onChange(s)},A=m=>{N(x,m),t.onTabChange(y[m].name)};var _=Ta(),v=b(_),C=b(v);xe(C,{get value(){return e().name},get readonly(){return t.readonly},onChange:m=>{e().name=m,q(e())}}),u(v);var c=o(v,2),f=b(c);Z(f,19,()=>y,m=>m.title,(m,s,d)=>{var h=De(),M=K(h);{var S=G=>{var V=Na();let $;V.__click=()=>A(a(d));var re=b(V,!0);u(V),L(ie=>{$=Q(V,1,"tab",null,$,ie),O(re,a(s).title)},[()=>({selected:a(x)===a(d)})]),P(G,V)};D(M,G=>{(a(s).availableWhenReadOnly||!t.readonly)&&G(S)})}P(m,h)});var i=o(f,2);{var g=m=>{var s=za(),d=o(K(s),2);d.__click=[Ia,l,e],P(m,s)};D(i,m=>{t.readonly||m(g)})}u(c);var p=o(c,2);je(p,()=>a(w).component,(m,s)=>{s(m,{get character(){return e()},get readonly(){return t.readonly},onChange:q,get allowPartyChange(){return r()}})}),u(_),P(n,_),j()}B(["click"]);export{Za as C,Qt as N,xe as T,sa as s};
