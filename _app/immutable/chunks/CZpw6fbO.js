import"./DsnmJJEf.js";import{G as Te,J as Ie,I as je,a2 as Ge,aa as _e,bi as xe,aw as We,h as a,Q as T,aN as ke,p as de,b as y,e as _,r as d,g as h,ab as H,t as D,a as m,d as ue,aV as Be,f as W,c as $,s as Qe}from"./Cx9SZC40.js";import{d as me,s as S,e as Ye}from"./FRtchhGd.js";import{i as F}from"./BQQjEHXb.js";import{e as he,r as fe,s as V,b as Xe,d as Ue,f as He}from"./y3PUPQak.js";import{b as Ne,s as ce}from"./BKawnmId.js";import{p as P}from"./BqEhn_dl.js";import{b as Je,r as we,l as Ke}from"./BQL_5efD.js";import{C as Ve,s as Ee}from"./_p_6lNmE.js";import{C as Z}from"./CyC3GOE6.js";import{h as Ze}from"./DswigK_E.js";import{d as $e}from"./Bx3Ta1aT.js";import{r as et}from"./BU-tBLa1.js";import{p as M}from"./CYBxATdP.js";import{r as tt}from"./B-cUA3C8.js";import{m as at,a as st}from"./CaGjeo4y.js";import{w as Oe,g as rt}from"./nYHX28hn.js";function lt(l,e,t){Te(()=>{var s=Ie(()=>e(l,t?.())||{});if(s?.destroy)return()=>s.destroy()})}function nt(l,e,t,s,o){var v=()=>{s(t[l])};t.addEventListener(e,v),o?je(()=>{t[l]=o()}):v(),(t===document.body||t===window||t===document)&&Ge(()=>{t.removeEventListener(e,v)})}const it=l=>{window.addEventListener("click",e);function e(t){l.contains(t.target)||l.dispatchEvent(new CustomEvent("outsideclick"))}return{destroy(){window.removeEventListener("click",e)}}};var ot=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],vt=["difference","intersection","symmetricDifference","union"],Le=!1;class re extends Set{#a=new Map;#e=_e(0);#t=_e(0);#s=xe||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#t.v=super.size}Le||this.#l()}#r(e){return xe===this.#s?_e(e):We(e)}#l(){Le=!0;var e=re.prototype,t=Set.prototype;for(const s of ot)e[s]=function(...o){return a(this.#e),t[s].apply(this,o)};for(const s of vt)e[s]=function(...o){a(this.#e);var v=t[s].apply(this,o);return new re(v)}}has(e){var t=super.has(e),s=this.#a,o=s.get(e);if(o===void 0){if(!t)return a(this.#e),!1;o=this.#r(!0),s.set(e,o)}return a(o),t}add(e){return super.has(e)||(super.add(e),T(this.#t,super.size),ke(this.#e)),this}delete(e){var t=super.delete(e),s=this.#a,o=s.get(e);return o!==void 0&&(s.delete(e),T(o,!1)),t&&(T(this.#t,super.size),ke(this.#e)),t}clear(){if(super.size!==0){super.clear();var e=this.#a;for(var t of e.values())T(t,!1);e.clear(),T(this.#t,0),ke(this.#e)}}keys(){return this.values()}values(){return a(this.#e),super.values()}entries(){return a(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return a(this.#t)}}const ct=(l,e,t)=>{T(e,new re),t.onChange(Array.from(a(e)))};var dt=(l,e,t)=>e(l.target.checked,a(t).value),ut=y('<li class="svelte-1d1gkms"><label class="svelte-1d1gkms"> <input type="checkbox" class="svelte-1d1gkms"/></label></li>'),_t=y('<details class="svelte-1d1gkms"><summary class="svelte-1d1gkms"> </summary> <form class="svelte-1d1gkms"><fieldset class="svelte-1d1gkms"><ul class="svelte-1d1gkms"></ul> <button class="clear-btn svelte-1d1gkms">Limpiar</button></fieldset></form></details>');function ze(l,e){de(e,!0);let t=H(()=>new re(e.value));const s=(w,C)=>{w?a(t).add(C):a(t).delete(C),T(t,new re(a(t))),e.onChange(Array.from(a(t)))};let o=_e(!1);const v=()=>{T(o,!1)};var c=_t(),r=_(c),g=_(r);d(r);var R=h(r,2),E=_(R),x=_(E);he(x,21,()=>e.options,w=>w.value,(w,C)=>{var U=ut(),N=_(U),i=_(N),n=h(i);fe(n),n.__input=[dt,s,C],d(N),d(U),D(u=>{V(N,"for",a(C).value),S(i,`${a(C).label??""} `),V(n,"id",a(C).value),V(n,"name",a(C).value),Xe(n,a(C).value),Ue(n,u)},[()=>a(t).has(a(C).value)]),m(w,U)}),d(x);var q=h(x,2);q.__click=[ct,t,e],d(E),d(R),d(c),lt(c,w=>it?.(w)),Te(()=>nt("open","toggle",c,w=>T(o,w),()=>a(o))),D(()=>{S(g,`${e.summary??""} (${a(t).size??""})`),q.disabled=a(t).size===0}),Ye("outsideclick",c,v),m(l,c),ue()}me(["input","click"]);var ft=(l,e,t)=>e.onFiltersChange({...a(t)}),mt=(l,e,t)=>{a(e).type=l.target.value,t.onFiltersChange({...a(e)})},ht=y("<option> </option>"),bt=(l,e,t)=>{a(e).onlyAvailables=l.target.checked,t.onFiltersChange({...a(e)})},gt=y('<div class="only-availables-field svelte-1o8sb8t"><label for="only-availables" class="svelte-1o8sb8t"><input type="checkbox" id="only-availables" class="svelte-1o8sb8t"/>Ver Solo disponibles</label></div>'),pt=(l,e)=>e.onResetFilters(),yt=y('<div class="filters svelte-1o8sb8t"><input type="text" placeholder="Buscar por nombre" class="svelte-1o8sb8t"/> <select class="svelte-1o8sb8t"><option>Todos los Tipos</option><!></select> <!> <!> <!> <button>Limpiar Filtros</button></div>');function _a(l,e){de(e,!0);let t=P(e,"includeOnlyAvailablesFilter",3,!1),s=H(()=>e.filters);const o=()=>{const r=new Set(e.cards.map(g=>g.level));return Array.from(r).sort((g,R)=>g-R)},v=()=>{const r=new Set(e.cards.flatMap(g=>g.tags));return Array.from(r).sort()},c=()=>{const r=new Set(e.cards.map(g=>g.type));return Array.from(r).sort()};Ve(l,{children:(r,g)=>{var R=yt(),E=_(R);fe(E),E.__input=[ft,e,s];var x=h(E,2);x.__change=[mt,s,e];var q=_(x);q.value=q.__value="";var w=h(q);he(w,16,c,u=>u,(u,p)=>{var z=ht(),j=_(z,!0);d(z);var A={};D(b=>{S(j,b),A!==(A=p)&&(z.value=(z.__value=p)??"")},[()=>Je(p)]),m(u,z)}),d(x);var C=h(x,2);{let u=H(()=>o().map(p=>({value:p,label:`Nivel ${p}`})));ze(C,{summary:"Niveles",get options(){return a(u)},get value(){return a(s).level},onChange:p=>{a(s).level=p,e.onFiltersChange({...a(s)})}})}var U=h(C,2);{let u=H(()=>v().map(p=>({value:p.toLowerCase(),label:p})));ze(U,{summary:"Etiquetas",get options(){return a(u)},get value(){return a(s).tags},onChange:p=>{a(s).tags=p.map(z=>z.toLowerCase()),e.onFiltersChange({...a(s)})}})}var N=h(U,2);{var i=u=>{var p=gt(),z=_(p),j=_(z);fe(j),j.__input=[bt,s,e],Be(),d(z),d(p),D(()=>Ue(j,a(s).onlyAvailables)),m(u,p)};F(N,u=>{t()&&u(i)})}var n=h(N,2);n.__click=[pt,e],d(R),Ne(E,()=>a(s).name,u=>a(s).name=u),m(r,R)},$$slots:{default:!0}}),ue()}me(["input","change","click"]);var Ct=y("<label> </label>"),At=(l,e,t,s)=>{e.max!==void 0&&typeof a(t)=="number"&&T(t,Math.min(a(t),e.max)),s()(a(t))},kt=y('<span class="divider svelte-1r47u3b">/</span> <span> </span>',1),wt=y('<button class="button svelte-1r47u3b"> </button>'),xt=y("<div><!> <span><input/> <!> <!></span></div>");function Et(l,e){de(e,!0);let t=P(e,"label",3,void 0),s=P(e,"labelWidth",3,"normalized"),o=P(e,"readonly",3,!1),v=P(e,"onChange",3,()=>{}),c=P(e,"button",3,void 0),r=P(e,"fullWidth",3,!1),g=P(e,"placeholder",3,""),R=P(e,"textAlign",3,"center"),E=H(()=>e.value);var x=xt();let q;var w=_(x);{var C=A=>{var b=Ct(),O=_(b,!0);d(b),D(()=>{ce(b,1,He(s()),"svelte-1r47u3b"),S(O,t())}),m(A,b)};F(w,A=>{t()&&A(C)})}var U=h(w,2);let N;var i=_(U);fe(i);let n;V(i,"min",0),i.__input=[At,e,E,v];var u=h(i,2);{var p=A=>{var b=kt(),O=h(W(b),2);let J;var le=_(O,!0);d(O),D(ee=>{J=ce(O,1,"max svelte-1r47u3b",null,J,ee),S(le,e.max)},[()=>({withButton:c()!==void 0})]),m(A,b)};F(u,A=>{e.max!==void 0&&A(p)})}var z=h(u,2);{var j=A=>{var b=wt();b.__click=function(...J){c().onClick?.apply(this,J)};var O=_(b,!0);d(b),D(()=>{V(b,"title",c().title),b.disabled=c().disabled,S(O,c().icon)}),m(A,b)};F(z,A=>{c()&&A(j)})}d(U),d(x),D((A,b,O)=>{q=ce(x,1,"fieldgroup svelte-1r47u3b",null,q,A),N=ce(U,1,"field svelte-1r47u3b",null,N,b),V(i,"type",typeof e.value=="number"?"number":"text"),i.disabled=o(),n=ce(i,1,`text-align-${R()}`,"svelte-1r47u3b",n,O),V(i,"max",e.max),V(i,"placeholder",g())},[()=>({fullWidth:r()}),()=>({inputAlone:e.max===void 0&&c()===void 0&&!r(),inputWithButton:c()!==void 0,fullWidth:r(),readonly:o()}),()=>({alone:e.max===void 0&&c()===void 0,fullWidth:r(),withButton:c()!==void 0,withButtonAndMax:e.max!==void 0&&c()!==void 0})]),Ne(i,()=>a(E),A=>T(E,A)),m(l,x),ue()}me(["input","click"]);var Lt=y('<span class="chip svelte-6vztta"> </span>'),zt=y('<span class="chip svelte-6vztta"> </span>'),St=y('<span class="chip svelte-6vztta"> </span>'),Ft=y('<span class="chip svelte-6vztta"> </span>'),Rt=y('<span class="chip svelte-6vztta"> </span>'),Tt=y('<span class="chip svelte-6vztta"> </span>'),Ut=y('<div class="controls svelte-6vztta"><!></div>'),Nt=y('<div class="card svelte-6vztta"><div class="bg svelte-6vztta"></div> <div class="inner svelte-6vztta"><div class="header svelte-6vztta"><div class="chips svelte-6vztta"><span class="chip svelte-6vztta"> </span> <span class="chip svelte-6vztta"> </span> <span class="spacer svelte-6vztta"></span> <span class="chip svelte-6vztta"> </span></div> <h3 class="svelte-6vztta"> </h3></div> <div class="body svelte-6vztta"><span class="description svelte-6vztta"><!></span> <div class="tags svelte-6vztta"><!> <!> <!></div></div> <div class="footer svelte-6vztta"><span class="requirements svelte-6vztta">REQUERIMIENTOS</span> <div class="requirements-list svelte-6vztta"><span> </span></div> <!></div></div></div>');function Ot(l,e){de(e,!0);let t=P(e,"children",3,void 0);const s=f=>{switch(we(f.length>0?String(f[0]).toLowerCase():"")){case"arcanista":return"var(--accent-arcanista)";case"combatiente":return"var(--accent-combatiente)";case"picaro":return"var(--accent-picaro)";case"druida":return"var(--accent-druida)";case"sacerdote":return"var(--accent-sacerdote)";case"bardo":return"var(--accent-bardo)";case"dote":return"var(--accent-dote)";case"linaje":return"var(--accent-linaje)";default:return"var(--accent-default)"}};var o=Nt();let v;var c=_(o);let r;var g=h(c,2),R=_(g),E=_(R),x=_(E),q=_(x,!0);d(x);var w=h(x,2),C=_(w);d(w);var U=h(w,4),N=_(U,!0);d(U),d(E);var i=h(E,2),n=_(i,!0);d(i),d(R);var u=h(R,2),p=_(u),z=_(p);Ze(z,()=>$e.parse(e.card.description)),d(p);var j=h(p,2),A=_(j);he(A,16,()=>e.card.tags,f=>f,(f,k)=>{var L=Lt(),Y=_(L,!0);d(L),D(()=>S(Y,k)),m(f,L)});var b=h(A,2);{var O=f=>{var k=$(),L=W(k);{var Y=Q=>{var X=zt(),ve=_(X);d(X),D(()=>S(ve,`Usos: ${e.card.uses.qty??"?"??""} por dÃ­a de descanso`)),m(Q,X)},oe=Q=>{var X=$(),ve=W(X);{var be=I=>{var G=St(),pe=_(G);d(G),D(()=>S(pe,`Usos: ${e.card.uses.qty??"?"??""} por dÃ­a`)),m(I,G)},ge=I=>{var G=$(),pe=W(G);{var Pe=ae=>{var se=Ft(),ye=_(se);d(se),D(()=>S(ye,`Usos: 1 (Recarga ${e.card.uses.qty??"?"??""}+)`)),m(ae,se)},De=ae=>{var se=$(),ye=W(se);{var Me=Ce=>{var Ae=Rt(),qe=_(Ae);d(Ae),D(()=>S(qe,`Usos: ${e.card.uses.qty??"?"??""}`)),m(Ce,Ae)};F(ye,Ce=>{e.card.uses.type==="USES"&&Ce(Me)},!0)}m(ae,se)};F(pe,ae=>{e.card.uses.type==="RELOAD"?ae(Pe):ae(De,!1)},!0)}m(I,G)};F(ve,I=>{e.card.uses.type==="DAY"?I(be):I(ge,!1)},!0)}m(Q,X)};F(L,Q=>{e.card.uses.type==="LONG_REST"?Q(Y):Q(oe,!1)})}m(f,k)};F(b,f=>{e.card.uses.type&&f(O)})}var J=h(b,2);{var le=f=>{var k=Tt(),L=_(k);d(k),D(()=>S(L,`Costo: ${e.card.cost??""} de oro`)),m(f,k)};F(J,f=>{e.card.cardType==="item"&&f(le)})}d(j),d(u);var ee=h(u,2),B=h(_(ee),2),K=_(B),te=_(K,!0);d(K),d(B);var ne=h(B,2);{var ie=f=>{var k=Ut(),L=_(k);Qe(L,t),d(k),m(f,k)};F(ne,f=>{t()!==void 0&&f(ie)})}d(ee),d(g),d(o),D((f,k,L,Y)=>{v=Ee(o,"",v,f),r=Ee(c,"",r,k),S(q,e.card.cardType==="ability"?"Habilidad":"Objeto MÃ¡gico"),S(C,`Nivel ${e.card.level??""}`),S(N,L),S(n,e.card.name),S(te,Y)},[()=>({"border-color":s(e.card.tags)}),()=>({"background-image":`url(${e.card.img})`}),()=>e.card.type.charAt(0).toUpperCase()+e.card.type.slice(1),()=>e.card.requirements.length>0?e.card.requirements.join(", "):"â€”"]),m(l,o),ue()}var Pt=(l,e,t)=>e(a(t).id),Dt=y('<!> <span class="spacer"></span> <button>Desactivar</button>',1),Mt=(l,e,t)=>e(a(t).id),qt=(l,e,t)=>e(a(t).id),It=y("<button>Desactivar</button>"),jt=(l,e,t)=>e(a(t).id),Gt=y("<button>Activar</button>"),Wt=y('<button>Quitar</button> <span class="spacer"></span> <!>',1),Bt=(l,e,t)=>e(a(t)),Qt=y('<span class="spacer"></span> <button>Agregar</button>',1),Yt=y('<div class="controls svelte-1rfcjb3"><!></div>'),Xt=y('<div class="cards svelte-1rfcjb3"></div>');function fa(l,e){de(e,!0);let t=P(e,"readonly",3,!0),s=P(e,"characterCards",19,()=>[]),o=P(e,"listMode",3,"all"),v=P(e,"onChange",3,()=>{}),c=P(e,"onCardReloadClick",3,()=>{}),r=H(s);const g=i=>{const n=e.cards.find(u=>u.id===i);if(!n){E(i);return}T(r,a(r).map(u=>u.id===i?{...u,isActive:!1,uses:C(n)}:u)),v()(a(r))},R=i=>{T(r,a(r).map(n=>n.id===i?{...n,isActive:!0}:n)),v()(a(r))},E=i=>{T(r,a(r).filter(n=>n.id!==i)),v()(a(r))},x=i=>{T(r,[...a(r),{id:i.id,uses:C(i),isActive:!1,level:i.level,cardType:i.type}]),v()(a(r))},q=(i,n)=>{T(r,a(r).map(u=>u.id===i?{...u,uses:n}:u)),v()(a(r))},w=i=>{const n=a(r).find(u=>u.id===i);return n?n.uses:0},C=i=>{if(i.uses.type===null)return null;switch(i.uses.type){case"USES":case"LONG_REST":case"DAY":return i.uses.qty??0;case"RELOAD":return Z.RELOAD_CARD_USES;default:return null}},U=i=>{const n=a(r).find(u=>u.id===i.id);return n?n.isActive:!1};var N=Xt();he(N,21,()=>e.cards,i=>i.id,(i,n)=>{Ot(i,{get card(){return a(n)},children:(u,p)=>{var z=$(),j=W(z);{var A=b=>{var O=Yt(),J=_(O);{var le=B=>{var K=Dt(),te=W(K);{var ne=f=>{{let k=H(()=>w(a(n).id)),L=H(()=>C(a(n))),Y=H(()=>({icon:"ðŸŽ²",title:"Tirar para recargar",onClick:()=>c()(a(n).id),disabled:w(a(n).id)===C(a(n))}));Et(f,{get value(){return a(k)},get max(){return a(L)},onChange:oe=>q(a(n).id,Number(oe)),get button(){return a(Y)}})}};F(te,f=>{C(a(n))!==null&&f(ne)})}var ie=h(te,4);ie.__click=[Pt,g,n],m(B,K)},ee=B=>{var K=$(),te=W(K);{var ne=f=>{var k=Wt(),L=W(k);L.__click=[Mt,E,n];var Y=h(L,4);{var oe=Q=>{var X=$(),ve=W(X);{var be=I=>{var G=It();G.__click=[qt,g,n],m(I,G)},ge=I=>{var G=Gt();G.__click=[jt,R,n],m(I,G)};F(ve,I=>{U(a(n))?I(be):I(ge,!1)})}m(Q,X)};F(Y,Q=>{a(n).type==="activable"&&Q(oe)})}m(f,k)},ie=f=>{var k=Qt(),L=h(W(k),2);L.__click=[Bt,x,n],m(f,k)};F(te,f=>{o()==="collection"?f(ne):f(ie,!1)},!0)}m(B,K)};F(J,B=>{o()==="active"?B(le):B(ee,!1)})}d(O),m(b,O)};F(j,b=>{t()||b(A)})}m(u,z)},$$slots:{default:!0}})}),d(N),m(l,N),ue()}me(["click"]);const ma=()=>({buildEmptyFilters:({onlyAvailables:s}={onlyAvailables:void 0})=>({name:"",level:[],tags:[],type:"",onlyAvailables:s}),getFiltersFromURL:()=>{const s=M.url.searchParams.get("name")??"",o=M.url.searchParams.getAll("level").filter(r=>r!=="").map(Number).filter(r=>r>0),v=M.url.searchParams.getAll("tags").filter(r=>r!==""),c=M.url.searchParams.get("type")??"";return{name:s,level:o,tags:v,type:c}},updateURLFilters:s=>{s.name?M.url.searchParams.set("name",s.name):M.url.searchParams.delete("name"),s.level.length===0?M.url.searchParams.delete("level"):M.url.searchParams.set("level",s.level.join(",")),s.tags.length===0?M.url.searchParams.delete("tags"):M.url.searchParams.set("tags",s.tags.join(",")),s.type?M.url.searchParams.set("type",s.type):M.url.searchParams.delete("type");const o=M.url.searchParams.toString(),v=`${M.url.pathname}${o?`?${o}`:""}`;et(v,{})}}),Se=Oe([]),Fe=Oe([]),Re=async(l,e,t,s)=>{if(rt(t).length>0)return;const v=await(await fetch(tt(l))).text();let c=[];try{c=Ke(v)[e]??[]}catch(r){console.error("Error parsing YAML:",r)}t.set(c.map(r=>s(r)).toSorted((r,g)=>r.level-g.level||r.tags.join("|").localeCompare(g.tags.join("|"))||r.name.localeCompare(g.name)))},ha=()=>({loadAbilityCards:async()=>{await Re("/docs/cards.yml","cards",Se,at)},abilityCards:Se,loadItemCards:async()=>{await Re("/docs/magical-items.yml","items",Fe,st)},itemCards:Fe}),ba=(l,e,t=void 0)=>{let s=[],o=!1;return t&&e.onlyAvailables&&(s=Ht(l,t),o=!0),l.filter(v=>{let c=we(e.name.toLowerCase()).split("|").filter(r=>r.length>0);return c.length===0&&(c=[""]),c.some(r=>we(v.name.toLowerCase()).includes(r))&&(e.level.length===0||e.level.includes(v.level))&&(e.tags.length===0||e.tags.every(r=>v.tags.map(g=>g.toLowerCase()).includes(r)))&&(!e.type||e.type===v.type)&&(!o||Jt(v,s))})},Ht=(l,e)=>{const t=[];for(const v of Object.keys(Z.ATTR_NAME_MAP))for(let c=1;c<=e.attributes[v];c++)t.push(`${Z.ATTR_NAME_MAP[v]} ${c}`.toLowerCase());const s=l.filter(v=>e.cards.find(c=>c.id===v.id));for(const v of s)t.push(v.name.toLowerCase());const o=l.filter(v=>v.tags.includes(Z.LINEAGE_CARD_TAG)&&e.cards.find(c=>c.id===v.id)).length;return e.cards.length<=Z.MAX_CARDS_TO_INCLUDE_LINEAGES&&o<Z.MAX_LINEAGE_CARDS&&t.push(Z.LINEAGE_REQUIREMENT.toLowerCase()),t},Jt=(l,e)=>l.requirements.find(t=>t.toLowerCase().startsWith("o "))?l.requirements.some(t=>e.includes(t.toLowerCase().replace("o ",""))):l.requirements.every(t=>e.includes(t.toLowerCase()));export{_a as C,Et as I,ha as a,fa as b,lt as c,it as d,ba as f,ma as u};
