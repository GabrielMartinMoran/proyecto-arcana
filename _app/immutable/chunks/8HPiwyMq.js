import{r as we}from"./r9wWQoUQ.js";import{C as re,r as Se,s as $,e as X}from"./DoQYgQHR.js";import{w as ve}from"./C2b8wWAA.js";import"./DsnmJJEf.js";import{aa as G,p as D,f as y,ab as p,t as M,O as U,H as r,b as f,c as L,d as b,s,aX as Ee,r as u,e as F,a as te,o as Ne,N as de,aG as ue,aQ as Re,aN as qe}from"./Kn-3yCMi.js";import{i as j,a as me,s as be}from"./XhFqZ_PR.js";import{b as _e,s as J}from"./WpMs7pcV.js";import{p as I}from"./C2rRscMh.js";import{g as ge}from"./BxDBji-2.js";import{p as K}from"./CfONpilM.js";import{c as ze}from"./DLr_xJsT.js";import{b as T,u as He,a as ie,C as Ie,I as z}from"./CoG21pVe.js";import{u as fe}from"./BD8Gg-N5.js";import{c as Te}from"./CjlGQt4x.js";import{b as je}from"./G309qHfw.js";const Me=(h,e)=>{if(!h)return 0;const t=h.trim();try{const a=new Function("cuerpo","reflejos","mente","instinto","presencia","Math",`return (${t});`);return Number(a(Number(e.cuerpo)||0,Number(e.reflejos)||0,Number(e.mente)||0,Number(e.instinto)||0,Number(e.presencia)||0,Math))||0}catch(a){return console.error("Error evaluating modifier expression:",a),0}},pe=(h,e)=>Me(h,{cuerpo:e.attributes.cuerpo,reflejos:e.attributes.reflejos,mente:e.attributes.mente,instinto:e.attributes.instinto,presencia:e.attributes.presencia,Math});class oe{id;name;attributes;cards;ppHistory;goldHistory;equipment;modifiers;currentHP;tempHP;currentLuck;img;story;notes;languages;quickInfo;attacks;maxActiveCards;version;constructor(e){this.id=e.id,this.name=e.name,this.attributes=e.attributes,this.cards=e.cards,this.ppHistory=e.ppHistory,this.goldHistory=e.goldHistory,this.equipment=e.equipment,this.modifiers=e.modifiers,this.currentHP=e.currentHP,this.tempHP=e.tempHP,this.currentLuck=e.currentLuck,this.img=e.img,this.story=e.story,this.notes=e.notes,this.languages=e.languages,this.quickInfo=e.quickInfo,this.attacks=e.attacks,this.maxActiveCards=e.maxActiveCards,this.version=e.version}calculateAttrModifiers(e,t){let a=t;const l=this.modifiers.filter(o=>o.attribute===e);for(const o of l){const w=pe(o.formula,this);if(o.type==="set")return w;o.type==="add"&&(a+=w)}return a}get maxLuck(){const e=re.MAX_LUCK;return this.calculateAttrModifiers("maxLuck",e)}get maxHP(){const e=re.BASE_HEALTH+this.attributes.cuerpo*re.HEALTH_BODY_MULTIPIER;return this.calculateAttrModifiers("maxHP",e)}get speed(){const e=re.BASE_SPEED+this.attributes.reflejos;return this.calculateAttrModifiers("speed",e)}get evasion(){const e=re.BASE_EVASION+this.attributes.reflejos;return this.calculateAttrModifiers("evasion",e)}get mitigation(){return this.calculateAttrModifiers("mitigation",0)}get currentGold(){const e=this.goldHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentGold;return t>0?e-t:e}get spentGold(){return this.goldHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get currentPP(){const e=this.ppHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentPP;return t>0?e-t:e}get spentPP(){return this.ppHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get pjPower(){const e=this.cards.reduce((a,l)=>Math.max(a,l.level),0),t=this.spentPP/re.PJ_POWER_SPENT_PP_DIVIDER;return Math.round(e+t)}get numActiveCards(){return this.cards.filter(e=>e.isActive).length}get initiative(){return this.attributes.reflejos}copy(){return new oe({...this})}}const ye="arcana:characters",Q={charactersStore:ve([]),exampleCharactersStore:ve([]),charactersAlreadyLoaded:!1,exampleCharactersAlreadyLoaded:!1},De=()=>{Q.charactersStore.subscribe(h=>{const e=JSON.stringify(h);localStorage.setItem(ye,e)})},Fa=()=>({loadCharacters:async()=>{if(Q.charactersAlreadyLoaded)return;const t=localStorage.getItem(ye);if(t)try{const a=JSON.parse(t);Q.charactersStore.set(a.map(l=>new oe(l)))}catch(a){console.error("Error parsing characters JSON:",a)}De(),Q.charactersAlreadyLoaded=!0},loadExampleCharacters:async()=>{if(Q.exampleCharactersAlreadyLoaded)return;let t=[];try{t=await(await fetch(we("/docs/example-characters.json"))).json()}catch(a){console.error("Error fetching example characters:",a)}try{Q.exampleCharactersStore.set(t.map(a=>new oe(a)))}catch(a){console.error("Error parsing example characters JSON:",a)}Q.exampleCharactersAlreadyLoaded=!0},characters:Q.charactersStore,exampleCharacters:Q.exampleCharactersStore});var Le=(h,e,t)=>e.onChange(r(t)),Fe=y('<input type="text" class="svelte-19nbfo1"/>');function Ce(h,e){D(e,!0);let t=I(e,"placeholder",3,void 0),a=p(()=>e.value);var l=Fe();Se(l),l.__input=[Le,e,a],M(()=>{$(l,"placeholder",t()),l.disabled=e.readonly}),_e(l,()=>r(a),o=>U(a,o)),f(h,l),L()}G(["input"]);var Oe=y("<label> </label>"),We=(h,e,t)=>e.onChange(r(t)),Ue=y("<div><!> <div><textarea></textarea></div></div>");function ce(h,e){D(e,!0);const t=6;let a=I(e,"label",3,void 0),l=I(e,"placeholder",3,""),o=I(e,"maxRows",3,t),w=p(()=>e.value);var N=Ue();let x;var S=b(N);{var m=i=>{var g=Oe(),C=b(g,!0);u(g),M(()=>F(C,a())),f(i,g)};j(S,i=>{a()&&i(m)})}var _=s(S,2);let E;var c=b(_);Ee(c),c.__input=[We,e,w];let A;u(_),u(N),M((i,g,C)=>{x=J(N,1,"fieldgroup svelte-o02g58",null,x,i),E=J(_,1,"field svelte-o02g58",null,E,g),c.disabled=e.readonly,$(c,"placeholder",l()),$(c,"rows",o()==="unlimited"?void 0:o()),A=J(c,1,"svelte-o02g58",null,A,C)},[()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"})]),_e(c,()=>r(w),i=>U(w,i)),f(h,N),L()}G(["input"]);var Ge=y('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),Ve=y("<!> <!>",1);function Be(h,e){D(e,!0);let t=I(e,"character",7);var a=Ve(),l=te(a);{var o=N=>{T(N,{children:(x,S)=>{var m=Ge(),_=b(m);u(m),M(()=>{$(_,"src",t().img),$(_,"alt",t().name)}),f(x,m)},$$slots:{default:!0}})};j(l,N=>{t().img&&N(o)})}var w=s(l,2);T(w,{children:(N,x)=>{ce(N,{label:"Historia",get value(){return t().story},get readonly(){return e.readonly},onChange:S=>{t().story=S,e.onChange(t())}})},$$slots:{default:!0}}),f(h,a),L()}var Je=y('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),Ke=y('<div class="all-cards svelte-o497rd"><!> <!></div>'),Qe=y('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div>');function Xe(h,e){D(e,!0);const t=()=>me(N,"$cardsStore",a),[a,l]=be();let o=I(e,"character",7),{loadCards:w,cards:N}=He(),{rollExpression:x}=fe(),S=p(t);Ne(async()=>{await w()});const m=n=>{o().cards=n,e.onChange(o())},_=n=>{U(S,n)},E=async n=>{const d=o().cards.find(k=>k.id===n),v=r(S).find(k=>k.id===n);d&&v&&d.uses!==null&&v&&await x({expression:"1d6",variables:{},title:`${o().name}: Recarga de carta ${v.name}`,resultFormatter:R=>`<span class="total ${R>=(v.uses?.qty??0)?"success":"failure"}">${R}</span>`})>=(v.uses?.qty??0)&&(d.uses+=1,m([...o().cards]))};var c=Qe(),A=b(c);{var i=n=>{T(n,{children:(d,v)=>{z(d,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return o().maxActiveCards},get readonly(){return e.readonly},fullWidth:!0,onChange:k=>{o().maxActiveCards=Number(k),e.onChange(o())}})},$$slots:{default:!0}})};j(A,n=>{e.readonly||n(i)})}var g=s(A,2);T(g,{get title(){return`Cartas Activas (${o().numActiveCards??""}/${o().maxActiveCards??""})`},children:(n,d)=>{{let v=p(()=>t().filter(k=>o().cards.some(R=>R.isActive&&R.id===k.id)));ie(n,{get cards(){return r(v)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"active",onChange:m,onCardReloadClick:E})}},$$slots:{default:!0}});var C=s(g,2);T(C,{title:"Colección",children:(n,d)=>{{let v=p(()=>t().filter(k=>o().cards.some(R=>R.id===k.id)));ie(n,{get cards(){return r(v)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"collection",onChange:m})}},$$slots:{default:!0}});var P=s(C,2);T(P,{title:"Todas las Cartas",children:(n,d)=>{var v=Ke(),k=b(v);Ie(k,{get cards(){return t()},onFilter:_});var R=s(k,2);{var O=V=>{{let q=p(()=>r(S).filter(H=>o().cards.find(W=>W.id===H.id)===void 0));ie(V,{get cards(){return r(q)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"all",onChange:m})}},Y=V=>{var q=Je();f(V,q)};j(R,V=>{r(S).length>0?V(O):V(Y,!1)})}u(v),f(n,v)},$$slots:{default:!0}}),u(c),f(h,c),L(),l()}const Ye=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()},Ze=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()};var $e=y('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),et=y('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Razón</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),tt=(h,e,t)=>e(r(t)),at=y('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acción">↶</button></div>'),rt=y('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),nt=y('<div class="history svelte-ssntdk"></div>'),lt=y("<!> <!> <!>",1);function ot(h,e){D(e,!0);const t="Sin razón especifica";let a=I(e,"character",7),l=de({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().goldHistory=a().goldHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=lt(),x=te(N);T(x,{title:"Estado Actual",children:(E,c)=>{var A=$e(),i=b(A),g=s(b(i),2);let C;var P=b(g,!0);u(g),u(i);var n=s(i,2),d=s(b(n),2),v=b(d,!0);u(d),u(n),u(A),M(k=>{C=J(g,1,"number svelte-ssntdk",null,C,k),F(P,a().currentGold),F(v,a().spentGold)},[()=>({negative:a().currentGold<0})]),f(E,A)},$$slots:{default:!0}});var S=s(x,2);{var m=E=>{T(E,{title:"Actualizar Oro",children:(c,A)=>{var i=et(),g=s(b(i),2),C=b(g);z(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{l.quantity=Number(v)}});var P=s(C,2);z(P,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{l.reason=v.toString()}});var n=s(P,2);n.__click=[Ze,l,t,a,e,o];var d=s(n,2);d.__click=[Ye,l,t,a,e,o],u(g),u(i),f(c,i)},$$slots:{default:!0}})};j(S,E=>{e.readonly||E(m)})}var _=s(S,2);T(_,{title:"Historial",children:(E,c)=>{var A=nt();X(A,21,()=>a().goldHistory,i=>i.id,(i,g)=>{var C=at(),P=b(C);let n;var d=b(P);u(P);var v=s(P,2),k=b(v,!0);u(v);var R=s(v,2);R.__click=[tt,w,g],u(C),M(O=>{n=J(P,1,"log-amount svelte-ssntdk",null,n,O),F(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} Oro`),F(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=rt();f(i,g)}),u(A),f(E,A)},$$slots:{default:!0}}),f(h,N),L()}G(["click"]);const st=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),t.onChange(e())};var it=y('<button title="Agregar Ataque">➕</button>'),dt=(h,e,t)=>e(r(t)),ct=y('<button title="Eliminar" class="svelte-1v2w3y3">🗑️</button>'),vt=y('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),ut=y('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Daño</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function gt(h,e){D(e,!0);let t=I(e,"attacks",7);const a=m=>{t(t().filter(_=>_.id!==m.id)),e.onChange(t())};var l=ut(),o=b(l),w=s(b(o),2);{var N=m=>{var _=it();_.__click=[st,t,e],f(m,_)};j(w,m=>{e.readonly||m(N)})}u(o);var x=s(o,2),S=s(b(x),2);X(S,17,t,m=>m.id,(m,_,E)=>{var c=vt(),A=b(c);z(A,{get value(){return r(_).name},get readonly(){return e.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{r(_).name=d.toString(),e.onChange(t())}});var i=s(A,2);{let d=p(()=>({icon:"🎯",title:"Tirar Ataque",onClick:()=>e.onAttackRoll(r(_)),disabled:!r(_).atkFormula}));z(i,{get value(){return r(_).atkFormula},get readonly(){return e.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:v=>{r(_).atkFormula=v.toString(),e.onChange(t())},get button(){return r(d)}})}var g=s(i,2);{let d=p(()=>({icon:"💥",title:"Tirar Daño",onClick:()=>e.onDamageRoll(r(_)),disabled:!r(_).dmgFormula}));z(g,{get value(){return r(_).dmgFormula},get readonly(){return e.readonly},placeholder:"1d4",fullWidth:!0,onChange:v=>{r(_).dmgFormula=v.toString(),e.onChange(t())},get button(){return r(d)}})}var C=s(g,2);z(C,{get value(){return r(_).notes},get readonly(){return e.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{r(_).notes=d.toString(),e.onChange(t())}});var P=s(C,2);{var n=d=>{var v=ct();v.__click=[dt,a,_],f(d,v)};j(P,d=>{e.readonly||d(n)})}u(c),f(m,c)}),u(x),u(l),f(h,l),L()}G(["click"]);function ne(h,e){D(e,!0);{let t=p(()=>({icon:"🎲",onClick:e.onDiceRoll,title:"Tirar"}));z(h,{get label(){return e.name},get value(){return e.value},get readonly(){return e.readonly},onChange:a=>e.onChange(Number(a)),get button(){return r(t)}})}L()}const ht=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),t.onChange(e())};var mt=y('<button title="Agregar Item">➕</button>'),bt=(h,e,t)=>e(r(t)),_t=y('<button title="Eliminar">🗑️</button>'),ft=y('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),yt=y('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="name svelte-1ewnrao">Nombre</label> <label class="quantity svelte-1ewnrao">Cantidad</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function Ct(h,e){D(e,!0);let t=I(e,"equipment",7);const a=m=>{t(t().filter(_=>_.id!==m.id)),e.onChange(t())};var l=yt(),o=b(l),w=s(b(o),2);{var N=m=>{var _=mt();_.__click=[ht,t,e],f(m,_)};j(w,m=>{e.readonly||m(N)})}u(o);var x=s(o,2),S=s(b(x),2);X(S,17,t,m=>m.id,(m,_,E)=>{var c=ft(),A=b(c);z(A,{get value(){return r(_).quantity},get readonly(){return e.readonly},onChange:n=>{r(_).quantity=Number(n),e.onChange(t())}});var i=s(A,2);z(i,{get value(){return r(_).name},get readonly(){return e.readonly},placeholder:"Nombre",onChange:n=>{r(_).name=n.toString(),e.onChange(t())}});var g=s(i,2);z(g,{get value(){return r(_).notes},get readonly(){return e.readonly},placeholder:"Notas",fullWidth:!0,onChange:n=>{r(_).notes=n.toString(),e.onChange(t())}});var C=s(g,2);{var P=n=>{var d=_t();d.__click=[bt,a,_],f(n,d)};j(C,n=>{e.readonly||n(P)})}u(c),f(m,c)}),u(x),u(l),f(h,l),L()}G(["click"]);var kt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),Pt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),xt=y('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),At=y('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),wt=y('<div class="empty svelte-ox7hjw"><em>El equipo esta vacío.</em></div>'),St=y('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Et=y("<!> <!> <!> <!>",1);function Nt(h,e){D(e,!0);let t=I(e,"character",7),{rollExpression:a,rollModal:l}=fe();const o=c=>{l.openRollModal({expression:`1d6e+${c}`,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia,iniciativa:t().initiative},title:`${t().name}: ${Te(c)}`})},w=c=>{l.openRollModal({expression:c.atkFormula,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia},title:`${t().name}: Ataque con ${c.name}`})},N=c=>{a({expression:c.dmgFormula,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia},title:`${t().name}: Daño de ${c.name}`})};var x=Et(),S=te(x);T(S,{title:"Atributos Principales",children:(c,A)=>{var i=kt(),g=b(i);ne(g,{name:"Cuerpo",get value(){return t().attributes.cuerpo},get readonly(){return e.readonly},onDiceRoll:()=>o("cuerpo"),onChange:k=>{t().attributes.cuerpo=k,e.onChange(t())}});var C=s(g,2);ne(C,{name:"Reflejos",get value(){return t().attributes.reflejos},get readonly(){return e.readonly},onDiceRoll:()=>o("reflejos"),onChange:k=>{t().attributes.reflejos=k,e.onChange(t())}});var P=s(C,2);ne(P,{name:"Mente",get value(){return t().attributes.mente},get readonly(){return e.readonly},onDiceRoll:()=>o("mente"),onChange:k=>{t().attributes.mente=k,e.onChange(t())}});var n=s(P,2);ne(n,{name:"Instinto",get value(){return t().attributes.instinto},get readonly(){return e.readonly},onDiceRoll:()=>o("instinto"),onChange:k=>{t().attributes.instinto=k,e.onChange(t())}});var d=s(n,2);ne(d,{name:"Presencia",get value(){return t().attributes.presencia},get readonly(){return e.readonly},onDiceRoll:()=>o("presencia"),onChange:k=>{t().attributes.presencia=k,e.onChange(t())}});var v=s(d,2);z(v,{label:"Suerte",get value(){return t().currentLuck},get max(){return t().maxLuck},get readonly(){return e.readonly},onChange:k=>{t().currentLuck=Number(k),e.onChange(t())}}),u(i),f(c,i)},$$slots:{default:!0}});var m=s(S,2);T(m,{title:"Atributos Derivados",children:(c,A)=>{var i=Pt(),g=b(i);z(g,{label:"Salud",get value(){return t().currentHP},get max(){return t().maxHP},get readonly(){return e.readonly},onChange:k=>{t().currentHP=Number(k),e.onChange(t())}});var C=s(g,2);z(C,{label:"Salud Temporal",get value(){return t().tempHP},get readonly(){return e.readonly},onChange:k=>{t().tempHP=Number(k),e.onChange(t())}});var P=s(C,2);z(P,{label:"Velocidad",get value(){return t().speed},readonly:!0});var n=s(P,2);z(n,{label:"Esquiva",get value(){return t().evasion},readonly:!0});var d=s(n,2);z(d,{label:"Mitigación",get value(){return t().mitigation},readonly:!0});var v=s(d,2);z(v,{label:"Iniciativa",get value(){return t().initiative},readonly:!0,button:{icon:"🎲",title:"Tirar iniciativa",onClick:()=>o("iniciativa")}}),u(i),f(c,i)},$$slots:{default:!0}});var _=s(m,2);T(_,{title:"Información",children:(c,A)=>{var i=At(),g=b(i);gt(g,{get attacks(){return t().attacks},get readonly(){return e.readonly},onChange:v=>{t().attacks=v,e.onChange(t())},onAttackRoll:w,onDamageRoll:N});var C=s(g,2);{var P=v=>{var k=xt();f(v,k)};j(C,v=>{t().attacks.length===0&&v(P)})}var n=s(C,2);ce(n,{label:"Información Rápida",get value(){return t().quickInfo},get readonly(){return e.readonly},placeholder:"Información general, habilidades, etc.",onChange:v=>{t().quickInfo=v,e.onChange(t())}});var d=s(n,2);z(d,{label:"Lenguas",get value(){return t().languages},get readonly(){return e.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:v=>{t().languages=v,e.onChange(t())}}),u(i),f(c,i)},$$slots:{default:!0}});var E=s(_,2);T(E,{title:"Equipo",children:(c,A)=>{var i=St(),g=b(i);z(g,{label:"Oro",get value(){return t().currentGold},readonly:!0,fullWidth:!0});var C=s(g,2);Ct(C,{get equipment(){return t().equipment},get readonly(){return e.readonly},onChange:d=>{t().equipment=d,e.onChange(t())}});var P=s(C,2);{var n=d=>{var v=wt();f(d,v)};j(P,d=>{t().equipment.length===0&&d(n)})}u(i),f(c,i)},$$slots:{default:!0}}),f(h,x),L()}const Rt=(h,e,t,a)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};U(e,[...r(e),l],!0),t.onChange(r(e)),a(l)};var qt=(h,e,t)=>e(r(t)),zt=y('<div class="header svelte-z1ulbz"><button title="Agregar Nota">➕</button> <button title="Eliminar Nota">🗑️</button></div>'),Ht=(h,e,t)=>e(r(t)),It=y('<button><span class="svelte-z1ulbz"> </span></button>'),Tt=y('<div class="notes svelte-z1ulbz"></div>'),jt=y('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Mt=y('<div class="note svelte-z1ulbz"><!> <!></div>'),pt=y('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Dt=y('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Lt(h,e){D(e,!0);let t=ue(de(e.notes)),a=ue(void 0),l=p(()=>r(t).find(n=>n.id===r(a)));const o=n=>{U(a,n.id,!0)},w=n=>{n&&(U(t,r(t).filter(d=>d.id!==n),!0),U(a,void 0),e.onChange(r(t)))},N=()=>{U(t,[...r(t)],!0),e.onChange(r(t))};var x=Dt(),S=b(x),m=b(S);{var _=n=>{var d=zt(),v=b(d);v.__click=[Rt,t,e,o];var k=s(v,2);k.__click=[qt,w,a],u(d),M(()=>k.disabled=!r(l)),f(n,d)};j(m,n=>{e.readonly||n(_)})}var E=s(m,2);{var c=n=>{var d=Tt();X(d,21,()=>r(t),v=>v.id,(v,k)=>{var R=It();let O;R.__click=[Ht,o,k];var Y=b(R),V=b(Y,!0);u(Y),u(R),M(q=>{O=J(R,1,"note-btn svelte-z1ulbz",null,O,q),F(V,r(k).title||"Nota sin título")},[()=>({selected:r(a)===r(k).id})]),f(v,R)}),u(d),f(n,d)},A=n=>{var d=jt();f(n,d)};j(E,n=>{r(t).length>0?n(c):n(A,!1)})}u(S);var i=s(S,2),g=b(i);{var C=n=>{var d=Mt(),v=b(d);Ce(v,{get value(){return r(l).title},get readonly(){return e.readonly},placeholder:"Título de la nota",onChange:R=>{r(l).title=R,N()}});var k=s(v,2);ce(k,{get value(){return r(l).content},get readonly(){return e.readonly},placeholder:"Contenido de la nota",onChange:R=>{r(l).content=R,N()},maxRows:"unlimited"}),u(d),f(n,d)},P=n=>{var d=pt();f(n,d)};j(g,n=>{r(l)?n(C):n(P,!1)})}u(i),u(x),f(h,x),L()}G(["click"]);function Ft(h,e){D(e,!0);let t=I(e,"character",7);T(h,{title:"Notas",children:(a,l)=>{Lt(a,{get notes(){return t().notes},get readonly(){return e.readonly},onChange:o=>{t().notes=o,e.onChange(t())}})},$$slots:{default:!0}}),L()}const Ot=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()},Wt=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()};var Ut=y('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Poder de PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),Gt=y('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Razón</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),Vt=(h,e,t)=>e(r(t)),Bt=y('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acción">↶</button></div>'),Jt=y('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),Kt=y('<div class="history svelte-1cdo061"></div>'),Qt=y("<!> <!> <!>",1);function Xt(h,e){D(e,!0);const t="Sin razón especifica";let a=I(e,"character",7),l=de({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().ppHistory=a().ppHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=Qt(),x=te(N);T(x,{title:"Estado Actual",children:(E,c)=>{var A=Ut(),i=b(A),g=s(b(i),2);let C;var P=b(g,!0);u(g),u(i);var n=s(i,2),d=s(b(n),2),v=b(d,!0);u(d),u(n);var k=s(n,2),R=s(b(k),2),O=b(R,!0);u(R),u(k),u(A),M(Y=>{C=J(g,1,"number svelte-1cdo061",null,C,Y),F(P,a().currentPP),F(v,a().spentPP),F(O,a().pjPower)},[()=>({negative:a().currentPP<0})]),f(E,A)},$$slots:{default:!0}});var S=s(x,2);{var m=E=>{T(E,{title:"Actualizar Progreso",children:(c,A)=>{var i=Gt(),g=s(b(i),2),C=b(g);z(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{l.quantity=Number(v)}});var P=s(C,2);z(P,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{l.reason=v.toString()}});var n=s(P,2);n.__click=[Wt,l,t,a,e,o];var d=s(n,2);d.__click=[Ot,l,t,a,e,o],u(g),u(i),f(c,i)},$$slots:{default:!0}})};j(S,E=>{e.readonly||E(m)})}var _=s(S,2);T(_,{title:"Historial",children:(E,c)=>{var A=Kt();X(A,21,()=>a().ppHistory,i=>i.id,(i,g)=>{var C=Bt(),P=b(C);let n;var d=b(P);u(P);var v=s(P,2),k=b(v,!0);u(v);var R=s(v,2);R.__click=[Vt,w,g],u(C),M(O=>{n=J(P,1,"log-amount svelte-1cdo061",null,n,O),F(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} PP`),F(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=Jt();f(i,g)}),u(A),f(E,A)},$$slots:{default:!0}}),f(h,N),L()}G(["click"]);var Yt=(h,e,t)=>e()(r(t)),Zt=y("<option> </option>"),$t=y('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function he(h,e){D(e,!0);let t=I(e,"onChange",3,()=>{}),a=p(()=>e.value);var l=$t(),o=b(l);o.__change=[Yt,t,a],X(o,21,()=>e.options,w=>w.label,(w,N)=>{var x=Zt(),S=b(x,!0);u(x);var m={};M(()=>{F(S,r(N).label),m!==(m=r(N).value)&&(x.value=(x.__value=r(N).value)??"")}),f(w,x)}),u(o),u(l),je(o,()=>r(a),w=>U(a,w)),f(h,l),L()}G(["change"]);const ea=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),t.onChange(e())};var ta=(h,e,t)=>e(r(t)),aa=y('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">🗑️</button></div>'),ra=y('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),na=y('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">➕</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Razón</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function la(h,e){D(e,!0);let t=I(e,"modifiers",7);const a=S=>{t(t().filter(m=>m.id!==S.id)),e.onChange(t())};var l=na(),o=b(l),w=s(b(o),2);w.__click=[ea,t,e],u(o);var N=s(o,2),x=s(b(N),2);X(x,17,t,S=>S.id,(S,m,_)=>{var E=aa(),c=b(E);he(c,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return r(m).type},onChange:P=>{r(m).type=P.toString(),e.onChange(t())}});var A=s(c,2);he(A,{options:[{label:"Salud Máxima",value:"maxHP"},{label:"Suerte Máxima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigación",value:"mitigation"},{label:"Velocidad",value:"speed"}],get value(){return r(m).attribute},onChange:P=>{r(m).attribute=P.toString(),e.onChange(t())}});var i=s(A,2);z(i,{get value(){return r(m).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:P=>{r(m).formula=P.toString(),e.onChange(t())}});var g=s(i,2);z(g,{get value(){return r(m).formula},placeholder:"Razón",fullWidth:!0,onChange:P=>{r(m).reason=P.toString(),e.onChange(t())}});var C=s(g,2);C.__click=[ta,a,m],u(E),f(S,E)},S=>{var m=ra();f(S,m)}),u(N),u(l),f(h,l),L()}G(["click"]);var oa=y('<div class="general svelte-1hn03u3"><!></div>'),sa=y('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),ia=y("<!> <!>",1);function da(h,e){D(e,!0);let t=I(e,"character",7);var a=ia(),l=te(a);T(l,{title:"General",children:(w,N)=>{var x=oa(),S=b(x);{let m=p(()=>t().img??"");z(S,{label:"URL del Retrato",get value(){return r(m)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:_=>{const E=_.toString();E.length>0?t().img=E:t().img=null,e.onChange(t())}})}u(x),f(w,x)},$$slots:{default:!0}});var o=s(l,2);T(o,{title:"Modificadores",children:(w,N)=>{var x=sa(),S=b(x);la(S,{get modifiers(){return t().modifiers},onChange:m=>{t().modifiers=m,e.onChange(t())}}),Re(2),u(x),f(w,x)},$$slots:{default:!0}}),f(h,a),L()}var ca=y("<button> </button>"),va=y('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function ua(h,e){D(e,!0);let t=I(e,"character",7);const a=[{name:"general",title:"General",component:Nt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:Xe,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:Be,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Ft,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:Xt,availableWhenReadOnly:!0},{name:"economy",title:"Economía",component:ot,availableWhenReadOnly:!0},{name:"settings",title:"Configuración",component:da,availableWhenReadOnly:!1}];let l=p(()=>Math.max(a.findIndex(c=>c.name===e.currentTab),0)),o=p(()=>a.find(c=>c.name===e.currentTab)??a[0]);const w=c=>{const A=c.copy();e.onChange(A),t(A)},N=c=>{U(l,c),e.onTabChange(a[c].name)};var x=va(),S=b(x),m=b(S);Ce(m,{get value(){return t().name},get readonly(){return e.readonly},onChange:c=>{t().name=c,w(t())}}),u(S);var _=s(S,2);X(_,23,()=>a,c=>c.title,(c,A,i)=>{var g=qe(),C=te(g);{var P=n=>{var d=ca();let v;d.__click=()=>N(r(i));var k=b(d,!0);u(d),M(R=>{v=J(d,1,"tab",null,v,R),F(k,r(A).title)},[()=>({selected:r(l)===r(i)})]),f(n,d)};j(C,n=>{(r(A).availableWhenReadOnly||!e.readonly)&&n(P)})}f(c,g)}),u(_);var E=s(_,2);ze(E,()=>r(o).component,(c,A)=>{A(c,{get character(){return t()},get readonly(){return e.readonly},onChange:w})}),u(x),f(h,x),L()}G(["click"]);const ga=async(h,e,t)=>{const a=await e()();t(a)},ha=async(h,e,t)=>{const a=await e()();t(a)},ma=async(h,e,t)=>{r(e)&&await t()(r(e))},ba=async(h,e,t,a)=>{!r(e)||!confirm(`¿Quieres eliminar a ${r(e).name}?`)||(await t()(r(e)),U(e,void 0),a(null))},_a=async(h,e,t)=>{r(e)&&await t()(r(e))};var fa=y('<button title="Importar y Editar">📝</button>'),ya=y('<button title="Crear">➕</button> <button title="Importar">📥</button> <button title="Exportar">📤</button> <button title="Eliminar">🗑️</button>',1),Ca=(h,e,t)=>e(r(t)),ka=y('<img class="character-image svelte-kjfy12"/>'),Pa=y('<span class="image-placeholder svelte-kjfy12"> </span>'),xa=y('<button><!> <span class="name svelte-kjfy12"> </span></button>'),Aa=y('<section class="characters-page svelte-kjfy12"><div class="list svelte-kjfy12"><div class="header svelte-kjfy12"><!></div> <div class="content svelte-kjfy12"></div></div> <div class="viewport svelte-kjfy12"><!></div></section>');function Oa(h,e){D(e,!0);const t=()=>me(e.characters,"$characters",a),[a,l]=be(),o="general";let w=I(e,"onAddToMyCharacters",3,()=>{throw new Error("onAddToMyCharacters not implemented")}),N=I(e,"onCreateCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),x=I(e,"onImportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),S=I(e,"onExportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),m=I(e,"onDeleteCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),_=p(()=>K.url.searchParams.get("characterId")),E=p(()=>K.url.searchParams.get("tab")??o);const c=q=>{q!==null?(K.url.searchParams.set("characterId",q.id),K.url.searchParams.set("tab",o)):(K.url.searchParams.delete("characterId"),K.url.searchParams.delete("tab")),ge(`?${K.url.searchParams.toString()}`)},A=q=>{K.url.searchParams.set("tab",q),ge(`?${K.url.searchParams.toString()}`)};let i=p(()=>t().find(q=>q.id===r(_)));const g=q=>{e.characters.update(H=>{const W=H.findIndex(B=>B.id===q.id);if(W!==-1){const B=[...H];return B[W]=q,B}return H})};var C=Aa(),P=b(C),n=b(P),d=b(n);{var v=q=>{var H=fa();H.__click=[_a,i,w],M(()=>H.disabled=!r(i)),f(q,H)},k=q=>{var H=ya(),W=te(H);W.__click=[ga,N,c];var B=s(W,2);B.__click=[ha,x,c];var ae=s(B,2);ae.__click=[ma,i,S];var le=s(ae,2);le.__click=[ba,i,m,c],M(()=>{ae.disabled=!r(i),le.disabled=!r(i)}),f(q,H)};j(d,q=>{e.readonly?q(v):q(k,!1)})}u(n);var R=s(n,2);X(R,5,t,q=>q.id,(q,H)=>{var W=xa();let B;W.__click=[Ca,c,H];var ae=b(W);{var le=Z=>{var ee=ka();M(()=>{$(ee,"src",r(H).img),$(ee,"alt",r(H).name)}),f(Z,ee)},ke=Z=>{var ee=Pa(),xe=b(ee,!0);u(ee),M(Ae=>F(xe,Ae),[()=>r(H).name.charAt(0).toUpperCase()]),f(Z,ee)};j(ae,Z=>{r(H).img?Z(le):Z(ke,!1)})}var se=s(ae,2),Pe=b(se,!0);u(se),u(W),M(Z=>{B=J(W,1,"character-item svelte-kjfy12",null,B,Z),$(se,"title",r(H).name),F(Pe,r(H).name)},[()=>({selected:r(_)===r(H).id})]),f(q,W)}),u(R),u(P);var O=s(P,2),Y=b(O);{var V=q=>{ua(q,{get character(){return r(i)},get readonly(){return e.readonly},onChange:g,get currentTab(){return r(E)},onTabChange:A})};j(Y,q=>{r(i)&&q(V)})}u(O),u(C),f(h,C),L(),l()}G(["click"]);export{Oa as C,oe as a,Fa as u};
