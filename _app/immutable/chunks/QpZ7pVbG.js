import"./DsnmJJEf.js";import{aF as J,p as U,f as p,aG as L,t as B,O as H,g as t,b as C,c as W,d as v,s as l,b9 as Ee,r as c,e as V,a as Q,a2 as le,N as oe,aL as Le,aH as we,b6 as Se,ba as He,am as Oe}from"./DLXWS9Me.js";import{i as E}from"./sk9sCnVa.js";import{e as X,i as Pe}from"./DqBPzmir.js";import{c as Ue}from"./DlWWNll5.js";import{s as $}from"./DvREelRX.js";import{p as O}from"./B0W8Y-cb.js";import{g as ee}from"./0JtrQ17s.js";import{r as Re}from"./Bf5GLf2V.js";import{a as Me,v as We,u as qe}from"./D8XH36mk.js";import{r as ze,s as ie,c as Ge}from"./YdHDDrJh.js";import{b as Ie}from"./CwyfYjnX.js";import{C as F}from"./QFUiQZjY.js";import{a as Ve,o as Te}from"./CzhoJcdv.js";import{u as Be,a as Ne,b as fe,C as Je,c as Ke,d as Ye,f as xe,I as T}from"./BgrnRFVS.js";import{C as Qe}from"./B_ycimPA.js";import{b as ye}from"./BQL_5efD.js";import{d as se}from"./BA7vPwHJ.js";import{g as Xe}from"./0K7s4aS1.js";import{b as Ze}from"./B16OnVP7.js";var $e=(r,a,e)=>a.onChange(t(e)),ea=p('<input type="text" class="svelte-19nbfo1"/>');function je(r,a){U(a,!0);let e=O(a,"placeholder",3,void 0),n=L(()=>a.value);var i=ea();ze(i),i.__input=[$e,a,n],B(()=>{ie(i,"placeholder",e()),i.disabled=a.readonly}),Ie(i,()=>t(n),_=>H(n,_)),C(r,i),W()}J(["input"]);var aa=p("<label> </label>"),ta=(r,a,e)=>a.onChange(t(e)),ra=p("<div><!> <div><textarea></textarea></div></div>");function pe(r,a){U(a,!0);const e=6;let n=O(a,"label",3,void 0),i=O(a,"placeholder",3,""),_=O(a,"maxRows",3,e),P=L(()=>a.value);var x=ra();let w;var S=v(x);{var f=u=>{var b=aa(),A=v(b,!0);c(b),B(()=>V(A,n())),C(u,b)};E(S,u=>{n()&&u(f)})}var k=l(S,2);let y;var h=v(k);Ee(h),h.__input=[ta,a,P];let g;c(k),c(x),B((u,b,A)=>{w=$(x,1,"fieldgroup svelte-o02g58",null,w,u),y=$(k,1,"field svelte-o02g58",null,y,b),h.disabled=a.readonly,ie(h,"placeholder",i()),ie(h,"rows",_()==="unlimited"?void 0:_()),g=$(h,1,"svelte-o02g58",null,g,A)},[()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"}),()=>({expanded:_()==="unlimited"})]),Ie(h,()=>t(P),u=>H(P,u)),C(r,x),W()}J(["input"]);var na=p('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),la=p("<!> <!>",1);function oa(r,a){U(a,!0);let e=O(a,"character",7);var n=la(),i=Q(n);{var _=x=>{F(x,{children:(w,S)=>{var f=na(),k=v(f);c(f),B(()=>{ie(k,"src",e().img),ie(k,"alt",e().name)}),C(w,f)},$$slots:{default:!0}})};E(i,x=>{e().img&&x(_)})}var P=l(i,2);F(P,{children:(x,w)=>{pe(x,{label:"Historia",get value(){return e().story},get readonly(){return a.readonly},onChange:S=>{e().story=S,a.onChange(e())}})},$$slots:{default:!0}}),C(r,n),W()}var ia=(r,a)=>a("ability"),sa=(r,a)=>a("item"),da=p('<!> <div class="controls svelte-o497rd"><span class="svelte-o497rd">Agregar cartas a tu colecciÃ³n</span> <div class="buttons svelte-o497rd"><button>Agregar Carta de Habilidad</button> <button>Agregar Carta de Objeto MÃ¡gico</button></div></div>',1),ca=p('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),va=p('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div> <div class="add-card-modal svelte-o497rd"><div class="all-cards svelte-o497rd"><!> <div class="cards-viewport svelte-o497rd"><!></div></div> <div class="footer svelte-o497rd"><span class="results-count"> </span> <button>Cerrar</button></div></div>',1);function ua(r,a){U(a,!0);let e=O(a,"character",7),{loadAbilityCards:n,abilityCards:i,loadItemCards:_,itemCards:P}=Ne(),{rollExpression:x}=Me();const{buildEmptyFilters:w}=Be();let S=le(oe(w({onlyAvailables:!0}))),f=le(oe([])),k=L(()=>e().cards.filter(q=>!t(f).some(D=>D.id===q.id))),y=le(oe({opened:!1,filteredCards:[],allCards:[]}));const h=i.subscribe(()=>{H(y,{...t(y),allCards:[],filteredCards:[]},!0)});Ve(()=>{h()}),Te(async()=>{await Promise.all([_(),n()]),H(f,[...ee(P),...ee(i)],!0)});const g=q=>{e().cards=q,a.onChange(e())},u=q=>{e().cards=[...e().cards.filter(D=>t(f).some(G=>G.id===D.id)),...q],a.onChange(e())},b=async q=>{const D=e().cards.find(K=>K.id===q),G=t(f).find(K=>K.id===q);D&&G&&D.uses!==null&&G&&await x({expression:"1d8",variables:{},title:`${e().name}: Recarga de carta ${G.name}`,resultFormatter:Y=>`<span class="total ${Y>=(G.uses?.qty??0)?"success":"failure"}">${Y}</span>`})>=(G.uses?.qty??0)&&(D.uses+=1,g([...e().cards]))},A=q=>{H(S,q,!0),H(y,{...t(y),filteredCards:xe(t(y).allCards,t(S),e())},!0)},o=()=>{A(w({onlyAvailables:!0}))},d=q=>{setTimeout(()=>{const D=q==="ability"?ee(i):ee(P);H(y,{opened:!0,filteredCards:xe(D,t(S),e()),allCards:D},!0)},0)},s=()=>{H(y,{opened:!1,filteredCards:[],allCards:[]},!0)};var m=va(),R=Q(m),M=v(R);{var z=q=>{F(q,{children:(D,G)=>{var K=da(),Y=Q(K);T(Y,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return e().maxActiveCards},get readonly(){return a.readonly},fullWidth:!0,onChange:Fe=>{e().maxActiveCards=Number(Fe),a.onChange(e())}});var re=l(Y,2),ke=l(v(re),2),Ae=v(ke);Ae.__click=[ia,d];var De=l(Ae,2);De.__click=[sa,d],c(ke),c(re),C(D,K)},$$slots:{default:!0}})};E(M,q=>{a.readonly||q(z)})}var I=l(M,2);F(I,{get title(){return`Cartas Activas (${e().numActiveCards??""}/${e().maxActiveCards??""})`},children:(q,D)=>{{let G=L(()=>t(f).filter(K=>e().cards.some(Y=>Y.isActive&&Y.id===K.id)));fe(q,{get cards(){return t(G)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"active",onChange:g,onCardReloadClick:b})}},$$slots:{default:!0}});var N=l(I,2);{let q=L(()=>`ColecciÃ³n (${e().cards.length})`);F(N,{get title(){return t(q)},children:(D,G)=>{{let K=L(()=>t(f).filter(Y=>e().cards.some(re=>re.id===Y.id)));fe(D,{get cards(){return t(K)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"collection",onChange:g})}},$$slots:{default:!0}})}var j=l(N,2);{var Z=q=>{{let D=L(()=>`Cartas Corruptas (${t(k).length})`);F(q,{get title(){return t(D)},children:(G,K)=>{{let Y=L(()=>t(k).map(re=>({id:re.id,name:"Carta Corrupta",level:re.level,tags:["Corrupta"],requirements:null,description:"Esta carta ya no existe. Por favor, eliminala.",uses:{qty:0,type:"USES"},type:"corrupta",cardType:re.cardType,img:Qe.ABILITY_CARD_BACKGROUNDS.default})));fe(G,{get cards(){return t(Y)},get readonly(){return a.readonly},get characterCards(){return t(k)},listMode:"collection",onChange:u})}},$$slots:{default:!0}})}};E(j,q=>{!a.readonly&&t(k).length>0&&q(Z)})}c(R);var ae=l(R,2),ve=v(ae),_e=v(ve);Je(_e,{get cards(){return t(y).filteredCards},onFiltersChange:A,onResetFilters:o,get filters(){return t(S)},includeOnlyAvailablesFilter:!0});var de=l(_e,2),ue=v(de);{var ge=q=>{{let D=L(()=>t(y).filteredCards.filter(G=>e().cards.find(K=>K.id===G.id)===void 0));fe(q,{get cards(){return t(D)},get readonly(){return a.readonly},get characterCards(){return e().cards},listMode:"all",onChange:g})}},he=q=>{var D=ca();C(q,D)};E(ue,q=>{t(y).filteredCards.length>0?q(ge):q(he,!1)})}c(de),c(ve);var be=l(ve,2),ne=v(be),ce=v(ne);c(ne);var te=l(ne,2);te.__click=s,c(be),c(ae),Ke(ae,q=>Ye?.(q)),B(()=>{ie(ae,"hidden",!t(y).opened),V(ce,`${t(y).filteredCards.length??""}
			${t(y).filteredCards.length===1?"resultado":"resultados"}`)}),Le("outsideclick",ae,s),C(r,m),W()}J(["click"]);const ga=(r,a,e,n,i,_)=>{const P={id:crypto.randomUUID(),type:"add",value:a.quantity,reason:a.reason||e};n().goldHistory.unshift(P),i.onChange(n()),_()},ba=(r,a,e,n,i,_)=>{const P={id:crypto.randomUUID(),type:"subtract",value:a.quantity,reason:a.reason||e};n().goldHistory.unshift(P),i.onChange(n()),_()};var ma=p('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),_a=p('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">RazÃ³n</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),fa=(r,a,e)=>a(t(e)),ha=p('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acciÃ³n">â†¶</button></div>'),ya=p('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),Ca=p('<div class="history svelte-ssntdk"></div>'),pa=p("<!> <!> <!>",1);function ka(r,a){U(a,!0);const e="Sin razÃ³n especifica";let n=O(a,"character",7),i=oe({quantity:1,reason:""});const _=()=>{i.quantity=1,i.reason=""},P=y=>{n().goldHistory=n().goldHistory.filter(h=>h.id!==y.id),a.onChange(n())};var x=pa(),w=Q(x);F(w,{title:"Estado Actual",children:(y,h)=>{var g=ma(),u=v(g),b=l(v(u),2);let A;var o=v(b,!0);c(b),c(u);var d=l(u,2),s=l(v(d),2),m=v(s,!0);c(s),c(d),c(g),B(R=>{A=$(b,1,"number svelte-ssntdk",null,A,R),V(o,n().currentGold),V(m,n().spentGold)},[()=>({negative:n().currentGold<0})]),C(y,g)},$$slots:{default:!0}});var S=l(w,2);{var f=y=>{F(y,{title:"Actualizar Oro",children:(h,g)=>{var u=_a(),b=l(v(u),2),A=v(b);T(A,{get value(){return i.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:m=>{i.quantity=Number(m)}});var o=l(A,2);T(o,{get value(){return i.reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:m=>{i.reason=m.toString()}});var d=l(o,2);d.__click=[ba,i,e,n,a,_];var s=l(d,2);s.__click=[ga,i,e,n,a,_],c(b),c(u),C(h,u)},$$slots:{default:!0}})};E(S,y=>{a.readonly||y(f)})}var k=l(S,2);F(k,{title:"Historial",children:(y,h)=>{var g=Ca();X(g,21,()=>n().goldHistory,u=>u.id,(u,b)=>{var A=ha(),o=v(A);let d;var s=v(o);c(o);var m=l(o,2),R=v(m,!0);c(m);var M=l(m,2);M.__click=[fa,P,b],c(A),B(z=>{d=$(o,1,"log-amount svelte-ssntdk",null,d,z),V(s,`${t(b).type==="add"?"+":"-"}${t(b).value??""} Oro`),V(R,t(b).reason)},[()=>({positive:t(b).type==="add",negative:t(b).type==="subtract"})]),C(u,A)},u=>{var b=ya();C(u,b)}),c(g),C(y,g)},$$slots:{default:!0}}),C(r,x),W()}J(["click"]);const Aa=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),e.onChange(a())};var Pa=p('<button title="Agregar Ataque">â•</button>'),xa=(r,a,e)=>a(t(e)),wa=p('<button title="Eliminar" class="svelte-1v2w3y3">ğŸ—‘ï¸</button>'),Sa=p('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),Ra=p('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula DaÃ±o</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function Ma(r,a){U(a,!0);let e=O(a,"attacks",7);const n=f=>{e(e().filter(k=>k.id!==f.id)),a.onChange(e())};var i=Ra(),_=v(i),P=l(v(_),2);{var x=f=>{var k=Pa();k.__click=[Aa,e,a],C(f,k)};E(P,f=>{a.readonly||f(x)})}c(_);var w=l(_,2),S=l(v(w),2);X(S,17,e,f=>f.id,(f,k,y)=>{var h=Sa(),g=v(h);T(g,{get value(){return t(k).name},get readonly(){return a.readonly},placeholder:"Nombre",fullWidth:!0,onChange:s=>{t(k).name=s.toString(),a.onChange(e())}});var u=l(g,2);{let s=L(()=>({icon:"ğŸ¯",title:"Tirar Ataque",onClick:()=>a.onAttackRoll(t(k)),disabled:!t(k).atkFormula}));T(u,{get value(){return t(k).atkFormula},get readonly(){return a.readonly},placeholder:"1d8e+cuerpo",fullWidth:!0,onChange:m=>{t(k).atkFormula=m.toString(),a.onChange(e())},get button(){return t(s)}})}var b=l(u,2);{let s=L(()=>({icon:"ğŸ’¥",title:"Tirar DaÃ±o",onClick:()=>a.onDamageRoll(t(k)),disabled:!t(k).dmgFormula}));T(b,{get value(){return t(k).dmgFormula},get readonly(){return a.readonly},placeholder:"1d4",fullWidth:!0,onChange:m=>{t(k).dmgFormula=m.toString(),a.onChange(e())},get button(){return t(s)}})}var A=l(b,2);T(A,{get value(){return t(k).notes},get readonly(){return a.readonly},placeholder:"Contundente",fullWidth:!0,onChange:s=>{t(k).notes=s.toString(),a.onChange(e())}});var o=l(A,2);{var d=s=>{var m=wa();m.__click=[xa,n,k],C(s,m)};E(o,s=>{a.readonly||s(d)})}c(h),C(f,h)}),c(w),c(i),C(r,i),W()}J(["click"]);function me(r,a){U(a,!0);{let e=L(()=>({icon:"ğŸ²",onClick:a.onDiceRoll,title:"Tirar"}));T(r,{get label(){return a.name},get value(){return a.value},get readonly(){return a.readonly},onChange:n=>a.onChange(Number(n)),get button(){return t(e)}})}W()}const qa=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),e.onChange(a())};var za=p('<button title="Agregar Item">â•</button>'),Ia=(r,a,e)=>a(t(e)),Ta=p('<button title="Eliminar">ğŸ—‘ï¸</button>'),Na=p('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),ja=p('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="quantity svelte-1ewnrao">Cantidad</label> <label class="name svelte-1ewnrao">Nombre</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function Da(r,a){U(a,!0);let e=O(a,"equipment",7);const n=f=>{e(e().filter(k=>k.id!==f.id)),a.onChange(e())};var i=ja(),_=v(i),P=l(v(_),2);{var x=f=>{var k=za();k.__click=[qa,e,a],C(f,k)};E(P,f=>{a.readonly||f(x)})}c(_);var w=l(_,2),S=l(v(w),2);X(S,17,e,f=>f.id,(f,k,y)=>{var h=Na(),g=v(h);T(g,{get value(){return t(k).quantity},get readonly(){return a.readonly},onChange:d=>{t(k).quantity=Number(d),a.onChange(e())}});var u=l(g,2);T(u,{get value(){return t(k).name},get readonly(){return a.readonly},placeholder:"Nombre",onChange:d=>{t(k).name=d.toString(),a.onChange(e())}});var b=l(u,2);T(b,{get value(){return t(k).notes},get readonly(){return a.readonly},placeholder:"Notas",fullWidth:!0,onChange:d=>{t(k).notes=d.toString(),a.onChange(e())}});var A=l(b,2);{var o=d=>{var s=Ta();s.__click=[Ia,n,k],C(d,s)};E(A,d=>{a.readonly||d(o)})}c(h),C(f,h)}),c(w),c(i),C(r,i),W()}J(["click"]);var Fa=p('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),Ea=p('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),La=(r,a,e)=>a(t(e)),Ha=p('<button> <span class="dice">ğŸ²</span></button>'),Oa=p('<div class="skill-group svelte-ox7hjw"><div class="group-header svelte-ox7hjw"> </div> <div class="skills-list svelte-ox7hjw"></div></div>'),Ua=p('<div class="empty svelte-ox7hjw"><em>No hay habilidades configuradas. Ve a ConfiguraciÃ³n para agregarlas.</em></div>'),Wa=p('<div class="skills-container svelte-ox7hjw"><!> <!></div>'),Ga=p('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),Va=p('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Ba=p('<div class="empty svelte-ox7hjw"><em>El equipo esta vacÃ­o.</em></div>'),Ja=p('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Ka=p("<!> <!> <!> <!> <!>",1);function Ya(r,a){U(a,!0);let e=O(a,"character",7),{rollExpression:n,rollModal:i}=Me();const _=o=>{i.openRollModal({expression:`1d8e+${o}`,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence,iniciativa:e().initiative},title:`${e().name}: ${ye(o)}`})},P=o=>{i.openRollModal({expression:o.atkFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: Ataque con ${o.name}`})},x=o=>{n({expression:o.dmgFormula,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: DaÃ±o de ${o.name}`})},w={body:"cuerpo",reflexes:"reflejos",mind:"mente",instinct:"instinto",presence:"presencia"},S=["body","reflexes","mind","instinct","presence"];let f=L(()=>{const o={};return S.forEach(d=>{const s=w[d];o[s]=[]}),e().skills&&e().skills.forEach(d=>{const s=w[d.attribute]||d.attribute;o[s]||(o[s]=[]),o[s].push(d)}),Object.keys(o).forEach(d=>{o[d].sort((s,m)=>s.name.localeCompare(m.name))}),o});const k=o=>{const d=w[o.attribute];let s=`1d8e+${d}`;i.openRollModal({expression:s,variables:{cuerpo:e().attributes.body,reflejos:e().attributes.reflexes,mente:e().attributes.mind,instinto:e().attributes.instinct,presencia:e().attributes.presence},title:`${e().name}: ${o.name} (${ye(d)})`,rollType:o.hasAdvantage?"advantage":"normal"})};var y=Ka(),h=Q(y);F(h,{title:"Atributos Principales",children:(o,d)=>{var s=Fa(),m=v(s);me(m,{name:"Cuerpo",get value(){return e().attributes.body},get readonly(){return a.readonly},onDiceRoll:()=>_("cuerpo"),onChange:j=>{e().attributes.body=j,a.onChange(e())}});var R=l(m,2);me(R,{name:"Reflejos",get value(){return e().attributes.reflexes},get readonly(){return a.readonly},onDiceRoll:()=>_("reflejos"),onChange:j=>{e().attributes.reflexes=j,a.onChange(e())}});var M=l(R,2);me(M,{name:"Mente",get value(){return e().attributes.mind},get readonly(){return a.readonly},onDiceRoll:()=>_("mente"),onChange:j=>{e().attributes.mind=j,a.onChange(e())}});var z=l(M,2);me(z,{name:"Instinto",get value(){return e().attributes.instinct},get readonly(){return a.readonly},onDiceRoll:()=>_("instinto"),onChange:j=>{e().attributes.instinct=j,a.onChange(e())}});var I=l(z,2);me(I,{name:"Presencia",get value(){return e().attributes.presence},get readonly(){return a.readonly},onDiceRoll:()=>_("presencia"),onChange:j=>{e().attributes.presence=j,a.onChange(e())}});var N=l(I,2);T(N,{label:"Suerte",get value(){return e().currentLuck},get max(){return e().maxLuck},get readonly(){return a.readonly},onChange:j=>{e().currentLuck=Number(j),a.onChange(e())}}),c(s),C(o,s)},$$slots:{default:!0}});var g=l(h,2);F(g,{title:"Atributos Derivados",children:(o,d)=>{var s=Ea(),m=v(s);T(m,{label:"Salud",get value(){return e().currentHP},get max(){return e().maxHP},get readonly(){return a.readonly},onChange:Z=>{e().currentHP=Number(Z),a.onChange(e())}});var R=l(m,2);T(R,{label:"Salud Temporal",get value(){return e().tempHP},get readonly(){return a.readonly},onChange:Z=>{e().tempHP=Number(Z),a.onChange(e())}});var M=l(R,2);T(M,{label:"Velocidad",get value(){return e().speed},readonly:!0});var z=l(M,2);T(z,{label:"Esquiva",get value(){return e().evasion},readonly:!0});var I=l(z,2);T(I,{label:"MitigaciÃ³n FÃ­sica",get value(){return e().physicalMitigation},readonly:!0});var N=l(I,2);T(N,{label:"MitigaciÃ³n MÃ¡gica",get value(){return e().magicalMitigation},readonly:!0});var j=l(N,2);T(j,{label:"Iniciativa",get value(){return e().initiative},readonly:!0,button:{icon:"ğŸ²",title:"Tirar iniciativa",onClick:()=>_("iniciativa")}}),c(s),C(o,s)},$$slots:{default:!0}});var u=l(g,2);F(u,{title:"Habilidades",children:(o,d)=>{var s=Wa(),m=v(s);X(m,17,()=>Object.entries(t(f)),Pe,(z,I)=>{var N=L(()=>He(t(I),2));let j=()=>t(N)[0],Z=()=>t(N)[1];var ae=we(),ve=Q(ae);{var _e=de=>{var ue=Oa(),ge=v(ue),he=v(ge,!0);c(ge);var be=l(ge,2);X(be,21,Z,Pe,(ne,ce)=>{var te=Ha();let q;te.__click=[La,k,ce];var D=v(te);Se(),c(te),B(G=>{q=$(te,1,"skill-btn svelte-ox7hjw",null,q,G),ie(te,"title",t(ce).description),V(D,`${t(ce).name??""} `)},[()=>({advantage:t(ce).hasAdvantage})]),C(ne,te)}),c(be),c(ue),B(ne=>V(he,ne),[()=>ye(j())]),C(de,ue)};E(ve,de=>{Z().length>0&&de(_e)})}C(z,ae)});var R=l(m,2);{var M=z=>{var I=Ua();C(z,I)};E(R,z=>{e().skills.length===0&&z(M)})}c(s),C(o,s)},$$slots:{default:!0}});var b=l(u,2);F(b,{title:"InformaciÃ³n",children:(o,d)=>{var s=Va(),m=v(s);Ma(m,{get attacks(){return e().attacks},get readonly(){return a.readonly},onChange:N=>{e().attacks=N,a.onChange(e())},onAttackRoll:P,onDamageRoll:x});var R=l(m,2);{var M=N=>{var j=Ga();C(N,j)};E(R,N=>{e().attacks.length===0&&N(M)})}var z=l(R,2);pe(z,{label:"InformaciÃ³n RÃ¡pida",get value(){return e().quickInfo},get readonly(){return a.readonly},placeholder:"InformaciÃ³n general, habilidades, etc.",onChange:N=>{e().quickInfo=N,a.onChange(e())}});var I=l(z,2);T(I,{label:"Lenguas",get value(){return e().languages},get readonly(){return a.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:N=>{e().languages=N,a.onChange(e())}}),c(s),C(o,s)},$$slots:{default:!0}});var A=l(b,2);F(A,{title:"Equipo",children:(o,d)=>{var s=Ja(),m=v(s);T(m,{label:"Oro",get value(){return e().currentGold},readonly:!0,fullWidth:!0});var R=l(m,2);Da(R,{get equipment(){return e().equipment},get readonly(){return a.readonly},onChange:I=>{e().equipment=I,a.onChange(e())}});var M=l(R,2);{var z=I=>{var N=Ba();C(I,N)};E(M,I=>{e().equipment.length===0&&I(z)})}c(s),C(o,s)},$$slots:{default:!0}}),C(r,y),W()}J(["click"]);const Qa=(r,a,e,n)=>{const i={id:crypto.randomUUID(),title:"Nota Nueva",content:""};H(a,[...t(a),i],!0),e.onChange(t(a)),n(i)};var Xa=(r,a,e)=>a(t(e)),Za=p('<div class="header svelte-z1ulbz"><button title="Agregar Nota">â•</button> <button title="Eliminar Nota">ğŸ—‘ï¸</button></div>'),$a=(r,a,e)=>a(t(e)),et=p('<button><span class="svelte-z1ulbz"> </span></button>'),at=p('<div class="notes svelte-z1ulbz"></div>'),tt=p('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),rt=p('<div class="note svelte-z1ulbz"><!> <!></div>'),nt=p('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),lt=p('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function ot(r,a){U(a,!0);let e=le(oe(a.notes)),n=le(void 0),i=L(()=>t(e).find(d=>d.id===t(n)));const _=d=>{H(n,d.id,!0)},P=d=>{d&&(H(e,t(e).filter(s=>s.id!==d),!0),H(n,void 0),a.onChange(t(e)))},x=()=>{H(e,[...t(e)],!0),a.onChange(t(e))};var w=lt(),S=v(w),f=v(S);{var k=d=>{var s=Za(),m=v(s);m.__click=[Qa,e,a,_];var R=l(m,2);R.__click=[Xa,P,n],c(s),B(()=>R.disabled=!t(i)),C(d,s)};E(f,d=>{a.readonly||d(k)})}var y=l(f,2);{var h=d=>{var s=at();X(s,21,()=>t(e),m=>m.id,(m,R)=>{var M=et();let z;M.__click=[$a,_,R];var I=v(M),N=v(I,!0);c(I),c(M),B(j=>{z=$(M,1,"note-btn svelte-z1ulbz",null,z,j),V(N,t(R).title||"Nota sin tÃ­tulo")},[()=>({selected:t(n)===t(R).id})]),C(m,M)}),c(s),C(d,s)},g=d=>{var s=tt();C(d,s)};E(y,d=>{t(e).length>0?d(h):d(g,!1)})}c(S);var u=l(S,2),b=v(u);{var A=d=>{var s=rt(),m=v(s);je(m,{get value(){return t(i).title},get readonly(){return a.readonly},placeholder:"TÃ­tulo de la nota",onChange:M=>{t(i).title=M,x()}});var R=l(m,2);pe(R,{get value(){return t(i).content},get readonly(){return a.readonly},placeholder:"Contenido de la nota",onChange:M=>{t(i).content=M,x()},maxRows:"unlimited"}),c(s),C(d,s)},o=d=>{var s=nt();C(d,s)};E(b,d=>{t(i)?d(A):d(o,!1)})}c(u),c(w),C(r,w),W()}J(["click"]);function it(r,a){U(a,!0);let e=O(a,"character",7);F(r,{title:"Notas",children:(n,i)=>{ot(n,{get notes(){return e().notes},get readonly(){return a.readonly},onChange:_=>{e().notes=_,a.onChange(e())}})},$$slots:{default:!0}}),W()}const st=(r,a,e,n,i,_)=>{const P={id:crypto.randomUUID(),type:"add",value:a.quantity,reason:a.reason||e};n().ppHistory.unshift(P),i.onChange(n()),_()},dt=(r,a,e,n,i,_)=>{const P={id:crypto.randomUUID(),type:"subtract",value:a.quantity,reason:a.reason||e};n().ppHistory.unshift(P),i.onChange(n()),_()};var ct=p('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Rango del PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),vt=p('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">RazÃ³n</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),ut=(r,a,e)=>a(t(e)),gt=p('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acciÃ³n">â†¶</button></div>'),bt=p('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),mt=p('<div class="history svelte-1cdo061"></div>'),_t=p("<!> <!> <!>",1);function ft(r,a){U(a,!0);const e="Sin razÃ³n especifica";let n=O(a,"character",7),i=oe({quantity:1,reason:""});const _=()=>{i.quantity=1,i.reason=""},P=y=>{n().ppHistory=n().ppHistory.filter(h=>h.id!==y.id),a.onChange(n())};var x=_t(),w=Q(x);F(w,{title:"Estado Actual",children:(y,h)=>{var g=ct(),u=v(g),b=l(v(u),2);let A;var o=v(b,!0);c(b),c(u);var d=l(u,2),s=l(v(d),2),m=v(s,!0);c(s),c(d);var R=l(d,2),M=l(v(R),2),z=v(M,!0);c(M),c(R),c(g),B(I=>{A=$(b,1,"number svelte-1cdo061",null,A,I),V(o,n().currentPP),V(m,n().spentPP),V(z,n().tier)},[()=>({negative:n().currentPP<0})]),C(y,g)},$$slots:{default:!0}});var S=l(w,2);{var f=y=>{F(y,{title:"Actualizar Progreso",children:(h,g)=>{var u=vt(),b=l(v(u),2),A=v(b);T(A,{get value(){return i.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:m=>{i.quantity=Number(m)}});var o=l(A,2);T(o,{get value(){return i.reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:m=>{i.reason=m.toString()}});var d=l(o,2);d.__click=[dt,i,e,n,a,_];var s=l(d,2);s.__click=[st,i,e,n,a,_],c(b),c(u),C(h,u)},$$slots:{default:!0}})};E(S,y=>{a.readonly||y(f)})}var k=l(S,2);F(k,{title:"Historial",children:(y,h)=>{var g=mt();X(g,21,()=>n().ppHistory,u=>u.id,(u,b)=>{var A=gt(),o=v(A);let d;var s=v(o);c(o);var m=l(o,2),R=v(m,!0);c(m);var M=l(m,2);M.__click=[ut,P,b],c(A),B(z=>{d=$(o,1,"log-amount svelte-1cdo061",null,d,z),V(s,`${t(b).type==="add"?"+":"-"}${t(b).value??""} PP`),V(R,t(b).reason)},[()=>({positive:t(b).type==="add",negative:t(b).type==="subtract"})]),C(u,A)},u=>{var b=bt();C(u,b)}),c(g),C(y,g)},$$slots:{default:!0}}),C(r,x),W()}J(["click"]);const ht=(r,a)=>{let e="";if(e+=`# ${r.name}

`,e+=`## Atributos
`,e+=`- **Cuerpo:** ${r.attributes.body}
`,e+=`- **Reflejos:** ${r.attributes.reflexes}
`,e+=`- **Mente:** ${r.attributes.mind}
`,e+=`- **Instinto:** ${r.attributes.instinct}
`,e+=`- **Presencia:** ${r.attributes.presence}

`,e+=`- **Suerte:** ${r.currentLuck}/${r.maxLuck}
`,e+=`
`,e+=`## Atributos derivados
`,e+=`- **Salud:** ${r.currentHP}/${r.maxHP}
`,e+=`- **Salud Temporal:** ${r.tempHP}
`,e+=`- **Velocidad:** ${r.speed}
`,e+=`- **Esquiva:** ${r.evasion}
`,e+=`- **MitigaciÃ³n FÃ­sica:** ${r.physicalMitigation}
`,e+=`- **MitigaciÃ³n MÃ¡gica:** ${r.magicalMitigation}
`,e+=`- **Iniciativa:** ${r.initiative}
`,e+=`
`,r.quickInfo&&(e+=`## InformaciÃ³n RÃ¡pida
`,e+=`\`\`\`${r.quickInfo}
\`\`\`
`,e+=`
`),e+=`## Lenguas
`,e+=`${r.languages||"-"}
`,e+=`
`,e+=`## Oro
`,e+=`${r.currentGold}
`,e+=`
`,e+=`## Inventario
`,r.equipment.length>0){e+=`| Cantidad | Nombre | Notas |
`,e+=`| - | - | - |
`;for(const n of r.equipment)e+=`| ${n.quantity} | ${n.name} | ${n.notes} |
`}else e+=`__No hay items en el inventario.__
`;if(e+=`
`,e+=`## Cartas
`,e+=`**Cartas activas:** ${r.numActiveCards}${r.maxActiveCards}
`,e+=`### ColecciÃ³n
`,r.cards.length>0){e+=`| Nombre | Tipo | Activa |
`,e+=`| - | - | - |
`;for(const n of r.cards){const i=a.find(_=>_.id===n.id);i&&(e+=`| ${i.name} | ${i.cardType==="item"?"Objeto MÃ¡gico":"Habilidad"} | ${n.isActive?"Si":"No"} |
`)}}else e+=`__No hay cartas en la colecciÃ³n.__
`;if(e+=`
`,e+=`## Progreso
`,e+=`- **PP Actuales:** ${r.currentPP}
`,e+=`- **PP Gastados:** ${r.spentPP}
`,e+=`- **Rango del Personaje:** ${r.tier}
`,e+=`
`,r.story&&(e+=`## Historia
`,e+=`${r.story}
`,e+=`
`),r.notes.length>0){e+=`## Notas del Jugador
`;for(const n of r.notes)e+=`### ${n.title}
`,e+=`\`\`\`${n.content}\`\`\`
`;e+=`
`}return e},yt=async(r,a)=>{try{await navigator.clipboard.writeText(t(a)),await se.alert("Personaje en formato Markdown copiado al portapapeles!")}catch(e){console.error("Failed to copy text: ",e),await se.alert("Error al copiar el markdown al portapapeles")}};var Ct=p('<div class="header svelte-1m8ejye"><label>Personaje</label> <button>Copiar Markdown</button></div> <pre class="svelte-1m8ejye"> </pre>',1);function pt(r,a){U(a,!0);let e=le(oe([])),{loadAbilityCards:n,abilityCards:i,loadItemCards:_,itemCards:P}=Ne(),x=L(()=>ht(a.character,t(e)));Te(async()=>{await Promise.all([_(),n()]),H(e,[...ee(P),...ee(i)],!0)}),F(r,{children:(w,S)=>{var f=Ct(),k=Q(f),y=l(v(k),2);y.__click=[yt,x],c(k);var h=l(k,2),g=v(h,!0);c(h),B(()=>V(g,t(x))),C(w,f)},$$slots:{default:!0}}),W()}J(["click"]);var kt=(r,a,e)=>a()(t(e)),At=p("<option> </option>"),Pt=p('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function Ce(r,a){U(a,!0);let e=O(a,"onChange",3,()=>{}),n=L(()=>a.value);var i=Pt(),_=v(i);_.__change=[kt,e,n],X(_,21,()=>a.options,P=>P.label,(P,x)=>{var w=At(),S=v(w,!0);c(w);var f={};B(()=>{V(S,t(x).label),f!==(f=t(x).value)&&(w.value=(w.__value=t(x).value)??"")}),C(P,w)}),c(_),c(i),Ze(_,()=>t(n),P=>H(n,P)),C(r,i),W()}J(["change"]);const xt=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),e.onChange(a())};var wt=(r,a,e)=>a(t(e)),St=p('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">ğŸ—‘ï¸</button></div>'),Rt=p('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),Mt=p('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">â•</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">RazÃ³n</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function qt(r,a){U(a,!0);let e=O(a,"modifiers",7);const n=S=>{e(e().filter(f=>f.id!==S.id)),a.onChange(e())};var i=Mt(),_=v(i),P=l(v(_),2);P.__click=[xt,e,a],c(_);var x=l(_,2),w=l(v(x),2);X(w,17,e,S=>S.id,(S,f,k)=>{var y=St(),h=v(y);Ce(h,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return t(f).type},onChange:o=>{t(f).type=o.toString(),a.onChange(e())}});var g=l(h,2);Ce(g,{options:[{label:"Salud MÃ¡xima",value:"maxHP"},{label:"Suerte MÃ¡xima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"MitigaciÃ³n FÃ­sica",value:"physicalMitigation"},{label:"MitigaciÃ³n MÃ¡gica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return t(f).attribute},onChange:o=>{t(f).attribute=o.toString(),a.onChange(e())}});var u=l(g,2);T(u,{get value(){return t(f).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:o=>{t(f).formula=o.toString(),a.onChange(e())}});var b=l(u,2);T(b,{get value(){return t(f).reason},placeholder:"RazÃ³n",fullWidth:!0,onChange:o=>{t(f).reason=o.toString(),a.onChange(e())}});var A=l(b,2);A.__click=[wt,n,f],c(y),C(S,y)},S=>{var f=Rt();C(S,f)}),c(x),c(i),C(r,i),W()}J(["click"]);const zt=[{name:"Atletismo",attribute:"body",description:"Se usa para actividades fÃ­sicas exigentes como escalar, saltar largas distancias o nadar en aguas turbulentas.",hasAdvantage:!1},{name:"Fuerza Bruta",attribute:"body",description:"Se usa para aplicar tu poderÃ­o fÃ­sico sin refinamiento para superar un obstÃ¡culo. Incluye actos de fuerza explosiva como derribar una puerta, levantar un portÃ³n pesado o doblar barrotes.",hasAdvantage:!1},{name:"Aguante",attribute:"body",description:"Mide tu capacidad para soportar el agotamiento, el dolor y las condiciones adversas a travÃ©s de pura tenacidad. Se utiliza para realizar marchas forzadas durante dÃ­as, soportar climas extremos sin el equipo adecuado, aguantar la respiraciÃ³n bajo el agua, resistir los efectos del alcohol o el cansancio para no quedarte dormido, y para sobreponerse al dolor en un interrogatorio fÃ­sico.",hasAdvantage:!1},{name:"Acrobacias",attribute:"reflexes",description:"Mide tu capacidad para mantener el equilibrio, realizar piruetas, caer de pie y escapar de ataduras.",hasAdvantage:!1},{name:"Juego de Manos",attribute:"reflexes",description:"Para acciones que requieren destreza manual fina y discreta, como robar bolsillos, plantar un objeto en alguien o realizar trucos de prestidigitaciÃ³n.",hasAdvantage:!1},{name:"Sigilo",attribute:"reflexes",description:"Determina tu Ã©xito al moverte en silencio y evitar ser visto.",hasAdvantage:!1},{name:"Pilotaje",attribute:"reflexes",description:"Mide tu pericia para controlar monturas y vehÃ­culos, especialmente bajo presiÃ³n. Se utiliza para guiar un carruaje en una persecuciÃ³n a alta velocidad por las calles de una ciudad, para maniobrar una embarcaciÃ³n en aguas turbulentas, o para realizar giros cerrados y maniobras complejas con una montura en el fragor de la batalla.",hasAdvantage:!1},{name:"Conocimiento Arcano",attribute:"mind",description:"Mide tu conocimiento sobre conjuros, objetos mÃ¡gicos, tradiciones arcanas, planos de existencia y las criaturas que los habitan.",hasAdvantage:!1},{name:"Historia",attribute:"mind",description:"Refleja tu conocimiento sobre eventos pasados, reinos legendarios, dinastÃ­as antiguas y personajes histÃ³ricos.",hasAdvantage:!1},{name:"InvestigaciÃ³n",attribute:"mind",description:"Representa tu capacidad para deducir, encontrar pistas ocultas, descifrar cÃ³digos y conectar informaciÃ³n a partir de la evidencia.",hasAdvantage:!1},{name:"Naturaleza",attribute:"mind",description:"Mide tu conocimiento sobre flora y fauna, ecosistemas, venenos naturales y remedios herbales.",hasAdvantage:!1},{name:"ReligiÃ³n",attribute:"mind",description:"Representa tu conocimiento acerca de los panteones, sus dogmas, sus rituales y sus conflictos.",hasAdvantage:!1},{name:"PercepciÃ³n",attribute:"instinct",description:"Tu capacidad para ver, oÃ­r u oler detalles sutiles en tu entorno, como detectar una emboscada, encontrar una puerta secreta o notar que alguien estÃ¡ mintiendo.",hasAdvantage:!1},{name:"Perspicacia",attribute:"instinct",description:"Se usa para leer las intenciones de una criatura, discernir si estÃ¡ diciendo la verdad o sentir sus verdaderas emociones.",hasAdvantage:!1},{name:"Supervivencia",attribute:"instinct",description:"Mide tu habilidad para seguir rastros, cazar, orientarte en la naturaleza, predecir el clima y evitar peligros naturales.",hasAdvantage:!1},{name:"Trato con Animales",attribute:"instinct",description:"Tu aptitud para calmar, entender y hacerte amigo de los animales.",hasAdvantage:!1},{name:"EngaÃ±o",attribute:"presence",description:"Tu habilidad para mentir de forma convincente, ya sea ocultando la verdad, diciendo una mentira flagrante o adoptando un disfraz.",hasAdvantage:!1},{name:"IntimidaciÃ³n",attribute:"presence",description:"Se utiliza para influir en otros a travÃ©s de amenazas, una conducta hostil o la fuerza de tu presencia.",hasAdvantage:!1},{name:"InterpretaciÃ³n",attribute:"presence",description:"Refleja tu capacidad para cautivar a una audiencia a travÃ©s de la mÃºsica, el baile, la actuaciÃ³n, la oratoria o el relato de historias.",hasAdvantage:!1},{name:"PersuasiÃ³n",attribute:"presence",description:"Tu aptitud para convencer a otros a travÃ©s del tacto, la elocuencia, la buena fe y los argumentos lÃ³gicos.",hasAdvantage:!1}],It=()=>zt.map(r=>({...r,id:We()})),Tt=(r,a,e)=>{a([...a(),{id:crypto.randomUUID(),name:"",attribute:"body",description:"",hasAdvantage:!1}]),e.onChange(a())},Nt=async(r,a,e)=>{a().length>0&&!await se.confirm("Â¿EstÃ¡s seguro de que quieres cargar las habilidades por defecto? Esto borrarÃ¡ las habilidades actuales.",{title:"Confirmar reinicio",confirmLabel:"Reiniciar",cancelLabel:"Cancelar"})||(a(It()),e.onChange(a()))};var jt=p('<div class="skills-header svelte-6getny"><label class="name svelte-6getny">Nombre</label> <label class="attribute svelte-6getny">Atributo</label> <label class="description svelte-6getny">DescripciÃ³n</label> <label class="advantage svelte-6getny">Ventaja</label> <label class="btn svelte-6getny"></label></div>'),Dt=(r,a,e,n)=>{t(a).hasAdvantage=r.currentTarget.checked,e.onChange(n())},Ft=(r,a,e)=>a(t(e)),Et=p('<div class="skill svelte-6getny"><!> <!> <!> <div class="advantage-check svelte-6getny"><input type="checkbox" class="svelte-6getny"/></div> <button title="Eliminar" class="svelte-6getny">ğŸ—‘ï¸</button></div>'),Lt=p('<div class="empty svelte-6getny"><em>No hay habilidades configuradas.</em></div>'),Ht=p('<div class="skills-list svelte-6getny"><div class="header svelte-6getny"><label>Habilidades</label> <div class="actions svelte-6getny"><button title="Cargar por defecto">ğŸ”„</button> <button title="Agregar Habilidad">â•</button></div></div> <div class="content svelte-6getny"><!> <!></div></div>');function Ot(r,a){U(a,!0);let e=O(a,"skills",7);const n=h=>{e(e().filter(g=>g.id!==h.id)),a.onChange(e())};var i=Ht(),_=v(i),P=l(v(_),2),x=v(P);x.__click=[Nt,e,a];var w=l(x,2);w.__click=[Tt,e,a],c(P),c(_);var S=l(_,2),f=v(S);{var k=h=>{var g=jt();C(h,g)};E(f,h=>{e().length>0&&h(k)})}var y=l(f,2);X(y,17,e,h=>h.id,(h,g,u)=>{var b=Et(),A=v(b);T(A,{get value(){return t(g).name},placeholder:"Nombre",onChange:M=>{t(g).name=M.toString(),a.onChange(e())}});var o=l(A,2);Ce(o,{options:[{label:"Cuerpo",value:"body"},{label:"Reflejos",value:"reflexes"},{label:"Mente",value:"mind"},{label:"Instinto",value:"instinct"},{label:"Presencia",value:"presence"}],get value(){return t(g).attribute},onChange:M=>{t(g).attribute=M.toString(),a.onChange(e())}});var d=l(o,2);T(d,{get value(){return t(g).description},placeholder:"DescripciÃ³n",fullWidth:!0,onChange:M=>{t(g).description=M.toString(),a.onChange(e())}});var s=l(d,2),m=v(s);ze(m),m.__change=[Dt,g,a,e],c(s);var R=l(s,2);R.__click=[Ft,n,g],c(b),B(()=>Ge(m,t(g).hasAdvantage)),C(h,b)},h=>{var g=Lt();C(h,g)}),c(S),c(i),C(r,i),W()}J(["click","change"]);const Ut=async(r,a)=>{const e=await se.prompt("Introduce el ID del grupo al que quieres unirte:",{title:"Unirse a grupo",placeholder:"ID del grupo",confirmLabel:"Unirse",cancelLabel:"Cancelar"});e&&a(e)},Wt=async(r,a)=>{await se.confirm("Â¿Seguro que quieres abandonar el grupo actual?",{title:"Confirmar salida",confirmLabel:"Abandonar",cancelLabel:"Cancelar"})&&a(null)},Gt=(r,a)=>{Xe(Re(`/parties?partyId=${a().party.partyId}`))};var Vt=p("<button>Unirse a un Grupo</button>"),Bt=p("<button>Abandonar Grupo</button> <button>Ver Grupo</button>",1),Jt=p('<div class="party svelte-1hn03u3"><!> <div class="buttons svelte-1hn03u3"><!></div></div>'),Kt=p('<div class="general svelte-1hn03u3"><!></div>'),Yt=p('<div class="skills svelte-1hn03u3"><!></div>'),Qt=p('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em><p>Valores disponibles: cuerpo, reflejos, mente, instinto, presencia, ppGastados.</p> <p>Funciones disponibles: floor, ceil, round, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math" class="svelte-1hn03u3">Math</a></p></em></small></div>'),Xt=p("<!> <!> <!> <!>",1);function Zt(r,a){U(a,!0);let e=O(a,"character",7);const n=qe();let i=le(null);Oe(()=>{const y=e()?.party?.partyId??null;if(!y){H(i,null);return}(async()=>{try{await n.initFirebase();const h=await n.loadParty(y);console.log("[SettingsTab] Getting party name"),H(i,h?.name??null,!0)}catch{H(i,null)}})()});async function _(y){const h=y?.toString()?.trim()||null,g=e().party.partyId;if(!h){if(e().party.partyId=null,e().party.ownerId=null,H(i,null),a.onChange(e()),g&&e().id)try{const u=ee(n.user),b=u?u.uid:null;b&&typeof n.removePartyMember=="function"&&(await n.removePartyMember(g,b,e().id),console.debug("[SettingsTab] removePartyMember succeeded",{prevPid:g,uid:b,cid:e().id}))}catch(u){console.warn("[SettingsTab] removePartyMember failed (awaited)",u)}return}e().party.partyId=h;try{await n.initFirebase();const u=await n.loadParty(h);e().party.ownerId=u?.ownerId??null,H(i,u?.name??null,!0)}catch(u){console.warn("[SettingsTab] Failed to read party info",u),e().party={partyId:null,ownerId:null},H(i,null)}finally{a.onChange(e());try{const u=ee(n.user),b=u?u.uid:null;if(b&&h&&e().id)try{typeof n.setPartyMember=="function"&&(await n.setPartyMember(h,b,e().id),console.debug("[SettingsTab] setPartyMember succeeded",{pid:h,uid:b,cid:e().id}))}catch(A){console.warn("[SettingsTab] setPartyMember failed (awaited)",A),await se.alert("No se pudo registrar el personaje en el grupo (permiso denegado o error).")}}catch{}}}var P=Xt(),x=Q(P);{var w=y=>{F(y,{title:"Grupo",children:(h,g)=>{var u=Jt(),b=v(u);{let m=L(()=>t(i)??e().party.partyId??"");T(b,{label:"Grupo Actual",placeholder:"Ninguno, pidele a tu DJ el ID del grupo",get value(){return t(m)},readonly:!0,fullWidth:!0})}var A=l(b,2),o=v(A);{var d=m=>{var R=Vt();R.__click=[Ut,_],C(m,R)},s=m=>{var R=Bt(),M=Q(R);M.__click=[Wt,_];var z=l(M,2);z.__click=[Gt,e],C(m,R)};E(o,m=>{e().party.partyId?m(s,!1):m(d)})}c(A),c(u),C(h,u)},$$slots:{default:!0}})};E(x,y=>{a.allowPartyChange&&y(w)})}var S=l(x,2);F(S,{title:"General",children:(y,h)=>{var g=Kt(),u=v(g);{let b=L(()=>e().img??"");T(u,{label:"URL del Retrato",get value(){return t(b)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:A=>{const o=A.toString();o.length>0?e().img=o:e().img=null,a.onChange(e())}})}c(g),C(y,g)},$$slots:{default:!0}});var f=l(S,2);F(f,{title:"Habilidades",children:(y,h)=>{var g=Yt(),u=v(g);Ot(u,{get skills(){return e().skills},onChange:b=>{e().skills=b,a.onChange(e())}}),c(g),C(y,g)},$$slots:{default:!0}});var k=l(f,2);F(k,{title:"Modificadores",children:(y,h)=>{var g=Qt(),u=v(g);qt(u,{get modifiers(){return e().modifiers},onChange:b=>{e().modifiers=b,a.onChange(e())}}),Se(2),c(g),C(y,g)},$$slots:{default:!0}}),C(r,P),W()}J(["click"]);const $t=async(r,a,e)=>{const n=ee(a)?.uid;if(!n)return;const i=Re(`/characters/shared/${n}/${e().id}`);await navigator.clipboard.writeText(window.location.origin+i),await se.alert(`Se copio el enlace pÃºblico del personaje al portapapeles!

Compartelo con quien quieras que lo vea.`)};var er=p("<button> </button>"),ar=p('<span class="spacer svelte-1dl9cdg"></span> <button>ğŸ”— Compartir</button>',1),tr=p('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"><!> <!></div> <!></div>');function Ar(r,a){U(a,!0);let e=O(a,"character",7),n=O(a,"allowPartyChange",3,!0),{user:i}=qe();const _=[{name:"general",title:"General",component:Ya,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:ua,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:oa,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:it,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:ft,availableWhenReadOnly:!0},{name:"economy",title:"EconomÃ­a",component:ka,availableWhenReadOnly:!0},{name:"settings",title:"ConfiguraciÃ³n",component:Zt,availableWhenReadOnly:!1},{name:"see_as_md",title:"Ver como MD",component:pt,availableWhenReadOnly:!0}];let P=L(()=>Math.max(_.findIndex(o=>o.name===a.currentTab),0)),x=L(()=>_.find(o=>o.name===a.currentTab)??_[0]);const w=o=>{const d=o.copy();e(d),a.onChange(d)},S=o=>{H(P,o),a.onTabChange(_[o].name)};var f=tr(),k=v(f),y=v(k);je(y,{get value(){return e().name},get readonly(){return a.readonly},onChange:o=>{e().name=o,w(e())}}),c(k);var h=l(k,2),g=v(h);X(g,19,()=>_,o=>o.title,(o,d,s)=>{var m=we(),R=Q(m);{var M=z=>{var I=er();let N;I.__click=()=>S(t(s));var j=v(I,!0);c(I),B(Z=>{N=$(I,1,"tab",null,N,Z),V(j,t(d).title)},[()=>({selected:t(P)===t(s)})]),C(z,I)};E(R,z=>{(t(d).availableWhenReadOnly||!a.readonly)&&z(M)})}C(o,m)});var u=l(g,2);{var b=o=>{var d=ar(),s=l(Q(d),2);s.__click=[$t,i,e],C(o,d)};E(u,o=>{a.readonly||o(b)})}c(h);var A=l(h,2);{let o=L(()=>a.currentTab??"stats");Ue(A,()=>t(x).component,(d,s)=>{s(d,{get character(){return e()},get readonly(){return a.readonly},onChange:w,get allowPartyChange(){return n()},get currentTab(){return t(o)},onTabChange:m=>a.onTabChange(m)})})}c(f),C(r,f),W()}J(["click"]);export{Ar as C,ot as N,je as T,ht as s};
