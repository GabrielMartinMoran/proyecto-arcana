import{C as ge,u as Ie,a as Re}from"./m-XZ8rSS.js";import{w as Se,g as _e}from"./DnpldMJA.js";import"./DsnmJJEf.js";import{p as O,b as y,an as M,t as L,J as V,i as a,a as f,d as W,e as h,s as o,bd as Ue,r as u,f as se,am as Ce,I as he,a_ as Le,c as Me}from"./CXLGFl3I.js";import{d as X,s as H}from"./DYVYXqqK.js";import{i as U,a as Ne,s as ze}from"./ta242qJX.js";import{r as Oe,s as ne,e as ee}from"./BPnaOVD8.js";import{b as pe,s as Z}from"./BJEA7xJg.js";import{p as T}from"./tM2D1iY6.js";import{g as Ae}from"./BLuNEerD.js";import{p as $}from"./SLyWnJcv.js";import{c as We}from"./DOxq7gAU.js";import{c as I,u as He,a as je,f as me,b as fe,C as Ge,I as F}from"./L7rzADys.js";import{a as Je,o as Ve}from"./DfNiT5Wx.js";import{c as Be}from"./CjlGQt4x.js";import{b as Ke}from"./g8FqIwc9.js";const xe="arcana:characters",j={charactersStore:Se([]),exampleCharactersStore:Se([]),charactersAlreadyLoaded:!1,exampleCharactersAlreadyLoaded:!1};let Y=null,ue=null,oe=null,ve=null,ke=!1;const Fe="arcana:pendingCharacterDeletes",re=(()=>{try{const c=(()=>{try{return localStorage.getItem(Fe)}catch{return null}})();return c?JSON.parse(c):[]}catch{return[]}})(),we=()=>{try{localStorage.setItem(Fe,JSON.stringify(re))}catch(c){console.warn("[characters-service] Failed to persist pending deletes",c)}},Ye=async c=>{if(c&&Q.isEnabled())for(const e of[...re])try{await Q.deleteCharacterForUser(c,e);const t=re.indexOf(e);t!==-1&&(re.splice(t,1),we()),console.info("[characters-service] Successfully processed pending delete for",e)}catch(t){console.warn("[characters-service] Failed to process pending delete for",e,t)}},Q=Ie(),Qe=()=>{ve||(ve=j.charactersStore.subscribe(async c=>{if(ke)return;const e=JSON.stringify(c);try{localStorage.setItem(xe,e)}catch(t){console.warn("Error saving characters to localStorage:",t)}try{Y&&Q.isEnabled()&&await Q.saveCharactersForUser(Y,c)}catch(t){console.error("Error persisting characters to cloud:",t)}}))},Xe=()=>{if(ve){try{ve()}catch{}ve=null}},Ze=c=>{if(oe){try{oe()}catch{}oe=null}oe=Q.listenCharactersForUser(c,e=>{ke=!0;try{j.charactersStore.set(e.map(t=>new ge(t)))}finally{ke=!1}})},ye=()=>{if(oe){try{oe()}catch{}oe=null}},tr=()=>{const c=async()=>{if(!j.charactersAlreadyLoaded){try{await Q.initFirebase()}catch(r){console.warn("Firebase init error (continuing with local persistence):",r)}try{ue=await Q.onAuthState(async r=>{const n=Y;if(Y=r?r.uid:null,n&&n!==Y&&ye(),Y&&Q.isEnabled())try{Ze(Y),Ye(Y).catch(l=>{console.warn("[characters-service] processPendingDeletes failed:",l)})}catch(l){console.error("Error starting remote listener:",l)}else{ye();const l=localStorage.getItem(xe);if(l)try{const x=JSON.parse(l);j.charactersStore.set(x.map(w=>new ge(w)))}catch(x){console.error("Error parsing characters JSON:",x)}else j.charactersStore.set([])}})}catch(r){console.warn("Auth listener setup error (continuing with local persistence):",r);const n=localStorage.getItem(xe);if(n)try{const l=JSON.parse(n);j.charactersStore.set(l.map(x=>new ge(x)))}catch(l){console.error("Error parsing characters JSON:",l)}}Qe(),j.charactersAlreadyLoaded=!0}},e=async()=>{if(j.exampleCharactersAlreadyLoaded)return;let r=[];try{r=await(await fetch("/docs/example-characters.json")).json()}catch(n){console.error("Error fetching example characters:",n)}try{j.exampleCharactersStore.set(r.map(n=>new ge(n)))}catch(n){console.error("Error parsing example characters JSON:",n)}j.exampleCharactersAlreadyLoaded=!0},t=async r=>{j.charactersStore.update(n=>n.filter(l=>l.id!==r));try{re.includes(r)||(re.push(r),we())}catch(n){console.warn("[characters-service] Failed to queue pending delete:",n)}if(Y&&Q.isEnabled())try{await Q.deleteCharacterForUser(Y,r);const n=re.indexOf(r);n!==-1&&(re.splice(n,1),we())}catch(n){console.warn("[characters-service] Immediate cloud delete failed, queued for retry:",n);try{const l=await new Promise(x=>{j.charactersStore.subscribe(w=>x(w))()});await Q.saveCharactersForUser(Y,l)}catch(l){console.error("[characters-service] Error syncing characters after failed delete:",l)}}};return{loadCharacters:c,loadExampleCharacters:e,characters:j.charactersStore,exampleCharacters:j.exampleCharactersStore,deleteCharacter:t,cleanup:()=>{if(ue){try{ue()}catch{}ue=null}ye(),Xe()}}};var $e=(c,e,t)=>e.onChange(a(t)),et=y('<input type="text" class="svelte-19nbfo1"/>');function De(c,e){O(e,!0);let t=T(e,"placeholder",3,void 0),r=M(()=>e.value);var n=et();Oe(n),n.__input=[$e,e,r],L(()=>{ne(n,"placeholder",t()),n.disabled=e.readonly}),pe(n,()=>a(r),l=>V(r,l)),f(c,n),W()}X(["input"]);var tt=y("<label> </label>"),at=(c,e,t)=>e.onChange(a(t)),rt=y("<div><!> <div><textarea></textarea></div></div>");function Pe(c,e){O(e,!0);const t=6;let r=T(e,"label",3,void 0),n=T(e,"placeholder",3,""),l=T(e,"maxRows",3,t),x=M(()=>e.value);var w=rt();let P;var E=h(w);{var b=s=>{var g=tt(),C=h(g,!0);u(g),L(()=>H(C,r())),f(s,g)};U(E,s=>{r()&&s(b)})}var m=o(E,2);let A;var d=h(m);Ue(d),d.__input=[at,e,x];let S;u(m),u(w),L((s,g,C)=>{P=Z(w,1,"fieldgroup svelte-o02g58",null,P,s),A=Z(m,1,"field svelte-o02g58",null,A,g),d.disabled=e.readonly,ne(d,"placeholder",n()),ne(d,"rows",l()==="unlimited"?void 0:l()),S=Z(d,1,"svelte-o02g58",null,S,C)},[()=>({expanded:l()==="unlimited"}),()=>({expanded:l()==="unlimited"}),()=>({expanded:l()==="unlimited"})]),pe(d,()=>a(x),s=>V(x,s)),f(c,w),W()}X(["input"]);var nt=y('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),lt=y("<!> <!>",1);function ot(c,e){O(e,!0);let t=T(e,"character",7);var r=lt(),n=se(r);{var l=w=>{I(w,{children:(P,E)=>{var b=nt(),m=h(b);u(b),L(()=>{ne(m,"src",t().img),ne(m,"alt",t().name)}),f(P,b)},$$slots:{default:!0}})};U(n,w=>{t().img&&w(l)})}var x=o(n,2);I(x,{children:(w,P)=>{Pe(w,{label:"Historia",get value(){return t().story},get readonly(){return e.readonly},onChange:E=>{t().story=E,e.onChange(t())}})},$$slots:{default:!0}}),f(c,r),W()}var st=y('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),it=y('<div class="all-cards svelte-o497rd"><!> <!></div>'),dt=y('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div>');function ct(c,e){O(e,!0);const t=()=>Ne(w,"$cardsStore",r),[r,n]=ze();let l=T(e,"character",7),{loadCards:x,cards:w}=je(),{rollExpression:P}=Re();const{buildEmptyFilters:E,getFiltersFromURL:b,updateURLFilters:m}=He();let A=Ce(he(b())),d=M(()=>me(_e(w),a(A)));const S=w.subscribe(()=>{V(d,me(_e(w),a(A)))});Je(()=>{S()}),Ve(async()=>{await x()});const s=D=>{l().cards=D,e.onChange(l())},g=async D=>{const B=l().cards.find(z=>z.id===D),R=a(d).find(z=>z.id===D);B&&R&&B.uses!==null&&R&&await P({expression:"1d6",variables:{},title:`${l().name}: Recarga de carta ${R.name}`,resultFormatter:q=>`<span class="total ${q>=(R.uses?.qty??0)?"success":"failure"}">${q}</span>`})>=(R.uses?.qty??0)&&(B.uses+=1,s([...l().cards]))},C=D=>{V(A,D,!0),V(d,me(_e(w),a(A))),m(a(A))},k=()=>{C(E())};var i=dt(),v=h(i);{var _=D=>{I(D,{children:(B,R)=>{F(B,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return l().maxActiveCards},get readonly(){return e.readonly},fullWidth:!0,onChange:z=>{l().maxActiveCards=Number(z),e.onChange(l())}})},$$slots:{default:!0}})};U(v,D=>{e.readonly||D(_)})}var N=o(v,2);I(N,{get title(){return`Cartas Activas (${l().numActiveCards??""}/${l().maxActiveCards??""})`},children:(D,B)=>{{let R=M(()=>t().filter(z=>l().cards.some(q=>q.isActive&&q.id===z.id)));fe(D,{get cards(){return a(R)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"active",onChange:s,onCardReloadClick:g})}},$$slots:{default:!0}});var p=o(N,2);I(p,{title:"Colección",children:(D,B)=>{{let R=M(()=>t().filter(z=>l().cards.some(q=>q.id===z.id)));fe(D,{get cards(){return a(R)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"collection",onChange:s})}},$$slots:{default:!0}});var G=o(p,2);I(G,{title:"Todas las Cartas",children:(D,B)=>{var R=it(),z=h(R);Ge(z,{get cards(){return t()},onFiltersChange:C,onResetFilters:k,get filters(){return a(A)}});var q=o(z,2);{var J=K=>{{let ie=M(()=>a(d).filter(de=>l().cards.find(be=>be.id===de.id)===void 0));fe(K,{get cards(){return a(ie)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"all",onChange:s})}},te=K=>{var ie=st();f(K,ie)};U(q,K=>{a(d).length>0?K(J):K(te,!1)})}u(R),f(D,R)},$$slots:{default:!0}}),u(i),f(c,i),W(),n()}const vt=(c,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};r().goldHistory.unshift(x),n.onChange(r()),l()},ut=(c,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};r().goldHistory.unshift(x),n.onChange(r()),l()};var gt=y('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ht=y('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Razón</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),bt=(c,e,t)=>e(a(t)),_t=y('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acción">↶</button></div>'),mt=y('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),ft=y('<div class="history svelte-ssntdk"></div>'),yt=y("<!> <!> <!>",1);function Ct(c,e){O(e,!0);const t="Sin razón especifica";let r=T(e,"character",7),n=he({quantity:1,reason:""});const l=()=>{n.quantity=1,n.reason=""},x=A=>{r().goldHistory=r().goldHistory.filter(d=>d.id!==A.id),e.onChange(r())};var w=yt(),P=se(w);I(P,{title:"Estado Actual",children:(A,d)=>{var S=gt(),s=h(S),g=o(h(s),2);let C;var k=h(g,!0);u(g),u(s);var i=o(s,2),v=o(h(i),2),_=h(v,!0);u(v),u(i),u(S),L(N=>{C=Z(g,1,"number svelte-ssntdk",null,C,N),H(k,r().currentGold),H(_,r().spentGold)},[()=>({negative:r().currentGold<0})]),f(A,S)},$$slots:{default:!0}});var E=o(P,2);{var b=A=>{I(A,{title:"Actualizar Oro",children:(d,S)=>{var s=ht(),g=o(h(s),2),C=h(g);F(C,{get value(){return n.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:_=>{n.quantity=Number(_)}});var k=o(C,2);F(k,{get value(){return n.reason},placeholder:"Razón",fullWidth:!0,onChange:_=>{n.reason=_.toString()}});var i=o(k,2);i.__click=[ut,n,t,r,e,l];var v=o(i,2);v.__click=[vt,n,t,r,e,l],u(g),u(s),f(d,s)},$$slots:{default:!0}})};U(E,A=>{e.readonly||A(b)})}var m=o(E,2);I(m,{title:"Historial",children:(A,d)=>{var S=ft();ee(S,21,()=>r().goldHistory,s=>s.id,(s,g)=>{var C=_t(),k=h(C);let i;var v=h(k);u(k);var _=o(k,2),N=h(_,!0);u(_);var p=o(_,2);p.__click=[bt,x,g],u(C),L(G=>{i=Z(k,1,"log-amount svelte-ssntdk",null,i,G),H(v,`${a(g).type==="add"?"+":"-"}${a(g).value??""} Oro`),H(N,a(g).reason)},[()=>({positive:a(g).type==="add",negative:a(g).type==="subtract"})]),f(s,C)},s=>{var g=mt();f(s,g)}),u(S),f(A,S)},$$slots:{default:!0}}),f(c,w),W()}X(["click"]);const xt=(c,e,t)=>{e([...e(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),t.onChange(e())};var kt=y('<button title="Agregar Ataque">➕</button>'),wt=(c,e,t)=>e(a(t)),Pt=y('<button title="Eliminar" class="svelte-1v2w3y3">🗑️</button>'),St=y('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),At=y('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Daño</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function Et(c,e){O(e,!0);let t=T(e,"attacks",7);const r=b=>{t(t().filter(m=>m.id!==b.id)),e.onChange(t())};var n=At(),l=h(n),x=o(h(l),2);{var w=b=>{var m=kt();m.__click=[xt,t,e],f(b,m)};U(x,b=>{e.readonly||b(w)})}u(l);var P=o(l,2),E=o(h(P),2);ee(E,17,t,b=>b.id,(b,m,A)=>{var d=St(),S=h(d);F(S,{get value(){return a(m).name},get readonly(){return e.readonly},placeholder:"Nombre",fullWidth:!0,onChange:v=>{a(m).name=v.toString(),e.onChange(t())}});var s=o(S,2);{let v=M(()=>({icon:"🎯",title:"Tirar Ataque",onClick:()=>e.onAttackRoll(a(m)),disabled:!a(m).atkFormula}));F(s,{get value(){return a(m).atkFormula},get readonly(){return e.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:_=>{a(m).atkFormula=_.toString(),e.onChange(t())},get button(){return a(v)}})}var g=o(s,2);{let v=M(()=>({icon:"💥",title:"Tirar Daño",onClick:()=>e.onDamageRoll(a(m)),disabled:!a(m).dmgFormula}));F(g,{get value(){return a(m).dmgFormula},get readonly(){return e.readonly},placeholder:"1d4",fullWidth:!0,onChange:_=>{a(m).dmgFormula=_.toString(),e.onChange(t())},get button(){return a(v)}})}var C=o(g,2);F(C,{get value(){return a(m).notes},get readonly(){return e.readonly},placeholder:"Contundente",fullWidth:!0,onChange:v=>{a(m).notes=v.toString(),e.onChange(t())}});var k=o(C,2);{var i=v=>{var _=Pt();_.__click=[wt,r,m],f(v,_)};U(k,v=>{e.readonly||v(i)})}u(d),f(b,d)}),u(P),u(n),f(c,n),W()}X(["click"]);function ce(c,e){O(e,!0);{let t=M(()=>({icon:"🎲",onClick:e.onDiceRoll,title:"Tirar"}));F(c,{get label(){return e.name},get value(){return e.value},get readonly(){return e.readonly},onChange:r=>e.onChange(Number(r)),get button(){return a(t)}})}W()}const Rt=(c,e,t)=>{e([...e(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),t.onChange(e())};var Nt=y('<button title="Agregar Item">➕</button>'),zt=(c,e,t)=>e(a(t)),pt=y('<button title="Eliminar">🗑️</button>'),Ft=y('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),Dt=y('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="name svelte-1ewnrao">Nombre</label> <label class="quantity svelte-1ewnrao">Cantidad</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function qt(c,e){O(e,!0);let t=T(e,"equipment",7);const r=b=>{t(t().filter(m=>m.id!==b.id)),e.onChange(t())};var n=Dt(),l=h(n),x=o(h(l),2);{var w=b=>{var m=Nt();m.__click=[Rt,t,e],f(b,m)};U(x,b=>{e.readonly||b(w)})}u(l);var P=o(l,2),E=o(h(P),2);ee(E,17,t,b=>b.id,(b,m,A)=>{var d=Ft(),S=h(d);F(S,{get value(){return a(m).quantity},get readonly(){return e.readonly},onChange:i=>{a(m).quantity=Number(i),e.onChange(t())}});var s=o(S,2);F(s,{get value(){return a(m).name},get readonly(){return e.readonly},placeholder:"Nombre",onChange:i=>{a(m).name=i.toString(),e.onChange(t())}});var g=o(s,2);F(g,{get value(){return a(m).notes},get readonly(){return e.readonly},placeholder:"Notas",fullWidth:!0,onChange:i=>{a(m).notes=i.toString(),e.onChange(t())}});var C=o(g,2);{var k=i=>{var v=pt();v.__click=[zt,r,m],f(i,v)};U(C,i=>{e.readonly||i(k)})}u(d),f(b,d)}),u(P),u(n),f(c,n),W()}X(["click"]);var Tt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),It=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Ut=y('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),Lt=y('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Mt=y('<div class="empty svelte-ox7hjw"><em>El equipo esta vacío.</em></div>'),Ot=y('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Wt=y("<!> <!> <!> <!>",1);function Ht(c,e){O(e,!0);let t=T(e,"character",7),{rollExpression:r,rollModal:n}=Re();const l=d=>{n.openRollModal({expression:`1d6e+${d}`,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence,iniciativa:t().initiative},title:`${t().name}: ${Be(d)}`})},x=d=>{n.openRollModal({expression:d.atkFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Ataque con ${d.name}`})},w=d=>{r({expression:d.dmgFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Daño de ${d.name}`})};var P=Wt(),E=se(P);I(E,{title:"Atributos Principales",children:(d,S)=>{var s=Tt(),g=h(s);ce(g,{name:"Cuerpo",get value(){return t().attributes.body},get readonly(){return e.readonly},onDiceRoll:()=>l("cuerpo"),onChange:N=>{t().attributes.body=N,e.onChange(t())}});var C=o(g,2);ce(C,{name:"Reflejos",get value(){return t().attributes.reflexes},get readonly(){return e.readonly},onDiceRoll:()=>l("reflejos"),onChange:N=>{t().attributes.reflexes=N,e.onChange(t())}});var k=o(C,2);ce(k,{name:"Mente",get value(){return t().attributes.mind},get readonly(){return e.readonly},onDiceRoll:()=>l("mente"),onChange:N=>{t().attributes.mind=N,e.onChange(t())}});var i=o(k,2);ce(i,{name:"Instinto",get value(){return t().attributes.instinct},get readonly(){return e.readonly},onDiceRoll:()=>l("instinto"),onChange:N=>{t().attributes.instinct=N,e.onChange(t())}});var v=o(i,2);ce(v,{name:"Presencia",get value(){return t().attributes.presence},get readonly(){return e.readonly},onDiceRoll:()=>l("presencia"),onChange:N=>{t().attributes.presence=N,e.onChange(t())}});var _=o(v,2);F(_,{label:"Suerte",get value(){return t().currentLuck},get max(){return t().maxLuck},get readonly(){return e.readonly},onChange:N=>{t().currentLuck=Number(N),e.onChange(t())}}),u(s),f(d,s)},$$slots:{default:!0}});var b=o(E,2);I(b,{title:"Atributos Derivados",children:(d,S)=>{var s=It(),g=h(s);F(g,{label:"Salud",get value(){return t().currentHP},get max(){return t().maxHP},get readonly(){return e.readonly},onChange:p=>{t().currentHP=Number(p),e.onChange(t())}});var C=o(g,2);F(C,{label:"Salud Temporal",get value(){return t().tempHP},get readonly(){return e.readonly},onChange:p=>{t().tempHP=Number(p),e.onChange(t())}});var k=o(C,2);F(k,{label:"Velocidad",get value(){return t().speed},readonly:!0});var i=o(k,2);F(i,{label:"Esquiva",get value(){return t().evasion},readonly:!0});var v=o(i,2);F(v,{label:"Mitigación Física",get value(){return t().physicalMitigation},readonly:!0});var _=o(v,2);F(_,{label:"Mitigación Mágica",get value(){return t().magicalMitigation},readonly:!0});var N=o(_,2);F(N,{label:"Iniciativa",get value(){return t().initiative},readonly:!0,button:{icon:"🎲",title:"Tirar iniciativa",onClick:()=>l("iniciativa")}}),u(s),f(d,s)},$$slots:{default:!0}});var m=o(b,2);I(m,{title:"Información",children:(d,S)=>{var s=Lt(),g=h(s);Et(g,{get attacks(){return t().attacks},get readonly(){return e.readonly},onChange:_=>{t().attacks=_,e.onChange(t())},onAttackRoll:x,onDamageRoll:w});var C=o(g,2);{var k=_=>{var N=Ut();f(_,N)};U(C,_=>{t().attacks.length===0&&_(k)})}var i=o(C,2);Pe(i,{label:"Información Rápida",get value(){return t().quickInfo},get readonly(){return e.readonly},placeholder:"Información general, habilidades, etc.",onChange:_=>{t().quickInfo=_,e.onChange(t())}});var v=o(i,2);F(v,{label:"Lenguas",get value(){return t().languages},get readonly(){return e.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:_=>{t().languages=_,e.onChange(t())}}),u(s),f(d,s)},$$slots:{default:!0}});var A=o(m,2);I(A,{title:"Equipo",children:(d,S)=>{var s=Ot(),g=h(s);F(g,{label:"Oro",get value(){return t().currentGold},readonly:!0,fullWidth:!0});var C=o(g,2);qt(C,{get equipment(){return t().equipment},get readonly(){return e.readonly},onChange:v=>{t().equipment=v,e.onChange(t())}});var k=o(C,2);{var i=v=>{var _=Mt();f(v,_)};U(k,v=>{t().equipment.length===0&&v(i)})}u(s),f(d,s)},$$slots:{default:!0}}),f(c,P),W()}const jt=(c,e,t,r)=>{const n={id:crypto.randomUUID(),title:"Nota Nueva",content:""};V(e,[...a(e),n],!0),t.onChange(a(e)),r(n)};var Gt=(c,e,t)=>e(a(t)),Jt=y('<div class="header svelte-z1ulbz"><button title="Agregar Nota">➕</button> <button title="Eliminar Nota">🗑️</button></div>'),Vt=(c,e,t)=>e(a(t)),Bt=y('<button><span class="svelte-z1ulbz"> </span></button>'),Kt=y('<div class="notes svelte-z1ulbz"></div>'),Yt=y('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Qt=y('<div class="note svelte-z1ulbz"><!> <!></div>'),Xt=y('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Zt=y('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function $t(c,e){O(e,!0);let t=Ce(he(e.notes)),r=Ce(void 0),n=M(()=>a(t).find(i=>i.id===a(r)));const l=i=>{V(r,i.id,!0)},x=i=>{i&&(V(t,a(t).filter(v=>v.id!==i),!0),V(r,void 0),e.onChange(a(t)))},w=()=>{V(t,[...a(t)],!0),e.onChange(a(t))};var P=Zt(),E=h(P),b=h(E);{var m=i=>{var v=Jt(),_=h(v);_.__click=[jt,t,e,l];var N=o(_,2);N.__click=[Gt,x,r],u(v),L(()=>N.disabled=!a(n)),f(i,v)};U(b,i=>{e.readonly||i(m)})}var A=o(b,2);{var d=i=>{var v=Kt();ee(v,21,()=>a(t),_=>_.id,(_,N)=>{var p=Bt();let G;p.__click=[Vt,l,N];var D=h(p),B=h(D,!0);u(D),u(p),L(R=>{G=Z(p,1,"note-btn svelte-z1ulbz",null,G,R),H(B,a(N).title||"Nota sin título")},[()=>({selected:a(r)===a(N).id})]),f(_,p)}),u(v),f(i,v)},S=i=>{var v=Yt();f(i,v)};U(A,i=>{a(t).length>0?i(d):i(S,!1)})}u(E);var s=o(E,2),g=h(s);{var C=i=>{var v=Qt(),_=h(v);De(_,{get value(){return a(n).title},get readonly(){return e.readonly},placeholder:"Título de la nota",onChange:p=>{a(n).title=p,w()}});var N=o(_,2);Pe(N,{get value(){return a(n).content},get readonly(){return e.readonly},placeholder:"Contenido de la nota",onChange:p=>{a(n).content=p,w()},maxRows:"unlimited"}),u(v),f(i,v)},k=i=>{var v=Xt();f(i,v)};U(g,i=>{a(n)?i(C):i(k,!1)})}u(s),u(P),f(c,P),W()}X(["click"]);function ea(c,e){O(e,!0);let t=T(e,"character",7);I(c,{title:"Notas",children:(r,n)=>{$t(r,{get notes(){return t().notes},get readonly(){return e.readonly},onChange:l=>{t().notes=l,e.onChange(t())}})},$$slots:{default:!0}}),W()}const ta=(c,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};r().ppHistory.unshift(x),n.onChange(r()),l()},aa=(c,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};r().ppHistory.unshift(x),n.onChange(r()),l()};var ra=y('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Poder de PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),na=y('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Razón</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),la=(c,e,t)=>e(a(t)),oa=y('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acción">↶</button></div>'),sa=y('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),ia=y('<div class="history svelte-1cdo061"></div>'),da=y("<!> <!> <!>",1);function ca(c,e){O(e,!0);const t="Sin razón especifica";let r=T(e,"character",7),n=he({quantity:1,reason:""});const l=()=>{n.quantity=1,n.reason=""},x=A=>{r().ppHistory=r().ppHistory.filter(d=>d.id!==A.id),e.onChange(r())};var w=da(),P=se(w);I(P,{title:"Estado Actual",children:(A,d)=>{var S=ra(),s=h(S),g=o(h(s),2);let C;var k=h(g,!0);u(g),u(s);var i=o(s,2),v=o(h(i),2),_=h(v,!0);u(v),u(i);var N=o(i,2),p=o(h(N),2),G=h(p,!0);u(p),u(N),u(S),L(D=>{C=Z(g,1,"number svelte-1cdo061",null,C,D),H(k,r().currentPP),H(_,r().spentPP),H(G,r().pjPower)},[()=>({negative:r().currentPP<0})]),f(A,S)},$$slots:{default:!0}});var E=o(P,2);{var b=A=>{I(A,{title:"Actualizar Progreso",children:(d,S)=>{var s=na(),g=o(h(s),2),C=h(g);F(C,{get value(){return n.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:_=>{n.quantity=Number(_)}});var k=o(C,2);F(k,{get value(){return n.reason},placeholder:"Razón",fullWidth:!0,onChange:_=>{n.reason=_.toString()}});var i=o(k,2);i.__click=[aa,n,t,r,e,l];var v=o(i,2);v.__click=[ta,n,t,r,e,l],u(g),u(s),f(d,s)},$$slots:{default:!0}})};U(E,A=>{e.readonly||A(b)})}var m=o(E,2);I(m,{title:"Historial",children:(A,d)=>{var S=ia();ee(S,21,()=>r().ppHistory,s=>s.id,(s,g)=>{var C=oa(),k=h(C);let i;var v=h(k);u(k);var _=o(k,2),N=h(_,!0);u(_);var p=o(_,2);p.__click=[la,x,g],u(C),L(G=>{i=Z(k,1,"log-amount svelte-1cdo061",null,i,G),H(v,`${a(g).type==="add"?"+":"-"}${a(g).value??""} PP`),H(N,a(g).reason)},[()=>({positive:a(g).type==="add",negative:a(g).type==="subtract"})]),f(s,C)},s=>{var g=sa();f(s,g)}),u(S),f(A,S)},$$slots:{default:!0}}),f(c,w),W()}X(["click"]);var va=(c,e,t)=>e()(a(t)),ua=y("<option> </option>"),ga=y('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function Ee(c,e){O(e,!0);let t=T(e,"onChange",3,()=>{}),r=M(()=>e.value);var n=ga(),l=h(n);l.__change=[va,t,r],ee(l,21,()=>e.options,x=>x.label,(x,w)=>{var P=ua(),E=h(P,!0);u(P);var b={};L(()=>{H(E,a(w).label),b!==(b=a(w).value)&&(P.value=(P.__value=a(w).value)??"")}),f(x,P)}),u(l),u(n),Ke(l,()=>a(r),x=>V(r,x)),f(c,n),W()}X(["change"]);const ha=(c,e,t)=>{e([...e(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),t.onChange(e())};var ba=(c,e,t)=>e(a(t)),_a=y('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">🗑️</button></div>'),ma=y('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),fa=y('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">➕</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Razón</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function ya(c,e){O(e,!0);let t=T(e,"modifiers",7);const r=E=>{t(t().filter(b=>b.id!==E.id)),e.onChange(t())};var n=fa(),l=h(n),x=o(h(l),2);x.__click=[ha,t,e],u(l);var w=o(l,2),P=o(h(w),2);ee(P,17,t,E=>E.id,(E,b,m)=>{var A=_a(),d=h(A);Ee(d,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return a(b).type},onChange:k=>{a(b).type=k.toString(),e.onChange(t())}});var S=o(d,2);Ee(S,{options:[{label:"Salud Máxima",value:"maxHP"},{label:"Suerte Máxima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigación Física",value:"physicalMitigation"},{label:"Mitigación Mágica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return a(b).attribute},onChange:k=>{a(b).attribute=k.toString(),e.onChange(t())}});var s=o(S,2);F(s,{get value(){return a(b).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:k=>{a(b).formula=k.toString(),e.onChange(t())}});var g=o(s,2);F(g,{get value(){return a(b).reason},placeholder:"Razón",fullWidth:!0,onChange:k=>{a(b).reason=k.toString(),e.onChange(t())}});var C=o(g,2);C.__click=[ba,r,b],u(A),f(E,A)},E=>{var b=ma();f(E,b)}),u(w),u(n),f(c,n),W()}X(["click"]);var Ca=y('<div class="general svelte-1hn03u3"><!></div>'),xa=y('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),ka=y("<!> <!>",1);function wa(c,e){O(e,!0);let t=T(e,"character",7);var r=ka(),n=se(r);I(n,{title:"General",children:(x,w)=>{var P=Ca(),E=h(P);{let b=M(()=>t().img??"");F(E,{label:"URL del Retrato",get value(){return a(b)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:m=>{const A=m.toString();A.length>0?t().img=A:t().img=null,e.onChange(t())}})}u(P),f(x,P)},$$slots:{default:!0}});var l=o(n,2);I(l,{title:"Modificadores",children:(x,w)=>{var P=xa(),E=h(P);ya(E,{get modifiers(){return t().modifiers},onChange:b=>{t().modifiers=b,e.onChange(t())}}),Le(2),u(P),f(x,P)},$$slots:{default:!0}}),f(c,r),W()}var Pa=y("<button> </button>"),Sa=y('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function Aa(c,e){O(e,!0);let t=T(e,"character",7);const r=[{name:"general",title:"General",component:Ht,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:ct,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:ot,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:ea,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:ca,availableWhenReadOnly:!0},{name:"economy",title:"Economía",component:Ct,availableWhenReadOnly:!0},{name:"settings",title:"Configuración",component:wa,availableWhenReadOnly:!1}];let n=M(()=>Math.max(r.findIndex(d=>d.name===e.currentTab),0)),l=M(()=>r.find(d=>d.name===e.currentTab)??r[0]);const x=d=>{const S=d.copy();e.onChange(S),t(S)},w=d=>{V(n,d),e.onTabChange(r[d].name)};var P=Sa(),E=h(P),b=h(E);De(b,{get value(){return t().name},get readonly(){return e.readonly},onChange:d=>{t().name=d,x(t())}}),u(E);var m=o(E,2);ee(m,23,()=>r,d=>d.title,(d,S,s)=>{var g=Me(),C=se(g);{var k=i=>{var v=Pa();let _;v.__click=()=>w(a(s));var N=h(v,!0);u(v),L(p=>{_=Z(v,1,"tab",null,_,p),H(N,a(S).title)},[()=>({selected:a(n)===a(s)})]),f(i,v)};U(C,i=>{(a(S).availableWhenReadOnly||!e.readonly)&&i(k)})}f(d,g)}),u(m);var A=o(m,2);We(A,()=>a(l).component,(d,S)=>{S(d,{get character(){return t()},get readonly(){return e.readonly},onChange:x})}),u(P),f(c,P),W()}X(["click"]);const Ea=async(c,e,t)=>{const r=await e()();t(r)},Ra=async(c,e,t)=>{const r=await e()();t(r)},Na=async(c,e,t)=>{a(e)&&await t()(a(e))},za=async(c,e,t,r)=>{!a(e)||!confirm(`¿Quieres eliminar a ${a(e).name}?`)||(await t()(a(e)),V(e,void 0),r(null))},pa=async(c,e,t)=>{a(e)&&await t()(a(e))};var Fa=y('<button title="Importar y Editar">📝</button>'),Da=y('<button title="Crear">➕</button> <button title="Importar">📥</button> <button title="Exportar">📤</button> <button title="Eliminar">🗑️</button>',1),qa=(c,e,t)=>e(a(t)),Ta=y('<img class="character-image svelte-dk16f3"/>'),Ia=y('<span class="image-placeholder svelte-dk16f3"> </span>'),Ua=y('<button><!> <span class="name svelte-dk16f3"> </span></button>'),La=y('<section class="characters-page svelte-dk16f3"><div class="list svelte-dk16f3"><div class="header svelte-dk16f3"><!></div> <div class="content svelte-dk16f3"></div></div> <div class="viewport svelte-dk16f3"><!></div></section>');function ar(c,e){O(e,!0);const t=()=>Ne(e.characters,"$characters",r),[r,n]=ze(),l="general";let x=T(e,"onAddToMyCharacters",3,()=>{throw new Error("onAddToMyCharacters not implemented")}),w=T(e,"onCreateCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),P=T(e,"onImportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),E=T(e,"onExportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),b=T(e,"onDeleteCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),m=M(()=>$.url.searchParams.get("characterId")),A=M(()=>$.url.searchParams.get("tab")??l);const d=R=>{R!==null?($.url.searchParams.set("characterId",R.id),$.url.searchParams.set("tab",l)):($.url.searchParams.delete("characterId"),$.url.searchParams.delete("tab")),Ae(`?${$.url.searchParams.toString()}`)},S=R=>{$.url.searchParams.set("tab",R),Ae(`?${$.url.searchParams.toString()}`)};let s=M(()=>t().find(R=>R.id===a(m)));const g=R=>{e.characters.update(z=>{const q=z.findIndex(J=>J.id===R.id);if(q!==-1){const J=[...z];return J[q]=R,J}return z})};var C=La(),k=h(C),i=h(k),v=h(i);{var _=R=>{var z=Fa();z.__click=[pa,s,x],L(()=>z.disabled=e.allActionsDisabled||!a(s)),f(R,z)},N=R=>{var z=Da(),q=se(z);q.__click=[Ea,w,d];var J=o(q,2);J.__click=[Ra,P,d];var te=o(J,2);te.__click=[Na,s,E];var K=o(te,2);K.__click=[za,s,b,d],L(()=>{q.disabled=e.allActionsDisabled,J.disabled=e.allActionsDisabled,te.disabled=e.allActionsDisabled||!a(s),K.disabled=e.allActionsDisabled||!a(s)}),f(R,z)};U(v,R=>{e.readonly?R(_):R(N,!1)})}u(i);var p=o(i,2);ee(p,5,t,R=>R.id,(R,z)=>{var q=Ua();let J;q.__click=[qa,d,z];var te=h(q);{var K=ae=>{var le=Ta();L(()=>{ne(le,"src",a(z).img),ne(le,"alt",a(z).name)}),f(ae,le)},ie=ae=>{var le=Ia(),qe=h(le,!0);u(le),L(Te=>H(qe,Te),[()=>a(z).name.charAt(0).toUpperCase()]),f(ae,le)};U(te,ae=>{a(z).img?ae(K):ae(ie,!1)})}var de=o(te,2),be=h(de,!0);u(de),u(q),L(ae=>{J=Z(q,1,"character-item svelte-dk16f3",null,J,ae),ne(de,"title",a(z).name),H(be,a(z).name)},[()=>({selected:a(m)===a(z).id})]),f(R,q)}),u(p),u(k);var G=o(k,2),D=h(G);{var B=R=>{Aa(R,{get character(){return a(s)},get readonly(){return e.readonly},onChange:g,get currentTab(){return a(A)},onTabChange:S})};U(D,R=>{a(s)&&R(B)})}u(G),u(C),f(c,C),W(),n()}X(["click"]);export{ar as C,tr as u};
