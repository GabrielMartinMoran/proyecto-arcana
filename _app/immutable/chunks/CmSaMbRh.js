import{C as ve,u as Fe,a as Pe}from"./CdP0W2Yj.js";import{w as Ce}from"./Dxiokm-6.js";import"./DsnmJJEf.js";import{p as M,b as y,aL as U,t as I,J as B,i as a,a as f,d as L,e as _,s,bd as Te,r as g,f as le,I as fe,aP as xe,a_ as Ie,c as Ue}from"./DYbDzwUz.js";import{d as K,s as O}from"./Bv3eHQs5.js";import{i as T,a as Se,s as Ae}from"./Cc_HksML.js";import{e as Z}from"./BcxGJwjK.js";import{r as Me,s as ae}from"./Coc7tNCi.js";import{b as Ee,s as Q}from"./CNlKbhCn.js";import{p as D}from"./CnzsFyVP.js";import{g as ke}from"./aqU259-d.js";import{p as X}from"./DySAmEa7.js";import{c as Le}from"./oDWvcfas.js";import{b as F,u as Oe,a as ge,C as We,I as p}from"./TPa2NKaA.js";import{o as He}from"./Eew5uVUK.js";import{c as je}from"./CjlGQt4x.js";import{b as Ge}from"./BYilo7wj.js";const be="arcana:characters",H={charactersStore:Ce([]),exampleCharactersStore:Ce([]),charactersAlreadyLoaded:!1,exampleCharactersAlreadyLoaded:!1};let J=null,ce=null,ne=null,ie=null,_e=!1;const Ne="arcana:pendingCharacterDeletes",te=(()=>{try{const u=(()=>{try{return localStorage.getItem(Ne)}catch{return null}})();return u?JSON.parse(u):[]}catch{return[]}})(),me=()=>{try{localStorage.setItem(Ne,JSON.stringify(te))}catch(u){console.warn("[characters-service] Failed to persist pending deletes",u)}},Je=async u=>{if(u&&V.isEnabled())for(const e of[...te])try{await V.deleteCharacterForUser(u,e);const t=te.indexOf(e);t!==-1&&(te.splice(t,1),me()),console.info("[characters-service] Successfully processed pending delete for",e)}catch(t){console.warn("[characters-service] Failed to process pending delete for",e,t)}},V=Fe(),Ve=()=>{ie||(ie=H.charactersStore.subscribe(async u=>{if(_e)return;const e=JSON.stringify(u);try{localStorage.setItem(be,e)}catch(t){console.warn("Error saving characters to localStorage:",t)}try{J&&V.isEnabled()&&await V.saveCharactersForUser(J,u)}catch(t){console.error("Error persisting characters to cloud:",t)}}))},Be=()=>{if(ie){try{ie()}catch{}ie=null}},Ke=u=>{if(ne){try{ne()}catch{}ne=null}ne=V.listenCharactersForUser(u,e=>{_e=!0;try{H.charactersStore.set(e.map(t=>new ve(t)))}finally{_e=!1}})},he=()=>{if(ne){try{ne()}catch{}ne=null}},Za=()=>{const u=async()=>{if(!H.charactersAlreadyLoaded){try{await V.initFirebase()}catch(r){console.warn("Firebase init error (continuing with local persistence):",r)}try{ce=await V.onAuthState(async r=>{const n=J;if(J=r?r.uid:null,n&&n!==J&&he(),J&&V.isEnabled())try{Ke(J),Je(J).catch(l=>{console.warn("[characters-service] processPendingDeletes failed:",l)})}catch(l){console.error("Error starting remote listener:",l)}else{he();const l=localStorage.getItem(be);if(l)try{const x=JSON.parse(l);H.charactersStore.set(x.map(E=>new ve(E)))}catch(x){console.error("Error parsing characters JSON:",x)}else H.charactersStore.set([])}})}catch(r){console.warn("Auth listener setup error (continuing with local persistence):",r);const n=localStorage.getItem(be);if(n)try{const l=JSON.parse(n);H.charactersStore.set(l.map(x=>new ve(x)))}catch(l){console.error("Error parsing characters JSON:",l)}}Ve(),H.charactersAlreadyLoaded=!0}},e=async()=>{if(H.exampleCharactersAlreadyLoaded)return;let r=[];try{r=await(await fetch("/docs/example-characters.json")).json()}catch(n){console.error("Error fetching example characters:",n)}try{H.exampleCharactersStore.set(r.map(n=>new ve(n)))}catch(n){console.error("Error parsing example characters JSON:",n)}H.exampleCharactersAlreadyLoaded=!0},t=async r=>{H.charactersStore.update(n=>n.filter(l=>l.id!==r));try{te.includes(r)||(te.push(r),me())}catch(n){console.warn("[characters-service] Failed to queue pending delete:",n)}if(J&&V.isEnabled())try{await V.deleteCharacterForUser(J,r);const n=te.indexOf(r);n!==-1&&(te.splice(n,1),me())}catch(n){console.warn("[characters-service] Immediate cloud delete failed, queued for retry:",n);try{const l=await new Promise(x=>{H.charactersStore.subscribe(E=>x(E))()});await V.saveCharactersForUser(J,l)}catch(l){console.error("[characters-service] Error syncing characters after failed delete:",l)}}};return{loadCharacters:u,loadExampleCharacters:e,characters:H.charactersStore,exampleCharacters:H.exampleCharactersStore,deleteCharacter:t,cleanup:()=>{if(ce){try{ce()}catch{}ce=null}he(),Be()}}};var Ye=(u,e,t)=>e.onChange(a(t)),Qe=y('<input type="text" class="svelte-19nbfo1"/>');function Re(u,e){M(e,!0);let t=D(e,"placeholder",3,void 0),r=U(()=>e.value);var n=Qe();Me(n),n.__input=[Ye,e,r],I(()=>{ae(n,"placeholder",t()),n.disabled=e.readonly}),Ee(n,()=>a(r),l=>B(r,l)),f(u,n),L()}K(["input"]);var Xe=y("<label> </label>"),Ze=(u,e,t)=>e.onChange(a(t)),$e=y("<div><!> <div><textarea></textarea></div></div>");function ye(u,e){M(e,!0);const t=6;let r=D(e,"label",3,void 0),n=D(e,"placeholder",3,""),l=D(e,"maxRows",3,t),x=U(()=>e.value);var E=$e();let P;var A=_(E);{var b=i=>{var h=Xe(),C=_(h,!0);g(h),I(()=>O(C,r())),f(i,h)};T(A,i=>{r()&&i(b)})}var m=s(A,2);let N;var c=_(m);Te(c),c.__input=[Ze,e,x];let S;g(m),g(E),I((i,h,C)=>{P=Q(E,1,"fieldgroup svelte-o02g58",null,P,i),N=Q(m,1,"field svelte-o02g58",null,N,h),c.disabled=e.readonly,ae(c,"placeholder",n()),ae(c,"rows",l()==="unlimited"?void 0:l()),S=Q(c,1,"svelte-o02g58",null,S,C)},[()=>({expanded:l()==="unlimited"}),()=>({expanded:l()==="unlimited"}),()=>({expanded:l()==="unlimited"})]),Ee(c,()=>a(x),i=>B(x,i)),f(u,E),L()}K(["input"]);var et=y('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),tt=y("<!> <!>",1);function at(u,e){M(e,!0);let t=D(e,"character",7);var r=tt(),n=le(r);{var l=E=>{F(E,{children:(P,A)=>{var b=et(),m=_(b);g(b),I(()=>{ae(m,"src",t().img),ae(m,"alt",t().name)}),f(P,b)},$$slots:{default:!0}})};T(n,E=>{t().img&&E(l)})}var x=s(n,2);F(x,{children:(E,P)=>{ye(E,{label:"Historia",get value(){return t().story},get readonly(){return e.readonly},onChange:A=>{t().story=A,e.onChange(t())}})},$$slots:{default:!0}}),f(u,r),L()}var rt=y('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),nt=y('<div class="all-cards svelte-o497rd"><!> <!></div>'),lt=y('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div>');function ot(u,e){M(e,!0);const t=()=>Se(E,"$cardsStore",r),[r,n]=Ae();let l=D(e,"character",7),{loadCards:x,cards:E}=Oe(),{rollExpression:P}=Pe(),A=U(t);He(async()=>{await x()});const b=o=>{l().cards=o,e.onChange(l())},m=o=>{B(A,o)},N=async o=>{const d=l().cards.find(w=>w.id===o),v=a(A).find(w=>w.id===o);d&&v&&d.uses!==null&&v&&await P({expression:"1d6",variables:{},title:`${l().name}: Recarga de carta ${v.name}`,resultFormatter:R=>`<span class="total ${R>=(v.uses?.qty??0)?"success":"failure"}">${R}</span>`})>=(v.uses?.qty??0)&&(d.uses+=1,b([...l().cards]))};var c=lt(),S=_(c);{var i=o=>{F(o,{children:(d,v)=>{p(d,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return l().maxActiveCards},get readonly(){return e.readonly},fullWidth:!0,onChange:w=>{l().maxActiveCards=Number(w),e.onChange(l())}})},$$slots:{default:!0}})};T(S,o=>{e.readonly||o(i)})}var h=s(S,2);F(h,{get title(){return`Cartas Activas (${l().numActiveCards??""}/${l().maxActiveCards??""})`},children:(o,d)=>{{let v=U(()=>t().filter(w=>l().cards.some(R=>R.isActive&&R.id===w.id)));ge(o,{get cards(){return a(v)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"active",onChange:b,onCardReloadClick:N})}},$$slots:{default:!0}});var C=s(h,2);F(C,{title:"Colección",children:(o,d)=>{{let v=U(()=>t().filter(w=>l().cards.some(R=>R.id===w.id)));ge(o,{get cards(){return a(v)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"collection",onChange:b})}},$$slots:{default:!0}});var k=s(C,2);F(k,{title:"Todas las Cartas",children:(o,d)=>{var v=nt(),w=_(v);We(w,{get cards(){return t()},onFilter:m});var R=s(w,2);{var j=Y=>{{let z=U(()=>a(A).filter(q=>l().cards.find(W=>W.id===q.id)===void 0));ge(Y,{get cards(){return a(z)},get readonly(){return e.readonly},get characterCards(){return l().cards},listMode:"all",onChange:b})}},$=Y=>{var z=rt();f(Y,z)};T(R,Y=>{a(A).length>0?Y(j):Y($,!1)})}g(v),f(o,v)},$$slots:{default:!0}}),g(c),f(u,c),L(),n()}const st=(u,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};r().goldHistory.unshift(x),n.onChange(r()),l()},it=(u,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};r().goldHistory.unshift(x),n.onChange(r()),l()};var dt=y('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),ct=y('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Razón</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),vt=(u,e,t)=>e(a(t)),ut=y('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acción">↶</button></div>'),gt=y('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),ht=y('<div class="history svelte-ssntdk"></div>'),bt=y("<!> <!> <!>",1);function _t(u,e){M(e,!0);const t="Sin razón especifica";let r=D(e,"character",7),n=fe({quantity:1,reason:""});const l=()=>{n.quantity=1,n.reason=""},x=N=>{r().goldHistory=r().goldHistory.filter(c=>c.id!==N.id),e.onChange(r())};var E=bt(),P=le(E);F(P,{title:"Estado Actual",children:(N,c)=>{var S=dt(),i=_(S),h=s(_(i),2);let C;var k=_(h,!0);g(h),g(i);var o=s(i,2),d=s(_(o),2),v=_(d,!0);g(d),g(o),g(S),I(w=>{C=Q(h,1,"number svelte-ssntdk",null,C,w),O(k,r().currentGold),O(v,r().spentGold)},[()=>({negative:r().currentGold<0})]),f(N,S)},$$slots:{default:!0}});var A=s(P,2);{var b=N=>{F(N,{title:"Actualizar Oro",children:(c,S)=>{var i=ct(),h=s(_(i),2),C=_(h);p(C,{get value(){return n.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{n.quantity=Number(v)}});var k=s(C,2);p(k,{get value(){return n.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{n.reason=v.toString()}});var o=s(k,2);o.__click=[it,n,t,r,e,l];var d=s(o,2);d.__click=[st,n,t,r,e,l],g(h),g(i),f(c,i)},$$slots:{default:!0}})};T(A,N=>{e.readonly||N(b)})}var m=s(A,2);F(m,{title:"Historial",children:(N,c)=>{var S=ht();Z(S,21,()=>r().goldHistory,i=>i.id,(i,h)=>{var C=ut(),k=_(C);let o;var d=_(k);g(k);var v=s(k,2),w=_(v,!0);g(v);var R=s(v,2);R.__click=[vt,x,h],g(C),I(j=>{o=Q(k,1,"log-amount svelte-ssntdk",null,o,j),O(d,`${a(h).type==="add"?"+":"-"}${a(h).value??""} Oro`),O(w,a(h).reason)},[()=>({positive:a(h).type==="add",negative:a(h).type==="subtract"})]),f(i,C)},i=>{var h=gt();f(i,h)}),g(S),f(N,S)},$$slots:{default:!0}}),f(u,E),L()}K(["click"]);const mt=(u,e,t)=>{e([...e(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),t.onChange(e())};var ft=y('<button title="Agregar Ataque">➕</button>'),yt=(u,e,t)=>e(a(t)),Ct=y('<button title="Eliminar" class="svelte-1v2w3y3">🗑️</button>'),xt=y('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),kt=y('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Daño</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function wt(u,e){M(e,!0);let t=D(e,"attacks",7);const r=b=>{t(t().filter(m=>m.id!==b.id)),e.onChange(t())};var n=kt(),l=_(n),x=s(_(l),2);{var E=b=>{var m=ft();m.__click=[mt,t,e],f(b,m)};T(x,b=>{e.readonly||b(E)})}g(l);var P=s(l,2),A=s(_(P),2);Z(A,17,t,b=>b.id,(b,m,N)=>{var c=xt(),S=_(c);p(S,{get value(){return a(m).name},get readonly(){return e.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{a(m).name=d.toString(),e.onChange(t())}});var i=s(S,2);{let d=U(()=>({icon:"🎯",title:"Tirar Ataque",onClick:()=>e.onAttackRoll(a(m)),disabled:!a(m).atkFormula}));p(i,{get value(){return a(m).atkFormula},get readonly(){return e.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:v=>{a(m).atkFormula=v.toString(),e.onChange(t())},get button(){return a(d)}})}var h=s(i,2);{let d=U(()=>({icon:"💥",title:"Tirar Daño",onClick:()=>e.onDamageRoll(a(m)),disabled:!a(m).dmgFormula}));p(h,{get value(){return a(m).dmgFormula},get readonly(){return e.readonly},placeholder:"1d4",fullWidth:!0,onChange:v=>{a(m).dmgFormula=v.toString(),e.onChange(t())},get button(){return a(d)}})}var C=s(h,2);p(C,{get value(){return a(m).notes},get readonly(){return e.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{a(m).notes=d.toString(),e.onChange(t())}});var k=s(C,2);{var o=d=>{var v=Ct();v.__click=[yt,r,m],f(d,v)};T(k,d=>{e.readonly||d(o)})}g(c),f(b,c)}),g(P),g(n),f(u,n),L()}K(["click"]);function se(u,e){M(e,!0);{let t=U(()=>({icon:"🎲",onClick:e.onDiceRoll,title:"Tirar"}));p(u,{get label(){return e.name},get value(){return e.value},get readonly(){return e.readonly},onChange:r=>e.onChange(Number(r)),get button(){return a(t)}})}L()}const Pt=(u,e,t)=>{e([...e(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),t.onChange(e())};var St=y('<button title="Agregar Item">➕</button>'),At=(u,e,t)=>e(a(t)),Et=y('<button title="Eliminar">🗑️</button>'),Nt=y('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),Rt=y('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="name svelte-1ewnrao">Nombre</label> <label class="quantity svelte-1ewnrao">Cantidad</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function zt(u,e){M(e,!0);let t=D(e,"equipment",7);const r=b=>{t(t().filter(m=>m.id!==b.id)),e.onChange(t())};var n=Rt(),l=_(n),x=s(_(l),2);{var E=b=>{var m=St();m.__click=[Pt,t,e],f(b,m)};T(x,b=>{e.readonly||b(E)})}g(l);var P=s(l,2),A=s(_(P),2);Z(A,17,t,b=>b.id,(b,m,N)=>{var c=Nt(),S=_(c);p(S,{get value(){return a(m).quantity},get readonly(){return e.readonly},onChange:o=>{a(m).quantity=Number(o),e.onChange(t())}});var i=s(S,2);p(i,{get value(){return a(m).name},get readonly(){return e.readonly},placeholder:"Nombre",onChange:o=>{a(m).name=o.toString(),e.onChange(t())}});var h=s(i,2);p(h,{get value(){return a(m).notes},get readonly(){return e.readonly},placeholder:"Notas",fullWidth:!0,onChange:o=>{a(m).notes=o.toString(),e.onChange(t())}});var C=s(h,2);{var k=o=>{var d=Et();d.__click=[At,r,m],f(o,d)};T(C,o=>{e.readonly||o(k)})}g(c),f(b,c)}),g(P),g(n),f(u,n),L()}K(["click"]);var pt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),qt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Dt=y('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),Ft=y('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),Tt=y('<div class="empty svelte-ox7hjw"><em>El equipo esta vacío.</em></div>'),It=y('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Ut=y("<!> <!> <!> <!>",1);function Mt(u,e){M(e,!0);let t=D(e,"character",7),{rollExpression:r,rollModal:n}=Pe();const l=c=>{n.openRollModal({expression:`1d6e+${c}`,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence,iniciativa:t().initiative},title:`${t().name}: ${je(c)}`})},x=c=>{n.openRollModal({expression:c.atkFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Ataque con ${c.name}`})},E=c=>{r({expression:c.dmgFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Daño de ${c.name}`})};var P=Ut(),A=le(P);F(A,{title:"Atributos Principales",children:(c,S)=>{var i=pt(),h=_(i);se(h,{name:"Cuerpo",get value(){return t().attributes.body},get readonly(){return e.readonly},onDiceRoll:()=>l("cuerpo"),onChange:w=>{t().attributes.body=w,e.onChange(t())}});var C=s(h,2);se(C,{name:"Reflejos",get value(){return t().attributes.reflexes},get readonly(){return e.readonly},onDiceRoll:()=>l("reflejos"),onChange:w=>{t().attributes.reflexes=w,e.onChange(t())}});var k=s(C,2);se(k,{name:"Mente",get value(){return t().attributes.mind},get readonly(){return e.readonly},onDiceRoll:()=>l("mente"),onChange:w=>{t().attributes.mind=w,e.onChange(t())}});var o=s(k,2);se(o,{name:"Instinto",get value(){return t().attributes.instinct},get readonly(){return e.readonly},onDiceRoll:()=>l("instinto"),onChange:w=>{t().attributes.instinct=w,e.onChange(t())}});var d=s(o,2);se(d,{name:"Presencia",get value(){return t().attributes.presence},get readonly(){return e.readonly},onDiceRoll:()=>l("presencia"),onChange:w=>{t().attributes.presence=w,e.onChange(t())}});var v=s(d,2);p(v,{label:"Suerte",get value(){return t().currentLuck},get max(){return t().maxLuck},get readonly(){return e.readonly},onChange:w=>{t().currentLuck=Number(w),e.onChange(t())}}),g(i),f(c,i)},$$slots:{default:!0}});var b=s(A,2);F(b,{title:"Atributos Derivados",children:(c,S)=>{var i=qt(),h=_(i);p(h,{label:"Salud",get value(){return t().currentHP},get max(){return t().maxHP},get readonly(){return e.readonly},onChange:R=>{t().currentHP=Number(R),e.onChange(t())}});var C=s(h,2);p(C,{label:"Salud Temporal",get value(){return t().tempHP},get readonly(){return e.readonly},onChange:R=>{t().tempHP=Number(R),e.onChange(t())}});var k=s(C,2);p(k,{label:"Velocidad",get value(){return t().speed},readonly:!0});var o=s(k,2);p(o,{label:"Esquiva",get value(){return t().evasion},readonly:!0});var d=s(o,2);p(d,{label:"Mitigación Física",get value(){return t().physicalMitigation},readonly:!0});var v=s(d,2);p(v,{label:"Mitigación Mágica",get value(){return t().magicalMitigation},readonly:!0});var w=s(v,2);p(w,{label:"Iniciativa",get value(){return t().initiative},readonly:!0,button:{icon:"🎲",title:"Tirar iniciativa",onClick:()=>l("iniciativa")}}),g(i),f(c,i)},$$slots:{default:!0}});var m=s(b,2);F(m,{title:"Información",children:(c,S)=>{var i=Ft(),h=_(i);wt(h,{get attacks(){return t().attacks},get readonly(){return e.readonly},onChange:v=>{t().attacks=v,e.onChange(t())},onAttackRoll:x,onDamageRoll:E});var C=s(h,2);{var k=v=>{var w=Dt();f(v,w)};T(C,v=>{t().attacks.length===0&&v(k)})}var o=s(C,2);ye(o,{label:"Información Rápida",get value(){return t().quickInfo},get readonly(){return e.readonly},placeholder:"Información general, habilidades, etc.",onChange:v=>{t().quickInfo=v,e.onChange(t())}});var d=s(o,2);p(d,{label:"Lenguas",get value(){return t().languages},get readonly(){return e.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:v=>{t().languages=v,e.onChange(t())}}),g(i),f(c,i)},$$slots:{default:!0}});var N=s(m,2);F(N,{title:"Equipo",children:(c,S)=>{var i=It(),h=_(i);p(h,{label:"Oro",get value(){return t().currentGold},readonly:!0,fullWidth:!0});var C=s(h,2);zt(C,{get equipment(){return t().equipment},get readonly(){return e.readonly},onChange:d=>{t().equipment=d,e.onChange(t())}});var k=s(C,2);{var o=d=>{var v=Tt();f(d,v)};T(k,d=>{t().equipment.length===0&&d(o)})}g(i),f(c,i)},$$slots:{default:!0}}),f(u,P),L()}const Lt=(u,e,t,r)=>{const n={id:crypto.randomUUID(),title:"Nota Nueva",content:""};B(e,[...a(e),n],!0),t.onChange(a(e)),r(n)};var Ot=(u,e,t)=>e(a(t)),Wt=y('<div class="header svelte-z1ulbz"><button title="Agregar Nota">➕</button> <button title="Eliminar Nota">🗑️</button></div>'),Ht=(u,e,t)=>e(a(t)),jt=y('<button><span class="svelte-z1ulbz"> </span></button>'),Gt=y('<div class="notes svelte-z1ulbz"></div>'),Jt=y('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Vt=y('<div class="note svelte-z1ulbz"><!> <!></div>'),Bt=y('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Kt=y('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Yt(u,e){M(e,!0);let t=xe(fe(e.notes)),r=xe(void 0),n=U(()=>a(t).find(o=>o.id===a(r)));const l=o=>{B(r,o.id,!0)},x=o=>{o&&(B(t,a(t).filter(d=>d.id!==o),!0),B(r,void 0),e.onChange(a(t)))},E=()=>{B(t,[...a(t)],!0),e.onChange(a(t))};var P=Kt(),A=_(P),b=_(A);{var m=o=>{var d=Wt(),v=_(d);v.__click=[Lt,t,e,l];var w=s(v,2);w.__click=[Ot,x,r],g(d),I(()=>w.disabled=!a(n)),f(o,d)};T(b,o=>{e.readonly||o(m)})}var N=s(b,2);{var c=o=>{var d=Gt();Z(d,21,()=>a(t),v=>v.id,(v,w)=>{var R=jt();let j;R.__click=[Ht,l,w];var $=_(R),Y=_($,!0);g($),g(R),I(z=>{j=Q(R,1,"note-btn svelte-z1ulbz",null,j,z),O(Y,a(w).title||"Nota sin título")},[()=>({selected:a(r)===a(w).id})]),f(v,R)}),g(d),f(o,d)},S=o=>{var d=Jt();f(o,d)};T(N,o=>{a(t).length>0?o(c):o(S,!1)})}g(A);var i=s(A,2),h=_(i);{var C=o=>{var d=Vt(),v=_(d);Re(v,{get value(){return a(n).title},get readonly(){return e.readonly},placeholder:"Título de la nota",onChange:R=>{a(n).title=R,E()}});var w=s(v,2);ye(w,{get value(){return a(n).content},get readonly(){return e.readonly},placeholder:"Contenido de la nota",onChange:R=>{a(n).content=R,E()},maxRows:"unlimited"}),g(d),f(o,d)},k=o=>{var d=Bt();f(o,d)};T(h,o=>{a(n)?o(C):o(k,!1)})}g(i),g(P),f(u,P),L()}K(["click"]);function Qt(u,e){M(e,!0);let t=D(e,"character",7);F(u,{title:"Notas",children:(r,n)=>{Yt(r,{get notes(){return t().notes},get readonly(){return e.readonly},onChange:l=>{t().notes=l,e.onChange(t())}})},$$slots:{default:!0}}),L()}const Xt=(u,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};r().ppHistory.unshift(x),n.onChange(r()),l()},Zt=(u,e,t,r,n,l)=>{const x={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};r().ppHistory.unshift(x),n.onChange(r()),l()};var $t=y('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Poder de PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),ea=y('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Razón</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),ta=(u,e,t)=>e(a(t)),aa=y('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acción">↶</button></div>'),ra=y('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),na=y('<div class="history svelte-1cdo061"></div>'),la=y("<!> <!> <!>",1);function oa(u,e){M(e,!0);const t="Sin razón especifica";let r=D(e,"character",7),n=fe({quantity:1,reason:""});const l=()=>{n.quantity=1,n.reason=""},x=N=>{r().ppHistory=r().ppHistory.filter(c=>c.id!==N.id),e.onChange(r())};var E=la(),P=le(E);F(P,{title:"Estado Actual",children:(N,c)=>{var S=$t(),i=_(S),h=s(_(i),2);let C;var k=_(h,!0);g(h),g(i);var o=s(i,2),d=s(_(o),2),v=_(d,!0);g(d),g(o);var w=s(o,2),R=s(_(w),2),j=_(R,!0);g(R),g(w),g(S),I($=>{C=Q(h,1,"number svelte-1cdo061",null,C,$),O(k,r().currentPP),O(v,r().spentPP),O(j,r().pjPower)},[()=>({negative:r().currentPP<0})]),f(N,S)},$$slots:{default:!0}});var A=s(P,2);{var b=N=>{F(N,{title:"Actualizar Progreso",children:(c,S)=>{var i=ea(),h=s(_(i),2),C=_(h);p(C,{get value(){return n.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{n.quantity=Number(v)}});var k=s(C,2);p(k,{get value(){return n.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{n.reason=v.toString()}});var o=s(k,2);o.__click=[Zt,n,t,r,e,l];var d=s(o,2);d.__click=[Xt,n,t,r,e,l],g(h),g(i),f(c,i)},$$slots:{default:!0}})};T(A,N=>{e.readonly||N(b)})}var m=s(A,2);F(m,{title:"Historial",children:(N,c)=>{var S=na();Z(S,21,()=>r().ppHistory,i=>i.id,(i,h)=>{var C=aa(),k=_(C);let o;var d=_(k);g(k);var v=s(k,2),w=_(v,!0);g(v);var R=s(v,2);R.__click=[ta,x,h],g(C),I(j=>{o=Q(k,1,"log-amount svelte-1cdo061",null,o,j),O(d,`${a(h).type==="add"?"+":"-"}${a(h).value??""} PP`),O(w,a(h).reason)},[()=>({positive:a(h).type==="add",negative:a(h).type==="subtract"})]),f(i,C)},i=>{var h=ra();f(i,h)}),g(S),f(N,S)},$$slots:{default:!0}}),f(u,E),L()}K(["click"]);var sa=(u,e,t)=>e()(a(t)),ia=y("<option> </option>"),da=y('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function we(u,e){M(e,!0);let t=D(e,"onChange",3,()=>{}),r=U(()=>e.value);var n=da(),l=_(n);l.__change=[sa,t,r],Z(l,21,()=>e.options,x=>x.label,(x,E)=>{var P=ia(),A=_(P,!0);g(P);var b={};I(()=>{O(A,a(E).label),b!==(b=a(E).value)&&(P.value=(P.__value=a(E).value)??"")}),f(x,P)}),g(l),g(n),Ge(l,()=>a(r),x=>B(r,x)),f(u,n),L()}K(["change"]);const ca=(u,e,t)=>{e([...e(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),t.onChange(e())};var va=(u,e,t)=>e(a(t)),ua=y('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">🗑️</button></div>'),ga=y('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),ha=y('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">➕</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Razón</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function ba(u,e){M(e,!0);let t=D(e,"modifiers",7);const r=A=>{t(t().filter(b=>b.id!==A.id)),e.onChange(t())};var n=ha(),l=_(n),x=s(_(l),2);x.__click=[ca,t,e],g(l);var E=s(l,2),P=s(_(E),2);Z(P,17,t,A=>A.id,(A,b,m)=>{var N=ua(),c=_(N);we(c,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return a(b).type},onChange:k=>{a(b).type=k.toString(),e.onChange(t())}});var S=s(c,2);we(S,{options:[{label:"Salud Máxima",value:"maxHP"},{label:"Suerte Máxima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigación Física",value:"physicalMitigation"},{label:"Mitigación Mágica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return a(b).attribute},onChange:k=>{a(b).attribute=k.toString(),e.onChange(t())}});var i=s(S,2);p(i,{get value(){return a(b).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:k=>{a(b).formula=k.toString(),e.onChange(t())}});var h=s(i,2);p(h,{get value(){return a(b).formula},placeholder:"Razón",fullWidth:!0,onChange:k=>{a(b).reason=k.toString(),e.onChange(t())}});var C=s(h,2);C.__click=[va,r,b],g(N),f(A,N)},A=>{var b=ga();f(A,b)}),g(E),g(n),f(u,n),L()}K(["click"]);var _a=y('<div class="general svelte-1hn03u3"><!></div>'),ma=y('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),fa=y("<!> <!>",1);function ya(u,e){M(e,!0);let t=D(e,"character",7);var r=fa(),n=le(r);F(n,{title:"General",children:(x,E)=>{var P=_a(),A=_(P);{let b=U(()=>t().img??"");p(A,{label:"URL del Retrato",get value(){return a(b)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:m=>{const N=m.toString();N.length>0?t().img=N:t().img=null,e.onChange(t())}})}g(P),f(x,P)},$$slots:{default:!0}});var l=s(n,2);F(l,{title:"Modificadores",children:(x,E)=>{var P=ma(),A=_(P);ba(A,{get modifiers(){return t().modifiers},onChange:b=>{t().modifiers=b,e.onChange(t())}}),Ie(2),g(P),f(x,P)},$$slots:{default:!0}}),f(u,r),L()}var Ca=y("<button> </button>"),xa=y('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function ka(u,e){M(e,!0);let t=D(e,"character",7);const r=[{name:"general",title:"General",component:Mt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:ot,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:at,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Qt,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:oa,availableWhenReadOnly:!0},{name:"economy",title:"Economía",component:_t,availableWhenReadOnly:!0},{name:"settings",title:"Configuración",component:ya,availableWhenReadOnly:!1}];let n=U(()=>Math.max(r.findIndex(c=>c.name===e.currentTab),0)),l=U(()=>r.find(c=>c.name===e.currentTab)??r[0]);const x=c=>{const S=c.copy();e.onChange(S),t(S)},E=c=>{B(n,c),e.onTabChange(r[c].name)};var P=xa(),A=_(P),b=_(A);Re(b,{get value(){return t().name},get readonly(){return e.readonly},onChange:c=>{t().name=c,x(t())}}),g(A);var m=s(A,2);Z(m,23,()=>r,c=>c.title,(c,S,i)=>{var h=Ue(),C=le(h);{var k=o=>{var d=Ca();let v;d.__click=()=>E(a(i));var w=_(d,!0);g(d),I(R=>{v=Q(d,1,"tab",null,v,R),O(w,a(S).title)},[()=>({selected:a(n)===a(i)})]),f(o,d)};T(C,o=>{(a(S).availableWhenReadOnly||!e.readonly)&&o(k)})}f(c,h)}),g(m);var N=s(m,2);Le(N,()=>a(l).component,(c,S)=>{S(c,{get character(){return t()},get readonly(){return e.readonly},onChange:x})}),g(P),f(u,P),L()}K(["click"]);const wa=async(u,e,t)=>{const r=await e()();t(r)},Pa=async(u,e,t)=>{const r=await e()();t(r)},Sa=async(u,e,t)=>{a(e)&&await t()(a(e))},Aa=async(u,e,t,r)=>{!a(e)||!confirm(`¿Quieres eliminar a ${a(e).name}?`)||(await t()(a(e)),B(e,void 0),r(null))},Ea=async(u,e,t)=>{a(e)&&await t()(a(e))};var Na=y('<button title="Importar y Editar">📝</button>'),Ra=y('<button title="Crear">➕</button> <button title="Importar">📥</button> <button title="Exportar">📤</button> <button title="Eliminar">🗑️</button>',1),za=(u,e,t)=>e(a(t)),pa=y('<img class="character-image svelte-dk16f3"/>'),qa=y('<span class="image-placeholder svelte-dk16f3"> </span>'),Da=y('<button><!> <span class="name svelte-dk16f3"> </span></button>'),Fa=y('<section class="characters-page svelte-dk16f3"><div class="list svelte-dk16f3"><div class="header svelte-dk16f3"><!></div> <div class="content svelte-dk16f3"></div></div> <div class="viewport svelte-dk16f3"><!></div></section>');function $a(u,e){M(e,!0);const t=()=>Se(e.characters,"$characters",r),[r,n]=Ae(),l="general";let x=D(e,"onAddToMyCharacters",3,()=>{throw new Error("onAddToMyCharacters not implemented")}),E=D(e,"onCreateCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),P=D(e,"onImportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),A=D(e,"onExportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),b=D(e,"onDeleteCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),m=U(()=>X.url.searchParams.get("characterId")),N=U(()=>X.url.searchParams.get("tab")??l);const c=z=>{z!==null?(X.url.searchParams.set("characterId",z.id),X.url.searchParams.set("tab",l)):(X.url.searchParams.delete("characterId"),X.url.searchParams.delete("tab")),ke(`?${X.url.searchParams.toString()}`)},S=z=>{X.url.searchParams.set("tab",z),ke(`?${X.url.searchParams.toString()}`)};let i=U(()=>t().find(z=>z.id===a(m)));const h=z=>{e.characters.update(q=>{const W=q.findIndex(G=>G.id===z.id);if(W!==-1){const G=[...q];return G[W]=z,G}return q})};var C=Fa(),k=_(C),o=_(k),d=_(o);{var v=z=>{var q=Na();q.__click=[Ea,i,x],I(()=>q.disabled=e.allActionsDisabled||!a(i)),f(z,q)},w=z=>{var q=Ra(),W=le(q);W.__click=[wa,E,c];var G=s(W,2);G.__click=[Pa,P,c];var oe=s(G,2);oe.__click=[Sa,i,A];var de=s(oe,2);de.__click=[Aa,i,b,c],I(()=>{W.disabled=e.allActionsDisabled,G.disabled=e.allActionsDisabled,oe.disabled=e.allActionsDisabled||!a(i),de.disabled=e.allActionsDisabled||!a(i)}),f(z,q)};T(d,z=>{e.readonly?z(v):z(w,!1)})}g(o);var R=s(o,2);Z(R,5,t,z=>z.id,(z,q)=>{var W=Da();let G;W.__click=[za,c,q];var oe=_(W);{var de=ee=>{var re=pa();I(()=>{ae(re,"src",a(q).img),ae(re,"alt",a(q).name)}),f(ee,re)},ze=ee=>{var re=qa(),qe=_(re,!0);g(re),I(De=>O(qe,De),[()=>a(q).name.charAt(0).toUpperCase()]),f(ee,re)};T(oe,ee=>{a(q).img?ee(de):ee(ze,!1)})}var ue=s(oe,2),pe=_(ue,!0);g(ue),g(W),I(ee=>{G=Q(W,1,"character-item svelte-dk16f3",null,G,ee),ae(ue,"title",a(q).name),O(pe,a(q).name)},[()=>({selected:a(m)===a(q).id})]),f(z,W)}),g(R),g(k);var j=s(k,2),$=_(j);{var Y=z=>{ka(z,{get character(){return a(i)},get readonly(){return e.readonly},onChange:h,get currentTab(){return a(N)},onTabChange:S})};T($,z=>{a(i)&&z(Y)})}g(j),g(C),f(u,C),L(),n()}K(["click"]);export{$a as C,Za as u};
