import{r as we}from"./CCtmJEK4.js";import{C as re,r as Se,s as $,e as X}from"./DoQYgQHR.js";import{w as ve}from"./C2b8wWAA.js";import"./DsnmJJEf.js";import{aa as G,p as F,f as y,ab as L,t as D,O as U,H as r,b as f,c as p,d as m,s,aX as Ee,r as u,e as j,a as te,o as Ne,N as de,aG as ue,aQ as Me,aN as Re}from"./Kn-3yCMi.js";import{i as T,a as be,s as me}from"./XhFqZ_PR.js";import{b as _e,s as J}from"./WpMs7pcV.js";import{p as H}from"./C2rRscMh.js";import{g as ge}from"./D9NnwYvQ.js";import{p as K}from"./BO6xIS95.js";import{c as qe}from"./DLr_xJsT.js";import{b as I,u as ze,a as ie,C as He,I as q}from"./CIhHzso7.js";import{u as fe}from"./BD8Gg-N5.js";import{c as Ie}from"./CjlGQt4x.js";import{b as Te}from"./G309qHfw.js";const De=(h,e)=>{if(!h)return 0;const t=h.trim();try{const a=new Function("cuerpo","reflejos","mente","instinto","presencia","Math",`return (${t});`);return Number(a(Number(e.cuerpo)||0,Number(e.reflejos)||0,Number(e.mente)||0,Number(e.instinto)||0,Number(e.presencia)||0,Math))||0}catch(a){return console.error("Error evaluating modifier expression:",a),0}},Le=(h,e)=>De(h,{cuerpo:e.attributes.body,reflejos:e.attributes.reflexes,mente:e.attributes.mind,instinto:e.attributes.instinct,presencia:e.attributes.presence,Math});class oe{id;name;attributes;cards;ppHistory;goldHistory;equipment;modifiers;currentHP;tempHP;currentLuck;img;story;notes;languages;quickInfo;attacks;maxActiveCards;version;constructor(e){this.id=e.id,this.name=e.name,this.attributes=e.attributes,this.cards=e.cards,this.ppHistory=e.ppHistory,this.goldHistory=e.goldHistory,this.equipment=e.equipment,this.modifiers=e.modifiers,this.currentHP=e.currentHP,this.tempHP=e.tempHP,this.currentLuck=e.currentLuck,this.img=e.img,this.story=e.story,this.notes=e.notes,this.languages=e.languages,this.quickInfo=e.quickInfo,this.attacks=e.attacks,this.maxActiveCards=e.maxActiveCards,this.version=e.version}calculateAttrModifiers(e,t){let a=t;const l=this.modifiers.filter(o=>o.attribute===e);for(const o of l){const w=Le(o.formula,this);if(o.type==="set")return w;o.type==="add"&&(a+=w)}return a}get maxLuck(){const e=re.MAX_LUCK;return this.calculateAttrModifiers("maxLuck",e)}get maxHP(){const e=re.BASE_HEALTH+this.attributes.body*re.HEALTH_BODY_MULTIPIER;return this.calculateAttrModifiers("maxHP",e)}get speed(){const e=re.BASE_SPEED+this.attributes.reflexes;return this.calculateAttrModifiers("speed",e)}get evasion(){const e=re.BASE_EVASION+this.attributes.reflexes;return this.calculateAttrModifiers("evasion",e)}get physicalMitigation(){return this.calculateAttrModifiers("physicalMitigation",0)}get magicalMitigation(){return this.calculateAttrModifiers("magicalMitigation",0)}get currentGold(){const e=this.goldHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentGold;return t>0?e-t:e}get spentGold(){return this.goldHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get currentPP(){const e=this.ppHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentPP;return t>0?e-t:e}get spentPP(){return this.ppHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get pjPower(){const e=this.cards.reduce((a,l)=>Math.max(a,l.level),0),t=this.spentPP/re.PJ_POWER_SPENT_PP_DIVIDER;return Math.round(e+t)}get numActiveCards(){return this.cards.filter(e=>e.isActive).length}get initiative(){return this.attributes.reflexes}copy(){return new oe({...this})}}const ye="arcana:characters",Q={charactersStore:ve([]),exampleCharactersStore:ve([]),charactersAlreadyLoaded:!1,exampleCharactersAlreadyLoaded:!1},Fe=()=>{Q.charactersStore.subscribe(h=>{const e=JSON.stringify(h);localStorage.setItem(ye,e)})},ja=()=>({loadCharacters:async()=>{if(Q.charactersAlreadyLoaded)return;const t=localStorage.getItem(ye);if(t)try{const a=JSON.parse(t);Q.charactersStore.set(a.map(l=>new oe(l)))}catch(a){console.error("Error parsing characters JSON:",a)}Fe(),Q.charactersAlreadyLoaded=!0},loadExampleCharacters:async()=>{if(Q.exampleCharactersAlreadyLoaded)return;let t=[];try{t=await(await fetch(we("/docs/example-characters.json"))).json()}catch(a){console.error("Error fetching example characters:",a)}try{Q.exampleCharactersStore.set(t.map(a=>new oe(a)))}catch(a){console.error("Error parsing example characters JSON:",a)}Q.exampleCharactersAlreadyLoaded=!0},characters:Q.charactersStore,exampleCharacters:Q.exampleCharactersStore});var pe=(h,e,t)=>e.onChange(r(t)),je=y('<input type="text" class="svelte-19nbfo1"/>');function Ce(h,e){F(e,!0);let t=H(e,"placeholder",3,void 0),a=L(()=>e.value);var l=je();Se(l),l.__input=[pe,e,a],D(()=>{$(l,"placeholder",t()),l.disabled=e.readonly}),_e(l,()=>r(a),o=>U(a,o)),f(h,l),p()}G(["input"]);var Oe=y("<label> </label>"),We=(h,e,t)=>e.onChange(r(t)),Ue=y("<div><!> <div><textarea></textarea></div></div>");function ce(h,e){F(e,!0);const t=6;let a=H(e,"label",3,void 0),l=H(e,"placeholder",3,""),o=H(e,"maxRows",3,t),w=L(()=>e.value);var N=Ue();let P;var S=m(N);{var b=i=>{var g=Oe(),C=m(g,!0);u(g),D(()=>j(C,a())),f(i,g)};T(S,i=>{a()&&i(b)})}var _=s(S,2);let E;var c=m(_);Ee(c),c.__input=[We,e,w];let A;u(_),u(N),D((i,g,C)=>{P=J(N,1,"fieldgroup svelte-o02g58",null,P,i),E=J(_,1,"field svelte-o02g58",null,E,g),c.disabled=e.readonly,$(c,"placeholder",l()),$(c,"rows",o()==="unlimited"?void 0:o()),A=J(c,1,"svelte-o02g58",null,A,C)},[()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"})]),_e(c,()=>r(w),i=>U(w,i)),f(h,N),p()}G(["input"]);var Ge=y('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),Ve=y("<!> <!>",1);function Be(h,e){F(e,!0);let t=H(e,"character",7);var a=Ve(),l=te(a);{var o=N=>{I(N,{children:(P,S)=>{var b=Ge(),_=m(b);u(b),D(()=>{$(_,"src",t().img),$(_,"alt",t().name)}),f(P,b)},$$slots:{default:!0}})};T(l,N=>{t().img&&N(o)})}var w=s(l,2);I(w,{children:(N,P)=>{ce(N,{label:"Historia",get value(){return t().story},get readonly(){return e.readonly},onChange:S=>{t().story=S,e.onChange(t())}})},$$slots:{default:!0}}),f(h,a),p()}var Je=y('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),Ke=y('<div class="all-cards svelte-o497rd"><!> <!></div>'),Qe=y('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div>');function Xe(h,e){F(e,!0);const t=()=>be(N,"$cardsStore",a),[a,l]=me();let o=H(e,"character",7),{loadCards:w,cards:N}=ze(),{rollExpression:P}=fe(),S=L(t);Ne(async()=>{await w()});const b=n=>{o().cards=n,e.onChange(o())},_=n=>{U(S,n)},E=async n=>{const d=o().cards.find(k=>k.id===n),v=r(S).find(k=>k.id===n);d&&v&&d.uses!==null&&v&&await P({expression:"1d6",variables:{},title:`${o().name}: Recarga de carta ${v.name}`,resultFormatter:M=>`<span class="total ${M>=(v.uses?.qty??0)?"success":"failure"}">${M}</span>`})>=(v.uses?.qty??0)&&(d.uses+=1,b([...o().cards]))};var c=Qe(),A=m(c);{var i=n=>{I(n,{children:(d,v)=>{q(d,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return o().maxActiveCards},get readonly(){return e.readonly},fullWidth:!0,onChange:k=>{o().maxActiveCards=Number(k),e.onChange(o())}})},$$slots:{default:!0}})};T(A,n=>{e.readonly||n(i)})}var g=s(A,2);I(g,{get title(){return`Cartas Activas (${o().numActiveCards??""}/${o().maxActiveCards??""})`},children:(n,d)=>{{let v=L(()=>t().filter(k=>o().cards.some(M=>M.isActive&&M.id===k.id)));ie(n,{get cards(){return r(v)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"active",onChange:b,onCardReloadClick:E})}},$$slots:{default:!0}});var C=s(g,2);I(C,{title:"Colección",children:(n,d)=>{{let v=L(()=>t().filter(k=>o().cards.some(M=>M.id===k.id)));ie(n,{get cards(){return r(v)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"collection",onChange:b})}},$$slots:{default:!0}});var x=s(C,2);I(x,{title:"Todas las Cartas",children:(n,d)=>{var v=Ke(),k=m(v);He(k,{get cards(){return t()},onFilter:_});var M=s(k,2);{var O=V=>{{let R=L(()=>r(S).filter(z=>o().cards.find(W=>W.id===z.id)===void 0));ie(V,{get cards(){return r(R)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"all",onChange:b})}},Y=V=>{var R=Je();f(V,R)};T(M,V=>{r(S).length>0?V(O):V(Y,!1)})}u(v),f(n,v)},$$slots:{default:!0}}),u(c),f(h,c),p(),l()}const Ye=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()},Ze=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()};var $e=y('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),et=y('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label class="qty svelte-ssntdk">Cantidad</label> <label class="reason svelte-ssntdk">Razón</label> <label class="btn svelte-ssntdk"></label> <label class="btn svelte-ssntdk"></label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro" class="svelte-ssntdk">-</button> <button title="Ganar Oro" class="svelte-ssntdk">+</button></div></div>'),tt=(h,e,t)=>e(r(t)),at=y('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acción">↶</button></div>'),rt=y('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),nt=y('<div class="history svelte-ssntdk"></div>'),lt=y("<!> <!> <!>",1);function ot(h,e){F(e,!0);const t="Sin razón especifica";let a=H(e,"character",7),l=de({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().goldHistory=a().goldHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=lt(),P=te(N);I(P,{title:"Estado Actual",children:(E,c)=>{var A=$e(),i=m(A),g=s(m(i),2);let C;var x=m(g,!0);u(g),u(i);var n=s(i,2),d=s(m(n),2),v=m(d,!0);u(d),u(n),u(A),D(k=>{C=J(g,1,"number svelte-ssntdk",null,C,k),j(x,a().currentGold),j(v,a().spentGold)},[()=>({negative:a().currentGold<0})]),f(E,A)},$$slots:{default:!0}});var S=s(P,2);{var b=E=>{I(E,{title:"Actualizar Oro",children:(c,A)=>{var i=et(),g=s(m(i),2),C=m(g);q(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{l.quantity=Number(v)}});var x=s(C,2);q(x,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{l.reason=v.toString()}});var n=s(x,2);n.__click=[Ze,l,t,a,e,o];var d=s(n,2);d.__click=[Ye,l,t,a,e,o],u(g),u(i),f(c,i)},$$slots:{default:!0}})};T(S,E=>{e.readonly||E(b)})}var _=s(S,2);I(_,{title:"Historial",children:(E,c)=>{var A=nt();X(A,21,()=>a().goldHistory,i=>i.id,(i,g)=>{var C=at(),x=m(C);let n;var d=m(x);u(x);var v=s(x,2),k=m(v,!0);u(v);var M=s(v,2);M.__click=[tt,w,g],u(C),D(O=>{n=J(x,1,"log-amount svelte-ssntdk",null,n,O),j(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} Oro`),j(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=rt();f(i,g)}),u(A),f(E,A)},$$slots:{default:!0}}),f(h,N),p()}G(["click"]);const st=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),t.onChange(e())};var it=y('<button title="Agregar Ataque">➕</button>'),dt=(h,e,t)=>e(r(t)),ct=y('<button title="Eliminar" class="svelte-1v2w3y3">🗑️</button>'),vt=y('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),ut=y('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Daño</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function gt(h,e){F(e,!0);let t=H(e,"attacks",7);const a=b=>{t(t().filter(_=>_.id!==b.id)),e.onChange(t())};var l=ut(),o=m(l),w=s(m(o),2);{var N=b=>{var _=it();_.__click=[st,t,e],f(b,_)};T(w,b=>{e.readonly||b(N)})}u(o);var P=s(o,2),S=s(m(P),2);X(S,17,t,b=>b.id,(b,_,E)=>{var c=vt(),A=m(c);q(A,{get value(){return r(_).name},get readonly(){return e.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{r(_).name=d.toString(),e.onChange(t())}});var i=s(A,2);{let d=L(()=>({icon:"🎯",title:"Tirar Ataque",onClick:()=>e.onAttackRoll(r(_)),disabled:!r(_).atkFormula}));q(i,{get value(){return r(_).atkFormula},get readonly(){return e.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:v=>{r(_).atkFormula=v.toString(),e.onChange(t())},get button(){return r(d)}})}var g=s(i,2);{let d=L(()=>({icon:"💥",title:"Tirar Daño",onClick:()=>e.onDamageRoll(r(_)),disabled:!r(_).dmgFormula}));q(g,{get value(){return r(_).dmgFormula},get readonly(){return e.readonly},placeholder:"1d4",fullWidth:!0,onChange:v=>{r(_).dmgFormula=v.toString(),e.onChange(t())},get button(){return r(d)}})}var C=s(g,2);q(C,{get value(){return r(_).notes},get readonly(){return e.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{r(_).notes=d.toString(),e.onChange(t())}});var x=s(C,2);{var n=d=>{var v=ct();v.__click=[dt,a,_],f(d,v)};T(x,d=>{e.readonly||d(n)})}u(c),f(b,c)}),u(P),u(l),f(h,l),p()}G(["click"]);function ne(h,e){F(e,!0);{let t=L(()=>({icon:"🎲",onClick:e.onDiceRoll,title:"Tirar"}));q(h,{get label(){return e.name},get value(){return e.value},get readonly(){return e.readonly},onChange:a=>e.onChange(Number(a)),get button(){return r(t)}})}p()}const ht=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),t.onChange(e())};var bt=y('<button title="Agregar Item">➕</button>'),mt=(h,e,t)=>e(r(t)),_t=y('<button title="Eliminar">🗑️</button>'),ft=y('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),yt=y('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="name svelte-1ewnrao">Nombre</label> <label class="quantity svelte-1ewnrao">Cantidad</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function Ct(h,e){F(e,!0);let t=H(e,"equipment",7);const a=b=>{t(t().filter(_=>_.id!==b.id)),e.onChange(t())};var l=yt(),o=m(l),w=s(m(o),2);{var N=b=>{var _=bt();_.__click=[ht,t,e],f(b,_)};T(w,b=>{e.readonly||b(N)})}u(o);var P=s(o,2),S=s(m(P),2);X(S,17,t,b=>b.id,(b,_,E)=>{var c=ft(),A=m(c);q(A,{get value(){return r(_).quantity},get readonly(){return e.readonly},onChange:n=>{r(_).quantity=Number(n),e.onChange(t())}});var i=s(A,2);q(i,{get value(){return r(_).name},get readonly(){return e.readonly},placeholder:"Nombre",onChange:n=>{r(_).name=n.toString(),e.onChange(t())}});var g=s(i,2);q(g,{get value(){return r(_).notes},get readonly(){return e.readonly},placeholder:"Notas",fullWidth:!0,onChange:n=>{r(_).notes=n.toString(),e.onChange(t())}});var C=s(g,2);{var x=n=>{var d=_t();d.__click=[mt,a,_],f(n,d)};T(C,n=>{e.readonly||n(x)})}u(c),f(b,c)}),u(P),u(l),f(h,l),p()}G(["click"]);var xt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),kt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!> <!></div>'),Pt=y('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),At=y('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),wt=y('<div class="empty svelte-ox7hjw"><em>El equipo esta vacío.</em></div>'),St=y('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Et=y("<!> <!> <!> <!>",1);function Nt(h,e){F(e,!0);let t=H(e,"character",7),{rollExpression:a,rollModal:l}=fe();const o=c=>{l.openRollModal({expression:`1d6e+${c}`,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence,iniciativa:t().initiative},title:`${t().name}: ${Ie(c)}`})},w=c=>{l.openRollModal({expression:c.atkFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Ataque con ${c.name}`})},N=c=>{a({expression:c.dmgFormula,variables:{cuerpo:t().attributes.body,reflejos:t().attributes.reflexes,mente:t().attributes.mind,instinto:t().attributes.instinct,presencia:t().attributes.presence},title:`${t().name}: Daño de ${c.name}`})};var P=Et(),S=te(P);I(S,{title:"Atributos Principales",children:(c,A)=>{var i=xt(),g=m(i);ne(g,{name:"Cuerpo",get value(){return t().attributes.body},get readonly(){return e.readonly},onDiceRoll:()=>o("cuerpo"),onChange:k=>{t().attributes.body=k,e.onChange(t())}});var C=s(g,2);ne(C,{name:"Reflejos",get value(){return t().attributes.reflexes},get readonly(){return e.readonly},onDiceRoll:()=>o("reflejos"),onChange:k=>{t().attributes.reflexes=k,e.onChange(t())}});var x=s(C,2);ne(x,{name:"Mente",get value(){return t().attributes.mind},get readonly(){return e.readonly},onDiceRoll:()=>o("mente"),onChange:k=>{t().attributes.mind=k,e.onChange(t())}});var n=s(x,2);ne(n,{name:"Instinto",get value(){return t().attributes.instinct},get readonly(){return e.readonly},onDiceRoll:()=>o("instinto"),onChange:k=>{t().attributes.instinct=k,e.onChange(t())}});var d=s(n,2);ne(d,{name:"Presencia",get value(){return t().attributes.presence},get readonly(){return e.readonly},onDiceRoll:()=>o("presencia"),onChange:k=>{t().attributes.presence=k,e.onChange(t())}});var v=s(d,2);q(v,{label:"Suerte",get value(){return t().currentLuck},get max(){return t().maxLuck},get readonly(){return e.readonly},onChange:k=>{t().currentLuck=Number(k),e.onChange(t())}}),u(i),f(c,i)},$$slots:{default:!0}});var b=s(S,2);I(b,{title:"Atributos Derivados",children:(c,A)=>{var i=kt(),g=m(i);q(g,{label:"Salud",get value(){return t().currentHP},get max(){return t().maxHP},get readonly(){return e.readonly},onChange:M=>{t().currentHP=Number(M),e.onChange(t())}});var C=s(g,2);q(C,{label:"Salud Temporal",get value(){return t().tempHP},get readonly(){return e.readonly},onChange:M=>{t().tempHP=Number(M),e.onChange(t())}});var x=s(C,2);q(x,{label:"Velocidad",get value(){return t().speed},readonly:!0});var n=s(x,2);q(n,{label:"Esquiva",get value(){return t().evasion},readonly:!0});var d=s(n,2);q(d,{label:"Mitigación Física",get value(){return t().physicalMitigation},readonly:!0});var v=s(d,2);q(v,{label:"Mitigación Mágica",get value(){return t().magicalMitigation},readonly:!0});var k=s(v,2);q(k,{label:"Iniciativa",get value(){return t().initiative},readonly:!0,button:{icon:"🎲",title:"Tirar iniciativa",onClick:()=>o("iniciativa")}}),u(i),f(c,i)},$$slots:{default:!0}});var _=s(b,2);I(_,{title:"Información",children:(c,A)=>{var i=At(),g=m(i);gt(g,{get attacks(){return t().attacks},get readonly(){return e.readonly},onChange:v=>{t().attacks=v,e.onChange(t())},onAttackRoll:w,onDamageRoll:N});var C=s(g,2);{var x=v=>{var k=Pt();f(v,k)};T(C,v=>{t().attacks.length===0&&v(x)})}var n=s(C,2);ce(n,{label:"Información Rápida",get value(){return t().quickInfo},get readonly(){return e.readonly},placeholder:"Información general, habilidades, etc.",onChange:v=>{t().quickInfo=v,e.onChange(t())}});var d=s(n,2);q(d,{label:"Lenguas",get value(){return t().languages},get readonly(){return e.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:v=>{t().languages=v,e.onChange(t())}}),u(i),f(c,i)},$$slots:{default:!0}});var E=s(_,2);I(E,{title:"Equipo",children:(c,A)=>{var i=St(),g=m(i);q(g,{label:"Oro",get value(){return t().currentGold},readonly:!0,fullWidth:!0});var C=s(g,2);Ct(C,{get equipment(){return t().equipment},get readonly(){return e.readonly},onChange:d=>{t().equipment=d,e.onChange(t())}});var x=s(C,2);{var n=d=>{var v=wt();f(d,v)};T(x,d=>{t().equipment.length===0&&d(n)})}u(i),f(c,i)},$$slots:{default:!0}}),f(h,P),p()}const Mt=(h,e,t,a)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};U(e,[...r(e),l],!0),t.onChange(r(e)),a(l)};var Rt=(h,e,t)=>e(r(t)),qt=y('<div class="header svelte-z1ulbz"><button title="Agregar Nota">➕</button> <button title="Eliminar Nota">🗑️</button></div>'),zt=(h,e,t)=>e(r(t)),Ht=y('<button><span class="svelte-z1ulbz"> </span></button>'),It=y('<div class="notes svelte-z1ulbz"></div>'),Tt=y('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Dt=y('<div class="note svelte-z1ulbz"><!> <!></div>'),Lt=y('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Ft=y('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function pt(h,e){F(e,!0);let t=ue(de(e.notes)),a=ue(void 0),l=L(()=>r(t).find(n=>n.id===r(a)));const o=n=>{U(a,n.id,!0)},w=n=>{n&&(U(t,r(t).filter(d=>d.id!==n),!0),U(a,void 0),e.onChange(r(t)))},N=()=>{U(t,[...r(t)],!0),e.onChange(r(t))};var P=Ft(),S=m(P),b=m(S);{var _=n=>{var d=qt(),v=m(d);v.__click=[Mt,t,e,o];var k=s(v,2);k.__click=[Rt,w,a],u(d),D(()=>k.disabled=!r(l)),f(n,d)};T(b,n=>{e.readonly||n(_)})}var E=s(b,2);{var c=n=>{var d=It();X(d,21,()=>r(t),v=>v.id,(v,k)=>{var M=Ht();let O;M.__click=[zt,o,k];var Y=m(M),V=m(Y,!0);u(Y),u(M),D(R=>{O=J(M,1,"note-btn svelte-z1ulbz",null,O,R),j(V,r(k).title||"Nota sin título")},[()=>({selected:r(a)===r(k).id})]),f(v,M)}),u(d),f(n,d)},A=n=>{var d=Tt();f(n,d)};T(E,n=>{r(t).length>0?n(c):n(A,!1)})}u(S);var i=s(S,2),g=m(i);{var C=n=>{var d=Dt(),v=m(d);Ce(v,{get value(){return r(l).title},get readonly(){return e.readonly},placeholder:"Título de la nota",onChange:M=>{r(l).title=M,N()}});var k=s(v,2);ce(k,{get value(){return r(l).content},get readonly(){return e.readonly},placeholder:"Contenido de la nota",onChange:M=>{r(l).content=M,N()},maxRows:"unlimited"}),u(d),f(n,d)},x=n=>{var d=Lt();f(n,d)};T(g,n=>{r(l)?n(C):n(x,!1)})}u(i),u(P),f(h,P),p()}G(["click"]);function jt(h,e){F(e,!0);let t=H(e,"character",7);I(h,{title:"Notas",children:(a,l)=>{pt(a,{get notes(){return t().notes},get readonly(){return e.readonly},onChange:o=>{t().notes=o,e.onChange(t())}})},$$slots:{default:!0}}),p()}const Ot=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()},Wt=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()};var Ut=y('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Poder de PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),Gt=y('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label class="qty svelte-1cdo061">Cantidad</label> <label class="reason svelte-1cdo061">Razón</label> <label class="btn svelte-1cdo061"></label> <label class="btn svelte-1cdo061"></label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP" class="svelte-1cdo061">-</button> <button title="Ganar PP" class="svelte-1cdo061">+</button></div></div>'),Vt=(h,e,t)=>e(r(t)),Bt=y('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acción">↶</button></div>'),Jt=y('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),Kt=y('<div class="history svelte-1cdo061"></div>'),Qt=y("<!> <!> <!>",1);function Xt(h,e){F(e,!0);const t="Sin razón especifica";let a=H(e,"character",7),l=de({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().ppHistory=a().ppHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=Qt(),P=te(N);I(P,{title:"Estado Actual",children:(E,c)=>{var A=Ut(),i=m(A),g=s(m(i),2);let C;var x=m(g,!0);u(g),u(i);var n=s(i,2),d=s(m(n),2),v=m(d,!0);u(d),u(n);var k=s(n,2),M=s(m(k),2),O=m(M,!0);u(M),u(k),u(A),D(Y=>{C=J(g,1,"number svelte-1cdo061",null,C,Y),j(x,a().currentPP),j(v,a().spentPP),j(O,a().pjPower)},[()=>({negative:a().currentPP<0})]),f(E,A)},$$slots:{default:!0}});var S=s(P,2);{var b=E=>{I(E,{title:"Actualizar Progreso",children:(c,A)=>{var i=Gt(),g=s(m(i),2),C=m(g);q(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!1,onChange:v=>{l.quantity=Number(v)}});var x=s(C,2);q(x,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:v=>{l.reason=v.toString()}});var n=s(x,2);n.__click=[Wt,l,t,a,e,o];var d=s(n,2);d.__click=[Ot,l,t,a,e,o],u(g),u(i),f(c,i)},$$slots:{default:!0}})};T(S,E=>{e.readonly||E(b)})}var _=s(S,2);I(_,{title:"Historial",children:(E,c)=>{var A=Kt();X(A,21,()=>a().ppHistory,i=>i.id,(i,g)=>{var C=Bt(),x=m(C);let n;var d=m(x);u(x);var v=s(x,2),k=m(v,!0);u(v);var M=s(v,2);M.__click=[Vt,w,g],u(C),D(O=>{n=J(x,1,"log-amount svelte-1cdo061",null,n,O),j(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} PP`),j(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=Jt();f(i,g)}),u(A),f(E,A)},$$slots:{default:!0}}),f(h,N),p()}G(["click"]);var Yt=(h,e,t)=>e()(r(t)),Zt=y("<option> </option>"),$t=y('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function he(h,e){F(e,!0);let t=H(e,"onChange",3,()=>{}),a=L(()=>e.value);var l=$t(),o=m(l);o.__change=[Yt,t,a],X(o,21,()=>e.options,w=>w.label,(w,N)=>{var P=Zt(),S=m(P,!0);u(P);var b={};D(()=>{j(S,r(N).label),b!==(b=r(N).value)&&(P.value=(P.__value=r(N).value)??"")}),f(w,P)}),u(o),u(l),Te(o,()=>r(a),w=>U(a,w)),f(h,l),p()}G(["change"]);const ea=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),t.onChange(e())};var ta=(h,e,t)=>e(r(t)),aa=y('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar" class="svelte-1n17zba">🗑️</button></div>'),ra=y('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),na=y('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">➕</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type svelte-1n17zba">Tipo</label> <label class="field svelte-1n17zba">Atributo</label> <label class="formula svelte-1n17zba">Formula</label> <label class="label svelte-1n17zba">Razón</label> <label class="btn svelte-1n17zba"></label></div> <!></div></div>');function la(h,e){F(e,!0);let t=H(e,"modifiers",7);const a=S=>{t(t().filter(b=>b.id!==S.id)),e.onChange(t())};var l=na(),o=m(l),w=s(m(o),2);w.__click=[ea,t,e],u(o);var N=s(o,2),P=s(m(N),2);X(P,17,t,S=>S.id,(S,b,_)=>{var E=aa(),c=m(E);he(c,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return r(b).type},onChange:x=>{r(b).type=x.toString(),e.onChange(t())}});var A=s(c,2);he(A,{options:[{label:"Salud Máxima",value:"maxHP"},{label:"Suerte Máxima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigación Física",value:"physicalMitigation"},{label:"Mitigación Mágica",value:"magicalMitigation"},{label:"Velocidad",value:"speed"}],get value(){return r(b).attribute},onChange:x=>{r(b).attribute=x.toString(),e.onChange(t())}});var i=s(A,2);q(i,{get value(){return r(b).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:x=>{r(b).formula=x.toString(),e.onChange(t())}});var g=s(i,2);q(g,{get value(){return r(b).formula},placeholder:"Razón",fullWidth:!0,onChange:x=>{r(b).reason=x.toString(),e.onChange(t())}});var C=s(g,2);C.__click=[ta,a,b],u(E),f(S,E)},S=>{var b=ra();f(S,b)}),u(N),u(l),f(h,l),p()}G(["click"]);var oa=y('<div class="general svelte-1hn03u3"><!></div>'),sa=y('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),ia=y("<!> <!>",1);function da(h,e){F(e,!0);let t=H(e,"character",7);var a=ia(),l=te(a);I(l,{title:"General",children:(w,N)=>{var P=oa(),S=m(P);{let b=L(()=>t().img??"");q(S,{label:"URL del Retrato",get value(){return r(b)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:_=>{const E=_.toString();E.length>0?t().img=E:t().img=null,e.onChange(t())}})}u(P),f(w,P)},$$slots:{default:!0}});var o=s(l,2);I(o,{title:"Modificadores",children:(w,N)=>{var P=sa(),S=m(P);la(S,{get modifiers(){return t().modifiers},onChange:b=>{t().modifiers=b,e.onChange(t())}}),Me(2),u(P),f(w,P)},$$slots:{default:!0}}),f(h,a),p()}var ca=y("<button> </button>"),va=y('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function ua(h,e){F(e,!0);let t=H(e,"character",7);const a=[{name:"general",title:"General",component:Nt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:Xe,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:Be,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:jt,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:Xt,availableWhenReadOnly:!0},{name:"economy",title:"Economía",component:ot,availableWhenReadOnly:!0},{name:"settings",title:"Configuración",component:da,availableWhenReadOnly:!1}];let l=L(()=>Math.max(a.findIndex(c=>c.name===e.currentTab),0)),o=L(()=>a.find(c=>c.name===e.currentTab)??a[0]);const w=c=>{const A=c.copy();e.onChange(A),t(A)},N=c=>{U(l,c),e.onTabChange(a[c].name)};var P=va(),S=m(P),b=m(S);Ce(b,{get value(){return t().name},get readonly(){return e.readonly},onChange:c=>{t().name=c,w(t())}}),u(S);var _=s(S,2);X(_,23,()=>a,c=>c.title,(c,A,i)=>{var g=Re(),C=te(g);{var x=n=>{var d=ca();let v;d.__click=()=>N(r(i));var k=m(d,!0);u(d),D(M=>{v=J(d,1,"tab",null,v,M),j(k,r(A).title)},[()=>({selected:r(l)===r(i)})]),f(n,d)};T(C,n=>{(r(A).availableWhenReadOnly||!e.readonly)&&n(x)})}f(c,g)}),u(_);var E=s(_,2);qe(E,()=>r(o).component,(c,A)=>{A(c,{get character(){return t()},get readonly(){return e.readonly},onChange:w})}),u(P),f(h,P),p()}G(["click"]);const ga=async(h,e,t)=>{const a=await e()();t(a)},ha=async(h,e,t)=>{const a=await e()();t(a)},ba=async(h,e,t)=>{r(e)&&await t()(r(e))},ma=async(h,e,t,a)=>{!r(e)||!confirm(`¿Quieres eliminar a ${r(e).name}?`)||(await t()(r(e)),U(e,void 0),a(null))},_a=async(h,e,t)=>{r(e)&&await t()(r(e))};var fa=y('<button title="Importar y Editar">📝</button>'),ya=y('<button title="Crear">➕</button> <button title="Importar">📥</button> <button title="Exportar">📤</button> <button title="Eliminar">🗑️</button>',1),Ca=(h,e,t)=>e(r(t)),xa=y('<img class="character-image svelte-kjfy12"/>'),ka=y('<span class="image-placeholder svelte-kjfy12"> </span>'),Pa=y('<button><!> <span class="name svelte-kjfy12"> </span></button>'),Aa=y('<section class="characters-page svelte-kjfy12"><div class="list svelte-kjfy12"><div class="header svelte-kjfy12"><!></div> <div class="content svelte-kjfy12"></div></div> <div class="viewport svelte-kjfy12"><!></div></section>');function Oa(h,e){F(e,!0);const t=()=>be(e.characters,"$characters",a),[a,l]=me(),o="general";let w=H(e,"onAddToMyCharacters",3,()=>{throw new Error("onAddToMyCharacters not implemented")}),N=H(e,"onCreateCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),P=H(e,"onImportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),S=H(e,"onExportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),b=H(e,"onDeleteCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),_=L(()=>K.url.searchParams.get("characterId")),E=L(()=>K.url.searchParams.get("tab")??o);const c=R=>{R!==null?(K.url.searchParams.set("characterId",R.id),K.url.searchParams.set("tab",o)):(K.url.searchParams.delete("characterId"),K.url.searchParams.delete("tab")),ge(`?${K.url.searchParams.toString()}`)},A=R=>{K.url.searchParams.set("tab",R),ge(`?${K.url.searchParams.toString()}`)};let i=L(()=>t().find(R=>R.id===r(_)));const g=R=>{e.characters.update(z=>{const W=z.findIndex(B=>B.id===R.id);if(W!==-1){const B=[...z];return B[W]=R,B}return z})};var C=Aa(),x=m(C),n=m(x),d=m(n);{var v=R=>{var z=fa();z.__click=[_a,i,w],D(()=>z.disabled=!r(i)),f(R,z)},k=R=>{var z=ya(),W=te(z);W.__click=[ga,N,c];var B=s(W,2);B.__click=[ha,P,c];var ae=s(B,2);ae.__click=[ba,i,S];var le=s(ae,2);le.__click=[ma,i,b,c],D(()=>{ae.disabled=!r(i),le.disabled=!r(i)}),f(R,z)};T(d,R=>{e.readonly?R(v):R(k,!1)})}u(n);var M=s(n,2);X(M,5,t,R=>R.id,(R,z)=>{var W=Pa();let B;W.__click=[Ca,c,z];var ae=m(W);{var le=Z=>{var ee=xa();D(()=>{$(ee,"src",r(z).img),$(ee,"alt",r(z).name)}),f(Z,ee)},xe=Z=>{var ee=ka(),Pe=m(ee,!0);u(ee),D(Ae=>j(Pe,Ae),[()=>r(z).name.charAt(0).toUpperCase()]),f(Z,ee)};T(ae,Z=>{r(z).img?Z(le):Z(xe,!1)})}var se=s(ae,2),ke=m(se,!0);u(se),u(W),D(Z=>{B=J(W,1,"character-item svelte-kjfy12",null,B,Z),$(se,"title",r(z).name),j(ke,r(z).name)},[()=>({selected:r(_)===r(z).id})]),f(R,W)}),u(M),u(x);var O=s(x,2),Y=m(O);{var V=R=>{ua(R,{get character(){return r(i)},get readonly(){return e.readonly},onChange:g,get currentTab(){return r(E)},onTabChange:A})};T(Y,R=>{r(i)&&R(V)})}u(O),u(C),f(h,C),p(),l()}G(["click"]);export{Oa as C,oe as a,ja as u};
