import{r as de}from"./DmB4ZnOZ.js";import{C as re,r as Se,s as $,e as Q}from"./CKrzFlF1.js";import{w as ve}from"./CkIMCjdd.js";import"./DsnmJJEf.js";import{aa as G,p as D,f as y,ab as p,t as M,O as U,H as r,b as f,c as L,d as _,s,aV as Ee,r as v,e as F,a as te,o as Ne,N as ce,aG as ge,aR as Re,aN as qe}from"./Dq1J35Nh.js";import{i as z,a as _e,s as be}from"./C6PZYbrM.js";import{b as fe,s as J}from"./Cllcj470.js";import{p as T}from"./Du0JBBBG.js";import{g as he}from"./CCbNn2KL.js";import{p as K}from"./B0aeXgCt.js";import{c as He}from"./hJAdS3TC.js";import{b as j,u as Ie,a as ie,C as Te,I as H}from"./Botdft6k.js";import{u as ye}from"./BPzsrxby.js";import{c as je}from"./CjlGQt4x.js";import{b as ze}from"./trHjHbxw.js";const Me=(h,e)=>{if(!h)return 0;const t=h.trim();try{const a=new Function("cuerpo","reflejos","mente","instinto","presencia","Math",`return (${t});`);return Number(a(Number(e.cuerpo)||0,Number(e.reflejos)||0,Number(e.mente)||0,Number(e.instinto)||0,Number(e.presencia)||0,Math))||0}catch(a){return console.error("Error evaluating modifier expression:",a),0}},pe=(h,e)=>Me(h,{cuerpo:e.attributes.cuerpo,reflejos:e.attributes.reflejos,mente:e.attributes.mente,instinto:e.attributes.instinto,presencia:e.attributes.presencia,Math});class oe{id;name;attributes;cards;ppHistory;goldHistory;equipment;modifiers;currentHP;tempHP;currentLuck;img;story;notes;languages;quickInfo;attacks;maxActiveCards;version;constructor(e){this.id=e.id,this.name=e.name,this.attributes=e.attributes,this.cards=e.cards,this.ppHistory=e.ppHistory,this.goldHistory=e.goldHistory,this.equipment=e.equipment,this.modifiers=e.modifiers,this.currentHP=e.currentHP,this.tempHP=e.tempHP,this.currentLuck=e.currentLuck,this.img=e.img,this.story=e.story,this.notes=e.notes,this.languages=e.languages,this.quickInfo=e.quickInfo,this.attacks=e.attacks,this.maxActiveCards=e.maxActiveCards,this.version=e.version}calculateAttrModifiers(e,t){let a=t;const l=this.modifiers.filter(o=>o.attribute===e);for(const o of l){const w=pe(o.formula,this);if(o.type==="set")return w;o.type==="add"&&(a+=w)}return a}get maxLuck(){const e=re.MAX_LUCK;return this.calculateAttrModifiers("maxLuck",e)}get maxHP(){const e=re.BASE_HEALTH+this.attributes.cuerpo*re.HEALTH_BODY_MULTIPIER;return this.calculateAttrModifiers("maxHP",e)}get speed(){const e=re.BASE_SPEED+this.attributes.reflejos;return this.calculateAttrModifiers("speed",e)}get evasion(){const e=re.BASE_EVASION+this.attributes.reflejos;return this.calculateAttrModifiers("evasion",e)}get mitigation(){return this.calculateAttrModifiers("mitigation",0)}get currentGold(){const e=this.goldHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentGold;return t>0?e-t:e}get spentGold(){return this.goldHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get currentPP(){const e=this.ppHistory.filter(a=>a.type==="add").reduce((a,l)=>a+l.value,0),t=this.spentPP;return t>0?e-t:e}get spentPP(){return this.ppHistory.filter(e=>e.type==="subtract").reduce((e,t)=>e+t.value,0)}get pjPower(){const e=this.cards.reduce((a,l)=>Math.max(a,l.level),0),t=this.spentPP/re.PJ_POWER_SPENT_PP_DIVIDER;return Math.round(e+t)}get numActiveCards(){return this.cards.filter(e=>e.isActive).length}get initiative(){return this.attributes.reflejos}copy(){return new oe({...this})}}const Ce="arcana:characters",Y={charactersStore:ve([]),exampleCharactersStore:ve([]),charactersAlreadyLoaded:!1,exampleCharactersAlreadyLoaded:!1},De=()=>{Y.charactersStore.subscribe(h=>{const e=JSON.stringify(h);localStorage.setItem(Ce,e)})},Fa=()=>({loadCharacters:async()=>{if(Y.charactersAlreadyLoaded)return;const t=localStorage.getItem(Ce);if(t)try{const a=JSON.parse(t);Y.charactersStore.set(a.map(l=>new oe(l)))}catch(a){console.error("Error parsing characters JSON:",a)}De(),Y.charactersAlreadyLoaded=!0},loadExampleCharacters:async()=>{if(Y.exampleCharactersAlreadyLoaded)return;let t=[];try{t=await(await fetch(de("/docs/example-characters.json"))).json()}catch(a){console.error("Error fetching example characters:",a)}try{Y.exampleCharactersStore.set(t.map(a=>new oe(a)))}catch(a){console.error("Error parsing example characters JSON:",a)}Y.exampleCharactersAlreadyLoaded=!0},characters:Y.charactersStore,exampleCharacters:Y.exampleCharactersStore});var Le=(h,e,t)=>e.onChange(r(t)),Fe=y('<input type="text" class="svelte-19nbfo1"/>');function ke(h,e){D(e,!0);let t=T(e,"placeholder",3,void 0),a=p(()=>e.value);var l=Fe();Se(l),l.__input=[Le,e,a],M(()=>{$(l,"placeholder",t()),l.disabled=e.readonly}),fe(l,()=>r(a),o=>U(a,o)),f(h,l),L()}G(["input"]);var Oe=y("<label> </label>"),We=(h,e,t)=>e.onChange(r(t)),Ue=y("<div><!> <div><textarea></textarea></div></div>");function ue(h,e){D(e,!0);const t=6;let a=T(e,"label",3,void 0),l=T(e,"placeholder",3,""),o=T(e,"maxRows",3,t),w=p(()=>e.value);var N=Ue();let x;var S=_(N);{var m=i=>{var g=Oe(),C=_(g,!0);v(g),M(()=>F(C,a())),f(i,g)};z(S,i=>{a()&&i(m)})}var b=s(S,2);let E;var c=_(b);Ee(c),c.__input=[We,e,w];let A;v(b),v(N),M((i,g,C)=>{x=J(N,1,"fieldgroup svelte-o02g58",null,x,i),E=J(b,1,"field svelte-o02g58",null,E,g),c.disabled=e.readonly,$(c,"placeholder",l()),$(c,"rows",o()==="unlimited"?void 0:o()),A=J(c,1,"svelte-o02g58",null,A,C)},[()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"}),()=>({expanded:o()==="unlimited"})]),fe(c,()=>r(w),i=>U(w,i)),f(h,N),L()}G(["input"]);var Ge=y('<div class="portrait svelte-8jg83a"><img class="svelte-8jg83a"/></div>'),Ve=y("<!> <!>",1);function Be(h,e){D(e,!0);let t=T(e,"character",7);var a=Ve(),l=te(a);{var o=N=>{j(N,{children:(x,S)=>{var m=Ge(),b=_(m);v(m),M(()=>{$(b,"src",t().img),$(b,"alt",t().name)}),f(x,m)},$$slots:{default:!0}})};z(l,N=>{t().img&&N(o)})}var w=s(l,2);j(w,{children:(N,x)=>{ue(N,{label:"Historia",get value(){return t().story},get readonly(){return e.readonly},onChange:S=>{t().story=S,e.onChange(t())}})},$$slots:{default:!0}}),f(h,a),L()}var Je=y('<div class="empty svelte-o497rd"><em>No se encontraron resultados</em></div>'),Ke=y('<div class="all-cards svelte-o497rd"><!> <!></div>'),Ye=y('<div class="cards-tab svelte-o497rd"><!> <!> <!> <!></div>');function Qe(h,e){D(e,!0);const t=()=>_e(N,"$cardsStore",a),[a,l]=be();let o=T(e,"character",7),{loadCards:w,cards:N}=Ie(),{rollExpression:x}=ye(),S=p(t);Ne(async()=>{await w()});const m=n=>{o().cards=n,e.onChange(o())},b=n=>{U(S,n)},E=async n=>{const d=o().cards.find(k=>k.id===n),u=r(S).find(k=>k.id===n);d&&u&&d.uses!==null&&u&&await x({expression:"1d6",variables:{},title:`${o().name}: Recarga de carta ${u.name}`,resultFormatter:R=>`<span class="total ${R>=(u.uses?.qty??0)?"success":"failure"}">${R}</span>`})>=(u.uses?.qty??0)&&(d.uses+=1,m([...o().cards]))};var c=Ye(),A=_(c);{var i=n=>{j(n,{children:(d,u)=>{H(d,{label:"Ranuras de Cartas Activas",labelWidth:"fit",get value(){return o().maxActiveCards},get readonly(){return e.readonly},fullWidth:!0,onChange:k=>{o().maxActiveCards=Number(k),e.onChange(o())}})},$$slots:{default:!0}})};z(A,n=>{e.readonly||n(i)})}var g=s(A,2);j(g,{get title(){return`Cartas Activas (${o().numActiveCards??""}/${o().maxActiveCards??""})`},children:(n,d)=>{{let u=p(()=>t().filter(k=>o().cards.some(R=>R.isActive&&R.id===k.id)));ie(n,{get cards(){return r(u)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"active",onChange:m,onCardReloadClick:E})}},$$slots:{default:!0}});var C=s(g,2);j(C,{title:"Colección",children:(n,d)=>{{let u=p(()=>t().filter(k=>o().cards.some(R=>R.id===k.id)));ie(n,{get cards(){return r(u)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"collection",onChange:m})}},$$slots:{default:!0}});var P=s(C,2);j(P,{title:"Todas las Cartas",children:(n,d)=>{var u=Ke(),k=_(u);Te(k,{get cards(){return t()},onFilter:b});var R=s(k,2);{var O=V=>{{let q=p(()=>r(S).filter(I=>o().cards.find(W=>W.id===I.id)===void 0));ie(V,{get cards(){return r(q)},get readonly(){return e.readonly},get characterCards(){return o().cards},listMode:"all",onChange:m})}},X=V=>{var q=Je();f(V,q)};z(R,V=>{r(S).length>0?V(O):V(X,!1)})}v(u),f(n,u)},$$slots:{default:!0}}),v(c),f(h,c),L(),l()}const Xe=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()},Ze=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().goldHistory.unshift(w),l.onChange(a()),o()};var $e=y('<div class="status svelte-ssntdk"><div class="indicator svelte-ssntdk"><span>Oro Actual</span> <strong> </strong></div> <div class="indicator svelte-ssntdk"><span>Oro Gastado</span> <strong class="number svelte-ssntdk"> </strong></div></div>'),et=y('<div class="editor svelte-ssntdk"><div class="labels svelte-ssntdk"><label>Cantidad</label> <label>Razón</label></div> <div class="controls svelte-ssntdk"><!> <!> <button title="Gastar Oro">-</button> <button title="Ganar Oro">+</button></div></div>'),tt=(h,e,t)=>e(r(t)),at=y('<div class="log-content svelte-ssntdk"><strong> </strong> <span class="log-reason svelte-ssntdk"> </span> <button title="Deshacer esta acción">↶</button></div>'),rt=y('<div class="empty svelte-ssntdk"><em>No hay registros</em></div>'),nt=y('<div class="history svelte-ssntdk"></div>'),lt=y("<!> <!> <!>",1);function ot(h,e){D(e,!0);const t="Sin razón especifica";let a=T(e,"character",7),l=ce({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().goldHistory=a().goldHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=lt(),x=te(N);j(x,{title:"Estado Actual",children:(E,c)=>{var A=$e(),i=_(A),g=s(_(i),2);let C;var P=_(g,!0);v(g),v(i);var n=s(i,2),d=s(_(n),2),u=_(d,!0);v(d),v(n),v(A),M(k=>{C=J(g,1,"number svelte-ssntdk",null,C,k),F(P,a().currentGold),F(u,a().spentGold)},[()=>({negative:a().currentGold<0})]),f(E,A)},$$slots:{default:!0}});var S=s(x,2);{var m=E=>{j(E,{title:"Actualizar Oro",children:(c,A)=>{var i=et(),g=s(_(i),2),C=_(g);H(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!0,onChange:u=>{l.quantity=Number(u)}});var P=s(C,2);H(P,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:u=>{l.reason=u.toString()}});var n=s(P,2);n.__click=[Ze,l,t,a,e,o];var d=s(n,2);d.__click=[Xe,l,t,a,e,o],v(g),v(i),f(c,i)},$$slots:{default:!0}})};z(S,E=>{e.readonly||E(m)})}var b=s(S,2);j(b,{title:"Historial",children:(E,c)=>{var A=nt();Q(A,21,()=>a().goldHistory,i=>i.id,(i,g)=>{var C=at(),P=_(C);let n;var d=_(P);v(P);var u=s(P,2),k=_(u,!0);v(u);var R=s(u,2);R.__click=[tt,w,g],v(C),M(O=>{n=J(P,1,"log-amount svelte-ssntdk",null,n,O),F(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} Oro`),F(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=rt();f(i,g)}),v(A),f(E,A)},$$slots:{default:!0}}),f(h,N),L()}G(["click"]);const st=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),name:"",atkFormula:"",dmgFormula:"",notes:""}]),t.onChange(e())};var it=y('<button title="Agregar Ataque">➕</button>'),dt=(h,e,t)=>e(r(t)),ct=y('<button title="Eliminar" class="svelte-1v2w3y3">🗑️</button>'),ut=y('<div class="item svelte-1v2w3y3"><!> <!> <!> <!> <!></div>'),vt=y('<div class="attack-list svelte-1v2w3y3"><div class="header svelte-1v2w3y3"><label>Ataques</label> <!></div> <div class="content svelte-1v2w3y3"><div class="attacks-header svelte-1v2w3y3"><label class="name svelte-1v2w3y3">Nombre</label> <label class="atk-formula svelte-1v2w3y3">Formula Ataque</label> <label class="dmg-formula svelte-1v2w3y3">Formula Daño</label> <label class="notes svelte-1v2w3y3">Notas</label> <label class="actions svelte-1v2w3y3"></label></div> <!></div></div>');function gt(h,e){D(e,!0);let t=T(e,"attacks",7);const a=m=>{t(t().filter(b=>b.id!==m.id)),e.onChange(t())};var l=vt(),o=_(l),w=s(_(o),2);{var N=m=>{var b=it();b.__click=[st,t,e],f(m,b)};z(w,m=>{e.readonly||m(N)})}v(o);var x=s(o,2),S=s(_(x),2);Q(S,17,t,m=>m.id,(m,b,E)=>{var c=ut(),A=_(c);H(A,{get value(){return r(b).name},get readonly(){return e.readonly},placeholder:"Nombre",fullWidth:!0,onChange:d=>{r(b).name=d.toString(),e.onChange(t())}});var i=s(A,2);{let d=p(()=>({icon:"🎯",title:"Tirar Ataque",onClick:()=>e.onAttackRoll(r(b)),disabled:!r(b).atkFormula}));H(i,{get value(){return r(b).atkFormula},get readonly(){return e.readonly},placeholder:"1d6e+cuerpo",fullWidth:!0,onChange:u=>{r(b).atkFormula=u.toString(),e.onChange(t())},get button(){return r(d)}})}var g=s(i,2);{let d=p(()=>({icon:"💥",title:"Tirar Daño",onClick:()=>e.onDamageRoll(r(b)),disabled:!r(b).dmgFormula}));H(g,{get value(){return r(b).dmgFormula},get readonly(){return e.readonly},placeholder:"1d4",fullWidth:!0,onChange:u=>{r(b).dmgFormula=u.toString(),e.onChange(t())},get button(){return r(d)}})}var C=s(g,2);H(C,{get value(){return r(b).notes},get readonly(){return e.readonly},placeholder:"Contundente",fullWidth:!0,onChange:d=>{r(b).notes=d.toString(),e.onChange(t())}});var P=s(C,2);{var n=d=>{var u=ct();u.__click=[dt,a,b],f(d,u)};z(P,d=>{e.readonly||d(n)})}v(c),f(m,c)}),v(x),v(l),f(h,l),L()}G(["click"]);function ne(h,e){D(e,!0);{let t=p(()=>({icon:"🎲",onClick:e.onDiceRoll,title:"Tirar"}));H(h,{get label(){return e.name},get value(){return e.value},get readonly(){return e.readonly},onChange:a=>e.onChange(Number(a)),get button(){return r(t)}})}L()}const ht=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),quantity:1,name:"",notes:""}]),t.onChange(e())};var mt=y('<button title="Agregar Item">➕</button>'),_t=(h,e,t)=>e(r(t)),bt=y('<button title="Eliminar">🗑️</button>'),ft=y('<div class="item svelte-1ewnrao"><!> <!> <!> <!></div>'),yt=y('<div class="equipment-list svelte-1ewnrao"><div class="header svelte-1ewnrao"><label>Equipo</label> <!></div> <div class="content svelte-1ewnrao"><div class="items-header svelte-1ewnrao"><label class="name svelte-1ewnrao">Nombre</label> <label class="quantity svelte-1ewnrao">Cantidad</label> <label class="notes svelte-1ewnrao">Notas</label></div> <!></div></div>');function Ct(h,e){D(e,!0);let t=T(e,"equipment",7);const a=m=>{t(t().filter(b=>b.id!==m.id)),e.onChange(t())};var l=yt(),o=_(l),w=s(_(o),2);{var N=m=>{var b=mt();b.__click=[ht,t,e],f(m,b)};z(w,m=>{e.readonly||m(N)})}v(o);var x=s(o,2),S=s(_(x),2);Q(S,17,t,m=>m.id,(m,b,E)=>{var c=ft(),A=_(c);H(A,{get value(){return r(b).quantity},get readonly(){return e.readonly},onChange:n=>{r(b).quantity=Number(n),e.onChange(t())}});var i=s(A,2);H(i,{get value(){return r(b).name},get readonly(){return e.readonly},placeholder:"Nombre",onChange:n=>{r(b).name=n.toString(),e.onChange(t())}});var g=s(i,2);H(g,{get value(){return r(b).notes},get readonly(){return e.readonly},placeholder:"Notas",fullWidth:!0,onChange:n=>{r(b).notes=n.toString(),e.onChange(t())}});var C=s(g,2);{var P=n=>{var d=bt();d.__click=[_t,a,b],f(n,d)};z(C,n=>{e.readonly||n(P)})}v(c),f(m,c)}),v(x),v(l),f(h,l),L()}G(["click"]);var kt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),Pt=y('<div class="attributes svelte-ox7hjw"><!> <!> <!> <!> <!> <!></div>'),xt=y('<div class="empty svelte-ox7hjw"><em>No hay ataques cargados.</em></div>'),At=y('<div class="info svelte-ox7hjw"><!> <!> <!> <!></div>'),wt=y('<div class="empty svelte-ox7hjw"><em>El equipo esta vacío.</em></div>'),St=y('<div class="equipment svelte-ox7hjw"><!> <!> <!></div>'),Et=y("<!> <!> <!> <!>",1);function Nt(h,e){D(e,!0);let t=T(e,"character",7),{rollExpression:a,rollModal:l}=ye();const o=c=>{l.openRollModal({expression:`1d6e+${c}`,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia,iniciativa:t().initiative},title:`${t().name}: ${je(c)}`})},w=c=>{l.openRollModal({expression:c.atkFormula,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia},title:`${t().name}: Ataque con ${c.name}`})},N=c=>{a({expression:c.dmgFormula,variables:{cuerpo:t().attributes.cuerpo,reflejos:t().attributes.reflejos,mente:t().attributes.mente,instinto:t().attributes.instinto,presencia:t().attributes.presencia},title:`${t().name}: Daño de ${c.name}`})};var x=Et(),S=te(x);j(S,{title:"Atributos Principales",children:(c,A)=>{var i=kt(),g=_(i);ne(g,{name:"Cuerpo",get value(){return t().attributes.cuerpo},get readonly(){return e.readonly},onDiceRoll:()=>o("cuerpo"),onChange:k=>{t().attributes.cuerpo=k,e.onChange(t())}});var C=s(g,2);ne(C,{name:"Reflejos",get value(){return t().attributes.reflejos},get readonly(){return e.readonly},onDiceRoll:()=>o("reflejos"),onChange:k=>{t().attributes.reflejos=k,e.onChange(t())}});var P=s(C,2);ne(P,{name:"Mente",get value(){return t().attributes.mente},get readonly(){return e.readonly},onDiceRoll:()=>o("mente"),onChange:k=>{t().attributes.mente=k,e.onChange(t())}});var n=s(P,2);ne(n,{name:"Instinto",get value(){return t().attributes.instinto},get readonly(){return e.readonly},onDiceRoll:()=>o("instinto"),onChange:k=>{t().attributes.instinto=k,e.onChange(t())}});var d=s(n,2);ne(d,{name:"Presencia",get value(){return t().attributes.presencia},get readonly(){return e.readonly},onDiceRoll:()=>o("presencia"),onChange:k=>{t().attributes.presencia=k,e.onChange(t())}});var u=s(d,2);H(u,{label:"Suerte",get value(){return t().currentLuck},get max(){return t().maxLuck},get readonly(){return e.readonly},onChange:k=>{t().currentLuck=Number(k),e.onChange(t())}}),v(i),f(c,i)},$$slots:{default:!0}});var m=s(S,2);j(m,{title:"Atributos Derivados",children:(c,A)=>{var i=Pt(),g=_(i);H(g,{label:"Salud",get value(){return t().currentHP},get max(){return t().maxHP},get readonly(){return e.readonly},onChange:k=>{t().currentHP=Number(k),e.onChange(t())}});var C=s(g,2);H(C,{label:"Salud Temporal",get value(){return t().tempHP},get readonly(){return e.readonly},onChange:k=>{t().tempHP=Number(k),e.onChange(t())}});var P=s(C,2);H(P,{label:"Velocidad",get value(){return t().speed},readonly:!0});var n=s(P,2);H(n,{label:"Esquiva",get value(){return t().evasion},readonly:!0});var d=s(n,2);H(d,{label:"Mitigación",get value(){return t().mitigation},readonly:!0});var u=s(d,2);H(u,{label:"Iniciativa",get value(){return t().initiative},readonly:!0,button:{icon:"🎲",title:"Tirar iniciativa",onClick:()=>o("iniciativa")}}),v(i),f(c,i)},$$slots:{default:!0}});var b=s(m,2);j(b,{title:"Información",children:(c,A)=>{var i=At(),g=_(i);gt(g,{get attacks(){return t().attacks},get readonly(){return e.readonly},onChange:u=>{t().attacks=u,e.onChange(t())},onAttackRoll:w,onDamageRoll:N});var C=s(g,2);{var P=u=>{var k=xt();f(u,k)};z(C,u=>{t().attacks.length===0&&u(P)})}var n=s(C,2);ue(n,{label:"Información Rápida",get value(){return t().quickInfo},get readonly(){return e.readonly},placeholder:"Información general, habilidades, etc.",onChange:u=>{t().quickInfo=u,e.onChange(t())}});var d=s(n,2);H(d,{label:"Lenguas",get value(){return t().languages},get readonly(){return e.readonly},fullWidth:!0,placeholder:"Lista de lenguas concidas",textAlign:"left",onChange:u=>{t().languages=u,e.onChange(t())}}),v(i),f(c,i)},$$slots:{default:!0}});var E=s(b,2);j(E,{title:"Equipo",children:(c,A)=>{var i=St(),g=_(i);H(g,{label:"Oro",get value(){return t().currentGold},readonly:!0,fullWidth:!0});var C=s(g,2);Ct(C,{get equipment(){return t().equipment},get readonly(){return e.readonly},onChange:d=>{t().equipment=d,e.onChange(t())}});var P=s(C,2);{var n=d=>{var u=wt();f(d,u)};z(P,d=>{t().equipment.length===0&&d(n)})}v(i),f(c,i)},$$slots:{default:!0}}),f(h,x),L()}const Rt=(h,e,t,a)=>{const l={id:crypto.randomUUID(),title:"Nota Nueva",content:""};U(e,[...r(e),l],!0),t.onChange(r(e)),a(l)};var qt=(h,e,t)=>e(r(t)),Ht=y('<div class="header svelte-z1ulbz"><button title="Agregar Nota">➕</button> <button title="Eliminar Nota">🗑️</button></div>'),It=(h,e,t)=>e(r(t)),Tt=y('<button><span class="svelte-z1ulbz"> </span></button>'),jt=y('<div class="notes svelte-z1ulbz"></div>'),zt=y('<div class="notes empty svelte-z1ulbz"><em>No hay notas</em></div>'),Mt=y('<div class="note svelte-z1ulbz"><!> <!></div>'),pt=y('<div class="note empty svelte-z1ulbz"><em>No hay ninguna nota seleccionada</em></div>'),Dt=y('<div class="notes svelte-z1ulbz"><div class="list svelte-z1ulbz"><!> <!></div> <div class="content svelte-z1ulbz"><!></div></div>');function Lt(h,e){D(e,!0);let t=ge(ce(e.notes)),a=ge(void 0),l=p(()=>r(t).find(n=>n.id===r(a)));const o=n=>{U(a,n.id,!0)},w=n=>{n&&(U(t,r(t).filter(d=>d.id!==n),!0),U(a,void 0),e.onChange(r(t)))},N=()=>{U(t,[...r(t)],!0),e.onChange(r(t))};var x=Dt(),S=_(x),m=_(S);{var b=n=>{var d=Ht(),u=_(d);u.__click=[Rt,t,e,o];var k=s(u,2);k.__click=[qt,w,a],v(d),M(()=>k.disabled=!r(l)),f(n,d)};z(m,n=>{e.readonly||n(b)})}var E=s(m,2);{var c=n=>{var d=jt();Q(d,21,()=>r(t),u=>u.id,(u,k)=>{var R=Tt();let O;R.__click=[It,o,k];var X=_(R),V=_(X,!0);v(X),v(R),M(q=>{O=J(R,1,"note-btn svelte-z1ulbz",null,O,q),F(V,r(k).title||"Nota sin título")},[()=>({selected:r(a)===r(k).id})]),f(u,R)}),v(d),f(n,d)},A=n=>{var d=zt();f(n,d)};z(E,n=>{r(t).length>0?n(c):n(A,!1)})}v(S);var i=s(S,2),g=_(i);{var C=n=>{var d=Mt(),u=_(d);ke(u,{get value(){return r(l).title},get readonly(){return e.readonly},placeholder:"Título de la nota",onChange:R=>{r(l).title=R,N()}});var k=s(u,2);ue(k,{get value(){return r(l).content},get readonly(){return e.readonly},placeholder:"Contenido de la nota",onChange:R=>{r(l).content=R,N()},maxRows:"unlimited"}),v(d),f(n,d)},P=n=>{var d=pt();f(n,d)};z(g,n=>{r(l)?n(C):n(P,!1)})}v(i),v(x),f(h,x),L()}G(["click"]);function Ft(h,e){D(e,!0);let t=T(e,"character",7);j(h,{title:"Notas",children:(a,l)=>{Lt(a,{get notes(){return t().notes},get readonly(){return e.readonly},onChange:o=>{t().notes=o,e.onChange(t())}})},$$slots:{default:!0}}),L()}const Ot=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"add",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()},Wt=(h,e,t,a,l,o)=>{const w={id:crypto.randomUUID(),type:"subtract",value:e.quantity,reason:e.reason||t};a().ppHistory.unshift(w),l.onChange(a()),o()};var Ut=y('<div class="status svelte-1cdo061"><div class="indicator svelte-1cdo061"><span>PP Actuales</span> <strong> </strong></div> <div class="indicator svelte-1cdo061"><span>PP Gastados</span> <strong class="number svelte-1cdo061"> </strong></div> <div class="indicator svelte-1cdo061"><span>Poder de PJ</span> <strong class="number svelte-1cdo061"> </strong></div></div>'),Gt=y('<div class="editor svelte-1cdo061"><div class="labels svelte-1cdo061"><label>Cantidad</label> <label>Razón</label></div> <div class="controls svelte-1cdo061"><!> <!> <button title="Gastar PP">-</button> <button title="Ganar PP">+</button></div></div>'),Vt=(h,e,t)=>e(r(t)),Bt=y('<div class="log-content svelte-1cdo061"><strong> </strong> <span class="log-reason svelte-1cdo061"> </span> <button title="Deshacer esta acción">↶</button></div>'),Jt=y('<div class="empty svelte-1cdo061"><em>No hay registros</em></div>'),Kt=y('<div class="history svelte-1cdo061"></div>'),Yt=y("<!> <!> <!>",1);function Qt(h,e){D(e,!0);const t="Sin razón especifica";let a=T(e,"character",7),l=ce({quantity:1,reason:""});const o=()=>{l.quantity=1,l.reason=""},w=E=>{a().ppHistory=a().ppHistory.filter(c=>c.id!==E.id),e.onChange(a())};var N=Yt(),x=te(N);j(x,{title:"Estado Actual",children:(E,c)=>{var A=Ut(),i=_(A),g=s(_(i),2);let C;var P=_(g,!0);v(g),v(i);var n=s(i,2),d=s(_(n),2),u=_(d,!0);v(d),v(n);var k=s(n,2),R=s(_(k),2),O=_(R,!0);v(R),v(k),v(A),M(X=>{C=J(g,1,"number svelte-1cdo061",null,C,X),F(P,a().currentPP),F(u,a().spentPP),F(O,a().pjPower)},[()=>({negative:a().currentPP<0})]),f(E,A)},$$slots:{default:!0}});var S=s(x,2);{var m=E=>{j(E,{title:"Actualizar Progreso",children:(c,A)=>{var i=Gt(),g=s(_(i),2),C=_(g);H(C,{get value(){return l.quantity},placeholder:"Cantidad",fullWidth:!0,onChange:u=>{l.quantity=Number(u)}});var P=s(C,2);H(P,{get value(){return l.reason},placeholder:"Razón",fullWidth:!0,onChange:u=>{l.reason=u.toString()}});var n=s(P,2);n.__click=[Wt,l,t,a,e,o];var d=s(n,2);d.__click=[Ot,l,t,a,e,o],v(g),v(i),f(c,i)},$$slots:{default:!0}})};z(S,E=>{e.readonly||E(m)})}var b=s(S,2);j(b,{title:"Historial",children:(E,c)=>{var A=Kt();Q(A,21,()=>a().ppHistory,i=>i.id,(i,g)=>{var C=Bt(),P=_(C);let n;var d=_(P);v(P);var u=s(P,2),k=_(u,!0);v(u);var R=s(u,2);R.__click=[Vt,w,g],v(C),M(O=>{n=J(P,1,"log-amount svelte-1cdo061",null,n,O),F(d,`${r(g).type==="add"?"+":"-"}${r(g).value??""} PP`),F(k,r(g).reason)},[()=>({positive:r(g).type==="add",negative:r(g).type==="subtract"})]),f(i,C)},i=>{var g=Jt();f(i,g)}),v(A),f(E,A)},$$slots:{default:!0}}),f(h,N),L()}G(["click"]);var Xt=(h,e,t)=>e()(r(t)),Zt=y("<option> </option>"),$t=y('<div class="fieldgroup svelte-1oyc7vz"><select></select></div>');function me(h,e){D(e,!0);let t=T(e,"onChange",3,()=>{}),a=p(()=>e.value);var l=$t(),o=_(l);o.__change=[Xt,t,a],Q(o,21,()=>e.options,w=>w.label,(w,N)=>{var x=Zt(),S=_(x,!0);v(x);var m={};M(()=>{F(S,r(N).label),m!==(m=r(N).value)&&(x.value=(x.__value=r(N).value)??"")}),f(w,x)}),v(o),v(l),ze(o,()=>r(a),w=>U(a,w)),f(h,l),L()}G(["change"]);const ea=(h,e,t)=>{e([...e(),{id:crypto.randomUUID(),attribute:"maxHP",type:"add",formula:"",reason:""}]),t.onChange(e())};var ta=(h,e,t)=>e(r(t)),aa=y('<div class="modifier svelte-1n17zba"><!> <!> <!> <!> <button title="Eliminar">🗑️</button></div>'),ra=y('<div class="empty svelte-1n17zba"><em>No hay modificadores disponibles</em></div>'),na=y('<div class="modifier-list svelte-1n17zba"><div class="header svelte-1n17zba"><label>Modificadores</label> <button title="Agregar Modificador">➕</button></div> <div class="content svelte-1n17zba"><div class="modifiers-header svelte-1n17zba"><label class="type">Tipo</label> <label class="field">Atributo</label> <label class="formula">Formula</label> <label class="label">Razón</label></div> <!></div></div>');function la(h,e){D(e,!0);let t=T(e,"modifiers",7);const a=S=>{t(t().filter(m=>m.id!==S.id)),e.onChange(t())};var l=na(),o=_(l),w=s(_(o),2);w.__click=[ea,t,e],v(o);var N=s(o,2),x=s(_(N),2);Q(x,17,t,S=>S.id,(S,m,b)=>{var E=aa(),c=_(E);me(c,{options:[{label:"Sumar",value:"add"},{label:"Establecer",value:"set"}],get value(){return r(m).type},onChange:P=>{r(m).type=P.toString(),e.onChange(t())}});var A=s(c,2);me(A,{options:[{label:"Salud Máxima",value:"maxHP"},{label:"Suerte Máxima",value:"maxLuck"},{label:"Esquiva",value:"evasion"},{label:"Mitigación",value:"mitigation"},{label:"Velocidad",value:"speed"}],get value(){return r(m).attribute},onChange:P=>{r(m).attribute=P.toString(),e.onChange(t())}});var i=s(A,2);H(i,{get value(){return r(m).formula},placeholder:"1+cuerpo",fullWidth:!0,onChange:P=>{r(m).formula=P.toString(),e.onChange(t())}});var g=s(i,2);H(g,{get value(){return r(m).formula},placeholder:"Razón",fullWidth:!0,onChange:P=>{r(m).reason=P.toString(),e.onChange(t())}});var C=s(g,2);C.__click=[ta,a,m],v(E),f(S,E)},S=>{var m=ra();f(S,m)}),v(N),v(l),f(h,l),L()}G(["click"]);var oa=y('<div class="general svelte-1hn03u3"><!></div>'),sa=y('<div class="modifiers svelte-1hn03u3"><!> <small class="available-variables svelte-1hn03u3"><em>Varaibles disponibles: cuerpo, reflejos, mente, instinto, presencia.</em></small></div>'),ia=y("<!> <!>",1);function da(h,e){D(e,!0);let t=T(e,"character",7);var a=ia(),l=te(a);j(l,{title:"General",children:(w,N)=>{var x=oa(),S=_(x);{let m=p(()=>t().img??"");H(S,{label:"URL del Retrato",get value(){return r(m)},fullWidth:!0,placeholder:"https://...",textAlign:"left",onChange:b=>{const E=b.toString();E.length>0?t().img=E:t().img=null,e.onChange(t())}})}v(x),f(w,x)},$$slots:{default:!0}});var o=s(l,2);j(o,{title:"Modificadores",children:(w,N)=>{var x=sa(),S=_(x);la(S,{get modifiers(){return t().modifiers},onChange:m=>{t().modifiers=m,e.onChange(t())}}),Re(2),v(x),f(w,x)},$$slots:{default:!0}}),f(h,a),L()}var ca=y("<button> </button>"),ua=y('<div class="character-sheet svelte-1dl9cdg"><div class="title"><!></div> <div class="tabs svelte-1dl9cdg"></div> <!></div>');function va(h,e){D(e,!0);let t=T(e,"character",7);const a=[{name:"general",title:"General",component:Nt,availableWhenReadOnly:!0},{name:"cards",title:"Cartas",component:Qe,availableWhenReadOnly:!0},{name:"bio",title:"Bio",component:Be,availableWhenReadOnly:!0},{name:"notes",title:"Notas",component:Ft,availableWhenReadOnly:!0},{name:"progress",title:"Progreso",component:Qt,availableWhenReadOnly:!0},{name:"economy",title:"Economía",component:ot,availableWhenReadOnly:!0},{name:"settings",title:"Configuración",component:da,availableWhenReadOnly:!1}];let l=p(()=>Math.max(a.findIndex(c=>c.name===e.currentTab),0)),o=p(()=>a.find(c=>c.name===e.currentTab)??a[0]);const w=c=>{const A=c.copy();e.onChange(A),t(A)},N=c=>{U(l,c),e.onTabChange(a[c].name)};var x=ua(),S=_(x),m=_(S);ke(m,{get value(){return t().name},get readonly(){return e.readonly},onChange:c=>{t().name=c,w(t())}}),v(S);var b=s(S,2);Q(b,23,()=>a,c=>c.title,(c,A,i)=>{var g=qe(),C=te(g);{var P=n=>{var d=ca();let u;d.__click=()=>N(r(i));var k=_(d,!0);v(d),M(R=>{u=J(d,1,"tab",null,u,R),F(k,r(A).title)},[()=>({selected:r(l)===r(i)})]),f(n,d)};z(C,n=>{(r(A).availableWhenReadOnly||!e.readonly)&&n(P)})}f(c,g)}),v(b);var E=s(b,2);He(E,()=>r(o).component,(c,A)=>{A(c,{get character(){return t()},get readonly(){return e.readonly},onChange:w})}),v(x),f(h,x),L()}G(["click"]);const ga=async(h,e,t)=>{const a=await e()();t(a)},ha=async(h,e,t)=>{const a=await e()();t(a)},ma=async(h,e,t)=>{r(e)&&await t()(r(e))},_a=async(h,e,t,a)=>{!r(e)||!confirm(`¿Quieres eliminar a ${r(e).name}?`)||(await t()(r(e)),U(e,void 0),a(null))},ba=async(h,e,t)=>{r(e)&&await t()(r(e))};var fa=y('<button title="Importar y Editar">📝</button>'),ya=y('<button title="Crear">➕</button> <button title="Importar">📥</button> <button title="Exportar">📤</button> <button title="Eliminar">🗑️</button>',1),Ca=(h,e,t)=>e(r(t)),ka=y('<img class="character-image svelte-kjfy12"/>'),Pa=y('<span class="image-placeholder svelte-kjfy12"> </span>'),xa=y('<button><!> <span class="name svelte-kjfy12"> </span></button>'),Aa=y('<section class="characters-page svelte-kjfy12"><div class="list svelte-kjfy12"><div class="header svelte-kjfy12"><!></div> <div class="content svelte-kjfy12"></div></div> <div class="viewport svelte-kjfy12"><!></div></section>');function Oa(h,e){D(e,!0);const t=()=>_e(e.characters,"$characters",a),[a,l]=be(),o="general";let w=T(e,"onAddToMyCharacters",3,()=>{throw new Error("onAddToMyCharacters not implemented")}),N=T(e,"onCreateCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),x=T(e,"onImportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),S=T(e,"onExportCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),m=T(e,"onDeleteCharacter",3,async()=>{throw new Error("onCreateCharacter not implemented")}),b=p(()=>K.url.searchParams.get("characterId")),E=p(()=>K.url.searchParams.get("tab")??o);const c=q=>{q!==null?(K.url.searchParams.set("characterId",q.id),K.url.searchParams.set("tab",o)):(K.url.searchParams.delete("characterId"),K.url.searchParams.delete("tab")),he(de(`?${K.url.searchParams.toString()}`))},A=q=>{K.url.searchParams.set("tab",q),he(de(`?${K.url.searchParams.toString()}`))};let i=p(()=>t().find(q=>q.id===r(b)));const g=q=>{e.characters.update(I=>{const W=I.findIndex(B=>B.id===q.id);if(W!==-1){const B=[...I];return B[W]=q,B}return I})};var C=Aa(),P=_(C),n=_(P),d=_(n);{var u=q=>{var I=fa();I.__click=[ba,i,w],M(()=>I.disabled=!r(i)),f(q,I)},k=q=>{var I=ya(),W=te(I);W.__click=[ga,N,c];var B=s(W,2);B.__click=[ha,x,c];var ae=s(B,2);ae.__click=[ma,i,S];var le=s(ae,2);le.__click=[_a,i,m,c],M(()=>{ae.disabled=!r(i),le.disabled=!r(i)}),f(q,I)};z(d,q=>{e.readonly?q(u):q(k,!1)})}v(n);var R=s(n,2);Q(R,5,t,q=>q.id,(q,I)=>{var W=xa();let B;W.__click=[Ca,c,I];var ae=_(W);{var le=Z=>{var ee=ka();M(()=>{$(ee,"src",r(I).img),$(ee,"alt",r(I).name)}),f(Z,ee)},Pe=Z=>{var ee=Pa(),Ae=_(ee,!0);v(ee),M(we=>F(Ae,we),[()=>r(I).name.charAt(0).toUpperCase()]),f(Z,ee)};z(ae,Z=>{r(I).img?Z(le):Z(Pe,!1)})}var se=s(ae,2),xe=_(se,!0);v(se),v(W),M(Z=>{B=J(W,1,"character-item svelte-kjfy12",null,B,Z),$(se,"title",r(I).name),F(xe,r(I).name)},[()=>({selected:r(b)===r(I).id})]),f(q,W)}),v(R),v(P);var O=s(P,2),X=_(O);{var V=q=>{va(q,{get character(){return r(i)},get readonly(){return e.readonly},onChange:g,get currentTab(){return r(E)},onTabChange:A})};z(X,q=>{r(i)&&q(V)})}v(O),v(C),f(h,C),L(),l()}G(["click"]);export{Oa as C,oe as a,Fa as u};
