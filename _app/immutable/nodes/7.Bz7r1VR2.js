import"../chunks/DsnmJJEf.js";import"../chunks/DYkEFMcb.js";import{a as S}from"../chunks/DDMpRfKd.js";import{p as j,d as k,j as x,k as F}from"../chunks/Cg1s0EoG.js";import{i as N}from"../chunks/9Ega0Btb.js";import{s as O,a as p}from"../chunks/MZe84WCl.js";import{g as T}from"../chunks/ChmArcVQ.js";import{r as P}from"../chunks/DODB3VtD.js";import{C as f,u as H}from"../chunks/DsW1QePW.js";import{C as c}from"../chunks/CyC3GOE6.js";import{u as q}from"../chunks/BL44n6jC.js";import{g as l}from"../chunks/CDyK6DUB.js";import{C as B}from"../chunks/CC2y7OC3.js";const G=()=>new f({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:c.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:c.BASE_MAX_ACTIVE_CARDS,version:1});function ae(y,b){j(b,!1);const h=()=>p(o,"$characters",i),C=()=>p(n,"$user",i),[i,g]=O();let{characters:o,loadCharacters:R,deleteCharacter:U}=q();const _=H(),{user:n,firebaseReady:m}=_,u=async()=>{if(l(m)){if(!l(n)){T(P("/"));return}await R()}},E=n.subscribe(async()=>await u()),$=m.subscribe(async e=>{e&&setTimeout(()=>{u()},c.NO_USER_REDIRECT_DELAY)});S(()=>{E(),$()});const v=async()=>{const e=G();return o.update(()=>[...h(),e]),e},D=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const s=r.files[0],t=new FileReader;t.onload=async a=>{const I=JSON.parse(a.target?.result),d=new f({...I,id:crypto.randomUUID()});o.update(L=>[...L,d]),e(d)},t.readAsText(s)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),w=async e=>{const r=e.getExportableData(),s=new Blob([JSON.stringify(r)],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`${e.name}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},A=async e=>{try{await U(e.id)}catch(r){console.error("Error deleting character:",r),o.update(s=>s.filter(t=>t.id!==e.id))}};N();{let e=F(()=>!C());B(y,{readonly:!1,get allActionsDisabled(){return x(e)},get characters(){return o},onCreateCharacter:v,onImportCharacter:D,onExportCharacter:w,onDeleteCharacter:A})}k(),g()}export{ae as component};
