import"../chunks/DsnmJJEf.js";import"../chunks/DuEWv733.js";import{a as S}from"../chunks/D_zjkKVN.js";import{p as j,d as k,j as F,k as N}from"../chunks/t0Cq7XZL.js";import{i as O}from"../chunks/CiH_d22C.js";import{s as T,a as d}from"../chunks/CuTJ2zLb.js";import{g as x}from"../chunks/DRXm3wfE.js";import{r as P}from"../chunks/D6W2gXA4.js";import{C as l,u as H}from"../chunks/F630LRhk.js";import{C as n}from"../chunks/BLLLuF8N.js";import{u as q}from"../chunks/DPEOgSum.js";import{g as p}from"../chunks/y52P6WVk.js";import{C as B}from"../chunks/BCvp4lBK.js";const G=()=>new l({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:n.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:n.BASE_MAX_ACTIVE_CARDS,version:1});function ae(f,y){j(y,!1);const h=()=>d(o,"$characters",c),C=()=>d(s,"$user",c),[c,b]=T();let{characters:o,loadCharacters:g,deleteCharacter:R}=q();const U=H(),{user:s,firebaseReady:i}=U,m=async()=>{if(p(i)){if(!p(s)){x(P("/"));return}await g()}},_=s.subscribe(async()=>await m()),$=i.subscribe(async e=>{e&&setTimeout(()=>{m()},n.NO_USER_REDIRECT_DELAY)});S(()=>{_(),$()});const v=async()=>{const e=G();return o.update(()=>[...h(),e]),e},E=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const a=r.files[0],t=new FileReader;t.onload=async D=>{const I=JSON.parse(D.target?.result),u=new l({...I,id:crypto.randomUUID()});o.update(L=>[...L,u]),e(u)},t.readAsText(a)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),w=async e=>{const r=new Blob([JSON.stringify(e)],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download=`${e.name}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},A=async e=>{try{await R(e.id)}catch(r){console.error("Error deleting character:",r),o.update(a=>a.filter(t=>t.id!==e.id))}};O();{let e=N(()=>!C());B(f,{readonly:!1,get allActionsDisabled(){return F(e)},get characters(){return o},onCreateCharacter:v,onImportCharacter:E,onExportCharacter:w,onDeleteCharacter:A})}k(),b()}export{ae as component};
