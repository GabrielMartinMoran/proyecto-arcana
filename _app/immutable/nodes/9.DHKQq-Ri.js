import"../chunks/DsnmJJEf.js";import{d as X,o as Y,a as Z,s as aa}from"../chunks/DDMpRfKd.js";import{p as ra,b as f,aa as N,g as O,t as D,a as c,d as ea,e as p,j as a,ab as T,F as t,r as m,c as J,f as M}from"../chunks/Cg1s0EoG.js";import{i as $,s as ta,a as sa}from"../chunks/MZe84WCl.js";import{g as U}from"../chunks/BpE9UHkb.js";import{r as oa}from"../chunks/Bk7atU9i.js";import{p as l}from"../chunks/CHlvO0V0.js";import{C as ia}from"../chunks/CPt7CevJ.js";import{u as ca}from"../chunks/CoCR_cx5.js";import{C as z,u as na}from"../chunks/CD4lfxyJ.js";const la=async(k,d,g)=>{if(!a(d))return;const _=JSON.parse(JSON.stringify(a(d))),u=new z({..._,id:crypto.randomUUID(),party:{partyId:null,ownerId:null}});g.update(b=>[...b,u]),U(oa(`/characters?characterId=${u.id}`))};var da=f('<div class="status svelte-1hit0hw">Cargando personaje...</div>'),ua=f('<div class="status error svelte-1hit0hw"> </div>'),va=f('<div class="sheet svelte-1hit0hw"><!></div>'),ha=f('<section class="shared-character-page svelte-1hit0hw"><div class="header svelte-1hit0hw"><h1>Personaje Compartido</h1> <div class="spacer svelte-1hit0hw"></div> <button>Importar a mis personajes</button></div> <!></section>');function Sa(k,d){ra(d,!0);const g=()=>sa(A,"$user",_),[_,u]=ta();let b=T(()=>l.params.userId),x=T(()=>l.params.characterId),B=T(()=>l.url.searchParams.get("tab")??"general");const q=r=>{l.url.searchParams.set("tab",r),U(`?${l.url.searchParams.toString()}`)},y=na(),{user:A}=y,{characters:E,loadCharacters:G}=ca();let v=N(!0),n=N(null),s=N(void 0),h=null;Y(async()=>{try{await y.initFirebase(),await G(),h=y.listenCharactersByIds([{userId:a(b),characterId:a(x)}],r=>{try{const e=(r||[]).find(I=>I.id===a(x));t(s,e?new z(e):void 0,!0),t(v,!1),t(n,a(s)?null:"No se encontró el personaje compartido.",!0)}catch{t(v,!1),t(n,"Ocurrió un error al cargar el personaje.")}})}catch{t(v,!1),t(n,"No se pudo inicializar los servicios.")}}),Z(()=>{if(h){try{h()}catch{}h=null}});var C=ha(),w=p(C),F=O(p(w),4);F.__click=[la,s,E],m(w);var H=O(w,2);{var K=r=>{var e=da();c(r,e)},L=r=>{var e=J(),I=M(e);{var Q=o=>{var i=ua(),S=p(i,!0);m(i),D(()=>aa(S,a(n))),c(o,i)},R=o=>{var i=J(),S=M(i);{var V=j=>{var P=va(),W=p(P);ia(W,{get character(){return a(s)},readonly:!0,onChange:()=>{},get currentTab(){return a(B)},onTabChange:q,allowPartyChange:!1}),m(P),c(j,P)};$(S,j=>{a(s)&&j(V)},!0)}c(o,i)};$(I,o=>{a(n)?o(Q):o(R,!1)},!0)}c(r,e)};$(H,r=>{a(v)?r(K):r(L,!1)})}m(C),D(()=>F.disabled=!g()||!a(s)),c(k,C),ea(),u()}X(["click"]);export{Sa as component};
