import"../chunks/DsnmJJEf.js";import{d as X,o as Y,a as Z,s as aa}from"../chunks/FRtchhGd.js";import{p as ra,b as f,aa as N,g as D,t as F,a as c,d as ea,e as p,h as a,ab as T,Q as t,r as m,c as J,f as M}from"../chunks/Cx9SZC40.js";import{i as $,s as ta,a as sa}from"../chunks/BQQjEHXb.js";import{g as U}from"../chunks/BU-tBLa1.js";import{r as oa}from"../chunks/B-cUA3C8.js";import{p as l}from"../chunks/CYBxATdP.js";import{C as ia}from"../chunks/CGTFqPjX.js";import{u as ca}from"../chunks/DCwzclUD.js";import{C as z,u as na}from"../chunks/DjO2gEHc.js";const la=async(k,d,g)=>{if(!a(d))return;const _=JSON.parse(JSON.stringify(a(d))),u=new z({..._,id:crypto.randomUUID(),party:{partyId:null,ownerId:null}});g.update(b=>[...b,u]),U(oa(`/characters?characterId=${u.id}`))};var da=f('<div class="status svelte-1hit0hw">Cargando personaje...</div>'),ua=f('<div class="status error svelte-1hit0hw"> </div>'),ha=f('<div class="sheet svelte-1hit0hw"><!></div>'),va=f('<section class="shared-character-page svelte-1hit0hw"><div class="header svelte-1hit0hw"><h1>Personaje Compartido</h1> <div class="spacer svelte-1hit0hw"></div> <button>Importar a mis personajes</button></div> <!></section>');function Sa(k,d){ra(d,!0);const g=()=>sa(q,"$user",_),[_,u]=ta();let b=T(()=>l.params.userId),x=T(()=>l.params.characterId),B=T(()=>l.url.searchParams.get("tab")??"general");const Q=r=>{l.url.searchParams.set("tab",r),U(`?${l.url.searchParams.toString()}`)},y=na(),{user:q}=y,{characters:A,loadCharacters:E}=ca();let h=N(!0),n=N(null),s=N(void 0),v=null;Y(async()=>{try{await y.initFirebase(),await E(),v=y.listenCharactersByIds([{userId:a(b),characterId:a(x)}],r=>{try{const e=(r||[]).find(I=>I.id===a(x));t(s,e?new z(e):void 0,!0),t(h,!1),t(n,a(s)?null:"No se encontró el personaje compartido.",!0)}catch{t(h,!1),t(n,"Ocurrió un error al cargar el personaje.")}})}catch{t(h,!1),t(n,"No se pudo inicializar los servicios.")}}),Z(()=>{if(v){try{v()}catch{}v=null}});var C=va(),w=p(C),O=D(p(w),4);O.__click=[la,s,A],m(w);var G=D(w,2);{var H=r=>{var e=da();c(r,e)},K=r=>{var e=J(),I=M(e);{var L=o=>{var i=ua(),S=p(i,!0);m(i),F(()=>aa(S,a(n))),c(o,i)},R=o=>{var i=J(),S=M(i);{var V=j=>{var P=ha(),W=p(P);ia(W,{get character(){return a(s)},readonly:!0,onChange:()=>{},get currentTab(){return a(B)},onTabChange:Q,allowPartyChange:!1}),m(P),c(j,P)};$(S,j=>{a(s)&&j(V)},!0)}c(o,i)};$(I,o=>{a(n)?o(L):o(R,!1)},!0)}c(r,e)};$(G,r=>{a(h)?r(H):r(K,!1)})}m(C),F(()=>O.disabled=!g()||!a(s)),c(k,C),ea(),u()}X(["click"]);export{Sa as component};
