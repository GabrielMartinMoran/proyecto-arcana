import"../chunks/DsnmJJEf.js";import"../chunks/DuEWv733.js";import{a as S}from"../chunks/D_zjkKVN.js";import{p as j,d as k,j as F,k as N}from"../chunks/t0Cq7XZL.js";import{i as O}from"../chunks/CiH_d22C.js";import{s as T,a as m}from"../chunks/CuTJ2zLb.js";import{g as x}from"../chunks/B_eVflCM.js";import{r as P}from"../chunks/BfoKIOzI.js";import{C as l,u as H}from"../chunks/F630LRhk.js";import{C as n}from"../chunks/BLLLuF8N.js";import{C as q,u as B}from"../chunks/U6-81Eul.js";import{g as p}from"../chunks/y52P6WVk.js";const G=()=>new l({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:n.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:n.BASE_MAX_ACTIVE_CARDS,version:1});function te(f,y){j(y,!1);const h=()=>m(s,"$characters",c),C=()=>m(o,"$user",c),[c,b]=T();let{characters:s,loadCharacters:g,deleteCharacter:R}=B();const U=H(),{user:o,firebaseReady:i}=U,u=async()=>{if(p(i)){if(!p(o)){x(P("/"));return}await g()}},_=o.subscribe(async()=>await u()),$=i.subscribe(async e=>{e&&setTimeout(()=>{u()},n.NO_USER_REDIRECT_DELAY)});S(()=>{_(),$()});const v=async()=>{const e=G();return s.update(()=>[...h(),e]),e},E=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const a=r.files[0],t=new FileReader;t.onload=async D=>{const I=JSON.parse(D.target?.result),d=new l({...I,id:crypto.randomUUID()});s.update(L=>[...L,d]),e(d)},t.readAsText(a)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),w=async e=>{const r=new Blob([JSON.stringify(e)],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download=`${e.name}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},A=async e=>{try{await R(e.id)}catch(r){console.error("Error deleting character:",r),s.update(a=>a.filter(t=>t.id!==e.id))}};O();{let e=N(()=>!C());q(f,{readonly:!1,get allActionsDisabled(){return F(e)},get characters(){return s},onCreateCharacter:v,onImportCharacter:E,onExportCharacter:w,onDeleteCharacter:A})}k(),b()}export{te as component};
