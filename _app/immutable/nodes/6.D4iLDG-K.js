import"../chunks/DsnmJJEf.js";import"../chunks/d2Dok1Vz.js";import{a as j}from"../chunks/DfNiT5Wx.js";import{p as k,d as F,i as N,j as O}from"../chunks/CXLGFl3I.js";import{i as T}from"../chunks/DZEc-YHI.js";import{s as x,a as d}from"../chunks/ta242qJX.js";import{g as P}from"../chunks/D01d1uBr.js";import{r as H}from"../chunks/DFLXd3-V.js";import{C as l,u as q}from"../chunks/kpi8fZtB.js";import{C as m}from"../chunks/BLWxwbCG.js";import{C as B,u as G}from"../chunks/z1w66Uij.js";import{g as p}from"../chunks/DnpldMJA.js";const J=()=>new l({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:m.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:m.BASE_MAX_ACTIVE_CARDS,version:1});function ae(f,y){k(y,!1);const h=()=>d(s,"$characters",n),C=()=>d(o,"$user",n),[n,b]=x(),g=500;let{characters:s,loadCharacters:R,deleteCharacter:U}=G();const _=q(),{user:o,firebaseReady:c}=_,i=async()=>{if(p(c)){if(!p(o)){P(H("/"));return}await R()}},$=o.subscribe(async()=>await i()),v=c.subscribe(async e=>{e&&setTimeout(()=>{i()},g)});j(()=>{$(),v()});const E=async()=>{const e=J();return s.update(()=>[...h(),e]),e},w=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const a=r.files[0],t=new FileReader;t.onload=async I=>{const L=JSON.parse(I.target?.result),u=new l({...L,id:crypto.randomUUID()});s.update(S=>[...S,u]),e(u)},t.readAsText(a)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),A=async e=>{const r=new Blob([JSON.stringify(e)],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download=`${e.name}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},D=async e=>{try{await U(e.id)}catch(r){console.error("Error deleting character:",r),s.update(a=>a.filter(t=>t.id!==e.id))}};T();{let e=O(()=>!C());B(f,{readonly:!1,get allActionsDisabled(){return N(e)},get characters(){return s},onCreateCharacter:E,onImportCharacter:w,onExportCharacter:A,onDeleteCharacter:D})}F(),b()}export{ae as component};
