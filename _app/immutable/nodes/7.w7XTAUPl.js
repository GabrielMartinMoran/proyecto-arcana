import"../chunks/DsnmJJEf.js";import"../chunks/D0fuGuPo.js";import{a as S}from"../chunks/CzhoJcdv.js";import{p as x,c as j,g as k,h as F}from"../chunks/DLXWS9Me.js";import{i as N}from"../chunks/DfGtoawc.js";import{s as O,a as p}from"../chunks/9-vBrUj_.js";import{g as T}from"../chunks/DqeTQttz.js";import{r as P}from"../chunks/DiZU9mbF.js";import{C as f,u as H}from"../chunks/B30fn5GU.js";import{C as c}from"../chunks/B_ycimPA.js";import{u as q}from"../chunks/BuyJ9dQ6.js";import{g as l}from"../chunks/0JtrQ17s.js";import{C as B}from"../chunks/DX0EWI4P.js";const G=()=>new f({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:c.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:c.BASE_MAX_ACTIVE_CARDS,version:1});function ae(y,b){x(b,!1);const h=()=>p(o,"$characters",i),C=()=>p(n,"$user",i),[i,g]=O();let{characters:o,loadCharacters:R,deleteCharacter:U}=q();const _=H(),{user:n,firebaseReady:m}=_,u=async()=>{if(l(m)){if(!l(n)){T(P("/"));return}await R()}},E=n.subscribe(async()=>await u()),$=m.subscribe(async e=>{e&&setTimeout(()=>{u()},c.NO_USER_REDIRECT_DELAY)});S(()=>{E(),$()});const v=async()=>{const e=G();return o.update(()=>[...h(),e]),e},D=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const s=r.files[0],t=new FileReader;t.onload=async a=>{const I=JSON.parse(a.target?.result),d=new f({...I,id:crypto.randomUUID()});o.update(L=>[...L,d]),e(d)},t.readAsText(s)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),w=async e=>{const r=e.getExportableData(),s=new Blob([JSON.stringify(r)],{type:"application/json"}),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`${e.name}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},A=async e=>{try{await U(e.id)}catch(r){console.error("Error deleting character:",r),o.update(s=>s.filter(t=>t.id!==e.id))}};N();{let e=F(()=>!C());B(y,{readonly:!1,get allActionsDisabled(){return k(e)},get characters(){return o},onCreateCharacter:v,onImportCharacter:D,onExportCharacter:w,onDeleteCharacter:A})}j(),g()}export{ae as component};
