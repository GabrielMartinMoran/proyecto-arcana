import"../chunks/DsnmJJEf.js";import{o as X,a as Y}from"../chunks/CzhoJcdv.js";import{aF as Z,p as aa,f,a2 as N,s as F,t as D,b as c,c as ra,d as p,g as a,aG as O,O as t,r as m,aH as J,a as M,e as ea}from"../chunks/DLXWS9Me.js";import{i as T}from"../chunks/sk9sCnVa.js";import{s as ta,a as sa}from"../chunks/9-vBrUj_.js";import{g as U}from"../chunks/z2voHXy0.js";import{r as oa}from"../chunks/BK70FVhP.js";import{p as l}from"../chunks/BEPhrcfZ.js";import{C as ia}from"../chunks/DkpkCuhO.js";import{u as ca}from"../chunks/DVbCL_PQ.js";import{C as z,u as na}from"../chunks/DDOa0yjM.js";const la=async($,d,g)=>{if(!a(d))return;const _=JSON.parse(JSON.stringify(a(d))),u=new z({..._,id:crypto.randomUUID(),party:{partyId:null,ownerId:null}});g.update(b=>[...b,u]),U(oa(`/characters?characterId=${u.id}`))};var da=f('<div class="status svelte-1hit0hw">Cargando personaje...</div>'),ua=f('<div class="status error svelte-1hit0hw"> </div>'),va=f('<div class="sheet svelte-1hit0hw"><!></div>'),ha=f('<section class="shared-character-page svelte-1hit0hw"><div class="header svelte-1hit0hw"><h1>Personaje Compartido</h1> <div class="spacer svelte-1hit0hw"></div> <button>Importar a mis personajes</button></div> <!></section>');function ja($,d){aa(d,!0);const g=()=>sa(H,"$user",_),[_,u]=ta();let b=O(()=>l.params.userId),k=O(()=>l.params.characterId),B=O(()=>l.url.searchParams.get("tab")??"general");const G=r=>{l.url.searchParams.set("tab",r),U(`?${l.url.searchParams.toString()}`)},y=na(),{user:H}=y,{characters:q,loadCharacters:A}=ca();let v=N(!0),n=N(null),s=N(void 0),h=null;X(async()=>{try{await y.initFirebase(),await A(),h=y.listenCharactersByIds([{userId:a(b),characterId:a(k)}],r=>{try{const e=(r||[]).find(I=>I.id===a(k));t(s,e?new z(e):void 0,!0),t(v,!1),t(n,a(s)?null:"No se encontró el personaje compartido.",!0)}catch{t(v,!1),t(n,"Ocurrió un error al cargar el personaje.")}})}catch{t(v,!1),t(n,"No se pudo inicializar los servicios.")}}),Y(()=>{if(h){try{h()}catch{}h=null}});var C=ha(),w=p(C),x=F(p(w),4);x.__click=[la,s,q],m(w);var E=F(w,2);{var K=r=>{var e=da();c(r,e)},L=r=>{var e=J(),I=M(e);{var Q=o=>{var i=ua(),S=p(i,!0);m(i),D(()=>ea(S,a(n))),c(o,i)},R=o=>{var i=J(),S=M(i);{var V=j=>{var P=va(),W=p(P);ia(W,{get character(){return a(s)},readonly:!0,onChange:()=>{},get currentTab(){return a(B)},onTabChange:G,allowPartyChange:!1}),m(P),c(j,P)};T(S,j=>{a(s)&&j(V)},!0)}c(o,i)};T(I,o=>{a(n)?o(Q):o(R,!1)},!0)}c(r,e)};T(E,r=>{a(v)?r(K):r(L,!1)})}m(C),D(()=>x.disabled=!g()||!a(s)),c($,C),ra(),u()}Z(["click"]);export{ja as component};
