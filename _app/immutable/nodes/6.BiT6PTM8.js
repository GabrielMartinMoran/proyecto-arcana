import"../chunks/DsnmJJEf.js";import"../chunks/COG_8PbO.js";import{a as k}from"../chunks/BogrDlyN.js";import{p as D,c as E,h as F,i as x}from"../chunks/Hn1PX6zW.js";import{i as N}from"../chunks/CJfzNrqp.js";import{s as O,a as d}from"../chunks/DFpaMj22.js";import{g as P}from"../chunks/CovAW-pG.js";import{r as T}from"../chunks/BRqfjyiD.js";import{C as l,u as H}from"../chunks/DqHZvFpo.js";import{C as m}from"../chunks/erSfHhUs.js";import{C as q,u as B}from"../chunks/BK9amNvV.js";import{g as p}from"../chunks/Cop9rsZ2.js";const G=()=>new l({id:crypto.randomUUID(),name:"Nuevo Personaje",attributes:{body:1,reflexes:1,mind:1,instinct:1,presence:1},cards:[],ppHistory:[],goldHistory:[],equipment:[],modifiers:[],currentHP:0,tempHP:0,currentLuck:m.STARTING_LUCK,img:null,story:"",notes:[],languages:"",quickInfo:"",attacks:[],maxActiveCards:m.BASE_MAX_ACTIVE_CARDS,version:1});function te(f,y){D(y,!1);const h=()=>d(s,"$characters",n),b=()=>d(o,"$user",n),[n,C]=O();let{characters:s,loadCharacters:g,deleteCharacter:U}=B();const $=H(),{user:o,firebaseReady:c}=$,i=async()=>{if(p(c)){if(!p(o)){P(T("/"));return}await g()}},v=o.subscribe(async()=>await i()),w=c.subscribe(async e=>{e&&setTimeout(()=>{i()},500)});k(()=>{v(),w()});const R=async()=>{const e=G();return s.update(()=>[...h(),e]),e},_=()=>new Promise(e=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async()=>{if(!r.files||r.files.length===0)return;const a=r.files[0],t=new FileReader;t.onload=async L=>{const S=JSON.parse(L.target?.result),u=new l({...S,id:crypto.randomUUID()});s.update(j=>[...j,u]),e(u)},t.readAsText(a)},document.body.appendChild(r),r.click(),document.body.removeChild(r)}),A=async e=>{const r=new Blob([JSON.stringify(e)],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download=`${e.name}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},I=async e=>{try{await U(e.id)}catch(r){console.error("Error deleting character:",r),s.update(a=>a.filter(t=>t.id!==e.id))}};N();{let e=x(()=>!b());q(f,{readonly:!1,get allActionsDisabled(){return F(e)},get characters(){return s},onCreateCharacter:R,onImportCharacter:_,onExportCharacter:A,onDeleteCharacter:I})}E(),C()}export{te as component};
